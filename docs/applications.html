<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Applications | Assignment 9: Auction</title>
  <meta name="description" content="Thie is a lecture note for ECON5630 at Hong Kong University of Science and Technology." />
  <meta name="generator" content="bookdown 0.28 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Applications | Assignment 9: Auction" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Thie is a lecture note for ECON5630 at Hong Kong University of Science and Technology." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Applications | Assignment 9: Auction" />
  
  <meta name="twitter:description" content="Thie is a lecture note for ECON5630 at Hong Kong University of Science and Technology." />
  

<meta name="author" content="Kohei Kawaguchi" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="auction.html"/>
<link rel="next" href="rcpp.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">ECON5630</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Syllabus</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#instructor-information"><i class="fa fa-check"></i><b>1.1</b> Instructor Information</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#general-information"><i class="fa fa-check"></i><b>1.2</b> General Information</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#class-time"><i class="fa fa-check"></i><b>1.2.1</b> Class Time</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#description"><i class="fa fa-check"></i><b>1.2.2</b> Description</a></li>
<li class="chapter" data-level="1.2.3" data-path="index.html"><a href="index.html#expectation-and-goals"><i class="fa fa-check"></i><b>1.2.3</b> Expectation and Goals</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#required-environment"><i class="fa fa-check"></i><b>1.3</b> Required Environment</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#evaluation"><i class="fa fa-check"></i><b>1.4</b> Evaluation</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#academic-integrity"><i class="fa fa-check"></i><b>1.5</b> Academic Integrity</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i><b>1.6</b> Schedule</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#course-materials"><i class="fa fa-check"></i><b>1.7</b> Course Materials</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="index.html"><a href="index.html#r-and-rstudio"><i class="fa fa-check"></i><b>1.7.1</b> R and RStudio</a></li>
<li class="chapter" data-level="1.7.2" data-path="index.html"><a href="index.html#handbook-chapters"><i class="fa fa-check"></i><b>1.7.2</b> Handbook Chapters</a></li>
<li class="chapter" data-level="1.7.3" data-path="index.html"><a href="index.html#books"><i class="fa fa-check"></i><b>1.7.3</b> Books</a></li>
<li class="chapter" data-level="1.7.4" data-path="index.html"><a href="index.html#papers"><i class="fa fa-check"></i><b>1.7.4</b> Papers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#structural-estimation-and-counterfactual-analysis"><i class="fa fa-check"></i><b>2.1</b> Structural Estimation and Counterfactual Analysis</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="intro.html"><a href="intro.html#example"><i class="fa fa-check"></i><b>2.1.1</b> Example</a></li>
<li class="chapter" data-level="2.1.2" data-path="intro.html"><a href="intro.html#recap"><i class="fa fa-check"></i><b>2.1.2</b> Recap</a></li>
<li class="chapter" data-level="2.1.3" data-path="intro.html"><a href="intro.html#historical-remark"><i class="fa fa-check"></i><b>2.1.3</b> Historical Remark</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#setting-up-the-environment"><i class="fa fa-check"></i><b>2.2</b> Setting Up The Environment</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="intro.html"><a href="intro.html#rstudio-project"><i class="fa fa-check"></i><b>2.2.1</b> RStudio Project</a></li>
<li class="chapter" data-level="2.2.2" data-path="intro.html"><a href="intro.html#basic-programming-in-r"><i class="fa fa-check"></i><b>2.2.2</b> Basic Programming in R</a></li>
<li class="chapter" data-level="2.2.3" data-path="intro.html"><a href="intro.html#reproducible-reports-using-rmarkdown"><i class="fa fa-check"></i><b>2.2.3</b> Reproducible Reports using Rmarkdown</a></li>
<li class="chapter" data-level="2.2.4" data-path="intro.html"><a href="intro.html#github-and-github-classroom"><i class="fa fa-check"></i><b>2.2.4</b> GitHub and GitHub Classroom</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="production.html"><a href="production.html"><i class="fa fa-check"></i><b>3</b> Production and Cost Function Estimation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="production.html"><a href="production.html#motivations"><i class="fa fa-check"></i><b>3.1</b> Motivations</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="production.html"><a href="production.html#io"><i class="fa fa-check"></i><b>3.1.1</b> IO</a></li>
<li class="chapter" data-level="3.1.2" data-path="production.html"><a href="production.html#development"><i class="fa fa-check"></i><b>3.1.2</b> Development</a></li>
<li class="chapter" data-level="3.1.3" data-path="production.html"><a href="production.html#trade"><i class="fa fa-check"></i><b>3.1.3</b> Trade</a></li>
<li class="chapter" data-level="3.1.4" data-path="production.html"><a href="production.html#management"><i class="fa fa-check"></i><b>3.1.4</b> Management</a></li>
<li class="chapter" data-level="3.1.5" data-path="production.html"><a href="production.html#education"><i class="fa fa-check"></i><b>3.1.5</b> Education</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="production.html"><a href="production.html#analyzing-producer-behaviors"><i class="fa fa-check"></i><b>3.2</b> Analyzing Producer Behaviors</a></li>
<li class="chapter" data-level="3.3" data-path="production.html"><a href="production.html#production-function-estimation"><i class="fa fa-check"></i><b>3.3</b> Production Function Estimation</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="production.html"><a href="production.html#cobb-douglas-specification-as-a-benchmark"><i class="fa fa-check"></i><b>3.3.1</b> Cobb-Douglas Specification as a Benchmark</a></li>
<li class="chapter" data-level="3.3.2" data-path="production.html"><a href="production.html#potential-bias-i-endogeneity"><i class="fa fa-check"></i><b>3.3.2</b> Potential Bias I: Endogeneity</a></li>
<li class="chapter" data-level="3.3.3" data-path="production.html"><a href="production.html#potential-bias-ii-selection"><i class="fa fa-check"></i><b>3.3.3</b> Potential Bias II: Selection</a></li>
<li class="chapter" data-level="3.3.4" data-path="production.html"><a href="production.html#how-to-resolve-endogeneity-bias"><i class="fa fa-check"></i><b>3.3.4</b> How to Resolve Endogeneity Bias?</a></li>
<li class="chapter" data-level="3.3.5" data-path="production.html"><a href="production.html#panel-data"><i class="fa fa-check"></i><b>3.3.5</b> Panel Data</a></li>
<li class="chapter" data-level="3.3.6" data-path="production.html"><a href="production.html#first-order-condition-for-inputs"><i class="fa fa-check"></i><b>3.3.6</b> First-Order Condition for Inputs</a></li>
<li class="chapter" data-level="3.3.7" data-path="production.html"><a href="production.html#productioniv"><i class="fa fa-check"></i><b>3.3.7</b> Instrumental Variable</a></li>
<li class="chapter" data-level="3.3.8" data-path="production.html"><a href="production.html#olley-pakes-approach"><i class="fa fa-check"></i><b>3.3.8</b> Olley-Pakes Approach</a></li>
<li class="chapter" data-level="3.3.9" data-path="production.html"><a href="production.html#assumption-i-information-set"><i class="fa fa-check"></i><b>3.3.9</b> Assumption I: Information Set</a></li>
<li class="chapter" data-level="3.3.10" data-path="production.html"><a href="production.html#assumption-ii-first-order-markov"><i class="fa fa-check"></i><b>3.3.10</b> Assumption II: First Order Markov</a></li>
<li class="chapter" data-level="3.3.11" data-path="production.html"><a href="production.html#assumption-iii-timing-of-input-choices"><i class="fa fa-check"></i><b>3.3.11</b> Assumption III: Timing of Input Choices</a></li>
<li class="chapter" data-level="3.3.12" data-path="production.html"><a href="production.html#assumption-iv-scalar-unobservable"><i class="fa fa-check"></i><b>3.3.12</b> Assumption IV: Scalar Unobservable</a></li>
<li class="chapter" data-level="3.3.13" data-path="production.html"><a href="production.html#assumption-iv-strict-monotonicity"><i class="fa fa-check"></i><b>3.3.13</b> Assumption IV: Strict Monotonicity</a></li>
<li class="chapter" data-level="3.3.14" data-path="production.html"><a href="production.html#two-step-approach-the-first-step"><i class="fa fa-check"></i><b>3.3.14</b> Two-step Approach: The First Step</a></li>
<li class="chapter" data-level="3.3.15" data-path="production.html"><a href="production.html#two-step-approach-the-second-step"><i class="fa fa-check"></i><b>3.3.15</b> Two-step Approach: The Second Step</a></li>
<li class="chapter" data-level="3.3.16" data-path="production.html"><a href="production.html#identification-of-the-anticipated-shocks"><i class="fa fa-check"></i><b>3.3.16</b> Identification of the Anticipated Shocks</a></li>
<li class="chapter" data-level="3.3.17" data-path="production.html"><a href="production.html#two-step-estimation-of-olley1996."><i class="fa fa-check"></i><b>3.3.17</b> Two-Step Estimation of <span class="citation">Olley &amp; Pakes (<span>1996</span>)</span>.</a></li>
<li class="chapter" data-level="3.3.18" data-path="production.html"><a href="production.html#from-an-economic-models-to-an-econometric-model"><i class="fa fa-check"></i><b>3.3.18</b> From An Economic Models to An Econometric Model</a></li>
<li class="chapter" data-level="3.3.19" data-path="production.html"><a href="production.html#how-to-resolve-selection-bias"><i class="fa fa-check"></i><b>3.3.19</b> How to Resolve Selection Bias</a></li>
<li class="chapter" data-level="3.3.20" data-path="production.html"><a href="production.html#correction-in-the-first-step"><i class="fa fa-check"></i><b>3.3.20</b> Correction in the First Step</a></li>
<li class="chapter" data-level="3.3.21" data-path="production.html"><a href="production.html#correction-in-the-second-step-i-the-source-of-bias"><i class="fa fa-check"></i><b>3.3.21</b> Correction in the Second Step I: The Source of Bias</a></li>
<li class="chapter" data-level="3.3.22" data-path="production.html"><a href="production.html#correction-in-the-second-step-ii-conditional-exit-probability"><i class="fa fa-check"></i><b>3.3.22</b> Correction in the Second Step II: Conditional Exit Probability</a></li>
<li class="chapter" data-level="3.3.23" data-path="production.html"><a href="production.html#correction-in-the-second-step-iii-invertibility-in-threshold"><i class="fa fa-check"></i><b>3.3.23</b> Correction in the Second Step III: Invertibility in Threshold</a></li>
<li class="chapter" data-level="3.3.24" data-path="production.html"><a href="production.html#correction-in-the-second-step-iv-controlling-the-threshold"><i class="fa fa-check"></i><b>3.3.24</b> Correction in the Second Step IV: Controlling the Threshold</a></li>
<li class="chapter" data-level="3.3.25" data-path="production.html"><a href="production.html#three-step-estimation-of-olley1996"><i class="fa fa-check"></i><b>3.3.25</b> Three Step Estimation of <span class="citation">Olley &amp; Pakes (<span>1996</span>)</span></a></li>
<li class="chapter" data-level="3.3.26" data-path="production.html"><a href="production.html#zero-investment-problem"><i class="fa fa-check"></i><b>3.3.26</b> Zero Investment Problem</a></li>
<li class="chapter" data-level="3.3.27" data-path="production.html"><a href="production.html#tackle-zero-investment-problem-i-discard-some-data"><i class="fa fa-check"></i><b>3.3.27</b> Tackle Zero Investment Problem I: Discard Some Data</a></li>
<li class="chapter" data-level="3.3.28" data-path="production.html"><a href="production.html#tackle-zero-investment-problem-ii-use-another-proxy"><i class="fa fa-check"></i><b>3.3.28</b> Tackle Zero Investment Problem II: Use Another Proxy</a></li>
<li class="chapter" data-level="3.3.29" data-path="production.html"><a href="production.html#one-step-estimation-of-olley1996-and-levinsohn2003"><i class="fa fa-check"></i><b>3.3.29</b> One-step Estimation of <span class="citation">Olley &amp; Pakes (<span>1996</span>)</span> and <span class="citation">Levinsohn &amp; Petrin (<span>2003</span>)</span></a></li>
<li class="chapter" data-level="3.3.30" data-path="production.html"><a href="production.html#scalar-unobservable-problem-finite-order-markov-process"><i class="fa fa-check"></i><b>3.3.30</b> Scalar Unobservable Problem: Finite-order Markov Process</a></li>
<li class="chapter" data-level="3.3.31" data-path="production.html"><a href="production.html#scalar-unobservable-problem-demand-and-productivity-shocks"><i class="fa fa-check"></i><b>3.3.31</b> Scalar Unobservable Problem: Demand and Productivity Shocks</a></li>
<li class="chapter" data-level="3.3.32" data-path="production.html"><a href="production.html#collinearity-problem"><i class="fa fa-check"></i><b>3.3.32</b> Collinearity Problem</a></li>
<li class="chapter" data-level="3.3.33" data-path="production.html"><a href="production.html#tackle-collinearity-problem-peculiar-assumptions"><i class="fa fa-check"></i><b>3.3.33</b> Tackle Collinearity Problem: Peculiar Assumptions</a></li>
<li class="chapter" data-level="3.3.34" data-path="production.html"><a href="production.html#tackle-collinearity-problem-share-regression"><i class="fa fa-check"></i><b>3.3.34</b> Tackle Collinearity Problem: Share Regression</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="production.html"><a href="production.html#cost-function-estimation"><i class="fa fa-check"></i><b>3.4</b> Cost Function Estimation</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="production.html"><a href="production.html#cost-function-duality"><i class="fa fa-check"></i><b>3.4.1</b> Cost Function: Duality</a></li>
<li class="chapter" data-level="3.4.2" data-path="production.html"><a href="production.html#translog-cost-function"><i class="fa fa-check"></i><b>3.4.2</b> Translog Cost Function</a></li>
<li class="chapter" data-level="3.4.3" data-path="production.html"><a href="production.html#translog-cost-function-integrability"><i class="fa fa-check"></i><b>3.4.3</b> Translog Cost Function: Integrability</a></li>
<li class="chapter" data-level="3.4.4" data-path="production.html"><a href="production.html#two-approaches"><i class="fa fa-check"></i><b>3.4.4</b> Two Approaches</a></li>
<li class="chapter" data-level="3.4.5" data-path="production.html"><a href="production.html#cost-data-approach"><i class="fa fa-check"></i><b>3.4.5</b> Cost Data Approach</a></li>
<li class="chapter" data-level="3.4.6" data-path="production.html"><a href="production.html#revealed-preference-approach"><i class="fa fa-check"></i><b>3.4.6</b> Revealed Preference Approach</a></li>
<li class="chapter" data-level="3.4.7" data-path="production.html"><a href="production.html#single-product-monopolist"><i class="fa fa-check"></i><b>3.4.7</b> Single-product Monopolist</a></li>
<li class="chapter" data-level="3.4.8" data-path="production.html"><a href="production.html#unobserved-heterogeneity-in-the-cost-function"><i class="fa fa-check"></i><b>3.4.8</b> Unobserved Heterogeneity in the Cost Function</a></li>
<li class="chapter" data-level="3.4.9" data-path="production.html"><a href="production.html#multi-product-monopolist-case"><i class="fa fa-check"></i><b>3.4.9</b> Multi-product Monopolist Case</a></li>
<li class="chapter" data-level="3.4.10" data-path="production.html"><a href="production.html#oligopoly"><i class="fa fa-check"></i><b>3.4.10</b> Oligopoly</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="demand.html"><a href="demand.html"><i class="fa fa-check"></i><b>4</b> Demand Function Estimation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="demand.html"><a href="demand.html#motivations-1"><i class="fa fa-check"></i><b>4.1</b> Motivations</a></li>
<li class="chapter" data-level="4.2" data-path="demand.html"><a href="demand.html#analyzing-consumer-behaviors"><i class="fa fa-check"></i><b>4.2</b> Analyzing Consumer Behaviors</a></li>
<li class="chapter" data-level="4.3" data-path="demand.html"><a href="demand.html#continuous-choice"><i class="fa fa-check"></i><b>4.3</b> Continuous Choice</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="demand.html"><a href="demand.html#duality-between-utility-and-expenditure-functions"><i class="fa fa-check"></i><b>4.3.1</b> Duality between Utility and Expenditure Functions</a></li>
<li class="chapter" data-level="4.3.2" data-path="demand.html"><a href="demand.html#deriving-other-functions"><i class="fa fa-check"></i><b>4.3.2</b> Deriving Other Functions</a></li>
<li class="chapter" data-level="4.3.3" data-path="demand.html"><a href="demand.html#starting-from-an-indirect-utility-function"><i class="fa fa-check"></i><b>4.3.3</b> Starting from an Indirect Utility Function</a></li>
<li class="chapter" data-level="4.3.4" data-path="demand.html"><a href="demand.html#expenditure-share-equation"><i class="fa fa-check"></i><b>4.3.4</b> Expenditure Share Equation</a></li>
<li class="chapter" data-level="4.3.5" data-path="demand.html"><a href="demand.html#almost-ideal-demand-system-aids"><i class="fa fa-check"></i><b>4.3.5</b> Almost Ideal Demand System (AIDS)</a></li>
<li class="chapter" data-level="4.3.6" data-path="demand.html"><a href="demand.html#piglog-class"><i class="fa fa-check"></i><b>4.3.6</b> PIGLOG Class</a></li>
<li class="chapter" data-level="4.3.7" data-path="demand.html"><a href="demand.html#derive-the-share-equation-i"><i class="fa fa-check"></i><b>4.3.7</b> Derive the Share Equation I</a></li>
<li class="chapter" data-level="4.3.8" data-path="demand.html"><a href="demand.html#derive-the-share-equation-ii"><i class="fa fa-check"></i><b>4.3.8</b> Derive the Share Equation II</a></li>
<li class="chapter" data-level="4.3.9" data-path="demand.html"><a href="demand.html#specify-the-detail-ii"><i class="fa fa-check"></i><b>4.3.9</b> Specify the Detail II</a></li>
<li class="chapter" data-level="4.3.10" data-path="demand.html"><a href="demand.html#estimation"><i class="fa fa-check"></i><b>4.3.10</b> Estimation</a></li>
<li class="chapter" data-level="4.3.11" data-path="demand.html"><a href="demand.html#from-product-space-approach-to-characteristics-space-approach"><i class="fa fa-check"></i><b>4.3.11</b> From Product Space Approach to Characteristics Space Approach</a></li>
<li class="chapter" data-level="4.3.12" data-path="demand.html"><a href="demand.html#from-continuous-choice-approach-to-discrete-choice-approach"><i class="fa fa-check"></i><b>4.3.12</b> From Continuous Choice Approach to Discrete Choice Approach</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="demand.html"><a href="demand.html#discrete-choice"><i class="fa fa-check"></i><b>4.4</b> Discrete Choice</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="demand.html"><a href="demand.html#discrete-choice-approach"><i class="fa fa-check"></i><b>4.4.1</b> Discrete Choice Approach</a></li>
<li class="chapter" data-level="4.4.2" data-path="demand.html"><a href="demand.html#discrete-choice-approach-1"><i class="fa fa-check"></i><b>4.4.2</b> Discrete Choice Approach</a></li>
<li class="chapter" data-level="4.4.3" data-path="demand.html"><a href="demand.html#discrete-choice-approach-2"><i class="fa fa-check"></i><b>4.4.3</b> Discrete Choice Approach</a></li>
<li class="chapter" data-level="4.4.4" data-path="demand.html"><a href="demand.html#characteristics-space-approach"><i class="fa fa-check"></i><b>4.4.4</b> Characteristics Space Approach</a></li>
<li class="chapter" data-level="4.4.5" data-path="demand.html"><a href="demand.html#weak-separability-and-income-effect"><i class="fa fa-check"></i><b>4.4.5</b> Weak Separability and Income Effect</a></li>
<li class="chapter" data-level="4.4.6" data-path="demand.html"><a href="demand.html#weak-separability-and-income-effect-1"><i class="fa fa-check"></i><b>4.4.6</b> Weak Separability and Income Effect</a></li>
<li class="chapter" data-level="4.4.7" data-path="demand.html"><a href="demand.html#utility-function-normalization"><i class="fa fa-check"></i><b>4.4.7</b> Utility Function Normalization</a></li>
<li class="chapter" data-level="4.4.8" data-path="demand.html"><a href="demand.html#aggregation-of-the-individual-demand"><i class="fa fa-check"></i><b>4.4.8</b> Aggregation of the Individual Demand</a></li>
<li class="chapter" data-level="4.4.9" data-path="demand.html"><a href="demand.html#horizontal-product-differentiation"><i class="fa fa-check"></i><b>4.4.9</b> Horizontal Product Differentiation</a></li>
<li class="chapter" data-level="4.4.10" data-path="demand.html"><a href="demand.html#horizontal-product-differentiation-1"><i class="fa fa-check"></i><b>4.4.10</b> Horizontal Product Differentiation</a></li>
<li class="chapter" data-level="4.4.11" data-path="demand.html"><a href="demand.html#vertical-product-differentiation"><i class="fa fa-check"></i><b>4.4.11</b> Vertical Product Differentiation</a></li>
<li class="chapter" data-level="4.4.12" data-path="demand.html"><a href="demand.html#vertical-product-differentiation-1"><i class="fa fa-check"></i><b>4.4.12</b> Vertical Product Differentiation</a></li>
<li class="chapter" data-level="4.4.13" data-path="demand.html"><a href="demand.html#econometric-models"><i class="fa fa-check"></i><b>4.4.13</b> Econometric Models</a></li>
<li class="chapter" data-level="4.4.14" data-path="demand.html"><a href="demand.html#multinomial-logit-model-preference-shock"><i class="fa fa-check"></i><b>4.4.14</b> Multinomial Logit Model: Preference Shock</a></li>
<li class="chapter" data-level="4.4.15" data-path="demand.html"><a href="demand.html#multinomial-logit-model-distributional-assumption"><i class="fa fa-check"></i><b>4.4.15</b> Multinomial Logit Model: Distributional Assumption</a></li>
<li class="chapter" data-level="4.4.16" data-path="demand.html"><a href="demand.html#multinomial-logit-model-choice-probability"><i class="fa fa-check"></i><b>4.4.16</b> Multinomial Logit Model: Choice Probability</a></li>
<li class="chapter" data-level="4.4.17" data-path="demand.html"><a href="demand.html#multinomial-logit-model-inclusive-value"><i class="fa fa-check"></i><b>4.4.17</b> Multinomial Logit Model: Inclusive Value</a></li>
<li class="chapter" data-level="4.4.18" data-path="demand.html"><a href="demand.html#maximum-likelihood-estimation-of-multinomial-logit-model"><i class="fa fa-check"></i><b>4.4.18</b> Maximum Likelihood Estimation of Multinomial Logit Model</a></li>
<li class="chapter" data-level="4.4.19" data-path="demand.html"><a href="demand.html#nonlinear-least-square-estimation-of-multinomial-logit-model"><i class="fa fa-check"></i><b>4.4.19</b> Nonlinear Least Square Estimation of Multinomial Logit Model</a></li>
<li class="chapter" data-level="4.4.20" data-path="demand.html"><a href="demand.html#iia-problem"><i class="fa fa-check"></i><b>4.4.20</b> IIA Problem</a></li>
<li class="chapter" data-level="4.4.21" data-path="demand.html"><a href="demand.html#blue-bus-and-red-bus-problem"><i class="fa fa-check"></i><b>4.4.21</b> Blue Bus and Red Bus Problem</a></li>
<li class="chapter" data-level="4.4.22" data-path="demand.html"><a href="demand.html#restrictive-price-elasticity"><i class="fa fa-check"></i><b>4.4.22</b> Restrictive Price Elasticity</a></li>
<li class="chapter" data-level="4.4.23" data-path="demand.html"><a href="demand.html#monotonic-inclusive-value"><i class="fa fa-check"></i><b>4.4.23</b> Monotonic Inclusive Value</a></li>
<li class="chapter" data-level="4.4.24" data-path="demand.html"><a href="demand.html#the-source-of-the-problem"><i class="fa fa-check"></i><b>4.4.24</b> The Source of the Problem</a></li>
<li class="chapter" data-level="4.4.25" data-path="demand.html"><a href="demand.html#correlation-in-preference-shocks"><i class="fa fa-check"></i><b>4.4.25</b> Correlation in Preference Shocks</a></li>
<li class="chapter" data-level="4.4.26" data-path="demand.html"><a href="demand.html#observed-and-unobserved-consumer-heterogeneity"><i class="fa fa-check"></i><b>4.4.26</b> Observed and Unobserved Consumer Heterogeneity</a></li>
<li class="chapter" data-level="4.4.27" data-path="demand.html"><a href="demand.html#mixed-logit-model"><i class="fa fa-check"></i><b>4.4.27</b> Mixed Logit Model</a></li>
<li class="chapter" data-level="4.4.28" data-path="demand.html"><a href="demand.html#mixed-logit-model-parametric-assumptions"><i class="fa fa-check"></i><b>4.4.28</b> Mixed Logit Model : Parametric Assumptions</a></li>
<li class="chapter" data-level="4.4.29" data-path="demand.html"><a href="demand.html#mixed-logit-model-iia"><i class="fa fa-check"></i><b>4.4.29</b> Mixed Logit Model: IIA</a></li>
<li class="chapter" data-level="4.4.30" data-path="demand.html"><a href="demand.html#mixed-logit-moel-price-elasticities"><i class="fa fa-check"></i><b>4.4.30</b> Mixed Logit Moel: Price Elasticities</a></li>
<li class="chapter" data-level="4.4.31" data-path="demand.html"><a href="demand.html#simulated-maximum-likelihood-estimation-of-the-mixed-logit-model"><i class="fa fa-check"></i><b>4.4.31</b> Simulated Maximum Likelihood Estimation of the Mixed Logit Model</a></li>
<li class="chapter" data-level="4.4.32" data-path="demand.html"><a href="demand.html#simulated-maximum-likelihood-estimation-of-the-mixed-logit-model-1"><i class="fa fa-check"></i><b>4.4.32</b> Simulated Maximum Likelihood Estimation of the Mixed Logit Model</a></li>
<li class="chapter" data-level="4.4.33" data-path="demand.html"><a href="demand.html#simulated-non-linear-least-square-estimation-of-the-mixed-logit-model"><i class="fa fa-check"></i><b>4.4.33</b> Simulated Non-linear Least Square Estimation of the Mixed Logit Model</a></li>
<li class="chapter" data-level="4.4.34" data-path="demand.html"><a href="demand.html#nested-logit-model-a-special-case-of-mixed-logit-model"><i class="fa fa-check"></i><b>4.4.34</b> Nested Logit Model: A Special Case of Mixed Logit Model</a></li>
<li class="chapter" data-level="4.4.35" data-path="demand.html"><a href="demand.html#nested-logit-model-distributional-assumption"><i class="fa fa-check"></i><b>4.4.35</b> Nested Logit Model: Distributional Assumption</a></li>
<li class="chapter" data-level="4.4.36" data-path="demand.html"><a href="demand.html#nested-logit-model-choice-probability"><i class="fa fa-check"></i><b>4.4.36</b> Nested Logit Model: Choice Probability</a></li>
<li class="chapter" data-level="4.4.37" data-path="demand.html"><a href="demand.html#nested-logit-model-decomposition-of-the-choice-probability"><i class="fa fa-check"></i><b>4.4.37</b> Nested Logit Model: Decomposition of the Choice Probability</a></li>
<li class="chapter" data-level="4.4.38" data-path="demand.html"><a href="demand.html#discrete-choice-model-with-unobserved-fixed-effects"><i class="fa fa-check"></i><b>4.4.38</b> Discrete Choice Model with Unobserved Fixed Effects</a></li>
<li class="chapter" data-level="4.4.39" data-path="demand.html"><a href="demand.html#unobserved-fixed-effects-in-multinomial-logit-model"><i class="fa fa-check"></i><b>4.4.39</b> Unobserved Fixed Effects in Multinomial Logit Model</a></li>
<li class="chapter" data-level="4.4.40" data-path="demand.html"><a href="demand.html#instrumental-variables-and-inversion"><i class="fa fa-check"></i><b>4.4.40</b> Instrumental Variables and Inversion</a></li>
<li class="chapter" data-level="4.4.41" data-path="demand.html"><a href="demand.html#inversion-in-multinomial-logit-model"><i class="fa fa-check"></i><b>4.4.41</b> Inversion in Multinomial Logit Model</a></li>
<li class="chapter" data-level="4.4.42" data-path="demand.html"><a href="demand.html#market-invariant-product-specific-fixed-effects"><i class="fa fa-check"></i><b>4.4.42</b> Market-invariant Product-specific Fixed Effects</a></li>
<li class="chapter" data-level="4.4.43" data-path="demand.html"><a href="demand.html#unobserved-consumer-heterogeneity-and-unobserved-fixed-effects-in-mixed-logit-model"><i class="fa fa-check"></i><b>4.4.43</b> Unobserved Consumer Heterogeneity and Unobserved Fixed Effects in Mixed-logit Model</a></li>
<li class="chapter" data-level="4.4.44" data-path="demand.html"><a href="demand.html#unobserved-fixed-effects-in-mixed-logit-model"><i class="fa fa-check"></i><b>4.4.44</b> Unobserved Fixed Effects in Mixed-logit Model</a></li>
<li class="chapter" data-level="4.4.45" data-path="demand.html"><a href="demand.html#representing-xi_jt-as-a-function-of-parameters-of-interest"><i class="fa fa-check"></i><b>4.4.45</b> Representing <span class="math inline">\(\xi_{jt}\)</span> as a Function of Parameters of Interest</a></li>
<li class="chapter" data-level="4.4.46" data-path="demand.html"><a href="demand.html#summarizing-the-conditional-mean-term"><i class="fa fa-check"></i><b>4.4.46</b> Summarizing the Conditional Mean Term</a></li>
<li class="chapter" data-level="4.4.47" data-path="demand.html"><a href="demand.html#contraction-mapping-for-delta_t."><i class="fa fa-check"></i><b>4.4.47</b> Contraction Mapping for <span class="math inline">\(\delta_t\)</span>.</a></li>
<li class="chapter" data-level="4.4.48" data-path="demand.html"><a href="demand.html#solving-for-xi_jttheta"><i class="fa fa-check"></i><b>4.4.48</b> Solving for <span class="math inline">\(\xi_{jt}(\theta)\)</span></a></li>
<li class="chapter" data-level="4.4.49" data-path="demand.html"><a href="demand.html#solving-for-xi_jttheta-summary"><i class="fa fa-check"></i><b>4.4.49</b> Solving for <span class="math inline">\(\xi_{jt}(\theta)\)</span>: Summary</a></li>
<li class="chapter" data-level="4.4.50" data-path="demand.html"><a href="demand.html#gmm-objective-function"><i class="fa fa-check"></i><b>4.4.50</b> GMM Objective Function</a></li>
<li class="chapter" data-level="4.4.51" data-path="demand.html"><a href="demand.html#estimating-linear-parameters"><i class="fa fa-check"></i><b>4.4.51</b> Estimating Linear Parameters</a></li>
<li class="chapter" data-level="4.4.52" data-path="demand.html"><a href="demand.html#blp-algorithm"><i class="fa fa-check"></i><b>4.4.52</b> BLP Algorithm</a></li>
<li class="chapter" data-level="4.4.53" data-path="demand.html"><a href="demand.html#mathematical-program-with-equilibrium-constraints-mpec"><i class="fa fa-check"></i><b>4.4.53</b> Mathematical Program with Equilibrium Constraints (MPEC)</a></li>
<li class="chapter" data-level="4.4.54" data-path="demand.html"><a href="demand.html#instrumental-variables"><i class="fa fa-check"></i><b>4.4.54</b> Instrumental Variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="merger.html"><a href="merger.html"><i class="fa fa-check"></i><b>5</b> Merger Analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="merger.html"><a href="merger.html#motivations-2"><i class="fa fa-check"></i><b>5.1</b> Motivations</a></li>
<li class="chapter" data-level="5.2" data-path="merger.html"><a href="merger.html#identification-of-conduct"><i class="fa fa-check"></i><b>5.2</b> Identification of Conduct</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="merger.html"><a href="merger.html#identification-of-conduct-1"><i class="fa fa-check"></i><b>5.2.1</b> Identification of Conduct</a></li>
<li class="chapter" data-level="5.2.2" data-path="merger.html"><a href="merger.html#marginal-revenue-function"><i class="fa fa-check"></i><b>5.2.2</b> Marginal Revenue Function</a></li>
<li class="chapter" data-level="5.2.3" data-path="merger.html"><a href="merger.html#first-order-condition"><i class="fa fa-check"></i><b>5.2.3</b> First-Order Condition</a></li>
<li class="chapter" data-level="5.2.4" data-path="merger.html"><a href="merger.html#linear-model"><i class="fa fa-check"></i><b>5.2.4</b> Linear Model</a></li>
<li class="chapter" data-level="5.2.5" data-path="merger.html"><a href="merger.html#pricing-equation"><i class="fa fa-check"></i><b>5.2.5</b> Pricing Equation</a></li>
<li class="chapter" data-level="5.2.6" data-path="merger.html"><a href="merger.html#identification-of-inverse-demand-function-and-pricing-equation"><i class="fa fa-check"></i><b>5.2.6</b> Identification of Inverse Demand Function and Pricing Equation</a></li>
<li class="chapter" data-level="5.2.7" data-path="merger.html"><a href="merger.html#the-conduct-parameter-is-unidentified"><i class="fa fa-check"></i><b>5.2.7</b> The Conduct Parameter is Unidentified</a></li>
<li class="chapter" data-level="5.2.8" data-path="merger.html"><a href="merger.html#identification-of-the-conduct-parameter-when-cost-data-is-available"><i class="fa fa-check"></i><b>5.2.8</b> Identification of the Conduct Parameter: When Cost Data is Available</a></li>
<li class="chapter" data-level="5.2.9" data-path="merger.html"><a href="merger.html#identification-of-the-conduct-parameter-when-cost-data-is-not-available"><i class="fa fa-check"></i><b>5.2.9</b> Identification of the Conduct Parameter: When Cost Data is Not Available</a></li>
<li class="chapter" data-level="5.2.10" data-path="merger.html"><a href="merger.html#identification-of-the-conduct-parameter-demand-rotater-is-available"><i class="fa fa-check"></i><b>5.2.10</b> Identification of the Conduct Parameter: Demand Rotater is Available</a></li>
<li class="chapter" data-level="5.2.11" data-path="merger.html"><a href="merger.html#identification-of-conduct-in-differentiated-product-market"><i class="fa fa-check"></i><b>5.2.11</b> Identification of Conduct in Differentiated Product Market</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="merger.html"><a href="merger.html#merger-simulation"><i class="fa fa-check"></i><b>5.3</b> Merger Simulation</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="merger.html"><a href="merger.html#unilateral-and-coordinated-effects-of-a-horizontal-merger"><i class="fa fa-check"></i><b>5.3.1</b> Unilateral and Coordinated Effects of a Horizontal Merger</a></li>
<li class="chapter" data-level="5.3.2" data-path="merger.html"><a href="merger.html#merger-simulation-1"><i class="fa fa-check"></i><b>5.3.2</b> Merger Simulation</a></li>
<li class="chapter" data-level="5.3.3" data-path="merger.html"><a href="merger.html#quantifying-the-unilateral-effect"><i class="fa fa-check"></i><b>5.3.3</b> Quantifying the Unilateral Effect</a></li>
<li class="chapter" data-level="5.3.4" data-path="merger.html"><a href="merger.html#pre-merger-equilibrium"><i class="fa fa-check"></i><b>5.3.4</b> Pre-Merger Equilibrium</a></li>
<li class="chapter" data-level="5.3.5" data-path="merger.html"><a href="merger.html#post-merger-equilibrium"><i class="fa fa-check"></i><b>5.3.5</b> Post-Merger Equilibrium</a></li>
<li class="chapter" data-level="5.3.6" data-path="merger.html"><a href="merger.html#consumer-surplus"><i class="fa fa-check"></i><b>5.3.6</b> Consumer Surplus</a></li>
<li class="chapter" data-level="5.3.7" data-path="merger.html"><a href="merger.html#quantifying-the-coordinated-effect"><i class="fa fa-check"></i><b>5.3.7</b> Quantifying the Coordinated Effect</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="entryexit.html"><a href="entryexit.html"><i class="fa fa-check"></i><b>6</b> Entry and Exit</a>
<ul>
<li class="chapter" data-level="6.1" data-path="entryexit.html"><a href="entryexit.html#motivations-3"><i class="fa fa-check"></i><b>6.1</b> Motivations</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="entryexit.html"><a href="entryexit.html#entry-cost-mode-of-competition-and-market-structure"><i class="fa fa-check"></i><b>6.1.1</b> Entry Cost, Mode of Competition, and Market Structure</a></li>
<li class="chapter" data-level="6.1.2" data-path="entryexit.html"><a href="entryexit.html#exogenous-and-endogenous-entry-cost"><i class="fa fa-check"></i><b>6.1.2</b> Exogenous and Endogenous Entry Cost</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="entryexit.html"><a href="entryexit.html#monopoly-entry"><i class="fa fa-check"></i><b>6.2</b> Monopoly Entry</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="entryexit.html"><a href="entryexit.html#variable-profits-and-fixed-costs"><i class="fa fa-check"></i><b>6.2.1</b> Variable Profits and Fixed Costs</a></li>
<li class="chapter" data-level="6.2.2" data-path="entryexit.html"><a href="entryexit.html#non-identification"><i class="fa fa-check"></i><b>6.2.2</b> Non-Identification</a></li>
<li class="chapter" data-level="6.2.3" data-path="entryexit.html"><a href="entryexit.html#restrictions-for-identification."><i class="fa fa-check"></i><b>6.2.3</b> Restrictions for Identification.</a></li>
<li class="chapter" data-level="6.2.4" data-path="entryexit.html"><a href="entryexit.html#homogeneous-of-degree-1-variable-profits"><i class="fa fa-check"></i><b>6.2.4</b> Homogeneous of Degree 1 Variable Profits</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="entryexit.html"><a href="entryexit.html#complete-information-homogeneous-oligopoly-entry"><i class="fa fa-check"></i><b>6.3</b> Complete-Information Homogeneous Oligopoly Entry</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="entryexit.html"><a href="entryexit.html#variable-and-fixed-costs"><i class="fa fa-check"></i><b>6.3.1</b> Variable and Fixed Costs</a></li>
<li class="chapter" data-level="6.3.2" data-path="entryexit.html"><a href="entryexit.html#equilibrium-condition"><i class="fa fa-check"></i><b>6.3.2</b> Equilibrium Condition</a></li>
<li class="chapter" data-level="6.3.3" data-path="entryexit.html"><a href="entryexit.html#identification-under-a-shape-restriction"><i class="fa fa-check"></i><b>6.3.3</b> Identification under a Shape Restriction</a></li>
<li class="chapter" data-level="6.3.4" data-path="entryexit.html"><a href="entryexit.html#log-likelihood-function"><i class="fa fa-check"></i><b>6.3.4</b> Log Likelihood Function</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="entryexit.html"><a href="entryexit.html#complete-information-heterogeneous-oligopoly-entry"><i class="fa fa-check"></i><b>6.4</b> Complete-Information Heterogeneous Oligopoly Entry</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="entryexit.html"><a href="entryexit.html#bivartiate-game-with-heterogeneous-profits"><i class="fa fa-check"></i><b>6.4.1</b> Bivartiate Game with Heterogeneous Profits</a></li>
<li class="chapter" data-level="6.4.2" data-path="entryexit.html"><a href="entryexit.html#sampling-assumption-and-observations"><i class="fa fa-check"></i><b>6.4.2</b> Sampling Assumption and Observations</a></li>
<li class="chapter" data-level="6.4.3" data-path="entryexit.html"><a href="entryexit.html#identification-assuming-pure-strategy-equilibrium"><i class="fa fa-check"></i><b>6.4.3</b> Identification Assuming Pure-Strategy Equilibrium</a></li>
<li class="chapter" data-level="6.4.4" data-path="entryexit.html"><a href="entryexit.html#heterogeneous-independent-fixed-costs"><i class="fa fa-check"></i><b>6.4.4</b> Heterogeneous Independent Fixed Costs</a></li>
<li class="chapter" data-level="6.4.5" data-path="entryexit.html"><a href="entryexit.html#heterogenous-and-market-level-correlated-fixed-costs"><i class="fa fa-check"></i><b>6.4.5</b> Heterogenous and Market-Level Correlated Fixed Costs</a></li>
<li class="chapter" data-level="6.4.6" data-path="entryexit.html"><a href="entryexit.html#inference-based-on-a-unique-prediction"><i class="fa fa-check"></i><b>6.4.6</b> Inference Based On a Unique Prediction</a></li>
<li class="chapter" data-level="6.4.7" data-path="entryexit.html"><a href="entryexit.html#entry-in-the-airline-industry-one-shot-game"><i class="fa fa-check"></i><b>6.4.7</b> Entry in the Airline Industry: One-shot Game</a></li>
<li class="chapter" data-level="6.4.8" data-path="entryexit.html"><a href="entryexit.html#entry-in-the-airline-industry-profit-function"><i class="fa fa-check"></i><b>6.4.8</b> Entry in the Airline Industry: Profit Function</a></li>
<li class="chapter" data-level="6.4.9" data-path="entryexit.html"><a href="entryexit.html#entry-in-the-airline-industry-profit-function-1"><i class="fa fa-check"></i><b>6.4.9</b> Entry in the Airline Industry: Profit Function</a></li>
<li class="chapter" data-level="6.4.10" data-path="entryexit.html"><a href="entryexit.html#entry-in-the-airline-industry-likelihood-function"><i class="fa fa-check"></i><b>6.4.10</b> Entry in the Airline Industry: Likelihood Function</a></li>
<li class="chapter" data-level="6.4.11" data-path="entryexit.html"><a href="entryexit.html#is-the-equilibrium-number-of-firms-unique"><i class="fa fa-check"></i><b>6.4.11</b> Is the Equilibrium Number of Firms Unique?</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="entryexit.html"><a href="entryexit.html#multiple-prediction"><i class="fa fa-check"></i><b>6.5</b> Multiple Prediction</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="entryexit.html"><a href="entryexit.html#multiple-equilibria-in-bivariate-game-with-heterogenous-profits"><i class="fa fa-check"></i><b>6.5.1</b> Multiple Equilibria in Bivariate Game with Heterogenous Profits</a></li>
<li class="chapter" data-level="6.5.2" data-path="entryexit.html"><a href="entryexit.html#multiple-prediction-in-bivariate-game-with-heterogenous-profits"><i class="fa fa-check"></i><b>6.5.2</b> Multiple Prediction in Bivariate Game with Heterogenous Profits</a></li>
<li class="chapter" data-level="6.5.3" data-path="entryexit.html"><a href="entryexit.html#inference-based-on-moment-inequalities"><i class="fa fa-check"></i><b>6.5.3</b> Inference Based on Moment Inequalities</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="entryexit.html"><a href="entryexit.html#incompelete-information-heterogenous-oligopoly-entry"><i class="fa fa-check"></i><b>6.6</b> Incompelete-Information Heterogenous Oligopoly Entry</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="entryexit.html"><a href="entryexit.html#bivariate-case"><i class="fa fa-check"></i><b>6.6.1</b> Bivariate Case</a></li>
<li class="chapter" data-level="6.6.2" data-path="entryexit.html"><a href="entryexit.html#the-equilibrium-strategy-and-belief"><i class="fa fa-check"></i><b>6.6.2</b> The Equilibrium Strategy and Belief</a></li>
<li class="chapter" data-level="6.6.3" data-path="entryexit.html"><a href="entryexit.html#equilibrium-selection-and-likelihood"><i class="fa fa-check"></i><b>6.6.3</b> Equilibrium Selection and Likelihood</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="dynamics.html"><a href="dynamics.html"><i class="fa fa-check"></i><b>7</b> Dynamic Decision Model</a>
<ul>
<li class="chapter" data-level="7.1" data-path="dynamics.html"><a href="dynamics.html#motivations-4"><i class="fa fa-check"></i><b>7.1</b> Motivations</a></li>
<li class="chapter" data-level="7.2" data-path="dynamics.html"><a href="dynamics.html#single-agent-model"><i class="fa fa-check"></i><b>7.2</b> Single-Agent Model</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="dynamics.html"><a href="dynamics.html#setting"><i class="fa fa-check"></i><b>7.2.1</b> Setting</a></li>
<li class="chapter" data-level="7.2.2" data-path="dynamics.html"><a href="dynamics.html#timing-of-the-model"><i class="fa fa-check"></i><b>7.2.2</b> Timing of the Model</a></li>
<li class="chapter" data-level="7.2.3" data-path="dynamics.html"><a href="dynamics.html#period-payoff"><i class="fa fa-check"></i><b>7.2.3</b> Period Payoff</a></li>
<li class="chapter" data-level="7.2.4" data-path="dynamics.html"><a href="dynamics.html#markovian-framework"><i class="fa fa-check"></i><b>7.2.4</b> Markovian Framework</a></li>
<li class="chapter" data-level="7.2.5" data-path="dynamics.html"><a href="dynamics.html#belief"><i class="fa fa-check"></i><b>7.2.5</b> Belief</a></li>
<li class="chapter" data-level="7.2.6" data-path="dynamics.html"><a href="dynamics.html#decision-problem"><i class="fa fa-check"></i><b>7.2.6</b> Decision Problem</a></li>
<li class="chapter" data-level="7.2.7" data-path="dynamics.html"><a href="dynamics.html#value-function-and-ex-ante-value-function"><i class="fa fa-check"></i><b>7.2.7</b> Value Function and Ex-ante Value Function</a></li>
<li class="chapter" data-level="7.2.8" data-path="dynamics.html"><a href="dynamics.html#choice-specific-value-function"><i class="fa fa-check"></i><b>7.2.8</b> Choice-specific Value Function</a></li>
<li class="chapter" data-level="7.2.9" data-path="dynamics.html"><a href="dynamics.html#optimality-condition"><i class="fa fa-check"></i><b>7.2.9</b> Optimality Condition</a></li>
<li class="chapter" data-level="7.2.10" data-path="dynamics.html"><a href="dynamics.html#optimal-conditional-choice-probability"><i class="fa fa-check"></i><b>7.2.10</b> Optimal Conditional Choice Probability</a></li>
<li class="chapter" data-level="7.2.11" data-path="dynamics.html"><a href="dynamics.html#optimality-condition-1"><i class="fa fa-check"></i><b>7.2.11</b> Optimality Condition</a></li>
<li class="chapter" data-level="7.2.12" data-path="dynamics.html"><a href="dynamics.html#mapping-from-a-conditional-choice-probability-to-an-ex-ante-value-function"><i class="fa fa-check"></i><b>7.2.12</b> Mapping from a Conditional Choice Probability to an Ex-ante Value Function</a></li>
<li class="chapter" data-level="7.2.13" data-path="dynamics.html"><a href="dynamics.html#mapping-from-an-ex-ante-value-function-to-an-optimal-conditional-choice-probability"><i class="fa fa-check"></i><b>7.2.13</b> Mapping from an Ex-ante Value Function to an Optimal Conditional Choice Probability</a></li>
<li class="chapter" data-level="7.2.14" data-path="dynamics.html"><a href="dynamics.html#the-optimality-conditions"><i class="fa fa-check"></i><b>7.2.14</b> The Optimality Conditions</a></li>
<li class="chapter" data-level="7.2.15" data-path="dynamics.html"><a href="dynamics.html#fixed-point-algorithm"><i class="fa fa-check"></i><b>7.2.15</b> Fixed-point Algorithm</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="dynamics.html"><a href="dynamics.html#identification"><i class="fa fa-check"></i><b>7.3</b> Identification</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="dynamics.html"><a href="dynamics.html#unidentification-result"><i class="fa fa-check"></i><b>7.3.1</b> Unidentification Result</a></li>
<li class="chapter" data-level="7.3.2" data-path="dynamics.html"><a href="dynamics.html#identification-when-beta-and-f-is-known"><i class="fa fa-check"></i><b>7.3.2</b> Identification when <span class="math inline">\(\beta\)</span> and <span class="math inline">\(F\)</span> is Known</a></li>
<li class="chapter" data-level="7.3.3" data-path="dynamics.html"><a href="dynamics.html#crucial-assumptions-for-the-argument"><i class="fa fa-check"></i><b>7.3.3</b> Crucial Assumptions for the Argument</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="dynamics.html"><a href="dynamics.html#estimation-by-nested-fixed-point-algorithm"><i class="fa fa-check"></i><b>7.4</b> Estimation by Nested Fixed-point Algorithm</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="dynamics.html"><a href="dynamics.html#nested-fixed-point-algorithm"><i class="fa fa-check"></i><b>7.4.1</b> Nested Fixed-Point Algorithm</a></li>
<li class="chapter" data-level="7.4.2" data-path="dynamics.html"><a href="dynamics.html#solving-for-the-ex-ante-value-function"><i class="fa fa-check"></i><b>7.4.2</b> Solving for the Ex-ante Value Function</a></li>
<li class="chapter" data-level="7.4.3" data-path="dynamics.html"><a href="dynamics.html#estimation-by-nested-fixed-point-algorithm-1"><i class="fa fa-check"></i><b>7.4.3</b> Estimation by Nested Fixed-Point Algorithm</a></li>
<li class="chapter" data-level="7.4.4" data-path="dynamics.html"><a href="dynamics.html#full-and-partial-likelihood"><i class="fa fa-check"></i><b>7.4.4</b> Full and Partial Likelihood</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="dynamics.html"><a href="dynamics.html#estimation-by-conditional-choice-probability-ccp-approach"><i class="fa fa-check"></i><b>7.5</b> Estimation by Conditional Choice Probability (CCP) Approach</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="dynamics.html"><a href="dynamics.html#ccp-approach"><i class="fa fa-check"></i><b>7.5.1</b> CCP Approach</a></li>
<li class="chapter" data-level="7.5.2" data-path="dynamics.html"><a href="dynamics.html#first-step-estimating-ccp"><i class="fa fa-check"></i><b>7.5.2</b> First Step: Estimating CCP</a></li>
<li class="chapter" data-level="7.5.3" data-path="dynamics.html"><a href="dynamics.html#first-step-estimating-ccp-1"><i class="fa fa-check"></i><b>7.5.3</b> First Step: Estimating CCP</a></li>
<li class="chapter" data-level="7.5.4" data-path="dynamics.html"><a href="dynamics.html#second-step-estimating-structural-parameters"><i class="fa fa-check"></i><b>7.5.4</b> Second Step: Estimating Structural Parameters</a></li>
<li class="chapter" data-level="7.5.5" data-path="dynamics.html"><a href="dynamics.html#second-step-estimating-structural-parameters-1"><i class="fa fa-check"></i><b>7.5.5</b> Second Step: Estimating Structural Parameters</a></li>
<li class="chapter" data-level="7.5.6" data-path="dynamics.html"><a href="dynamics.html#type-i-extreme-value-distribution"><i class="fa fa-check"></i><b>7.5.6</b> Type-I Extreme Value Distribution</a></li>
<li class="chapter" data-level="7.5.7" data-path="dynamics.html"><a href="dynamics.html#type-i-extreme-value-distribution-1"><i class="fa fa-check"></i><b>7.5.7</b> Type-I Extreme Value Distribution</a></li>
<li class="chapter" data-level="7.5.8" data-path="dynamics.html"><a href="dynamics.html#type-i-extreme-value-distribution-2"><i class="fa fa-check"></i><b>7.5.8</b> Type-I Extreme Value Distribution</a></li>
<li class="chapter" data-level="7.5.9" data-path="dynamics.html"><a href="dynamics.html#type-i-extreme-value-distribution-3"><i class="fa fa-check"></i><b>7.5.9</b> Type-I Extreme Value Distribution</a></li>
<li class="chapter" data-level="7.5.10" data-path="dynamics.html"><a href="dynamics.html#type-i-extreme-value-distribution-4"><i class="fa fa-check"></i><b>7.5.10</b> Type-I Extreme Value Distribution</a></li>
<li class="chapter" data-level="7.5.11" data-path="dynamics.html"><a href="dynamics.html#general-distribution"><i class="fa fa-check"></i><b>7.5.11</b> General Distribution</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="dynamics.html"><a href="dynamics.html#unobserved-heterogeneity"><i class="fa fa-check"></i><b>7.6</b> Unobserved Heterogeneity</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="dynamics.html"><a href="dynamics.html#dynamic-decision-model-with-a-finite-mixture"><i class="fa fa-check"></i><b>7.6.1</b> Dynamic Decision Model with a Finite Mixture</a></li>
<li class="chapter" data-level="7.6.2" data-path="dynamics.html"><a href="dynamics.html#setting-1"><i class="fa fa-check"></i><b>7.6.2</b> Setting</a></li>
<li class="chapter" data-level="7.6.3" data-path="dynamics.html"><a href="dynamics.html#observation"><i class="fa fa-check"></i><b>7.6.3</b> Observation</a></li>
<li class="chapter" data-level="7.6.4" data-path="dynamics.html"><a href="dynamics.html#assumptions-finite-mixture"><i class="fa fa-check"></i><b>7.6.4</b> Further Assumptions</a></li>
<li class="chapter" data-level="7.6.5" data-path="dynamics.html"><a href="dynamics.html#lower-dimensional-submodels"><i class="fa fa-check"></i><b>7.6.5</b> Lower-dimensional Submodels</a></li>
<li class="chapter" data-level="7.6.6" data-path="dynamics.html"><a href="dynamics.html#notations"><i class="fa fa-check"></i><b>7.6.6</b> Notations</a></li>
<li class="chapter" data-level="7.6.7" data-path="dynamics.html"><a href="dynamics.html#notations-for-parameters-to-be-identified"><i class="fa fa-check"></i><b>7.6.7</b> Notations for Parameters to be Identified</a></li>
<li class="chapter" data-level="7.6.8" data-path="dynamics.html"><a href="dynamics.html#notations-for-observables"><i class="fa fa-check"></i><b>7.6.8</b> Notations for Observables</a></li>
<li class="chapter" data-level="7.6.9" data-path="dynamics.html"><a href="dynamics.html#sufficient-condition-for-identification"><i class="fa fa-check"></i><b>7.6.9</b> Sufficient Condition for Identification</a></li>
<li class="chapter" data-level="7.6.10" data-path="dynamics.html"><a href="dynamics.html#remarks-on-the-theorem"><i class="fa fa-check"></i><b>7.6.10</b> Remarks on the Theorem</a></li>
<li class="chapter" data-level="7.6.11" data-path="dynamics.html"><a href="dynamics.html#factorization-equations"><i class="fa fa-check"></i><b>7.6.11</b> Factorization Equations</a></li>
<li class="chapter" data-level="7.6.12" data-path="dynamics.html"><a href="dynamics.html#sketch-of-the-proof"><i class="fa fa-check"></i><b>7.6.12</b> Sketch of the Proof</a></li>
<li class="chapter" data-level="7.6.13" data-path="dynamics.html"><a href="dynamics.html#constructive-estimation"><i class="fa fa-check"></i><b>7.6.13</b> Constructive Estimation</a></li>
<li class="chapter" data-level="7.6.14" data-path="dynamics.html"><a href="dynamics.html#estimation-by-an-em-algorithm"><i class="fa fa-check"></i><b>7.6.14</b> Estimation by an EM Algorithm</a></li>
<li class="chapter" data-level="7.6.15" data-path="dynamics.html"><a href="dynamics.html#idea"><i class="fa fa-check"></i><b>7.6.15</b> Idea</a></li>
<li class="chapter" data-level="7.6.16" data-path="dynamics.html"><a href="dynamics.html#optimal-conditional-choice-probability-1"><i class="fa fa-check"></i><b>7.6.16</b> Optimal Conditional Choice Probability</a></li>
<li class="chapter" data-level="7.6.17" data-path="dynamics.html"><a href="dynamics.html#likelihood-functions"><i class="fa fa-check"></i><b>7.6.17</b> Likelihood Functions</a></li>
<li class="chapter" data-level="7.6.18" data-path="dynamics.html"><a href="dynamics.html#expectation-step"><i class="fa fa-check"></i><b>7.6.18</b> Expectation Step</a></li>
<li class="chapter" data-level="7.6.19" data-path="dynamics.html"><a href="dynamics.html#maximization-step"><i class="fa fa-check"></i><b>7.6.19</b> Maximization Step</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="dynamicgame.html"><a href="dynamicgame.html"><i class="fa fa-check"></i><b>8</b> Dynamic Game</a>
<ul>
<li class="chapter" data-level="8.1" data-path="dynamicgame.html"><a href="dynamicgame.html#multiple-agent-model"><i class="fa fa-check"></i><b>8.1</b> Multiple-Agent Model</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="dynamicgame.html"><a href="dynamicgame.html#setting-2"><i class="fa fa-check"></i><b>8.1.1</b> Setting</a></li>
<li class="chapter" data-level="8.1.2" data-path="dynamicgame.html"><a href="dynamicgame.html#timing-of-the-model-1"><i class="fa fa-check"></i><b>8.1.2</b> Timing of the Model</a></li>
<li class="chapter" data-level="8.1.3" data-path="dynamicgame.html"><a href="dynamicgame.html#period-profit"><i class="fa fa-check"></i><b>8.1.3</b> Period Profit</a></li>
<li class="chapter" data-level="8.1.4" data-path="dynamicgame.html"><a href="dynamicgame.html#belief-1"><i class="fa fa-check"></i><b>8.1.4</b> Belief</a></li>
<li class="chapter" data-level="8.1.5" data-path="dynamicgame.html"><a href="dynamicgame.html#markov-perfect-equilibrium"><i class="fa fa-check"></i><b>8.1.5</b> Markov Perfect Equilibrium</a></li>
<li class="chapter" data-level="8.1.6" data-path="dynamicgame.html"><a href="dynamicgame.html#ex-ante-value-function"><i class="fa fa-check"></i><b>8.1.6</b> Ex-ante Value Function</a></li>
<li class="chapter" data-level="8.1.7" data-path="dynamicgame.html"><a href="dynamicgame.html#choice-specific-value-function-1"><i class="fa fa-check"></i><b>8.1.7</b> Choice-specific Value Function</a></li>
<li class="chapter" data-level="8.1.8" data-path="dynamicgame.html"><a href="dynamicgame.html#optimality-condition-2"><i class="fa fa-check"></i><b>8.1.8</b> Optimality Condition</a></li>
<li class="chapter" data-level="8.1.9" data-path="dynamicgame.html"><a href="dynamicgame.html#optimal-conditional-choice-probability-2"><i class="fa fa-check"></i><b>8.1.9</b> Optimal Conditional Choice Probability</a></li>
<li class="chapter" data-level="8.1.10" data-path="dynamicgame.html"><a href="dynamicgame.html#equilibrium-condition-1"><i class="fa fa-check"></i><b>8.1.10</b> Equilibrium Condition</a></li>
<li class="chapter" data-level="8.1.11" data-path="dynamicgame.html"><a href="dynamicgame.html#equilibrium-condition-2"><i class="fa fa-check"></i><b>8.1.11</b> Equilibrium Condition</a></li>
<li class="chapter" data-level="8.1.12" data-path="dynamicgame.html"><a href="dynamicgame.html#single-path-of-play"><i class="fa fa-check"></i><b>8.1.12</b> Single Path of Play</a></li>
<li class="chapter" data-level="8.1.13" data-path="dynamicgame.html"><a href="dynamicgame.html#identification-1"><i class="fa fa-check"></i><b>8.1.13</b> Identification</a></li>
<li class="chapter" data-level="8.1.14" data-path="dynamicgame.html"><a href="dynamicgame.html#estimation-ccp-approach"><i class="fa fa-check"></i><b>8.1.14</b> Estimation: CCP Approach</a></li>
<li class="chapter" data-level="8.1.15" data-path="dynamicgame.html"><a href="dynamicgame.html#computing-psi"><i class="fa fa-check"></i><b>8.1.15</b> Computing <span class="math inline">\(\Psi\)</span></a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="dynamicgame.html"><a href="dynamicgame.html#with-continuous-dynamic-choice"><i class="fa fa-check"></i><b>8.2</b> With Continuous Dynamic Choice</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="dynamicgame.html"><a href="dynamicgame.html#continuous-control"><i class="fa fa-check"></i><b>8.2.1</b> Continuous Control</a></li>
<li class="chapter" data-level="8.2.2" data-path="dynamicgame.html"><a href="dynamicgame.html#period-payoff-1"><i class="fa fa-check"></i><b>8.2.2</b> Period Payoff</a></li>
<li class="chapter" data-level="8.2.3" data-path="dynamicgame.html"><a href="dynamicgame.html#policy-function-estimation-with-continuous-control"><i class="fa fa-check"></i><b>8.2.3</b> Policy Function Estimation with Continuous Control</a></li>
<li class="chapter" data-level="8.2.4" data-path="dynamicgame.html"><a href="dynamicgame.html#converting-to-the-standard-discrete-choice-model"><i class="fa fa-check"></i><b>8.2.4</b> Converting to the Standard Discrete Choice Model</a></li>
<li class="chapter" data-level="8.2.5" data-path="dynamicgame.html"><a href="dynamicgame.html#value-function-based-ccp-approach"><i class="fa fa-check"></i><b>8.2.5</b> Value Function Based CCP Approach</a></li>
<li class="chapter" data-level="8.2.6" data-path="dynamicgame.html"><a href="dynamicgame.html#approximating-the-ex-ante-value-function"><i class="fa fa-check"></i><b>8.2.6</b> Approximating the Ex-ante Value Function</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="dynamicgame.html"><a href="dynamicgame.html#dynamic-oligopoly-model"><i class="fa fa-check"></i><b>8.3</b> Dynamic Oligopoly Model</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="dynamicgame.html"><a href="dynamicgame.html#ryancostenvironmentregulation2012"><i class="fa fa-check"></i><b>8.3.1</b> <span class="citation">Ryan (<span>2012</span>)</span></a></li>
<li class="chapter" data-level="8.3.2" data-path="dynamicgame.html"><a href="dynamicgame.html#setting-3"><i class="fa fa-check"></i><b>8.3.2</b> Setting</a></li>
<li class="chapter" data-level="8.3.3" data-path="dynamicgame.html"><a href="dynamicgame.html#timing-of-the-game"><i class="fa fa-check"></i><b>8.3.3</b> Timing of the Game</a></li>
<li class="chapter" data-level="8.3.4" data-path="dynamicgame.html"><a href="dynamicgame.html#demand-function"><i class="fa fa-check"></i><b>8.3.4</b> Demand Function</a></li>
<li class="chapter" data-level="8.3.5" data-path="dynamicgame.html"><a href="dynamicgame.html#production-cost-function"><i class="fa fa-check"></i><b>8.3.5</b> Production Cost Function</a></li>
<li class="chapter" data-level="8.3.6" data-path="dynamicgame.html"><a href="dynamicgame.html#investment-cost"><i class="fa fa-check"></i><b>8.3.6</b> Investment Cost</a></li>
<li class="chapter" data-level="8.3.7" data-path="dynamicgame.html"><a href="dynamicgame.html#entry-and-exit-costs"><i class="fa fa-check"></i><b>8.3.7</b> Entry and Exit Costs</a></li>
<li class="chapter" data-level="8.3.8" data-path="dynamicgame.html"><a href="dynamicgame.html#period-profit-function"><i class="fa fa-check"></i><b>8.3.8</b> Period Profit Function</a></li>
<li class="chapter" data-level="8.3.9" data-path="dynamicgame.html"><a href="dynamicgame.html#transition"><i class="fa fa-check"></i><b>8.3.9</b> Transition</a></li>
<li class="chapter" data-level="8.3.10" data-path="dynamicgame.html"><a href="dynamicgame.html#equilibrium"><i class="fa fa-check"></i><b>8.3.10</b> Equilibrium</a></li>
<li class="chapter" data-level="8.3.11" data-path="dynamicgame.html"><a href="dynamicgame.html#value-function-for-incumbents"><i class="fa fa-check"></i><b>8.3.11</b> Value Function for Incumbents</a></li>
<li class="chapter" data-level="8.3.12" data-path="dynamicgame.html"><a href="dynamicgame.html#value-function-for-entrants"><i class="fa fa-check"></i><b>8.3.12</b> Value Function for Entrants</a></li>
<li class="chapter" data-level="8.3.13" data-path="dynamicgame.html"><a href="dynamicgame.html#markov-perfect-equilibrium-1"><i class="fa fa-check"></i><b>8.3.13</b> Markov Perfect Equilibrium</a></li>
<li class="chapter" data-level="8.3.14" data-path="dynamicgame.html"><a href="dynamicgame.html#demand-and-production-cost-estimation"><i class="fa fa-check"></i><b>8.3.14</b> Demand and Production Cost Estimation</a></li>
<li class="chapter" data-level="8.3.15" data-path="dynamicgame.html"><a href="dynamicgame.html#investment-policy-function-estimation"><i class="fa fa-check"></i><b>8.3.15</b> Investment Policy Function Estimation</a></li>
<li class="chapter" data-level="8.3.16" data-path="dynamicgame.html"><a href="dynamicgame.html#investment-policy-function-estimation-1"><i class="fa fa-check"></i><b>8.3.16</b> Investment Policy Function Estimation</a></li>
<li class="chapter" data-level="8.3.17" data-path="dynamicgame.html"><a href="dynamicgame.html#entry-and-exit-policy-functions"><i class="fa fa-check"></i><b>8.3.17</b> Entry and Exit Policy Functions</a></li>
<li class="chapter" data-level="8.3.18" data-path="dynamicgame.html"><a href="dynamicgame.html#bbl-estimation"><i class="fa fa-check"></i><b>8.3.18</b> BBL Estimation</a></li>
<li class="chapter" data-level="8.3.19" data-path="dynamicgame.html"><a href="dynamicgame.html#structural-parameters-estimation-results"><i class="fa fa-check"></i><b>8.3.19</b> Structural Parameters Estimation Results</a></li>
<li class="chapter" data-level="8.3.20" data-path="dynamicgame.html"><a href="dynamicgame.html#counterfactual-simulation"><i class="fa fa-check"></i><b>8.3.20</b> Counterfactual Simulation</a></li>
<li class="chapter" data-level="8.3.21" data-path="dynamicgame.html"><a href="dynamicgame.html#counterfactual-simulation-results"><i class="fa fa-check"></i><b>8.3.21</b> Counterfactual Simulation Results</a></li>
<li class="chapter" data-level="8.3.22" data-path="dynamicgame.html"><a href="dynamicgame.html#counterfactual-simulation-estimation-results"><i class="fa fa-check"></i><b>8.3.22</b> Counterfactual Simulation Estimation Results</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="dynamicgame.html"><a href="dynamicgame.html#dynamic-oligopoly-with-many-firms"><i class="fa fa-check"></i><b>8.4</b> Dynamic Oligopoly with Many Firms</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="dynamicgame.html"><a href="dynamicgame.html#setting-4"><i class="fa fa-check"></i><b>8.4.1</b> Setting</a></li>
<li class="chapter" data-level="8.4.2" data-path="dynamicgame.html"><a href="dynamicgame.html#timing-of-the-game-1"><i class="fa fa-check"></i><b>8.4.2</b> Timing of the Game</a></li>
<li class="chapter" data-level="8.4.3" data-path="dynamicgame.html"><a href="dynamicgame.html#assumptions"><i class="fa fa-check"></i><b>8.4.3</b> Assumptions</a></li>
<li class="chapter" data-level="8.4.4" data-path="dynamicgame.html"><a href="dynamicgame.html#strategy-profile"><i class="fa fa-check"></i><b>8.4.4</b> Strategy Profile</a></li>
<li class="chapter" data-level="8.4.5" data-path="dynamicgame.html"><a href="dynamicgame.html#value-function"><i class="fa fa-check"></i><b>8.4.5</b> Value Function</a></li>
<li class="chapter" data-level="8.4.6" data-path="dynamicgame.html"><a href="dynamicgame.html#markov-perfect-equilibrium-2"><i class="fa fa-check"></i><b>8.4.6</b> Markov-perfect Equilibrium</a></li>
<li class="chapter" data-level="8.4.7" data-path="dynamicgame.html"><a href="dynamicgame.html#oblivious-strategy"><i class="fa fa-check"></i><b>8.4.7</b> Oblivious Strategy</a></li>
<li class="chapter" data-level="8.4.8" data-path="dynamicgame.html"><a href="dynamicgame.html#long-run-average-industry-state"><i class="fa fa-check"></i><b>8.4.8</b> Long-run Average Industry State</a></li>
<li class="chapter" data-level="8.4.9" data-path="dynamicgame.html"><a href="dynamicgame.html#oblivious-value-function"><i class="fa fa-check"></i><b>8.4.9</b> Oblivious Value Function</a></li>
<li class="chapter" data-level="8.4.10" data-path="dynamicgame.html"><a href="dynamicgame.html#oblivious-equilibrium"><i class="fa fa-check"></i><b>8.4.10</b> Oblivious Equilibrium</a></li>
<li class="chapter" data-level="8.4.11" data-path="dynamicgame.html"><a href="dynamicgame.html#asymptotic-results-and-extensions"><i class="fa fa-check"></i><b>8.4.11</b> Asymptotic Results and Extensions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="auction.html"><a href="auction.html"><i class="fa fa-check"></i><b>9</b> Auction</a>
<ul>
<li class="chapter" data-level="9.1" data-path="auction.html"><a href="auction.html#general-symmetric-information-model"><i class="fa fa-check"></i><b>9.1</b> General symmetric information model</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="auction.html"><a href="auction.html#setting-5"><i class="fa fa-check"></i><b>9.1.1</b> Setting</a></li>
<li class="chapter" data-level="9.1.2" data-path="auction.html"><a href="auction.html#discussion-about-the-asssumptions"><i class="fa fa-check"></i><b>9.1.2</b> Discussion About the Asssumptions</a></li>
<li class="chapter" data-level="9.1.3" data-path="auction.html"><a href="auction.html#bidding-strategy"><i class="fa fa-check"></i><b>9.1.3</b> Bidding Strategy</a></li>
<li class="chapter" data-level="9.1.4" data-path="auction.html"><a href="auction.html#special-cases"><i class="fa fa-check"></i><b>9.1.4</b> Special Cases</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="auction.html"><a href="auction.html#second-price-auctions"><i class="fa fa-check"></i><b>9.2</b> Second-Price Auctions</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="auction.html"><a href="auction.html#the-button-auction"><i class="fa fa-check"></i><b>9.2.1</b> The Button Auction</a></li>
<li class="chapter" data-level="9.2.2" data-path="auction.html"><a href="auction.html#equilibrium-bidding-strategies"><i class="fa fa-check"></i><b>9.2.2</b> Equilibrium Bidding Strategies</a></li>
<li class="chapter" data-level="9.2.3" data-path="auction.html"><a href="auction.html#reserve-price"><i class="fa fa-check"></i><b>9.2.3</b> Reserve Price</a></li>
<li class="chapter" data-level="9.2.4" data-path="auction.html"><a href="auction.html#variations"><i class="fa fa-check"></i><b>9.2.4</b> Variations</a></li>
<li class="chapter" data-level="9.2.5" data-path="auction.html"><a href="auction.html#estimation-of-a-ipv-button-auction"><i class="fa fa-check"></i><b>9.2.5</b> Estimation of a IPV Button Auction</a></li>
<li class="chapter" data-level="9.2.6" data-path="auction.html"><a href="auction.html#likelihood-of-ipv-button-auction"><i class="fa fa-check"></i><b>9.2.6</b> Likelihood of IPV Button Auction</a></li>
<li class="chapter" data-level="9.2.7" data-path="auction.html"><a href="auction.html#optimal-reserve-price"><i class="fa fa-check"></i><b>9.2.7</b> Optimal Reserve Price</a></li>
<li class="chapter" data-level="9.2.8" data-path="auction.html"><a href="auction.html#likelihood-of-ipv-english-auction-with-bid-data"><i class="fa fa-check"></i><b>9.2.8</b> Likelihood of IPV English Auction with Bid Data</a></li>
<li class="chapter" data-level="9.2.9" data-path="auction.html"><a href="auction.html#observed-heterogeneity"><i class="fa fa-check"></i><b>9.2.9</b> Observed Heterogeneity</a></li>
<li class="chapter" data-level="9.2.10" data-path="auction.html"><a href="auction.html#identification-2"><i class="fa fa-check"></i><b>9.2.10</b> Identification</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="auction.html"><a href="auction.html#first-price-auctions"><i class="fa fa-check"></i><b>9.3</b> First-Price Auctions</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="auction.html"><a href="auction.html#first-price-sealed-bid-auction"><i class="fa fa-check"></i><b>9.3.1</b> First-Price Sealed Bid Auction</a></li>
<li class="chapter" data-level="9.3.2" data-path="auction.html"><a href="auction.html#equilibrium-bidding-strategies-1"><i class="fa fa-check"></i><b>9.3.2</b> Equilibrium Bidding Strategies</a></li>
<li class="chapter" data-level="9.3.3" data-path="auction.html"><a href="auction.html#maximum-likelihood-estimation-of-the-ipv-first-price-auction"><i class="fa fa-check"></i><b>9.3.3</b> Maximum Likelihood Estimation of the IPV First-Price Auction</a></li>
<li class="chapter" data-level="9.3.4" data-path="auction.html"><a href="auction.html#non-parametric-approach"><i class="fa fa-check"></i><b>9.3.4</b> Non-Parametric Approach</a></li>
<li class="chapter" data-level="9.3.5" data-path="auction.html"><a href="auction.html#non-parmaetric-approach-estimation"><i class="fa fa-check"></i><b>9.3.5</b> Non-Parmaetric Approach: Estimation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i><b>10</b> Applications</a>
<ul>
<li class="chapter" data-level="10.1" data-path="applications.html"><a href="applications.html#section"><i class="fa fa-check"></i><b>10.1</b> 2018-2019</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="applications.html"><a href="applications.html#american-economic-review"><i class="fa fa-check"></i><b>10.1.1</b> American Economic Review</a></li>
<li class="chapter" data-level="10.1.2" data-path="applications.html"><a href="applications.html#econometrica"><i class="fa fa-check"></i><b>10.1.2</b> Econometrica</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="applications.html"><a href="applications.html#asymmetric-information-and-market-power"><i class="fa fa-check"></i><b>10.2</b> Asymmetric Information and Market Power</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="applications.html"><a href="applications.html#motivation"><i class="fa fa-check"></i><b>10.2.1</b> Motivation</a></li>
<li class="chapter" data-level="10.2.2" data-path="applications.html"><a href="applications.html#question-method-and-materials"><i class="fa fa-check"></i><b>10.2.2</b> Question, Method, and Materials</a></li>
<li class="chapter" data-level="10.2.3" data-path="applications.html"><a href="applications.html#findings"><i class="fa fa-check"></i><b>10.2.3</b> Findings</a></li>
<li class="chapter" data-level="10.2.4" data-path="applications.html"><a href="applications.html#policy-experiments"><i class="fa fa-check"></i><b>10.2.4</b> Policy Experiments</a></li>
<li class="chapter" data-level="10.2.5" data-path="applications.html"><a href="applications.html#source"><i class="fa fa-check"></i><b>10.2.5</b> Source</a></li>
<li class="chapter" data-level="10.2.6" data-path="applications.html"><a href="applications.html#loan-data"><i class="fa fa-check"></i><b>10.2.6</b> Loan Data</a></li>
<li class="chapter" data-level="10.2.7" data-path="applications.html"><a href="applications.html#firm-data"><i class="fa fa-check"></i><b>10.2.7</b> Firm Data</a></li>
<li class="chapter" data-level="10.2.8" data-path="applications.html"><a href="applications.html#default-data"><i class="fa fa-check"></i><b>10.2.8</b> Default Data</a></li>
<li class="chapter" data-level="10.2.9" data-path="applications.html"><a href="applications.html#positive-correlation-tests"><i class="fa fa-check"></i><b>10.2.9</b> Positive Correlation Tests</a></li>
<li class="chapter" data-level="10.2.10" data-path="applications.html"><a href="applications.html#setting-6"><i class="fa fa-check"></i><b>10.2.10</b> Setting</a></li>
<li class="chapter" data-level="10.2.11" data-path="applications.html"><a href="applications.html#firm-preference-over-banks"><i class="fa fa-check"></i><b>10.2.11</b> Firm Preference over Banks</a></li>
<li class="chapter" data-level="10.2.12" data-path="applications.html"><a href="applications.html#required-loand-amount"><i class="fa fa-check"></i><b>10.2.12</b> Required Loand Amount</a></li>
<li class="chapter" data-level="10.2.13" data-path="applications.html"><a href="applications.html#default-decision"><i class="fa fa-check"></i><b>10.2.13</b> Default Decision</a></li>
<li class="chapter" data-level="10.2.14" data-path="applications.html"><a href="applications.html#information-structure"><i class="fa fa-check"></i><b>10.2.14</b> Information Structure</a></li>
<li class="chapter" data-level="10.2.15" data-path="applications.html"><a href="applications.html#moral-hazard"><i class="fa fa-check"></i><b>10.2.15</b> Moral Hazard</a></li>
<li class="chapter" data-level="10.2.16" data-path="applications.html"><a href="applications.html#bank-problem"><i class="fa fa-check"></i><b>10.2.16</b> Bank Problem</a></li>
<li class="chapter" data-level="10.2.17" data-path="applications.html"><a href="applications.html#the-effect-of-price-on-default-probability"><i class="fa fa-check"></i><b>10.2.17</b> The Effect of Price on Default Probability</a></li>
<li class="chapter" data-level="10.2.18" data-path="applications.html"><a href="applications.html#the-first-order-condition"><i class="fa fa-check"></i><b>10.2.18</b> The First-Order Condition</a></li>
<li class="chapter" data-level="10.2.19" data-path="applications.html"><a href="applications.html#the-effect-of-higher-adverse-selection"><i class="fa fa-check"></i><b>10.2.19</b> The Effect of Higher Adverse Selection</a></li>
<li class="chapter" data-level="10.2.20" data-path="applications.html"><a href="applications.html#estimating-equilibrium-pricing-strategy-and-augmenting-missing-price-data"><i class="fa fa-check"></i><b>10.2.20</b> Estimating Equilibrium Pricing Strategy and Augmenting Missing Price Data</a></li>
<li class="chapter" data-level="10.2.21" data-path="applications.html"><a href="applications.html#inserting-pricing-estimates-into-the-utility"><i class="fa fa-check"></i><b>10.2.21</b> Inserting Pricing Estimates into the Utility</a></li>
<li class="chapter" data-level="10.2.22" data-path="applications.html"><a href="applications.html#choice-probability"><i class="fa fa-check"></i><b>10.2.22</b> Choice Probability</a></li>
<li class="chapter" data-level="10.2.23" data-path="applications.html"><a href="applications.html#equilibrium-loan-strategy"><i class="fa fa-check"></i><b>10.2.23</b> Equilibrium Loan Strategy</a></li>
<li class="chapter" data-level="10.2.24" data-path="applications.html"><a href="applications.html#equilibrium-default-strategy"><i class="fa fa-check"></i><b>10.2.24</b> Equilibrium Default Strategy</a></li>
<li class="chapter" data-level="10.2.25" data-path="applications.html"><a href="applications.html#control-function-approach-to-deal-with-endogeneity-in-loand-and-defaulty-equations"><i class="fa fa-check"></i><b>10.2.25</b> Control Function Approach to Deal with Endogeneity in Loand and Defaulty Equations</a></li>
<li class="chapter" data-level="10.2.26" data-path="applications.html"><a href="applications.html#first-stage-estimation"><i class="fa fa-check"></i><b>10.2.26</b> First-Stage Estimation</a></li>
<li class="chapter" data-level="10.2.27" data-path="applications.html"><a href="applications.html#second-stage-estimation"><i class="fa fa-check"></i><b>10.2.27</b> Second-Stage Estimation</a></li>
<li class="chapter" data-level="10.2.28" data-path="applications.html"><a href="applications.html#estimation-results"><i class="fa fa-check"></i><b>10.2.28</b> Estimation Results</a></li>
<li class="chapter" data-level="10.2.29" data-path="applications.html"><a href="applications.html#findings-from-estimation-results"><i class="fa fa-check"></i><b>10.2.29</b> Findings from Estimation Results</a></li>
<li class="chapter" data-level="10.2.30" data-path="applications.html"><a href="applications.html#fit-of-the-model"><i class="fa fa-check"></i><b>10.2.30</b> Fit of the Model</a></li>
<li class="chapter" data-level="10.2.31" data-path="applications.html"><a href="applications.html#counterfactuals"><i class="fa fa-check"></i><b>10.2.31</b> Counterfactuals</a></li>
<li class="chapter" data-level="10.2.32" data-path="applications.html"><a href="applications.html#what-if-adverse-selection-got-severer"><i class="fa fa-check"></i><b>10.2.32</b> What if Adverse Selection Got Severer?</a></li>
<li class="chapter" data-level="10.2.33" data-path="applications.html"><a href="applications.html#what-if-cost-of-capital-increased"><i class="fa fa-check"></i><b>10.2.33</b> What if Cost of Capital Increased?</a></li>
<li class="chapter" data-level="10.2.34" data-path="applications.html"><a href="applications.html#merger-simulation-2"><i class="fa fa-check"></i><b>10.2.34</b> Merger Simulation</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="applications.html"><a href="applications.html#simulate-data"><i class="fa fa-check"></i><b>10.3</b> Simulate data</a></li>
<li class="chapter" data-level="10.4" data-path="applications.html"><a href="applications.html#estimate-the-parameter"><i class="fa fa-check"></i><b>10.4</b> Estimate the parameter</a></li>
<li class="chapter" data-level="10.5" data-path="applications.html"><a href="applications.html#simulate-data-1"><i class="fa fa-check"></i><b>10.5</b> Simulate data</a></li>
<li class="chapter" data-level="10.6" data-path="applications.html"><a href="applications.html#estimate-the-parameters"><i class="fa fa-check"></i><b>10.6</b> Estimate the parameters</a></li>
<li class="chapter" data-level="10.7" data-path="applications.html"><a href="applications.html#simulate-data-2"><i class="fa fa-check"></i><b>10.7</b> Simulate data</a></li>
<li class="chapter" data-level="10.8" data-path="applications.html"><a href="applications.html#estimate-the-parameters-1"><i class="fa fa-check"></i><b>10.8</b> Estimate the parameters</a></li>
<li class="chapter" data-level="10.9" data-path="applications.html"><a href="applications.html#simulate-data-3"><i class="fa fa-check"></i><b>10.9</b> Simulate data</a></li>
<li class="chapter" data-level="10.10" data-path="applications.html"><a href="applications.html#estimate-the-parameters-2"><i class="fa fa-check"></i><b>10.10</b> Estimate the parameters</a></li>
<li class="chapter" data-level="10.11" data-path="applications.html"><a href="applications.html#simulate-data-4"><i class="fa fa-check"></i><b>10.11</b> Simulate data</a></li>
<li class="chapter" data-level="10.12" data-path="applications.html"><a href="applications.html#estimate-the-parameters-3"><i class="fa fa-check"></i><b>10.12</b> Estimate the parameters</a></li>
<li class="chapter" data-level="10.13" data-path="applications.html"><a href="applications.html#conduct-counterfactual-simulation"><i class="fa fa-check"></i><b>10.13</b> Conduct counterfactual simulation</a></li>
<li class="chapter" data-level="10.14" data-path="applications.html"><a href="applications.html#simulate-data-5"><i class="fa fa-check"></i><b>10.14</b> Simulate data</a></li>
<li class="chapter" data-level="10.15" data-path="applications.html"><a href="applications.html#estimate-the-parameters-4"><i class="fa fa-check"></i><b>10.15</b> Estimate the parameters</a></li>
<li class="chapter" data-level="10.16" data-path="applications.html"><a href="applications.html#conduct-counterfactual-simulations"><i class="fa fa-check"></i><b>10.16</b> Conduct counterfactual simulations</a></li>
<li class="chapter" data-level="10.17" data-path="applications.html"><a href="applications.html#simulate-data-6"><i class="fa fa-check"></i><b>10.17</b> Simulate data</a></li>
<li class="chapter" data-level="10.18" data-path="applications.html"><a href="applications.html#estimate-parameters"><i class="fa fa-check"></i><b>10.18</b> Estimate parameters</a></li>
<li class="chapter" data-level="10.19" data-path="applications.html"><a href="applications.html#simulate-data-7"><i class="fa fa-check"></i><b>10.19</b> Simulate data</a></li>
<li class="chapter" data-level="10.20" data-path="applications.html"><a href="applications.html#estimate-parameters-1"><i class="fa fa-check"></i><b>10.20</b> Estimate parameters</a></li>
<li class="chapter" data-level="10.21" data-path="applications.html"><a href="applications.html#simulate-data-8"><i class="fa fa-check"></i><b>10.21</b> Simulate data</a></li>
<li class="chapter" data-level="10.22" data-path="applications.html"><a href="applications.html#estimate-the-parameters-5"><i class="fa fa-check"></i><b>10.22</b> Estimate the parameters</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="rcpp.html"><a href="rcpp.html"><i class="fa fa-check"></i><b>11</b> Integrating with C++ using Rcpp and RcppEigen</a>
<ul>
<li class="chapter" data-level="11.1" data-path="rcpp.html"><a href="rcpp.html#prerequisite"><i class="fa fa-check"></i><b>11.1</b> Prerequisite</a></li>
<li class="chapter" data-level="11.2" data-path="rcpp.html"><a href="rcpp.html#workflow"><i class="fa fa-check"></i><b>11.2</b> Workflow</a></li>
<li class="chapter" data-level="11.3" data-path="rcpp.html"><a href="rcpp.html#passing-r-objects-as-rcpp-objects"><i class="fa fa-check"></i><b>11.3</b> Passing R Objects as Rcpp Objects</a></li>
<li class="chapter" data-level="11.4" data-path="rcpp.html"><a href="rcpp.html#passing-r-objects-as-eigen-objects"><i class="fa fa-check"></i><b>11.4</b> Passing R Objects as Eigen Objects</a></li>
<li class="chapter" data-level="11.5" data-path="rcpp.html"><a href="rcpp.html#passing-r-objects-in-other-objects-in-cc"><i class="fa fa-check"></i><b>11.5</b> Passing R Objects in Other Objects in C/C++</a></li>
<li class="chapter" data-level="11.6" data-path="rcpp.html"><a href="rcpp.html#manipulating-objects-in-a-c-function"><i class="fa fa-check"></i><b>11.6</b> Manipulating Objects in a C++ Function</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="rcpp.html"><a href="rcpp.html#matrix-and-vector-arithmetic"><i class="fa fa-check"></i><b>11.6.1</b> Matrix and Vector Arithmetic</a></li>
<li class="chapter" data-level="11.6.2" data-path="rcpp.html"><a href="rcpp.html#the-array-class-and-coefficient-wise-operations"><i class="fa fa-check"></i><b>11.6.2</b> The Array Class and Coefficient-wise Operations</a></li>
<li class="chapter" data-level="11.6.3" data-path="rcpp.html"><a href="rcpp.html#solving-linear-least-squares-systems"><i class="fa fa-check"></i><b>11.6.3</b> Solving Linear Least Squares Systems</a></li>
<li class="chapter" data-level="11.6.4" data-path="rcpp.html"><a href="rcpp.html#accessing-to-elements-of-a-matrix-and-vector"><i class="fa fa-check"></i><b>11.6.4</b> Accessing to Elements of a Matrix and Vector</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>12</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Assignment 9: Auction</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="applications" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">Chapter 10</span> Applications<a href="applications.html#applications" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<ul>
<li>Recently published empirical studies using a structural estimation based on a partial equilibrium model, mostly in the field of industrial organization.</li>
</ul>
<div id="section" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> 2018-2019<a href="applications.html#section" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="american-economic-review" class="section level3 hasAnchor" number="10.1.1">
<h3><span class="header-section-number">10.1.1</span> American Economic Review<a href="applications.html#american-economic-review" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p><span class="citation">Wollmann (<a href="#ref-wollmannTrucksBailoutsEquilibrium2018" role="doc-biblioref">2018</a>)</span>: Estimate a structural model of the US commercial vehicle market and demonstrate the importance of allowing for endogenous product offerings in a merger analysis.</p></li>
<li><p><span class="citation">Dinerstein, Einav, Levin, &amp; Sundaresan (<a href="#ref-dinersteinConsumerPriceSearch2018" role="doc-biblioref">2018</a>)</span>: Study how the redesign of the search engine at eBay affect consumer search and price competition among sellers.</p></li>
<li><p><span class="citation">Crawford, Pavanini, &amp; Schivardi (<a href="#ref-crawfordAsymmetricInformationImperfect2018" role="doc-biblioref">2018</a>)</span>: Estimate a structural model of credit demand, loan use, pricing, and firm default using matched firm-bank data from Italy, and find evidence of adverse selection and how banks can mitigate the negative effects by adjusting credit supply.</p></li>
<li><p><span class="citation">Hortasu, Kastl, &amp; Zhang (<a href="#ref-hortacsuBidShadingBidder2018" role="doc-biblioref">2018</a>)</span>: Estimate a structural model of bidding at the uniform price auctions of US Treasury bills and notes that takes into account informational asymmetries introduced by the bidding system and show that primary dealers have bid-shading ability higher than their willingness-to-pay.</p></li>
<li><p><span class="citation">Aizawa &amp; Kim (<a href="#ref-aizawaAdvertisingRiskSelection2018" role="doc-biblioref">2018</a>)</span>: Estimate an equilibrium model of Medicare Advantage with advertising allowing rich individual heterogeneity and show that advertising is effective in attracting healthy individuals for are newly eligible for Medicare, contributing to advantageous selection into Medicare Advantage.</p></li>
<li><p><span class="citation">Ulrich Doraszelski, Lewis, &amp; Pakes (<a href="#ref-doraszelskiJustStartingOut2018" role="doc-biblioref">2018</a>)</span>: Draw on models of fictitious play and adaptive learning to analyze the evolution of the new market for frequency response within the UK electricity system and explain the convergence of pricing to a rest point that is consistent with equilibrium play.</p></li>
<li><p><span class="citation">Acemoglu, Akcigit, Alp, Bloom, &amp; Kerr (<a href="#ref-acemogluInnovationReallocationGrowth2018" role="doc-biblioref">2018</a>)</span>: Estimate a model of firm-level innovation, productivity growth, and reallocation featuring endogenous entry and exit and the selection between high- and low-type firms which differ in terms for their innovation capacity, and show that taxing the continued operation of incumbent can lead to gains because of the exit of less productive firms.</p></li>
<li><p><span class="citation">Dubois &amp; Lasio (<a href="#ref-duboisIdentifyingIndustryMargins2018" role="doc-biblioref">2018</a>)</span>: Estimate a structural model of pharmaceutical with price constraints and infer whether these constraints are binding and study its consequences.</p></li>
<li><p><span class="citation">Ho &amp; Lee (<a href="#ref-hoEquilibriumProviderNetworks2019" role="doc-biblioref">2019</a>)</span>: Estimate a Nash-in-Nash bargaining model between insurers and hospitals and evaluate the consequence of narrowing hospital networks in commercial heal care markets in the US.</p></li>
<li><p><span class="citation">Crawford, Shcherbakov, &amp; Shum (<a href="#ref-crawfordQualityOverprovisionCable2019" role="doc-biblioref">2019</a>)</span>: Estimate a model of endogenous quality choice in imperfectly competitive markets and show that a quality over-provision in the US cable television markets is caused by the presence of competition from high-end satellite TV providers.</p></li>
<li><p><span class="citation">Fack, Grenet, &amp; He (<a href="#ref-fackTruthTellingPreferenceEstimation2019" role="doc-biblioref">2019</a>)</span>: Propose a new approach to estimate student preferences with data from matching mechanisms and estimate the model with school choice data in Paris.</p></li>
</ul>
</div>
<div id="econometrica" class="section level3 hasAnchor" number="10.1.2">
<h3><span class="header-section-number">10.1.2</span> Econometrica<a href="applications.html#econometrica" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p><span class="citation">Trebbi &amp; Weese (<a href="#ref-trebbiInsurgencySmallWars2019" role="doc-biblioref">2019</a>)</span>: Propose methodologies for the detection of unobserved coalitions of militants in conflict areas and apply to the Afghan conflict during the 2004-2009 period and to Pakistan during the 2008-2011 period, identifying systematically different coalition structures.</p></li>
<li><p><span class="citation">Einav, Finkelstein, &amp; Mahoney (<a href="#ref-einavProviderIncentivesHealthcare2018" role="doc-biblioref">2018</a>)</span>: Estimate a dynamic discrete choice model of long-term care hospitals discharge decisions and study the design of provider incentive in the post-acute setting.</p></li>
<li><p><span class="citation">Miravete, Seim, &amp; Thurk (<a href="#ref-miraveteMarketPowerLaffer2018" role="doc-biblioref">2018</a>)</span>: Estimate a model of taxation in a imperfectly competitive market that leads to incomplete tax pass-through using a data from alcoholic beverages in Pennsylvania and study the welfare implication of the states current tax policy.</p></li>
<li><p><span class="citation">Crawford, Lee, Whinston, &amp; Yurukoglu (<a href="#ref-crawfordWelfareEffectsVertical2018" role="doc-biblioref">2018</a>)</span>: Estimate a structural model of view-ship, subscription, distributor pricing, and affiliate fee bargaining using a data set on the US cable an satellite television industry to analyze the impact of simulated vertical mergers and divestitures of regional sports networks on competition and welfare.</p></li>
<li><p><span class="citation">Agarwal &amp; Somaini (<a href="#ref-agarwalDemandAnalysisUsing2018" role="doc-biblioref">2018</a>)</span>: Propose an empirical method for studying random utility models in a school choice mechanisms and apply it to the data from Cambridge.</p></li>
</ul>
</div>
</div>
<div id="asymmetric-information-and-market-power" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Asymmetric Information and Market Power<a href="applications.html#asymmetric-information-and-market-power" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>I present this paper in detail because the structure of the paper, especially the structure of the introduction, is textbook-perfect.</li>
<li>It also applies textbook-perfect demand and cost estimation techniques but to an empirically interesting setting.</li>
<li>The introduction consists of:
<ul>
<li><strong>Background and motivation</strong>: Following the seminal work; Although the basic; The vast majority; A recent strand;</li>
<li><strong>Question</strong>: We measure</li>
<li><strong>Materials</strong>: We exploit detailed data on</li>
<li><strong>Methods</strong>: After providing reduced-form evidence</li>
<li><strong>Details of the materials and methods</strong>: model (We begin by), its characterization (The degree of competition), estimation (We estimate the model), identification (We face two important challenges).</li>
<li><strong>Results</strong>: In our results</li>
<li><strong>Counterfactuals</strong>: We run three counterfactuals</li>
<li><strong>Implications</strong>: All in all</li>
<li><strong>Contributions</strong>: Our paper is related to</li>
</ul></li>
<li>These topics should be discussed <strong>in this order</strong> in a structural estimation paper.</li>
<li>The paper is organized as follows:
<ul>
<li><strong>Data</strong>: Source; sampling procedure; cleaning; transformation; summary statistics; motivating findings.</li>
<li><strong>Model</strong>: Economic model to estimate; relevance to the research question; justification of the assumptions; discussion on key channels; relevance to theoretical models in the literature.</li>
<li><strong>Estimation</strong>: Econometric specification; estimation procedure; identification.</li>
<li><strong>Results</strong>: Estimation results; key findings and their interpretations; fit of the model.</li>
<li><strong>Conterfactuals</strong>: Policy experiments; policy implications.</li>
</ul></li>
<li>The data section can come after model and estimation sections if it is a methodological paper that builds estimation and/or identification techniques on an abstract model.</li>
</ul>
<div id="motivation" class="section level3 hasAnchor" number="10.2.1">
<h3><span class="header-section-number">10.2.1</span> Motivation<a href="applications.html#motivation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Asymmetric information works differently in imperfectly competitive markets.</li>
<li><strong>Competitive market</strong>: adverse selection <span class="math inline">\(\to\)</span> higher average cost <span class="math inline">\(\to\)</span> higher price.</li>
<li><strong>Imperfectly competitive market</strong>: additional channel: adverse selection <span class="math inline">\(\to\)</span> lower benefit of setting a high price <span class="math inline">\(\to\)</span> lower price <span class="citation">(<a href="#ref-lesterScreeningAdverseSelection2018" role="doc-biblioref">Lester, Shourideh, Venkateswaran, &amp; Zetlin-Jones, 2018</a>; <a href="#ref-mahoneyImperfectCompetitionSelection2017" role="doc-biblioref">Mahoney &amp; Weyl, 2017</a>)</span>.</li>
<li>Adverse selection can moderate the welfare losses from market power, and <em>vice versa</em>.</li>
</ul>
</div>
<div id="question-method-and-materials" class="section level3 hasAnchor" number="10.2.2">
<h3><span class="header-section-number">10.2.2</span> Question, Method, and Materials<a href="applications.html#question-method-and-materials" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>This paper measures the consequences of asymmetric information and imperfect competition in the market for small business lines of credit.</li>
<li>To do so, formulate and estimate a model of credit demand, loan use, default, and bank pricing;</li>
<li>using data on a representative sample of Italian firms, the population of medium and large Italian banks, individual lines of credits between them, and subsequent defaults.</li>
</ul>
</div>
<div id="findings" class="section level3 hasAnchor" number="10.2.3">
<h3><span class="header-section-number">10.2.3</span> Findings<a href="applications.html#findings" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Find evidence of adverse selection:
<ul>
<li>The unobserved determinants of the choice to borrow and of default are positively correlated.</li>
<li>The unobserved determinants of loan use and default are positively correlated.</li>
<li>Both are statistically significant.</li>
</ul></li>
<li>Find positive effect of interest rates on default:
<ul>
<li>Evidence of moral hazard?</li>
</ul></li>
</ul>
</div>
<div id="policy-experiments" class="section level3 hasAnchor" number="10.2.4">
<h3><span class="header-section-number">10.2.4</span> Policy Experiments<a href="applications.html#policy-experiments" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>What if the degree of adverse selection changes?
<ul>
<li>The severer adverse selection still causes a higher price and a smaller credit supply.</li>
<li>But market power significantly mitigates this effect.</li>
</ul></li>
<li>What if banks cost of capital, say, due to a financial crisis?
<ul>
<li>In the presence of adverse selection, the pass-through is smaller for a bank with higher market power.</li>
</ul></li>
<li>What if banks merge?
<ul>
<li>Under high adverse selection, a merger can <em>decrease</em> prices.</li>
</ul></li>
</ul>
</div>
<div id="source" class="section level3 hasAnchor" number="10.2.5">
<h3><span class="header-section-number">10.2.5</span> Source<a href="applications.html#source" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Data on individual loans from the Central Credit Register.</li>
<li>Firm-level balance sheet data from the Company Accounts Data Services.</li>
<li>Banks balance-sheet and income-statement data from the Banking Supervision Register.</li>
<li>Data on bank branches at the local level.</li>
<li>The resulting data is over 1988-1998.</li>
</ul>
</div>
<div id="loan-data" class="section level3 hasAnchor" number="10.2.6">
<h3><span class="header-section-number">10.2.6</span> Loan Data<a href="applications.html#loan-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Italian banks have to report data for each individual borrower to the register.</li>
<li>Focus on the short-term lines of credit:
<ul>
<li>Interest rate is independent of the maturity.</li>
<li>Homogeneous product.</li>
<li>Not collateralized.</li>
<li>Main source of borrowing for Italian firms.</li>
</ul></li>
<li>Focus on firms main credit line in the first year they open any credit line.
<ul>
<li>Avoid heterogeneous experience in ratings, loan negotiations, and learning across banks and firms.</li>
</ul></li>
<li>This reduces the sample size from 90,000 to 36,500.</li>
<li>Average loan amount EUR370,000, average interest rate 14.2%.</li>
<li>Average bank asset EUR11 billion, average employees 3,200.</li>
</ul>
</div>
<div id="firm-data" class="section level3 hasAnchor" number="10.2.7">
<h3><span class="header-section-number">10.2.7</span> Firm Data<a href="applications.html#firm-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>The service collects yearly data on the balance sheets and income statements of a sample of 35,000 Italian non-financial and non-agricultural firms, roughly 30% of the total value added reported in the national accounting.</li>
<li>The service also computes an indicator of the risk profile of each firm, Score, and reports to banks.</li>
<li>The Score is approximately the information that a lending bank has available at the time a loan is granted.</li>
<li>A firm is classified as a borrowing firm if it appears in the Credit Register, and is classified as a non-borrowing firm if it does not appear in the Credit Register and reports zero bank borrowing in the balance sheet.</li>
<li>Banks loan approval decisions are not observed.</li>
</ul>
</div>
<div id="default-data" class="section level3 hasAnchor" number="10.2.8">
<h3><span class="header-section-number">10.2.8</span> Default Data<a href="applications.html#default-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>A loan is classified as default if a firms main line of credit defined it as a bad debt within three years of being granted.</li>
<li>Reporting a loan as a bad debt to the Credit Registry can happen prior to a legally certified bankruptcy filing, but it usually prevents the firm from borrowing any other loans.</li>
<li>6% of new loans default during the sample period.</li>
</ul>
</div>
<div id="positive-correlation-tests" class="section level3 hasAnchor" number="10.2.9">
<h3><span class="header-section-number">10.2.9</span> Positive Correlation Tests<a href="applications.html#positive-correlation-tests" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Positive correlation tests <span class="citation">(<a href="#ref-chiapporiTestingAsymmetricInformation2000" role="doc-biblioref">Chiappori &amp; Salanie, 2000</a>)</span> are often used to test the presence of asymmetric information.</li>
<li>Are firms more likely to demand credit more likely to default?
<span class="math display">\[
d_i = 1\{X_i^d \beta + \nu_i &gt; 0\},
\]</span>
<span class="math display">\[
f_i =
\begin{cases}
X_i^f \gamma + \eta_i &amp;\text{   if   } d_i = 1\\
-&amp;\text{    if   } d_i = 0,
\end{cases}
\]</span>
where <span class="math inline">\(d_i\)</span> is equal to one if the firm borrows and <span class="math inline">\(f_i\)</span> is equal to one if the borrow defaults.</li>
<li><span class="math inline">\(X_i^d\)</span> and <span class="math inline">\(X_i^f\)</span> include year, market, firms Score, amount of granted credit, sector Fixed effects, firms balance sheet variables.</li>
<li>The number of banks in a firms market is only included in <span class="math inline">\(X_i^d\)</span> (instrument).</li>
<li><span class="math inline">\(f_i\)</span> is observed only if <span class="math inline">\(d_i = 1\)</span>.</li>
<li>A positive and significant correlation of 0.09 between <span class="math inline">\(\nu_i\)</span> and <span class="math inline">\(\eta_i\)</span>.</li>
<li>Are riskier firms use more credit?
<span class="math display">\[
l_i = X_i \beta + \epsilon_i,
\]</span>
<span class="math display">\[
f_i = X_i \gamma + \eta_i,
\]</span>
where <span class="math inline">\(l_i\)</span> is the amount of its loan used by the firm.</li>
<li>A positive and significant correlation of 0.03 between <span class="math inline">\(\epsilon_i\)</span> and <span class="math inline">\(\eta_i\)</span>.</li>
<li>These positive correlations can be interpreted as evidence of adverse selection <span class="citation">(<a href="#ref-stiglitzCreditRationingMarkets1981" role="doc-biblioref">Stiglitz &amp; Weiss, 1981</a>)</span>.</li>
<li>We further control several factors such as strategic interactions in the following structural model.</li>
</ul>
</div>
<div id="setting-6" class="section level3 hasAnchor" number="10.2.10">
<h3><span class="header-section-number">10.2.10</span> Setting<a href="applications.html#setting-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Each of <span class="math inline">\(i = 1, \cdots, I_{mt}\)</span> firms in market <span class="math inline">\(m\)</span> in year <span class="math inline">\(t\)</span> is willing to invest in a project and is looking for credit to finance it.</li>
<li>Firms select their main line of credit from <span class="math inline">\(j = 1, \cdots, J_{mt}\)</span> banks in <span class="math inline">\(m\)</span> in <span class="math inline">\(t\)</span>.</li>
<li>Each bank sets interest rates <span class="math inline">\(P_{ijmt}\)</span>.</li>
<li><strong>Informational asymmetry</strong>: conditional on observable, a firms riskiness is known by that firm but not by any of the banks in its market; instead, banks are assumed to known the distribution.</li>
<li><strong>Screening device</strong>: assume that banks use interest rates as their only screening device; the amount of credit granted from a bank to a firm is exogenously given.</li>
</ul>
</div>
<div id="firm-preference-over-banks" class="section level3 hasAnchor" number="10.2.11">
<h3><span class="header-section-number">10.2.11</span> Firm Preference over Banks<a href="applications.html#firm-preference-over-banks" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Firm <span class="math inline">\(i\)</span> in market <span class="math inline">\(m\)</span> in year <span class="math inline">\(t\)</span> obtains the following utility as it chooses bank <span class="math inline">\(j\)</span> as its main credit line:
<span class="math display" id="eq:demand-utility">\[\begin{equation}
U_{ijmt}^D := \overline{\alpha}_0^D + X_{jmt}^{\prime D} \beta^D + \xi_{jmt}^D + \alpha^D P_{ijmt} + Y_{ijmt}^{\prime D} \eta^D + \epsilon_i^D + \nu_{ijmt}^D. \tag{10.1}
\end{equation}\]</span></li>
<li><span class="math inline">\(X_{ijm}^D\)</span>: a vector of bank-market-year determinants of demand; observed by everyone.</li>
<li><span class="math inline">\(Y_{ijmt}^D\)</span>: a vector of firm-bank-market-year determinants of demand; observed by everyone.</li>
<li><span class="math inline">\(\xi_{jmt}^D\)</span>: the banks attributes; not observed to econometrician.</li>
<li><span class="math inline">\(\epsilon_i^D\)</span>: the firms propensity to borrow; only observed to the firm.</li>
<li><span class="math inline">\(\nu_{ijmt}^D\)</span>: an idiosyncratic shock; only observed to the firm.</li>
<li><span class="math inline">\(\epsilon_i^D\)</span> is the source of asymmetric information.</li>
<li>Let <span class="math inline">\(\alpha_{0i}^D := \overline{\alpha}_0^D + \epsilon_i^D\)</span>.</li>
</ul>
</div>
<div id="required-loand-amount" class="section level3 hasAnchor" number="10.2.12">
<h3><span class="header-section-number">10.2.12</span> Required Loand Amount<a href="applications.html#required-loand-amount" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Firm <span class="math inline">\(i\)</span> in market <span class="math inline">\(m\)</span> in year <span class="math inline">\(t\)</span> borrows the following amount of loan if it chooses bank <span class="math inline">\(j\)</span> as its main line:
<span class="math display">\[
L_{ijmt} := \alpha_0^L + X_{jmt}^{\prime L} \beta^L + \alpha^L P_{ijmt} + Y_{ijmt}^{\prime L} \eta^L + \epsilon_i^L.
\]</span></li>
<li><span class="math inline">\(\epsilon_i^L\)</span>: the firms propensity to use credit; only observed to the firm.</li>
<li><span class="math inline">\(\epsilon_i^L\)</span> is another source of asymmetric information.</li>
<li>Notice that <strong>there is no firm-bank-specific unobserved heterogeneity</strong>; why?; we need to know how much a firm will borrow when the firm borrowed from a different bank than in the data; because a loan between a firm and a bank is observed only when the firm borrows from the bank, we need to exclude any firm-bank-specific unobserved heterogeneity in order to predict loans with hypothetical banks.</li>
</ul>
</div>
<div id="default-decision" class="section level3 hasAnchor" number="10.2.13">
<h3><span class="header-section-number">10.2.13</span> Default Decision<a href="applications.html#default-decision" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Conditional on borrowing, each firm chooses to default if its utility from doing so is greater than 0:
<span class="math display">\[
U_{ijmt}^F := \alpha_0^F + X_{jmt}^{\prime F} \beta^F + \alpha^F P_{ijmt} + Y_{ijmt}^{\prime F} \eta^F + \epsilon_i^F.
\]</span></li>
<li><span class="math inline">\(\epsilon_i^F\)</span>: the firms propensity to default; only observed to the firm.</li>
<li><span class="math inline">\(\epsilon_i^F\)</span> is another source of asymmetric information.</li>
<li>Notice that there is no firm-bank-specific unobserved heterogeneity for the same reason.</li>
</ul>
</div>
<div id="information-structure" class="section level3 hasAnchor" number="10.2.14">
<h3><span class="header-section-number">10.2.14</span> Information Structure<a href="applications.html#information-structure" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><span class="math inline">\(\epsilon_i^D, \epsilon_i^L\)</span>, and <span class="math inline">\(\epsilon_i^F\)</span> are assumed to be fixed at the firm level and do not vary across banks.</li>
<li>They are assumed to follow:
<span class="math display">\[
\begin{pmatrix}
\epsilon_i^D\\
\epsilon_i^L\\
\epsilon_i^F
\end{pmatrix}
\sim
N
\left(
\begin{pmatrix}
0 \\
0 \\
0
\end{pmatrix},
\begin{pmatrix}
\sigma_D^2 &amp; \rho_{DL} \sigma_D \sigma_L &amp; \rho_{DF} \sigma_D\\
\rho_{DL} \sigma_D \sigma_L &amp; \sigma_L^2 &amp; \rho_{LF} \sigma_L\\
\rho_{DF} \sigma_D &amp; \rho_{LF} \sigma_L &amp; 1
\end{pmatrix}
\right).
\]</span></li>
</ul>
</div>
<div id="moral-hazard" class="section level3 hasAnchor" number="10.2.15">
<h3><span class="header-section-number">10.2.15</span> Moral Hazard<a href="applications.html#moral-hazard" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>The model allows for the presence of moral hazard.</li>
<li><span class="citation">Holmstrom &amp; Tirole (<a href="#ref-holmstromFinancialIntermediationLoanable1997" role="doc-biblioref">1997</a>)</span>: If moral hazard is present, higher repayment requirements on loans can reduce the incentives to exert efforts and increases the default probability.</li>
<li>Interpreting <span class="math inline">\(\alpha^F\)</span> a causal effect of price on default (by using an instrument), we will be able to interpret the positive <span class="math inline">\(\alpha^F\)</span> as evidence of moral hazard.</li>
</ul>
</div>
<div id="bank-problem" class="section level3 hasAnchor" number="10.2.16">
<h3><span class="header-section-number">10.2.16</span> Bank Problem<a href="applications.html#bank-problem" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>The expected profit for bank <span class="math inline">\(j\)</span> from charging a price <span class="math inline">\(P_{ijmt}\)</span> offered to firm <span class="math inline">\(i\)</span> in market <span class="math inline">\(m\)</span> in year <span class="math inline">\(t\)</span> is:
<span class="math display">\[
\Pi_{ijmt} := P_{ijmt} Q_{ijmt} (1 - F_{ijmt}) - MC_{ijmt} Q_{ijmt}.
\]</span></li>
<li><span class="math inline">\(Q_{ijmt}\)</span>: the banks expectation of the firms demand.</li>
<li><span class="math inline">\(F_{ijmt}\)</span>: the banks expectation of the firms default.</li>
<li><span class="math inline">\(MC_{ijmt}\)</span>: the banks marginal cost.</li>
</ul>
</div>
<div id="the-effect-of-price-on-default-probability" class="section level3 hasAnchor" number="10.2.17">
<h3><span class="header-section-number">10.2.17</span> The Effect of Price on Default Probability<a href="applications.html#the-effect-of-price-on-default-probability" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>There are two channels.</li>
<li>If <span class="math inline">\(\alpha^F\)</span> is positive, higher interest rate can increase the default probability, possibly because of moral hazard.</li>
<li>A higher interest rate also changes the composition of borrower types; borrowing conditional on a high interest rate means that the firm has higher demand for loan; if <span class="math inline">\(\rho_{DF} &gt; 0\)</span>, this implies the firm is riskier.</li>
</ul>
</div>
<div id="the-first-order-condition" class="section level3 hasAnchor" number="10.2.18">
<h3><span class="header-section-number">10.2.18</span> The First-Order Condition<a href="applications.html#the-first-order-condition" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>The pricing equation is:
<span class="math display">\[
P_{ijmt} = \frac{MC_{ijmt}}{1 - F_{ijmt} + F_{ijmt}&#39; \mathcal{M}_{ijmt}} + \frac{(1 - F_{ijmt}) \mathcal{M}_{ijmt}}{1 - F_{ijmt} + F_{ijmt}&#39; \mathcal{M}_{ijmt}}.
\]</span></li>
<li>The first term is the <strong>effective marginal cost</strong> and the second <strong>effective markup</strong>.</li>
<li><span class="math inline">\(\mathcal{M}_{ijmt} := - Q_{ijmt} / Q_{ijmt}&#39;\)</span> is the bank <span class="math inline">\(j\)</span>s markup on a loan to firm <span class="math inline">\(i\)</span>.</li>
</ul>
</div>
<div id="the-effect-of-higher-adverse-selection" class="section level3 hasAnchor" number="10.2.19">
<h3><span class="header-section-number">10.2.19</span> The Effect of Higher Adverse Selection<a href="applications.html#the-effect-of-higher-adverse-selection" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>As measured by the higher <span class="math inline">\(\rho_{DF}\)</span>.</li>
<li><strong>Average borrower effect</strong>: tends to increase the price.
<ul>
<li>A higher <span class="math inline">\(\rho_{DF}\)</span> implies a higher default probability <span class="math inline">\(F_{ijmt}\)</span> for a given price.</li>
<li>This decreases the denominator of the pricing equation.</li>
</ul></li>
<li><strong>Marginal borrower effect</strong>: tends to suppress the price.
<ul>
<li>A higher <span class="math inline">\(\rho_{DF}\)</span> (in most cases) implies a higher sensitivity of default probability to price <span class="math inline">\(F_{ijmt}&#39;\)</span> for a given price.</li>
<li>This increases the denominator of the pricing equation.</li>
<li>Because the marginal borrower is safer than the average borrow to larger degree, the firm will want to keep them by reducing the price.</li>
</ul></li>
<li>Which of the effects dominates depend on the markup <span class="math inline">\(\mathcal{M}_{ijmt}\)</span>.
<ul>
<li>Low levels of competition imply margins are high, increasing the value to the bank of marginal borrowers.</li>
</ul></li>
</ul>
</div>
<div id="estimating-equilibrium-pricing-strategy-and-augmenting-missing-price-data" class="section level3 hasAnchor" number="10.2.20">
<h3><span class="header-section-number">10.2.20</span> Estimating Equilibrium Pricing Strategy and Augmenting Missing Price Data<a href="applications.html#estimating-equilibrium-pricing-strategy-and-augmenting-missing-price-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>To estimate bank choice problem for a firm, we need to have price for each pair of bank and firm.</li>
<li>However, the price is observed only between a bank and a firm that actually held a credit line.</li>
<li>We augment the missing price by predicted values.</li>
<li>But the prediction depends on what kind of information set we assume for banks pricing decisions.</li>
<li>We assume that large banks mostly predict the demand based on hard information such as the balance-sheet and income-statement variables and Scores.</li>
<li>Specifically, we fit the following model to observed prices:
<span class="math display">\[
P_{ijmt} = \gamma_0 + \gamma_1 \mathcal{D}_{ijmt} + \gamma_2 \mathcal{L}_{ijmt} + \lambda_{jmt} + \omega_i^P + \tau_{ijmt}.
\]</span></li>
<li><span class="math inline">\(\mathcal{D}_{ijmt}\)</span> is the distance between firm <span class="math inline">\(i\)</span> and the nearest branch of bank <span class="math inline">\(j\)</span>.</li>
<li><span class="math inline">\(\mathcal{L}_{ijmt}\)</span> are dummies for the size of the granted loan amount.</li>
<li>Regard this as a <strong>reduced-form</strong> estimates of the equilibrium pricing strategy of the banks.</li>
<li>Let <span class="math inline">\(\tilde{\gamma}_0\)</span>, <span class="math inline">\(\tilde{\gamma}_1\)</span>, <span class="math inline">\(\tilde{\gamma}_2\)</span>, <span class="math inline">\(\tilde{lambda}_{jmt}\)</span>, and <span class="math inline">\(\tilde{\omega}_i^P\)</span> the estimates.</li>
<li>Let <span class="math inline">\(\tilde{P}_{ijmt}\)</span> be the predicted value from these estimates:
<span class="math display" id="eq:price-predicted">\[\begin{equation}
\begin{split}
\tilde{P}_{ijmt} &amp;:= \tilde{\gamma}_0 + \tilde{\gamma}_1 \mathcal{D}_{ijmt} + \tilde{\gamma_2} \mathcal{L}_{ijmt} + \tilde{\lambda}_{jmt} + \tilde{\omega}_i^P\\
&amp;:= \tilde{P}_{jmt} + \tilde{\gamma}_1 \mathcal{D}_{ijmt} + \tilde{\gamma_2} \mathcal{L}_{ijmt} + \tilde{\omega}_i^P.
\end{split} \tag{10.2}
\end{equation}\]</span></li>
<li>We predict prices offered to non-borrowing firms by propensity score matching.</li>
</ul>
</div>
<div id="inserting-pricing-estimates-into-the-utility" class="section level3 hasAnchor" number="10.2.21">
<h3><span class="header-section-number">10.2.21</span> Inserting Pricing Estimates into the Utility<a href="applications.html#inserting-pricing-estimates-into-the-utility" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>We assume that firm-bank-market-year determinants of demand <span class="math inline">\(Y_{ijmt}^D\)</span> is of the following form:
<span class="math display">\[
Y_{ijmt}^D := \eta_1^D \mathcal{D}_{ijmt} + \eta_2^D \mathcal{L}_{ijmt} + \eta_3^D Y_i + \omega_i^D.
\]</span></li>
<li><span class="math inline">\(Y_i\)</span> is the observed firm covariates.</li>
<li><span class="math inline">\(\omega_i^D\)</span>$ is the firm covariates not observed to econometrician.</li>
<li>We further assume that unobserved firm-level attributes <span class="math inline">\(\omega_i^D\)</span> determining the demand is related to unobserved firm-level attributes <span class="math inline">\(\omega_i^P\)</span> determining banks pricing decision are related as:
<span class="math display">\[
\omega_i^D = \eta_4^D \omega_i^P.
\]</span></li>
<li>Because previous regression of price gives estimates of <span class="math inline">\(\omega_i^P\)</span>, <span class="math inline">\(\tilde{\omega}_i^P\)</span>, we treat this as if an observed covariate.</li>
<li>At the end, we have:
<span class="math display" id="eq:demand-determinants">\[\begin{equation}
Y_{ijmt}^{\prime D} \eta^D = \eta_1^D \mathcal{D}_{ijmt} + \eta_2^D \mathcal{L}_{ijmt} + \eta_3^D Y_i + \eta_4 \tilde{\omega_i}^P. \tag{10.3}
\end{equation}\]</span></li>
<li>Inserting equations <a href="applications.html#eq:price-predicted">(10.2)</a> and <a href="applications.html#eq:demand-determinants">(10.3)</a> into equation <a href="applications.html#eq:demand-utility">(10.1)</a> gives us:
<span class="math display">\[\begin{equation}
\begin{split}
U_{ijmt}^D &amp;= \overline{\alpha}_0^D + X_{jmt}^{\prime D} \beta^D + \xi_{jmt}^D + \alpha^D P_{ijmt} + Y_{ijmt}^{\prime D} \eta^D + \epsilon_i^D + \nu_{ijmt}^D\\
&amp;= \overline{\alpha}_0^D + X_{jmt}^{\prime D} \beta^D + \xi_{jmt}^D + \alpha^D[\tilde{P}_{jmt} + \tilde{\gamma}_1 \mathcal{D}_{ijmt} + \tilde{\gamma_2} \mathcal{L}_{ijmt} + \tilde{\omega}_i^P] + \eta_1^D \mathcal{D}_{ijmt} + \eta_2^D \mathcal{L}_{ijmt} + \eta_3^D Y_i + \tilde{\omega}_i^D\\
&amp;= \underbrace{(\overline{\alpha}_0^D + X_{jmt}^{\prime D} \beta^D + \xi_{jmt}^D + \alpha^D \tilde{P}_{jmt})}_{\tilde{\delta}_{jmt}^D} + \underbrace{(\eta_1^D + \alpha^D \tilde{\gamma}_1)}_{\tilde{\eta}_1^D}\mathcal{D}_{ijmt} + \tilde{(\eta_2^D + \alpha^D \tilde{\gamma}_2^D)}_{\tilde{\eta}_2^D} \mathcal{L}_{ijmt}\\
&amp;+ \eta_3^D Y_i + \underbrace{(\eta_4^D + \alpha^D)}_{\tilde{\eta}_4^D} \tilde{\omega}_i^P + \epsilon_i^D + \alpha^D \underbrace{\tilde{\tau}_{ijmt} + \nu_{ijmt}}_{\zeta_{ijmt}}\\
&amp;:= \tilde{\delta}_{jmt}^D + Y_{ijmt}^{\prime D} \tilde{\eta}^D + \epsilon_i^D + \zeta_{ijmt}\\
&amp;:= \tilde{\delta}_{jmt}^D(X_{jmt}^D, \widetilde{P}_{jmt}, \xi_{jmt}^D, \overline{\alpha}_0^D, \alpha^D, \beta^D) + V_{ijmt}^D(Y_{ijmt}^D, \sigma_D, \tilde{\eta}^D) + \zeta_{ijmt}.
\end{split}
\end{equation}\]</span></li>
<li><span class="math inline">\(Y_{ijmt}^D : = \{\mathcal{D}_{ijmt}, \mathcal{L}_{ijmt}, Y_i, \tilde{\omega}_i^P\}\)</span>.</li>
<li><span class="math inline">\(\tilde{\eta}^D := \{\tilde{\eta}_1^D, \tilde{\eta}_2^D, \eta_3^D, \tilde{\eta}_4^D\}\)</span>.</li>
<li>Inserting the reduced-form estimates of the equilibrium pricing strategy into the demand model; kind of CCP approach; find parameters that make this estimate consistent with equilibrium conditions.</li>
<li>Predictors for the equilibrium pricing strategy is all included in the utility for choosing a bank; thus, at the equilibrium, the change in covariate affect the utility through two channels; direct effect and indirect effect through price change; <span class="math inline">\(\tilde{\eta}_1^D, \tilde{\eta}_2^D\)</span>, and <span class="math inline">\(\tilde{\eta}_4^D\)</span> represent the composite effects; because the effect on pricing is already identified, we can separate the effects through these two channels in the second stage.</li>
<li>The error terms is also a composite of preference shock <span class="math inline">\(\nu_{ijmt}\)</span> and prediction error in pricing <span class="math inline">\(\tilde{\tau}_{ijmt}\)</span>.</li>
<li><span class="math inline">\(\alpha_D\)</span> is identified in the second stage after estimating <span class="math inline">\(\tilde{\eta}^D\)</span> in the first stage.</li>
</ul>
</div>
<div id="choice-probability" class="section level3 hasAnchor" number="10.2.22">
<h3><span class="header-section-number">10.2.22</span> Choice Probability<a href="applications.html#choice-probability" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>The probability that borrower <span class="math inline">\(i\)</span> in market <span class="math inline">\(m\)</span> in year <span class="math inline">\(t\)</span> chooses bank <span class="math inline">\(j\)</span> is given by:
<span class="math display">\[
Pr_{ijmt}^D := \int \frac{\exp[\tilde{\delta}_{jmt}^D(X_{jmt}^D, \widetilde{P}_{jmt}, \xi_{jmt}^D, \overline{\alpha}_0^D, \alpha^D, \beta^D) + V_{ijmt}^D(Y_{ijmt}^D, \sigma_D, \tilde{\eta}^D)]}{1 + \sum_{l} \exp[\tilde{\delta}_{lmt}^D(X_{lmt}^D, \widetilde{P}_{lmt}, \xi_{lmt}^D, \overline{\alpha}_0^D, \alpha^D, \beta^D) + V_{ilmt}^D(Y_{ilmt}^D, \sigma_D, \tilde{\eta}^D)]} f(\epsilon_i^D) d\epsilon_i^D.
\]</span></li>
</ul>
</div>
<div id="equilibrium-loan-strategy" class="section level3 hasAnchor" number="10.2.23">
<h3><span class="header-section-number">10.2.23</span> Equilibrium Loan Strategy<a href="applications.html#equilibrium-loan-strategy" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>In the equilibrium, the probability of having loan <span class="math inline">\(L\)</span> conditional on borrowing (<span class="math inline">\(D = 1\)</span>) is:
<span class="math display" id="eq:loan-strategy">\[\begin{equation}
\begin{split}
Pr_{ijmt, L|D = 1}^L &amp;:= \mathbb{E}\left\{\mathbb{P}[L_{ijmt} = \alpha_0^L + \alpha^L P_{ijmt} + Y_{ijmt}^{\prime L} \eta^L + \epsilon_i^L|\epsilon_i^D] D = 1 \right\}\\
&amp;= \int \phi_{\epsilon_i^L|\epsilon_i^D} \left(\frac{L_{ijmt} - \alpha_0^L - \alpha^L P_{ijmt} - Y_{ijmt}^{\prime L} \eta^L - \tilde{\mu}_{\epsilon_i^L|\epsilon_i^D}^L}{\tilde{\sigma}_{\epsilon_i^L|\epsilon_i^D}} \right) f(\epsilon_i^D|D = 1) d \epsilon_i^D.
\end{split} \tag{10.4}
\end{equation}\]</span>
where
<span class="math display">\[
\epsilon_i^L | \epsilon_i^D \sim N\left(\frac{\sigma_L}{\sigma_D} \rho_{DL} \epsilon_i^D, \sigma_L^2 (1 - \rho_{DL}^2) \right) := N(\tilde{\mu}_{\epsilon_i^L|\epsilon_i^D}^, \tilde{\sigma}_{\epsilon_i^L|\epsilon_i^D}).
\]</span></li>
</ul>
</div>
<div id="equilibrium-default-strategy" class="section level3 hasAnchor" number="10.2.24">
<h3><span class="header-section-number">10.2.24</span> Equilibrium Default Strategy<a href="applications.html#equilibrium-default-strategy" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>In the equilibrium, the probability of default (<span class="math inline">\(F = 1\)</span>) conditional on borrowing (<span class="math inline">\(D = 1\)</span>) is:
<span class="math display" id="eq:default-strategy">\[\begin{equation}
\begin{split}
Pr_{ijmt, F = 1| D = 1, L}^F &amp;:= \int \Phi_{\epsilon_i^F|\epsilon_i^D, \epsilon_i^L}\left(\frac{\alpha_0^F + X_{jmt}^{\prime F} \beta^F + \alpha^F P_{ijmt} + Y_{ijmt}^{\prime F} \eta^F - \tilde{\mu}_{\epsilon_i^F|\epsilon_i^D, \epsilon_i^L}}{\tilde{\sigma}_{\epsilon_i^F | \epsilon_i^D, \epsilon_i^L}} \right) f(\epsilon_i^D | D = 1) d\epsilon_i^D,
\end{split} \tag{10.5}
\end{equation}\]</span>
where
<span class="math display">\[
\epsilon_i^F | \epsilon_i^D, \epsilon_i^L \sim N(A \epsilon_i^D + B \epsilon_i^L, \sigma_F^2 - (A \rho_{DF} + B \rho_{LF})) := N(\tilde{\mu}_{\epsilon_i^F|\epsilon_i^D, \epsilon_i^L}, \tilde{\sigma}_{\epsilon_i^F | \epsilon_i^D, \epsilon_i^L}).
\]</span>
<span class="math display">\[
A := \frac{\rho_{DF} \sigma_L^2 - \rho_{LF} \rho_{DL}}{\sigma_D^2 \sigma_L^2 - \rho_{DL}^2}.
\]</span>
<span class="math display">\[
B := \frac{-\rho_{DF} \rho_{DL} + \rho_{LF} \sigma_D^2}{\sigma_D^2 \sigma_L^2 - \rho_{DL}^2}.
\]</span></li>
</ul>
</div>
<div id="control-function-approach-to-deal-with-endogeneity-in-loand-and-defaulty-equations" class="section level3 hasAnchor" number="10.2.25">
<h3><span class="header-section-number">10.2.25</span> Control Function Approach to Deal with Endogeneity in Loand and Defaulty Equations<a href="applications.html#control-function-approach-to-deal-with-endogeneity-in-loand-and-defaulty-equations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>The structural parameters in loan use and default strategies are identified by using instrumental variables.</li>
<li>Use prices in the other market as instruments (Hausman-type instruments).</li>
<li>Use a control function approach.</li>
<li>Regress prices on the convariates in loan use equation <strong>and the instrument</strong>.</li>
<li>Let <span class="math inline">\(\hat{u}_{ijmt}^L\)</span> be the residual estimate.</li>
<li>Regress prices on the covariates in default equation <strong>and the instrument</strong>.</li>
<li>Let <span class="math inline">\(\hat{u}_{ijmt}^F\)</span> be the residual estimate.</li>
<li>Replace <span class="math inline">\(\tilde{P}_{jmt}\)</span> in equation <a href="applications.html#eq:loan-strategy">(10.4)</a> with the predicted value plus <span class="math inline">\(\hat{u}_{ijmt}^L\)</span>.</li>
<li>Replace <span class="math inline">\(\tilde{P}_{jmt}\)</span> in equation <a href="applications.html#eq:default-strategy">(10.5)</a> with the predicted value plus <span class="math inline">\(\hat{u}_{ijmt}^F\)</span>.</li>
<li>Because of the instruments, the values of <span class="math inline">\(\hat{u}_{ijmt}^L\)</span> and <span class="math inline">\(\hat{u}_{ijmt}^F\)</span> can change conditional on the covariates in the loan strategy and default strategy.</li>
<li>These variations identify <span class="math inline">\(\alpha^L\)</span> and <span class="math inline">\(\alpha^F\)</span> in the following first-stage equation.</li>
</ul>
</div>
<div id="first-stage-estimation" class="section level3 hasAnchor" number="10.2.26">
<h3><span class="header-section-number">10.2.26</span> First-Stage Estimation<a href="applications.html#first-stage-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>In the first-stage, we identify the composite parameters in the bank choice; the coefficients consist of structural parameters and the <em>biases</em> from endogeneity.</li>
<li>We separate structural parameters from biases in the second stage using instrumental variables.</li>
<li>We estimate parameters by maximizing the following simulated log-likelihood function:
<span class="math display">\[
log L := \sum_{i} d_{ijmt} \{\log(P_{ijmt}^D) + \log (Pr_{immt}^L) + f_{ijmt} \log (Pr_{ijmt}^T) + (1 - f_{ijmt}) log (1 - Pr_{ijmt}^F) \}.
\]</span></li>
<li><span class="math inline">\(d_{ijmt}\)</span>: firm <span class="math inline">\(i\)</span> borrows from bank <span class="math inline">\(j\)</span> in market <span class="math inline">\(m\)</span> in year <span class="math inline">\(t\)</span>.</li>
<li><span class="math inline">\(f_{ijmt}\)</span>: firm <span class="math inline">\(i\)</span> defaults from bank <span class="math inline">\(j\)</span></li>
</ul>
</div>
<div id="second-stage-estimation" class="section level3 hasAnchor" number="10.2.27">
<h3><span class="header-section-number">10.2.27</span> Second-Stage Estimation<a href="applications.html#second-stage-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>From the first-stage estimates, we obtain the estimate of <span class="math inline">\(\tilde{\delta}_{jmt}\)</span>, denoted by <span class="math inline">\(\hat{\tilde{\delta}_{jmt}}\)</span>.</li>
<li>Consider a regression such as:
<span class="math display">\[
\hat{\tilde{\delta}_{jmt}} = \overline{\alpha}_0^D + \alpha^D \tilde{P}_{jmt} + X_{jmt}^{\prime D} \beta^D + \xi_{jmt}^D,
\]</span>
where <span class="math inline">\(\tilde{P}_{jmt}\)</span> and <span class="math inline">\(\xi_{jmt}^D\)</span> can be correlated.</li>
<li>Use the euro value of collected deposits and the number of deposit accounts at the bank-market-year level as instruments.</li>
<li>The high degree of autonomy that local branch managers have in their lending decisions will imply better service and condition for loans.</li>
<li>Because deposit conditions are determined in the market with households, it will be independent of loan market conditions.</li>
</ul>
</div>
<div id="estimation-results" class="section level3 hasAnchor" number="10.2.28">
<h3><span class="header-section-number">10.2.28</span> Estimation Results<a href="applications.html#estimation-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><img src="figuretable/Crawford_2018_Table4.png" /></p>
</div>
<div id="findings-from-estimation-results" class="section level3 hasAnchor" number="10.2.29">
<h3><span class="header-section-number">10.2.29</span> Findings from Estimation Results<a href="applications.html#findings-from-estimation-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Interest rates have negative impact on bank choice and loan amount.
<ul>
<li>On average among five largest banks, 10% increase in the interest rate reduces the banks market share by 10% and increases rival banks shares by 1%.</li>
</ul></li>
<li>A higher interest rate leads to a higher default probability.
<ul>
<li>If the control function approach successfully identify the structural effect of price increase on the default probability, the positive estimate can be interpreted as evidence of moral hazard as we have discussed.</li>
</ul></li>
<li>Correlation between unobserved demand and loan amount shocks, and between demand and default shocks, are positive and statistically significant.</li>
</ul>
</div>
<div id="fit-of-the-model" class="section level3 hasAnchor" number="10.2.30">
<h3><span class="header-section-number">10.2.30</span> Fit of the Model<a href="applications.html#fit-of-the-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><img src="figuretable/Crawford_2018_Table5.png" /></p>
</div>
<div id="counterfactuals" class="section level3 hasAnchor" number="10.2.31">
<h3><span class="header-section-number">10.2.31</span> Counterfactuals<a href="applications.html#counterfactuals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><img src="figuretable/Crawford_2018_Table6.png" /></p>
<p><img src="figuretable/Crawford_2018_Table7.png" /></p>
</div>
<div id="what-if-adverse-selection-got-severer" class="section level3 hasAnchor" number="10.2.32">
<h3><span class="header-section-number">10.2.32</span> What if Adverse Selection Got Severer?<a href="applications.html#what-if-adverse-selection-got-severer" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>A doubling in the correlations <span class="math inline">\(\rho_{DF}\)</span> and <span class="math inline">\(\rho_{LF}\)</span> causes 1.87 percent points increases in the average interest rates.</li>
<li>This causes 1.28 percent points decrease in the share and EUR700 decrease in the loan amount.</li>
<li>The default probability substantially increases from 5.5 to 11.4%.</li>
<li>The effective markup of a bank is negatively correlated with the price and default probability changes, and positively correlated with demand and loan amount changes.
<ul>
<li>A bank with higher market power takes care of marginal borrowers more than a bank with less market power.</li>
</ul></li>
</ul>
</div>
<div id="what-if-cost-of-capital-increased" class="section level3 hasAnchor" number="10.2.33">
<h3><span class="header-section-number">10.2.33</span> What if Cost of Capital Increased?<a href="applications.html#what-if-cost-of-capital-increased" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>5% (or 70 basis points) increase in the banks marginal cost leads to 1.78 percent points increase in the interest rates.</li>
<li>The default probability increases only by 1.84 percent points in this case.
<ul>
<li>With price increase, riskier borrowers will borrow from a bank.</li>
<li>But in the current case, the degree of adverse selection is fixed.</li>
<li>So the increase in default probability is moderate.</li>
</ul></li>
<li>The effective markup of a bank is negatively correlated with the price and default changes, and positively correlated with demand and loan amount change.</li>
</ul>
</div>
<div id="merger-simulation-2" class="section level3 hasAnchor" number="10.2.34">
<h3><span class="header-section-number">10.2.34</span> Merger Simulation<a href="applications.html#merger-simulation-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><img src="figuretable/Crawford_2018_Table8.png" /></p>
<ul>
<li>Under severe adverse selection, unilateral effects of a merger on prices is moderate.</li>
</ul>

<p>The deadline is the <strong>start time of February 18 class</strong>.</p>
<p>Report the following results in html format using R markdown. In other words, replicate this document. You write functions in a separate R file and put in <code>R</code> folder in the project folder. Build the project as a package and load it from the R markdown file. The execution code sholuld be written in R markdown file.</p>
<p>You submit:</p>
<ul>
<li>R file containing functions.</li>
<li>R markdown file containing your answers and executing codes.</li>
<li>HTML(or PDF) report generated from the R markdown.</li>
</ul>
</div>
</div>
<div id="simulate-data" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">10.3</span> Simulate data<a href="applications.html#simulate-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Consider to simulate data from the following model and estimate the parameters from the simulated data.</p>
<p><span class="math display">\[
y_{ij} = 1\{j = \text{argmax}_{k = 1, 2} \beta x_k + \epsilon_{ik} \},
\]</span>
where <span class="math inline">\(\epsilon_{ik}\)</span> follows i.i.d. type-I extreme value distribution, <span class="math inline">\(\beta = 0.2\)</span>, <span class="math inline">\(x_1 = 0\)</span> and <span class="math inline">\(x_2 = 1\)</span>.</p>
<ol style="list-style-type: decimal">
<li>To simulate data, first make a data frame as follows:</li>
</ol>
<pre><code>## # A tibble: 2,000  3
##        i     k     x
##    &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1     1     1     0
##  2     1     2     1
##  3     2     1     0
##  4     2     2     1
##  5     3     1     0
##  6     3     2     1
##  7     4     1     0
##  8     4     2     1
##  9     5     1     0
## 10     5     2     1
## #  with 1,990 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Second, draw type-I extreme value random variables. Set the seed at 1. You can use <code>evd</code> package to draw the variables. You should get exactly the same realization if the seed is correctly set.</li>
</ol>
<pre><code>## # A tibble: 2,000  4
##        i     k     x       e
##    &lt;int&gt; &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;
##  1     1     1     0  0.281 
##  2     1     2     1 -0.167 
##  3     2     1     0  1.93  
##  4     2     2     1  1.97  
##  5     3     1     0  0.830 
##  6     3     2     1 -1.06  
##  7     4     1     0 -0.207 
##  8     4     2     1  0.617 
##  9     5     1     0  0.0444
## 10     5     2     1  1.92  
## #  with 1,990 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Third, compute the latent value of each option to obtain the following data frame:</li>
</ol>
<pre><code>## # A tibble: 2,000  5
##        i     k     x       e  latent
##    &lt;int&gt; &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1     1     1     0  0.281   0.281 
##  2     1     2     1 -0.167   0.0331
##  3     2     1     0  1.93    1.93  
##  4     2     2     1  1.97    2.17  
##  5     3     1     0  0.830   0.830 
##  6     3     2     1 -1.06   -0.863 
##  7     4     1     0 -0.207  -0.207 
##  8     4     2     1  0.617   0.817 
##  9     5     1     0  0.0444  0.0444
## 10     5     2     1  1.92    2.12  
## #  with 1,990 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Finally, compute <span class="math inline">\(y\)</span> by comparing the latent values of <span class="math inline">\(k = 1, 2\)</span> for each <span class="math inline">\(i\)</span> to obtain the following result:</li>
</ol>
<pre><code>## # A tibble: 2,000  6
##        i     k     x       e  latent     y
##    &lt;int&gt; &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1     1     1     0  0.281   0.281      1
##  2     1     2     1 -0.167   0.0331     0
##  3     2     1     0  1.93    1.93       0
##  4     2     2     1  1.97    2.17       1
##  5     3     1     0  0.830   0.830      1
##  6     3     2     1 -1.06   -0.863      0
##  7     4     1     0 -0.207  -0.207      0
##  8     4     2     1  0.617   0.817      1
##  9     5     1     0  0.0444  0.0444     0
## 10     5     2     1  1.92    2.12       1
## #  with 1,990 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
</div>
<div id="estimate-the-parameter" class="section level2 hasAnchor" number="10.4">
<h2><span class="header-section-number">10.4</span> Estimate the parameter<a href="applications.html#estimate-the-parameter" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now you generated simulated data. Suppose you observe <span class="math inline">\(x_k\)</span> and <span class="math inline">\(y_{ik}\)</span> for each <span class="math inline">\(i\)</span> and <span class="math inline">\(k\)</span> and estimate <span class="math inline">\(\beta\)</span> by a maximum likelihood estimator. The likelihood for <span class="math inline">\(i\)</span> to choose <span class="math inline">\(k\)</span> (<span class="math inline">\(y_{ik} = 1\)</span>) can be shown to be:
<span class="math display">\[
p_{ik}(\beta) = \frac{\exp(\beta x_k)}{\exp(\beta x_1) + \exp(\beta x_2)}.
\]</span></p>
<p>Then, the likelihood of observing <span class="math inline">\(\{y_{ik}\}_{i, k}\)</span> is:
<span class="math display">\[
L(\beta) = \prod_{i = 1}^{1000} p_{i1}(\beta)^{y_{i1}} [1 - p_{i1}(\beta)]^{1 - y_{i1}},
\]</span>
and the log likelihood is:
<span class="math display">\[
l(\beta) = \sum_{i = 1}^{1000}\{y_{i1}\log p_{i1}(\beta) + (1 - y_{i1})\log [1 - p_{i1}(\beta)\}.
\]</span></p>
<ol style="list-style-type: decimal">
<li><p>Write a function to compute the livelihood for a given <span class="math inline">\(\beta\)</span> and data and name the function <code>loglikelihood_A1</code>.</p></li>
<li><p>Compute the value of log likelihood for <span class="math inline">\(\beta = 0, 0.1, \cdots, 1\)</span> and plot the result using <code>ggplot2</code> packages. You can use <code>latex2exp</code> package to use LaTeX math symbol in the label:
<img src="lecture_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p></li>
<li><p>Find and report <span class="math inline">\(\beta\)</span> that maximizes the log likelihood for the simulated data. You can use <code>optim</code> function to achieve this. You will use <code>Brent</code> method and set the lower bound at -1 and upper bound at 1 for the parameter search.</p></li>
</ol>
<pre><code>## $par
## [1] 0.2371046
## 
## $value
## [1] -0.6861689
## 
## $counts
## function gradient 
##       NA       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>

</div>
<div id="simulate-data-1" class="section level2 hasAnchor" number="10.5">
<h2><span class="header-section-number">10.5</span> Simulate data<a href="applications.html#simulate-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Consider the following production and investment process for <span class="math inline">\(j = 1, \cdots, 1000\)</span> firms across <span class="math inline">\(t = 1, \cdots, 10\)</span> periods.</p>
<p>The log production function is of the form:
<span class="math display">\[
y_{jt} = \beta_0 + \beta_l l_{jt} + \beta_k k_{jt} + \omega_{jt} + \eta_{jt},
\]</span>
where <span class="math inline">\(\omega_{jt}\)</span> is an anticipated shock and <span class="math inline">\(\eta_{jt}\)</span> is an ex post shock.</p>
<p>The anticipated shocks evolve as:
<span class="math display">\[
\omega_{jt} = \alpha \omega_{j, t - 1} + \nu_{jt},
\]</span>
where <span class="math inline">\(\nu_{jt}\)</span> is an i.i.d. normal random variable with mean 0 and standard deviation <span class="math inline">\(\sigma_\nu\)</span>. The ex post shock is an i.i.d. normal random variable with mean 0 and standard deviation <span class="math inline">\(\sigma_{\eta}\)</span>.</p>
<p>The product price the same across firms and normalized at 1. The price is normalized at 1. The wage <span class="math inline">\(w_t\)</span> is constant at 0.5.</p>
<p>Finally, the capital accumulate according to:
<span class="math display">\[
K_{j, t + 1} = (1 - \delta) K_{jt} + I_{jt}.
\]</span></p>
<p>We set the parameters as follows:</p>
<table>
<thead>
<tr class="header">
<th>parameter</th>
<th>variable</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\beta_0\)</span></td>
<td><code>beta_0</code></td>
<td>1</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\beta_l\)</span></td>
<td><code>beta_l</code></td>
<td>0.2</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\beta_k\)</span></td>
<td><code>beta_k</code></td>
<td>0.7</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\alpha\)</span></td>
<td><code>alpha</code></td>
<td>0.7</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\sigma_{\eta}\)</span></td>
<td><code>sigma_eta</code></td>
<td>0.2</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\sigma_{\nu}\)</span></td>
<td><code>sigma_nu</code></td>
<td>0.5</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\sigma_{w}\)</span></td>
<td><code>sigma_w</code></td>
<td>0.1</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\delta\)</span></td>
<td><code>delta</code></td>
<td>0.05</td>
</tr>
</tbody>
</table>
<ol style="list-style-type: decimal">
<li><p>Define the parameter variables as above.</p></li>
<li><p>Write a function that returns the log output given <span class="math inline">\(l_{jt}\)</span>, <span class="math inline">\(k_{jt}\)</span>, <span class="math inline">\(\omega_{jt}\)</span>, and <span class="math inline">\(\eta_{jt}\)</span> under the given parameter values according to the above production function and name it <code>log_production(l, k, omega, eta, beta_0, beta_l, beta_k)</code>.</p></li>
</ol>
<p>Suppose that the labor is determined after <span class="math inline">\(\omega_{jt}\)</span> is observed, but before <span class="math inline">\(\eta_{jt}\)</span> is observed, given the log capital level <span class="math inline">\(k_{jt}\)</span>.</p>
<ol start="3" style="list-style-type: decimal">
<li>Derive the optimal log labor as a function of <span class="math inline">\(\omega_{jt}\)</span>, <span class="math inline">\(\eta_{jt}\)</span>, <span class="math inline">\(k_{jt}\)</span>, and wage. Write a function to return the optimal log labor given the variables and parameters and name it <code>log_labor_choice(k, wage, omega, beta_0, beta_l, beta_k, sigma_eta)</code>.</li>
</ol>
<p>As discussed in the class, if there is no additional variation in labor, the coefficient on the labor <span class="math inline">\(\beta_l\)</span> is not identified. Thus, if we generate labor choice from the previous function, <span class="math inline">\(\beta_l\)</span> will not be identified from the simulated data. To see this, we write a modified version of the previous function in which <span class="math inline">\(\omega_{jt}\)</span> is replaced with <span class="math inline">\(\omega_{jt} + \iota_{jt}\)</span>, where <span class="math inline">\(\iota_{jt}\)</span> is an optimization error that follows an i.i.d. normal distribution with mean 0 and standard deviation 0.05. That is, the manager of the firm perceives as if the shock is <span class="math inline">\(\omega_{jt} + \iota_{jt}\)</span>, even though the true shock is <span class="math inline">\(\omega_{jt}\)</span>.</p>
<ol start="4" style="list-style-type: decimal">
<li>Modify the previous function by including <span class="math inline">\(\iota_{jt}\)</span> as an additional input and name it <code>log_labor_choice_error(k, wage, omega, beta_0, beta_l, beta_k, iota, sigma_eta)</code>.</li>
</ol>
<p>Consider an investment process such that:
<span class="math display">\[
I_{jt} = (\delta + \gamma \omega_{jt}) K_{jt},
\]</span>
where <span class="math inline">\(I_{jt}\)</span> and <span class="math inline">\(K_{jt}\)</span> are investment and capital in level. Set <span class="math inline">\(\gamma = 0.1\)</span>, i.e., the investment is strictly increasing in <span class="math inline">\(\omega_{jt}\)</span>. The investment function should be derived by solving the dynamic problem of a firm. But here, we just specify it in a reduced-form.</p>
<ol start="5" style="list-style-type: decimal">
<li>Define variable <span class="math inline">\(\gamma\)</span> and assign it the value. Write a function that returns the investment given <span class="math inline">\(K_{jt}\)</span>, <span class="math inline">\(\omega_{jt}\)</span>, and parameter values, according to the previous equation, and name it <code>investment_choice(k, omega, gamma, delta)</code>.</li>
</ol>
<p>Simulate the data first using the labor choice without optimization error and second using the labor choice with optimization error. To do so, we specify the initial values for the state variables <span class="math inline">\(k_{jt}\)</span> and <span class="math inline">\(\omega_{jt}\)</span> as follows.</p>
<ol start="6" style="list-style-type: decimal">
<li>Draw <span class="math inline">\(k_{j1}\)</span> from an i.i.d. normal distribution with mean 1 and standard deviation 0.5. Draw <span class="math inline">\(\omega_{j1}\)</span> from its stationary distribution (check the stationary distribution of AR(1) process). Draw a wage. Before simulating the rest of the data, set the seed at 1.</li>
</ol>
<pre><code>## # A tibble: 1,000  5
##        j     t     k   omega  wage
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1     1     1 0.687  0.795    0.5
##  2     2     1 1.09   0.779    0.5
##  3     3     1 0.582 -0.610    0.5
##  4     4     1 1.80   0.148    0.5
##  5     5     1 1.16   0.0486   0.5
##  6     6     1 0.590 -1.16     0.5
##  7     7     1 1.24   0.568    0.5
##  8     8     1 1.37  -1.34     0.5
##  9     9     1 1.29  -0.873    0.5
## 10    10     1 0.847  0.699    0.5
## #  with 990 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Draw optimization error <span class="math inline">\(\iota_{jt}\)</span> and compute the labor and investment choice of period 1. For labor choice, compute both types of labor choices.</li>
</ol>
<pre><code>## # A tibble: 1,000  9
##        j     t     k   omega  wage     iota      l l_error       I
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1     1     1 0.687  0.795    0.5 -0.0443   1.72   1.67    0.257 
##  2     2     1 1.09   0.779    0.5 -0.0961   2.06   1.94    0.381 
##  3     3     1 0.582 -0.610    0.5  0.0810  -0.123 -0.0218 -0.0196
##  4     4     1 1.80   0.148    0.5  0.0260   1.89   1.92    0.391 
##  5     5     1 1.16   0.0486   0.5 -0.00279  1.21   1.21    0.176 
##  6     6     1 0.590 -1.16     0.5  0.0348  -0.809 -0.766  -0.120 
##  7     7     1 1.24   0.568    0.5  0.00268  1.93   1.93    0.370 
##  8     8     1 1.37  -1.34     0.5 -0.0655  -0.346 -0.428  -0.330 
##  9     9     1 1.29  -0.873    0.5 -0.106    0.165  0.0327 -0.135 
## 10    10     1 0.847  0.699    0.5 -0.0104   1.74   1.73    0.280 
## #  with 990 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<ol start="8" style="list-style-type: decimal">
<li>Draw ex post shock and compute the output according to the production function for both labor without optimization error and with optimization error. Name the output without optimization error <code>y</code> and the one with optimization error <code>y_error</code>.</li>
</ol>
<pre><code>## # A tibble: 1,000  12
##        j     t     k   omega  wage     iota      l l_error       I     eta     y
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1     1     1 0.687  0.795    0.5 -0.0443   1.72   1.67    0.257   0.148  2.77 
##  2     2     1 1.09   0.779    0.5 -0.0961   2.06   1.94    0.381   0.0773 3.03 
##  3     3     1 0.582 -0.610    0.5  0.0810  -0.123 -0.0218 -0.0196  0.259  1.03 
##  4     4     1 1.80   0.148    0.5  0.0260   1.89   1.92    0.391  -0.161  2.62 
##  5     5     1 1.16   0.0486   0.5 -0.00279  1.21   1.21    0.176  -0.321  1.79 
##  6     6     1 0.590 -1.16     0.5  0.0348  -0.809 -0.766  -0.120   0.187  0.274
##  7     7     1 1.24   0.568    0.5  0.00268  1.93   1.93    0.370   0.361  3.19 
##  8     8     1 1.37  -1.34     0.5 -0.0655  -0.346 -0.428  -0.330  -0.0113 0.539
##  9     9     1 1.29  -0.873    0.5 -0.106    0.165  0.0327 -0.135   0.377  1.44 
## 10    10     1 0.847  0.699    0.5 -0.0104   1.74   1.73    0.280   0.316  2.96 
## #  with 990 more rows, and 1 more variable: y_error &lt;dbl&gt;
## #  Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</code></pre>
<ol start="9" style="list-style-type: decimal">
<li><p>Repeat this procedure for <span class="math inline">\(t = 1, \cdots 10\)</span> by updating the capital and anticipated shocks, and name the resulting data frame <code>df_T</code>.</p></li>
<li><p>Check the simulated data by making summary table.</p></li>
</ol>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">N</th>
<th align="right">Mean</th>
<th align="right">Sd</th>
<th align="right">Min</th>
<th align="right">Max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">j</td>
<td align="right">10000</td>
<td align="right">500.5000000</td>
<td align="right">288.6894251</td>
<td align="right">1.0000000</td>
<td align="right">1000.0000000</td>
</tr>
<tr class="even">
<td align="left">t</td>
<td align="right">10000</td>
<td align="right">5.5000000</td>
<td align="right">2.8724249</td>
<td align="right">1.0000000</td>
<td align="right">10.0000000</td>
</tr>
<tr class="odd">
<td align="left">k</td>
<td align="right">10000</td>
<td align="right">0.9797900</td>
<td align="right">0.5838949</td>
<td align="right">-1.2822534</td>
<td align="right">3.2332312</td>
</tr>
<tr class="even">
<td align="left">omega</td>
<td align="right">10000</td>
<td align="right">-0.0055826</td>
<td align="right">0.7025102</td>
<td align="right">-2.5894171</td>
<td align="right">2.6281307</td>
</tr>
<tr class="odd">
<td align="left">wage</td>
<td align="right">10000</td>
<td align="right">0.5000000</td>
<td align="right">0.0000000</td>
<td align="right">0.5000000</td>
<td align="right">0.5000000</td>
</tr>
<tr class="even">
<td align="left">iota</td>
<td align="right">10000</td>
<td align="right">-0.0000696</td>
<td align="right">0.0502883</td>
<td align="right">-0.1841453</td>
<td align="right">0.1715419</td>
</tr>
<tr class="odd">
<td align="left">l</td>
<td align="right">10000</td>
<td align="right">0.9799746</td>
<td align="right">1.0965108</td>
<td align="right">-3.3281023</td>
<td align="right">4.9679634</td>
</tr>
<tr class="even">
<td align="left">l_error</td>
<td align="right">10000</td>
<td align="right">0.9798876</td>
<td align="right">1.0971595</td>
<td align="right">-3.3765433</td>
<td align="right">4.9520674</td>
</tr>
<tr class="odd">
<td align="left">I</td>
<td align="right">10000</td>
<td align="right">0.1793502</td>
<td align="right">0.3006526</td>
<td align="right">-1.2722627</td>
<td align="right">3.2975332</td>
</tr>
<tr class="even">
<td align="left">eta</td>
<td align="right">10000</td>
<td align="right">0.0015825</td>
<td align="right">0.2001539</td>
<td align="right">-0.7650371</td>
<td align="right">0.7455922</td>
</tr>
<tr class="odd">
<td align="left">y</td>
<td align="right">10000</td>
<td align="right">1.8778479</td>
<td align="right">1.1171035</td>
<td align="right">-2.4680251</td>
<td align="right">6.1228291</td>
</tr>
<tr class="even">
<td align="left">y_error</td>
<td align="right">10000</td>
<td align="right">1.8778305</td>
<td align="right">1.1169266</td>
<td align="right">-2.4777133</td>
<td align="right">6.1196499</td>
</tr>
<tr class="odd">
<td align="left">nu</td>
<td align="right">10000</td>
<td align="right">-0.0021155</td>
<td align="right">0.4984324</td>
<td align="right">-2.1513907</td>
<td align="right">1.8253882</td>
</tr>
</tbody>
</table>
</div>
<div id="estimate-the-parameters" class="section level2 hasAnchor" number="10.6">
<h2><span class="header-section-number">10.6</span> Estimate the parameters<a href="applications.html#estimate-the-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For now, use the labor choice with optimization error.</p>
<ol style="list-style-type: decimal">
<li>First, simply regress <span class="math inline">\(y_{jt}\)</span> on <span class="math inline">\(l_{jt}\)</span> and <span class="math inline">\(k_{jt}\)</span> using the least square method. This is likely to give an upwardly biased estimates on <span class="math inline">\(\beta_l\)</span> and <span class="math inline">\(\beta_k\)</span>. Why is it?</li>
</ol>
<pre><code>## 
## Call:
## lm(formula = y_error ~ l_error + k, data = df_T)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.73002 -0.14117 -0.00071  0.13743  0.87983 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 0.892542   0.004058 219.966   &lt;2e-16 ***
## l_error     0.997913   0.002396 416.454   &lt;2e-16 ***
## k           0.007599   0.004503   1.688   0.0915 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2068 on 9997 degrees of freedom
## Multiple R-squared:  0.9657, Adjusted R-squared:  0.9657 
## F-statistic: 1.408e+05 on 2 and 9997 DF,  p-value: &lt; 2.2e-16</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Second, take within-transformation on <span class="math inline">\(y_{jt}\)</span>, <span class="math inline">\(l_{jt}\)</span>, and <span class="math inline">\(k_{jt}\)</span> and let <span class="math inline">\(\Delta y_{jt}\)</span>, <span class="math inline">\(\Delta l_{jt}\)</span>, and <span class="math inline">\(\Delta k_{jt}\)</span> denote them. Then, regress <span class="math inline">\(\Delta y_{jt}\)</span> on <span class="math inline">\(\Delta l_{jt}\)</span>, and <span class="math inline">\(\Delta k_{jt}\)</span> by the least squares method.</li>
</ol>
<pre><code>## 
## Call:
## lm(formula = dy_error ~ -1 + dl_error + dk, data = df_T_within)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.72450 -0.13285 -0.00244  0.12931  0.77657 
## 
## Coefficients:
##            Estimate Std. Error t value Pr(&gt;|t|)    
## dl_error  0.9910916  0.0029548 335.413   &lt;2e-16 ***
## dk       -0.0009029  0.0127539  -0.071    0.944    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1961 on 9998 degrees of freedom
## Multiple R-squared:  0.9184, Adjusted R-squared:  0.9184 
## F-statistic: 5.629e+04 on 2 and 9998 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Next, we attempt to estimate the parameters using Olley-Pakes method. Estimate the first-step model of Olley-Pakes method:
<span class="math display">\[
y_{jt} = \beta_1 l_{jt} + \phi(k_{jt}, I_{jt}) + \eta_{jt},
\]</span>
by approximating <span class="math inline">\(\phi_t\)</span> by a kernel function.</p>
<p>Remark that <span class="math inline">\(\phi\)</span> in general depends on observed and unobserved state variables. For this reason, in theory, <span class="math inline">\(\phi\)</span> should be estimated for each period. In this exercise, we assume <span class="math inline">\(\phi\)</span> is common across periods because we know that there is no unobserved state variables in the true data generating process. Moreover, we do not include <span class="math inline">\(w_t\)</span> because we know that it is time -invariant. Do not forget to consider them in the actual data analysis.</p>
<p>You can use <code>npplreg</code> function of <code>np</code> package to estimate a partially linear model with a multivariate kernel. You first use <code>npplregbw</code> to obtain the optimal band width and then use <code>npplreg</code> to estimate the model under the optimal bandwidth. The computation of the optimal bandwidth is time consuming.</p>
<ol start="3" style="list-style-type: decimal">
<li>Return the summary of the first stage estimation and plot the fitted values against the data points.</li>
</ol>
<pre><code>## 
## Partially Linear Model
## Regression data: 10000 training points, in 5 variable(s)
## With 3 linear parametric regressor(s), 2 nonparametric regressor(s)
## 
##                     y(z)           
## Bandwidth(s): 0.07355058 0.01435558
## 
##                     x(z)           
## Bandwidth(s): 0.03908594 0.01191551
##               0.01397428 3.74953039
##               0.83529394 0.00398329
## 
##                   l_error        k        I
## Coefficient(s): 0.2485295 2.355522 5.345144
## 
## Kernel Regression Estimator: Local-Constant
## Bandwidth Type: Fixed
## 
## Residual standard error: 0.1934585
## R-squared: 0.970064
## 
## Continuous Kernel Type: Second-Order Gaussian
## No. Continuous Explanatory Vars.: 2</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-54-1.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Check that <span class="math inline">\(\beta_l\)</span> is not identified with the data without optimization error. Estimate the first stage model of Olley-Pakes with the labor choice without optimization error and report the result.</li>
</ol>
<pre><code>## 
## Partially Linear Model
## Regression data: 10000 training points, in 5 variable(s)
## With 3 linear parametric regressor(s), 2 nonparametric regressor(s)
## 
##                     y(z)           
## Bandwidth(s): 0.07347226 0.01437256
## 
##                     x(z)            
## Bandwidth(s): 0.02960021 0.009986945
##               0.01397428 3.749530394
##               0.83529394 0.003983290
## 
##                        l        k         I
## Coefficient(s): 1.180628 2.034182 0.7805075
## 
## Kernel Regression Estimator: Local-Constant
## Bandwidth Type: Fixed
## 
## Residual standard error: 0.1932285
## R-squared: 0.970116
## 
## Continuous Kernel Type: Second-Order Gaussian
## No. Continuous Explanatory Vars.: 2</code></pre>
<p>Then, we estimate the second stage model of Olley-Pakes method:
<span class="math display">\[
y_{jt} - \hat{\beta_l} l_{jt} = \beta_0 + \beta_k k_{jt} + \alpha[\hat{\phi}(k_{j, t - 1}, I_{j, t - 1}) - \beta_0 - \beta_k k_{j, t-1}] + \nu_{jt} + \eta_{jt}.
\]</span></p>
<p>In this model, we do not have to non-parametetrically estimate the conditional expectation of <span class="math inline">\(\omega_{jt}\)</span> on <span class="math inline">\(\omega_{j, t - 1}\)</span>, because we know that the anticipated shock follows an AR(1) process. Remark that we in general have to non-parametrically estimate it.</p>
<p>The model is non-linear in parameters, because of the term <span class="math inline">\(\alpha \beta_0\)</span> and <span class="math inline">\(\alpha \beta_k\)</span>. We estimate <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta_0\)</span>, and <span class="math inline">\(\beta_k\)</span> by a GMM estimator. The moment is:
<span class="math display">\[
g_{JT}(\alpha, \beta_0, \beta_k) \equiv \frac{1}{JT}\sum_{j = 1}^J \sum_{t = 1}^T \{y_{jt} - \hat{\beta_l} l_{jt} - \beta_0 - \beta_k k_{jt} - \alpha[\hat{\phi}(k_{j, t - 1}, I_{j, t - 1}) - \beta_0 - \beta_k k_{j, t-1}]\}
\begin{bmatrix}
k_{jt} \\
k_{j, t - 1} \\
I_{j, t - 1}
\end{bmatrix}.
\]</span></p>
<ol start="5" style="list-style-type: decimal">
<li>Using the estimates in the first step, compute:
<span class="math display">\[
y_{jt} - \hat{\beta_l} l_{jt},
\]</span>
and:
<span class="math display">\[
\hat{\phi}(k_{j, t - 1}, I_{j, t - 1}),
\]</span>
for each <span class="math inline">\(j\)</span> and <span class="math inline">\(t\)</span> and save it as a data frame names <code>df_T_1st</code>.</li>
</ol>
<pre><code>## # A tibble: 10,000  4
##        j     t y_error_tilde phi_t_1[,1]
##    &lt;int&gt; &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;
##  1     1     1         2.34       NA    
##  2     1     2         1.37        2.21 
##  3     1     3         0.621       1.49 
##  4     1     4         0.447       0.882
##  5     1     5         0.878       0.611
##  6     1     6         1.62        0.926
##  7     1     7         0.558       1.40 
##  8     1     8         0.684       0.439
##  9     1     9         0.939       0.520
## 10     1    10         1.49        0.836
## #  with 9,990 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Compute a function that returns the value of <span class="math inline">\(g_{JT}(\alpha, \beta_0, \beta_k)\)</span> given parameter values, data, and <code>df_T_1st</code>, and name it <code>moment_OP_2nd</code>. Show the values of the moments evaluated at the true parameters.</li>
</ol>
<pre><code>## [1] -0.018507303 -0.019038229 -0.003867714</code></pre>
<p>Based on the moment, we can define the objective function of a generalized method of moments estimator with a weighting matrix <span class="math inline">\(W\)</span> as:
<span class="math display">\[
Q_{JT}(\alpha, \beta_0, \beta_k) \equiv g_{JT}(\alpha, \beta_0, \beta_k)&#39; W g_{JT}(\alpha, \beta_0, \beta_k).
\]</span></p>
<ol start="7" style="list-style-type: decimal">
<li>Write a function that returns the value of <span class="math inline">\(Q_{JT}(\alpha, \beta_0, \beta_k)\)</span> given the vector of parameter values, data, and <code>df_T_1st</code>, and name it <code>objective_OP_2nd</code>. Setting <span class="math inline">\(W\)</span> at the identity matrix, show the value of the objective function evaluated at the true parameters.</li>
</ol>
<pre><code>##              [,1]
## [1,] 0.0007199336</code></pre>
<ol start="8" style="list-style-type: decimal">
<li><p>Draw the graph of the objective function when one of <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta_0\)</span>, and <span class="math inline">\(\beta_k\)</span> are changed from 0 to 1 by 0.1 while the others are set at the true value. Is the objective function minimized at around the true value?
<img src="lecture_files/figure-html/unnamed-chunk-61-1.png" width="672" style="display: block; margin: auto;" /><img src="lecture_files/figure-html/unnamed-chunk-61-2.png" width="672" style="display: block; margin: auto;" /><img src="lecture_files/figure-html/unnamed-chunk-61-3.png" width="672" style="display: block; margin: auto;" /></p></li>
<li><p>Find the parameters that minimize the objective function using <code>optim</code>. You may use <code>L-BFGS-B</code> method to solve it.</p></li>
</ol>
<pre><code>## $par
## [1] 0.7020260 0.9766308 0.6693945
## 
## $value
## [1] 1.994601e-07
## 
## $counts
## function gradient 
##       10       10 
## 
## $convergence
## [1] 0
## 
## $message
## [1] &quot;CONVERGENCE: REL_REDUCTION_OF_F &lt;= FACTR*EPSMCH&quot;</code></pre>

</div>
<div id="simulate-data-2" class="section level2 hasAnchor" number="10.7">
<h2><span class="header-section-number">10.7</span> Simulate data<a href="applications.html#simulate-data-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We simulate data from a discrete choice model. There are <span class="math inline">\(T\)</span> markets and each market has <span class="math inline">\(N\)</span> consumers. There are <span class="math inline">\(J\)</span> products and the indirect utility of consumer <span class="math inline">\(i\)</span> in market <span class="math inline">\(t\)</span> for product <span class="math inline">\(j\)</span> is:
<span class="math display">\[
u_{itj} = \beta_{it}&#39; x_j + \alpha_{it} p_{jt} + \xi_{jt} + \epsilon_{ijt},
\]</span>
where <span class="math inline">\(\epsilon_{ijt}\)</span> is an i.i.d. type-I extreme random variable. <span class="math inline">\(x_j\)</span> is <span class="math inline">\(K\)</span>-dimensional observed characteristics of the product. <span class="math inline">\(p_{jt}\)</span> is the retail price of the product in the market.</p>
<p><span class="math inline">\(\xi_{jt}\)</span> is product-market specific fixed effect. <span class="math inline">\(p_{jt}\)</span> can be correlated with <span class="math inline">\(\xi_{jt}\)</span> but <span class="math inline">\(x_{jt}\)</span>s are independent of <span class="math inline">\(\xi_{jt}\)</span>. <span class="math inline">\(j = 0\)</span> is an outside option whose indirect utility is:
<span class="math display">\[
u_{it0} = \epsilon_{i0t},
\]</span>
where <span class="math inline">\(\epsilon_{i0t}\)</span> is an i.i.d. type-I extreme random variable.</p>
<p><span class="math inline">\(\beta_{it}\)</span> and <span class="math inline">\(\alpha_{it}\)</span> are different across consumers, and they are distributed as:
<span class="math display">\[
\beta_{itk} = \beta_{0k} + \sigma_k \nu_{itk},
\]</span>
<span class="math display">\[
\alpha_{it} = - \exp(\mu + \omega \upsilon_{it}) = - \exp(\mu + \frac{\omega^2}{2}) + [- \exp(\mu + \omega \upsilon_{it}) + \exp(\mu + \frac{\omega^2}{2})] \equiv \alpha_0 + \tilde{\alpha}_{it},
\]</span>
where <span class="math inline">\(\nu_{itk}\)</span> for <span class="math inline">\(k = 1, \cdots, K\)</span> and <span class="math inline">\(\upsilon_{it}\)</span> are i.i.d. standard normal random variables. <span class="math inline">\(\alpha_0\)</span> is the mean of <span class="math inline">\(\alpha_i\)</span> and <span class="math inline">\(\tilde{\alpha}_i\)</span> is the deviation from the mean.</p>
<p>Given a choice set in the market, <span class="math inline">\(\mathcal{J}_t \cup \{0\}\)</span>, a consumer chooses the alternative that maximizes her utility:
<span class="math display">\[
q_{ijt} = 1\{u_{ijt} = \max_{k \in \mathcal{J}_t \cup \{0\}} u_{ikt}\}.
\]</span>
The choice probability of product <span class="math inline">\(j\)</span> for consumer <span class="math inline">\(i\)</span> in market <span class="math inline">\(t\)</span> is:
<span class="math display">\[
\sigma_{jt}(p_t, x_t, \xi_t) = \mathbb{P}\{u_{ijt} = \max_{k \in \mathcal{J}_t \cup \{0\}} u_{ikt}\}.
\]</span></p>
<p>Suppose that we only observe the share data:
<span class="math display">\[
s_{jt} = \frac{1}{N} \sum_{i = 1}^N q_{ijt},
\]</span>
along with the product-market characteristics <span class="math inline">\(x_{jt}\)</span> and the retail prices <span class="math inline">\(p_{jt}\)</span> for <span class="math inline">\(j \in \mathcal{J}_t \cup \{0\}\)</span> for <span class="math inline">\(t = 1, \cdots, T\)</span>. We do not observe the choice data <span class="math inline">\(q_{ijt}\)</span> nor shocks <span class="math inline">\(\xi_{jt}, \nu_{it}, \upsilon_{it}, \epsilon_{ijt}\)</span>.</p>
<p>In this assignment, we consider a model with <span class="math inline">\(\xi_{jt} = 0\)</span>, i.e., the model without the unobserved fixed effects. However, the code to simulate data should be written for general <span class="math inline">\(\xi_{jt}\)</span>, so that we can use the same code in the next assignment in which we consider a model with the unobserved fixed effects.</p>
<ol style="list-style-type: decimal">
<li>Set the seed, constants, and parameters of interest as follows.</li>
</ol>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="applications.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set the seed</span></span>
<span id="cb75-2"><a href="applications.html#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb75-3"><a href="applications.html#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co"># number of products</span></span>
<span id="cb75-4"><a href="applications.html#cb75-4" aria-hidden="true" tabindex="-1"></a>J <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb75-5"><a href="applications.html#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="co"># dimension of product characteristics including the intercept</span></span>
<span id="cb75-6"><a href="applications.html#cb75-6" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb75-7"><a href="applications.html#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="co"># number of markets</span></span>
<span id="cb75-8"><a href="applications.html#cb75-8" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb75-9"><a href="applications.html#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="co"># number of consumers per market</span></span>
<span id="cb75-10"><a href="applications.html#cb75-10" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb75-11"><a href="applications.html#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="co"># number of Monte Carlo</span></span>
<span id="cb75-12"><a href="applications.html#cb75-12" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="dv">500</span></span></code></pre></div>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="applications.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set parameters of interests</span></span>
<span id="cb76-2"><a href="applications.html#cb76-2" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(K); </span>
<span id="cb76-3"><a href="applications.html#cb76-3" aria-hidden="true" tabindex="-1"></a>beta[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb76-4"><a href="applications.html#cb76-4" aria-hidden="true" tabindex="-1"></a>beta</span></code></pre></div>
<pre><code>## [1]  4.0000000  0.1836433 -0.8356286</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="applications.html#cb78-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(K)); sigma</span></code></pre></div>
<pre><code>## [1] 1.5952808 0.3295078 0.8204684</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="applications.html#cb80-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb80-2"><a href="applications.html#cb80-2" aria-hidden="true" tabindex="-1"></a>omega <span class="ot">&lt;-</span> <span class="dv">1</span></span></code></pre></div>
<p>Generate the covariates as follows.</p>
<p>The product-market characteristics:
<span class="math display">\[
x_{j1} = 1, x_{jk} \sim N(0, \sigma_x), k = 2, \cdots, K,
\]</span>
where <span class="math inline">\(\sigma_x\)</span> is referred to as <code>sd_x</code> in the code.</p>
<p>The product-market-specific unobserved fixed effect:
<span class="math display">\[
\xi_{jt} = 0.
\]</span>
The marginal cost of product <span class="math inline">\(j\)</span> in market <span class="math inline">\(t\)</span>:
<span class="math display">\[
c_{jt} \sim \text{logNormal}(0, \sigma_c),
\]</span>
where <span class="math inline">\(\sigma_c\)</span> is referred to as <code>sd_c</code> in the code.</p>
<p>The retail price:
<span class="math display">\[
p_{jt} - c_{jt} \sim \text{logNorm}(\gamma \xi_{jt}, \sigma_p),
\]</span>
where <span class="math inline">\(\gamma\)</span> is referred to as <code>price_xi</code> and <span class="math inline">\(\sigma_p\)</span> as <code>sd_p</code> in the code. This price is not the equilibrium price. We will revisit this point in a subsequent assignment.</p>
<p>The value of the auxiliary parameters are set as follows:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="applications.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set auxiliary parameters</span></span>
<span id="cb81-2"><a href="applications.html#cb81-2" aria-hidden="true" tabindex="-1"></a>price_xi <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb81-3"><a href="applications.html#cb81-3" aria-hidden="true" tabindex="-1"></a>prop_jt <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb81-4"><a href="applications.html#cb81-4" aria-hidden="true" tabindex="-1"></a>sd_x <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb81-5"><a href="applications.html#cb81-5" aria-hidden="true" tabindex="-1"></a>sd_c <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb81-6"><a href="applications.html#cb81-6" aria-hidden="true" tabindex="-1"></a>sd_p <span class="ot">&lt;-</span> <span class="fl">0.05</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><code>X</code> is the data frame such that a row contains the characteristics vector <span class="math inline">\(x_{j}\)</span> of a product and columns are product index and observed product characteristics. The dimension of the characteristics <span class="math inline">\(K\)</span> is specified above. Add the row of the outside option whose index is <span class="math inline">\(0\)</span> and all the characteristics are zero.</li>
</ol>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="applications.html#cb82-1" aria-hidden="true" tabindex="-1"></a>X</span></code></pre></div>
<pre><code>## # A tibble: 11  4
##        j   x_1     x_2      x_3
##    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1     0     0  0       0      
##  2     1     1  0.244  -0.00810
##  3     2     1  0.369   0.472  
##  4     3     1  0.288   0.411  
##  5     4     1 -0.153   0.297  
##  6     5     1  0.756   0.459  
##  7     6     1  0.195   0.391  
##  8     7     1 -0.311   0.0373 
##  9     8     1 -1.11   -0.995  
## 10     9     1  0.562   0.310  
## 11    10     1 -0.0225 -0.0281</code></pre>
<ol start="3" style="list-style-type: decimal">
<li><code>M</code> is the data frame such that a row contains the price <span class="math inline">\(\xi_{jt}\)</span>, marginal cost <span class="math inline">\(c_{jt}\)</span>, and price <span class="math inline">\(p_{jt}\)</span>. After generating the variables, drop <code>1 - prop_jt</code> products from each market using <code>dplyr::sample_frac</code> function. The variation in the available products is important for the identification of the distribution of consumer-level unobserved heterogeneity. Add the row of the outside option to each market whose index is <span class="math inline">\(0\)</span> and all the variables take value zero.</li>
</ol>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="applications.html#cb84-1" aria-hidden="true" tabindex="-1"></a>M</span></code></pre></div>
<pre><code>## # A tibble: 700  5
##        j     t    xi     c     p
##    &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     0     1     0 0      0   
##  2     2     1     0 0.929  1.97
##  3     3     1     0 0.976  1.91
##  4     4     1     0 1.02   2.05
##  5     6     1     0 0.995  1.98
##  6     7     1     0 1.02   1.98
##  7     8     1     0 0.997  1.99
##  8     0     2     0 0      0   
##  9     1     2     0 0.980  1.97
## 10     4     2     0 1.04   2.04
## #  with 690 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Generate the consumer-level heterogeneity. <code>V</code> is the data frame such that a row contains the vector of shocks to consumer-level heterogeneity, <span class="math inline">\((\nu_{i}&#39;, \upsilon_i)\)</span>. They are all i.i.d. standard normal random variables.</li>
</ol>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="applications.html#cb86-1" aria-hidden="true" tabindex="-1"></a>V</span></code></pre></div>
<pre><code>## # A tibble: 50,000  6
##        i     t  v_x_1   v_x_2  v_x_3     v_p
##    &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
##  1     1     1  1.32  -0.0670 -0.758 -0.590 
##  2     2     1  0.930  1.34    1.16   0.0684
##  3     3     1  1.08   0.768  -0.725 -0.130 
##  4     4     1 -0.300  0.156  -0.641 -0.896 
##  5     5     1  1.04   1.17   -0.224  1.31  
##  6     6     1  0.709 -0.286   0.948  1.15  
##  7     7     1 -1.27   0.193  -0.212 -0.156 
##  8     8     1 -0.932 -0.780   1.49  -0.362 
##  9     9     1  1.37  -0.205   0.594 -0.998 
## 10    10     1 -0.461 -0.834   0.221 -1.62  
## #  with 49,990 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Join <code>X</code>, <code>M</code>, <code>V</code> using <code>dplyr::left_join</code> and name it <code>df</code>. <code>df</code> is the data frame such that a row contains variables for a consumer about a product that is available in a market.</li>
</ol>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="applications.html#cb88-1" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 350,000  13
##        t     i     j v_x_1   v_x_2  v_x_3     v_p   x_1    x_2     x_3    xi     c
##    &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1     1     0 1.32  -0.0670 -0.758 -0.590      0  0      0          0 0    
##  2     1     1     2 1.32  -0.0670 -0.758 -0.590      1  0.369  0.472      0 0.929
##  3     1     1     3 1.32  -0.0670 -0.758 -0.590      1  0.288  0.411      0 0.976
##  4     1     1     4 1.32  -0.0670 -0.758 -0.590      1 -0.153  0.297      0 1.02 
##  5     1     1     6 1.32  -0.0670 -0.758 -0.590      1  0.195  0.391      0 0.995
##  6     1     1     7 1.32  -0.0670 -0.758 -0.590      1 -0.311  0.0373     0 1.02 
##  7     1     1     8 1.32  -0.0670 -0.758 -0.590      1 -1.11  -0.995      0 0.997
##  8     1     2     0 0.930  1.34    1.16   0.0684     0  0      0          0 0    
##  9     1     2     2 0.930  1.34    1.16   0.0684     1  0.369  0.472      0 0.929
## 10     1     2     3 0.930  1.34    1.16   0.0684     1  0.288  0.411      0 0.976
## #  with 349,990 more rows, and 1 more variable: p &lt;dbl&gt;
## #  Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Draw a vector of preference shocks <code>e</code> whose length is the same as the number of rows of <code>df</code>.</li>
</ol>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="applications.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(e)</span></code></pre></div>
<pre><code>## [1]  0.32969177 -1.03771238  1.41496338  5.02048718 -0.01302806  0.57956001</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Write a function <code>compute_indirect_utility(df, beta, sigma, mu, omega)</code> that returns a vector whose element is the mean indirect utility of a product for a consumer in a market. The output should have the same length with <span class="math inline">\(e\)</span>.</li>
</ol>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="applications.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute indirect utility</span></span>
<span id="cb92-2"><a href="applications.html#cb92-2" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> </span>
<span id="cb92-3"><a href="applications.html#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_indirect_utility</span>(</span>
<span id="cb92-4"><a href="applications.html#cb92-4" aria-hidden="true" tabindex="-1"></a>    df, beta, sigma, </span>
<span id="cb92-5"><a href="applications.html#cb92-5" aria-hidden="true" tabindex="-1"></a>           mu, omega)</span>
<span id="cb92-6"><a href="applications.html#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(u)</span></code></pre></div>
<pre><code>##             u
## [1,] 0.000000
## [2,] 3.681882
## [3,] 3.807728
## [4,] 3.779036
## [5,] 3.764454
## [6,] 4.193113</code></pre>
<ol start="8" style="list-style-type: decimal">
<li>Write a function <code>compute_choice(X, M, V, e, beta, sigma, mu, omega)</code> that first construct <code>df</code> from <code>X</code>, <code>M</code>, <code>V</code>, second call <code>compute_indirect_utility</code> to obtain the vector of mean indirect utilities <code>u</code>, third compute the choice vector <code>q</code> based on the vector of mean indirect utilities and <code>e</code>, and finally return the data frame to which <code>u</code> and <code>q</code> are added as columns.</li>
</ol>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="applications.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute choice</span></span>
<span id="cb94-2"><a href="applications.html#cb94-2" aria-hidden="true" tabindex="-1"></a>df_choice <span class="ot">&lt;-</span> </span>
<span id="cb94-3"><a href="applications.html#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_choice</span>(X, M, V, e, beta, sigma, </span>
<span id="cb94-4"><a href="applications.html#cb94-4" aria-hidden="true" tabindex="-1"></a>                 mu, omega)</span>
<span id="cb94-5"><a href="applications.html#cb94-5" aria-hidden="true" tabindex="-1"></a>df_choice</span></code></pre></div>
<pre><code>## # A tibble: 350,000  16
##        t     i     j v_x_1   v_x_2  v_x_3     v_p   x_1    x_2     x_3    xi     c
##    &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1     1     0 1.32  -0.0670 -0.758 -0.590      0  0      0          0 0    
##  2     1     1     2 1.32  -0.0670 -0.758 -0.590      1  0.369  0.472      0 0.929
##  3     1     1     3 1.32  -0.0670 -0.758 -0.590      1  0.288  0.411      0 0.976
##  4     1     1     4 1.32  -0.0670 -0.758 -0.590      1 -0.153  0.297      0 1.02 
##  5     1     1     6 1.32  -0.0670 -0.758 -0.590      1  0.195  0.391      0 0.995
##  6     1     1     7 1.32  -0.0670 -0.758 -0.590      1 -0.311  0.0373     0 1.02 
##  7     1     1     8 1.32  -0.0670 -0.758 -0.590      1 -1.11  -0.995      0 0.997
##  8     1     2     0 0.930  1.34    1.16   0.0684     0  0      0          0 0    
##  9     1     2     2 0.930  1.34    1.16   0.0684     1  0.369  0.472      0 0.929
## 10     1     2     3 0.930  1.34    1.16   0.0684     1  0.288  0.411      0 0.976
## #  with 349,990 more rows, and 4 more variables: p &lt;dbl&gt;, u &lt;dbl&gt;, e &lt;dbl&gt;, q &lt;dbl&gt;
## #  Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="applications.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df_choice)</span></code></pre></div>
<pre><code>##        t                i               j              v_x_1          
##  Min.   :  1.00   Min.   :  1.0   Min.   : 0.000   Min.   :-4.302781  
##  1st Qu.: 25.75   1st Qu.:125.8   1st Qu.: 2.000   1st Qu.:-0.683141  
##  Median : 50.50   Median :250.5   Median : 5.000   Median : 0.001562  
##  Mean   : 50.50   Mean   :250.5   Mean   : 4.791   Mean   :-0.002669  
##  3rd Qu.: 75.25   3rd Qu.:375.2   3rd Qu.: 8.000   3rd Qu.: 0.669657  
##  Max.   :100.00   Max.   :500.0   Max.   :10.000   Max.   : 3.809895  
##      v_x_2               v_x_3                v_p                 x_1        
##  Min.   :-4.542122   Min.   :-3.957618   Min.   :-4.218131   Min.   :0.0000  
##  1st Qu.:-0.680086   1st Qu.:-0.673321   1st Qu.:-0.671449   1st Qu.:1.0000  
##  Median : 0.002374   Median : 0.004941   Median : 0.001083   Median :1.0000  
##  Mean   :-0.000890   Mean   : 0.003589   Mean   :-0.002011   Mean   :0.8571  
##  3rd Qu.: 0.673194   3rd Qu.: 0.676967   3rd Qu.: 0.671318   3rd Qu.:1.0000  
##  Max.   : 4.313621   Max.   : 4.244194   Max.   : 4.017246   Max.   :1.0000  
##       x_2                x_3                xi          c                p        
##  Min.   :-1.10735   Min.   :-0.9947   Min.   :0   Min.   :0.0000   Min.   :0.000  
##  1st Qu.:-0.15269   1st Qu.: 0.0000   1st Qu.:0   1st Qu.:0.9404   1st Qu.:1.913  
##  Median : 0.19492   Median : 0.2970   Median :0   Median :0.9841   Median :1.981  
##  Mean   : 0.05989   Mean   : 0.1128   Mean   :0   Mean   :0.8560   Mean   :1.712  
##  3rd Qu.: 0.36916   3rd Qu.: 0.3911   3rd Qu.:0   3rd Qu.:1.0260   3rd Qu.:2.039  
##  Max.   : 0.75589   Max.   : 0.4719   Max.   :0   Max.   :1.2099   Max.   :2.293  
##        u                  e                 q         
##  Min.   :-190.479   Min.   :-2.6364   Min.   :0.0000  
##  1st Qu.:  -2.177   1st Qu.:-0.3301   1st Qu.:0.0000  
##  Median :   0.000   Median : 0.3635   Median :0.0000  
##  Mean   :  -1.291   Mean   : 0.5763   Mean   :0.1429  
##  3rd Qu.:   1.978   3rd Qu.: 1.2418   3rd Qu.:0.0000  
##  Max.   :  10.909   Max.   :14.0966   Max.   :1.0000</code></pre>
<ol start="9" style="list-style-type: decimal">
<li>Write a function <code>compute_share(X, M, V, e, beta, sigma, mu, omega)</code> that first construct <code>df</code> from <code>X</code>, <code>M</code>, <code>V</code>, second call <code>compute_choice</code> to obtain a data frame with <code>u</code> and <code>q</code>, third compute the share of each product at each market <code>s</code> and the log difference in the share from the outside option, <span class="math inline">\(\ln(s_{jt}/s_{0t})\)</span>, denoted by <code>y</code>, and finally return the data frame that is summarized at the product-market level, dropped consumer-level variables, and added <code>s</code> and <code>y</code>.</li>
</ol>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="applications.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute share</span></span>
<span id="cb98-2"><a href="applications.html#cb98-2" aria-hidden="true" tabindex="-1"></a>df_share <span class="ot">&lt;-</span></span>
<span id="cb98-3"><a href="applications.html#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_share</span>(X, M, V, e, beta, sigma, </span>
<span id="cb98-4"><a href="applications.html#cb98-4" aria-hidden="true" tabindex="-1"></a>                mu, omega)</span>
<span id="cb98-5"><a href="applications.html#cb98-5" aria-hidden="true" tabindex="-1"></a>df_share</span></code></pre></div>
<pre><code>## # A tibble: 700  11
##        t     j   x_1    x_2      x_3    xi     c     p     q     s       y
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
##  1     1     0     0  0      0           0 0      0      144 0.288  0     
##  2     1     2     1  0.369  0.472       0 0.929  1.97    47 0.094 -1.12  
##  3     1     3     1  0.288  0.411       0 0.976  1.91    37 0.074 -1.36  
##  4     1     4     1 -0.153  0.297       0 1.02   2.05    35 0.07  -1.41  
##  5     1     6     1  0.195  0.391       0 0.995  1.98    60 0.12  -0.875 
##  6     1     7     1 -0.311  0.0373      0 1.02   1.98    44 0.088 -1.19  
##  7     1     8     1 -1.11  -0.995       0 0.997  1.99   133 0.266 -0.0795
##  8     2     0     0  0      0           0 0      0      170 0.34   0     
##  9     2     1     1  0.244 -0.00810     0 0.980  1.97    84 0.168 -0.705 
## 10     2     4     1 -0.153  0.297       0 1.04   2.04    35 0.07  -1.58  
## #  with 690 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="applications.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df_share)</span></code></pre></div>
<pre><code>##        t                j               x_1              x_2          
##  Min.   :  1.00   Min.   : 0.000   Min.   :0.0000   Min.   :-1.10735  
##  1st Qu.: 25.75   1st Qu.: 2.000   1st Qu.:1.0000   1st Qu.:-0.15269  
##  Median : 50.50   Median : 5.000   Median :1.0000   Median : 0.19492  
##  Mean   : 50.50   Mean   : 4.791   Mean   :0.8571   Mean   : 0.05989  
##  3rd Qu.: 75.25   3rd Qu.: 8.000   3rd Qu.:1.0000   3rd Qu.: 0.36916  
##  Max.   :100.00   Max.   :10.000   Max.   :1.0000   Max.   : 0.75589  
##       x_3                xi          c                p               q         
##  Min.   :-0.9947   Min.   :0   Min.   :0.0000   Min.   :0.000   Min.   : 26.00  
##  1st Qu.: 0.0000   1st Qu.:0   1st Qu.:0.9404   1st Qu.:1.913   1st Qu.: 43.00  
##  Median : 0.2970   Median :0   Median :0.9841   Median :1.981   Median : 52.00  
##  Mean   : 0.1128   Mean   :0   Mean   :0.8560   Mean   :1.712   Mean   : 71.43  
##  3rd Qu.: 0.3911   3rd Qu.:0   3rd Qu.:1.0260   3rd Qu.:2.039   3rd Qu.: 73.00  
##  Max.   : 0.4719   Max.   :0   Max.   :1.2099   Max.   :2.293   Max.   :195.00  
##        s                y           
##  Min.   :0.0520   Min.   :-1.89354  
##  1st Qu.:0.0860   1st Qu.:-1.35812  
##  Median :0.1040   Median :-1.16644  
##  Mean   :0.1429   Mean   :-0.99214  
##  3rd Qu.:0.1460   3rd Qu.:-0.81801  
##  Max.   :0.3900   Max.   : 0.05196</code></pre>
</div>
<div id="estimate-the-parameters-1" class="section level2 hasAnchor" number="10.8">
<h2><span class="header-section-number">10.8</span> Estimate the parameters<a href="applications.html#estimate-the-parameters-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>Estimate the parameters assuming there is no consumer-level heterogeneity, i.e., by assuming:
<span class="math display">\[
\ln \frac{s_{jt}}{s_{0t}} = \beta&#39; x_{jt} + \alpha p_{jt}.
\]</span>
This can be implemented using <code>lm</code> function. Print out the estimate results.</li>
</ol>
<pre><code>## 
## Call:
## lm(formula = y ~ -1 + x_1 + x_2 + x_3 + p, data = df_share)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.57415 -0.09781  0.00000  0.10491  0.51149 
## 
## Coefficients:
##     Estimate Std. Error t value Pr(&gt;|t|)    
## x_1  1.20614    0.18150   6.646 6.10e-11 ***
## x_2  0.21995    0.02841   7.741 3.49e-14 ***
## x_3 -0.92818    0.03364 -27.589  &lt; 2e-16 ***
## p   -1.12982    0.09086 -12.435  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1677 on 696 degrees of freedom
## Multiple R-squared:  0.9778, Adjusted R-squared:  0.9777 
## F-statistic:  7678 on 4 and 696 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>We estimate the model using simulated share.</p>
<p>When optimizing an objective function that uses the Monte Carlo simulation, it is important to keep the realizations of the shocks the same across the evaluations of the objective function. If the realization of the shocks differ across the objective function evaluations, the optimization algorithm will not converge because it cannot distinguish the change in the value of the objective function due to the difference in the parameters and the difference in the realized shocks.</p>
<p>The best practice to avoid this problem is to generate the shocks outside the optimization algorithm as in the current case. If the size of the shocks can be too large to store in the memory, the second best practice is to make sure to set the seed inside the optimization algorithm so that the realized shocks are the same across function evaluations.</p>
<ol start="2" style="list-style-type: decimal">
<li>For this reason, we first draw Monte Carlo consumer-level heterogeneity <code>V_mcmc</code> and Monte Carlo preference shocks <code>e_mcmc</code>. The number of simulations is <code>L</code>. This does not have to be the same with the actual number of consumers <code>N</code>.</li>
</ol>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="applications.html#cb103-1" aria-hidden="true" tabindex="-1"></a>V_mcmc</span></code></pre></div>
<pre><code>## # A tibble: 50,000  6
##        i     t   v_x_1  v_x_2   v_x_3    v_p
##    &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1     1     1 -0.715  -0.798 -0.548   1.09 
##  2     2     1  0.0243 -0.943 -1.88    0.471
##  3     3     1 -0.183   0.660  0.669   1.45 
##  4     4     1  0.0207  3.36  -0.363   1.58 
##  5     5     1 -1.94    0.221  1.02    0.943
##  6     6     1  0.876  -0.636  0.0432  0.324
##  7     7     1  1.96   -0.195 -0.0950  1.39 
##  8     8     1  1.11    0.571  1.77    0.497
##  9     9     1  1.45    0.154  1.96    0.740
## 10    10     1 -1.00   -0.413  0.0542 -0.469
## #  with 49,990 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="applications.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(e_mcmc)</span></code></pre></div>
<pre><code>## [1]  0.265602821  0.652183731 -0.006127627 -0.317288366  3.145022297 -1.277026910</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Use <code>compute_share</code> to check the simulated share at the true parameter using the Monte Carlo shocks. Remember that the number of consumers should be set at <code>L</code> instead of <code>N</code>.</li>
</ol>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="applications.html#cb107-1" aria-hidden="true" tabindex="-1"></a>df_share_mcmc</span></code></pre></div>
<pre><code>## # A tibble: 700  11
##        t     j   x_1    x_2      x_3    xi     c     p     q     s      y
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1     1     0     0  0      0           0 0      0      171 0.342  0    
##  2     1     2     1  0.369  0.472       0 0.929  1.97    46 0.092 -1.31 
##  3     1     3     1  0.288  0.411       0 0.976  1.91    37 0.074 -1.53 
##  4     1     4     1 -0.153  0.297       0 1.02   2.05    38 0.076 -1.50 
##  5     1     6     1  0.195  0.391       0 0.995  1.98    38 0.076 -1.50 
##  6     1     7     1 -0.311  0.0373      0 1.02   1.98    52 0.104 -1.19 
##  7     1     8     1 -1.11  -0.995       0 0.997  1.99   118 0.236 -0.371
##  8     2     0     0  0      0           0 0      0      194 0.388  0    
##  9     2     1     1  0.244 -0.00810     0 0.980  1.97    62 0.124 -1.14 
## 10     2     4     1 -0.153  0.297       0 1.04   2.04    37 0.074 -1.66 
## #  with 690 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Vectorize the parameters to a vector <code>theta</code> because <code>optim</code> requires the maximiand to be a vector.</li>
</ol>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="applications.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set parameters</span></span>
<span id="cb109-2"><a href="applications.html#cb109-2" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">c</span>(beta, sigma, mu, omega)</span>
<span id="cb109-3"><a href="applications.html#cb109-3" aria-hidden="true" tabindex="-1"></a>theta</span></code></pre></div>
<pre><code>## [1]  4.0000000  0.1836433 -0.8356286  1.5952808  0.3295078  0.8204684  0.5000000
## [8]  1.0000000</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Write a function <code>NLLS_objective_A3(theta, df_share, X, M, V_mcmc, e_mcmc)</code> that first computes the simulated share and then compute the mean-squared error between the share data.</li>
</ol>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="applications.html#cb111-1" aria-hidden="true" tabindex="-1"></a>NLLS_objective</span></code></pre></div>
<pre><code>## [1] 0.0004815657</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Draw a graph of the objective function that varies each parameter from 0.5, 0.6, <span class="math inline">\(\cdots\)</span>, 1.5 of the true value. First try with the actual shocks <code>V</code> and <code>e</code> and then try with the Monte Carlo shocks <code>V_mcmc</code> and <code>e_mcmc</code>. You will some of the graph does not look good with the Monte Carlo shocks. It will cause the approximation error.</li>
</ol>
<p>Because this takes time, you may want to parallelize the computation using <code>%dopar</code> functionality of <code>foreach</code> loop. To do so, first install <code>doParallel</code> package and then load it and register the workers as follows:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="applications.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>()</span></code></pre></div>
<p>This automatically detect the number of cores available at your computer and registers them as the workers. Then, you only have to change <code>%do%</code> to <code>%dopar</code> in the <code>foreach</code> loop as follows:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="applications.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">foreach</span> (<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">%dopar%</span> {</span>
<span id="cb114-2"><a href="applications.html#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this part is parallelized</span></span>
<span id="cb114-3"><a href="applications.html#cb114-3" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> i</span>
<span id="cb114-4"><a href="applications.html#cb114-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb114-5"><a href="applications.html#cb114-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [[1]]
## [1] 2
## 
## [[2]]
## [1] 4
## 
## [[3]]
## [1] 6
## 
## [[4]]
## [1] 8</code></pre>
<p>In windows, you may have to explicitly pass packages, functions, and data to the worker by using <code>.export</code> and <code>.packages</code> options as follows:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="applications.html#cb116-1" aria-hidden="true" tabindex="-1"></a>temp_func <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb116-2"><a href="applications.html#cb116-2" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> x</span>
<span id="cb116-3"><a href="applications.html#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb116-4"><a href="applications.html#cb116-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb116-5"><a href="applications.html#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="fu">foreach</span> (<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, </span>
<span id="cb116-6"><a href="applications.html#cb116-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">.export =</span> <span class="st">&quot;temp_func&quot;</span>,</span>
<span id="cb116-7"><a href="applications.html#cb116-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">.packages =</span> <span class="st">&quot;magrittr&quot;</span>) <span class="sc">%dopar%</span> {</span>
<span id="cb116-8"><a href="applications.html#cb116-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this part is parallelized</span></span>
<span id="cb116-9"><a href="applications.html#cb116-9" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">temp_func</span>(i)</span>
<span id="cb116-10"><a href="applications.html#cb116-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb116-11"><a href="applications.html#cb116-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Warning in e$fun(obj, substitute(ex), parent.frame(), e$data): already exporting
## variable(s): temp_func</code></pre>
<pre><code>## [[1]]
## [1] 2
## 
## [[2]]
## [1] 4
## 
## [[3]]
## [1] 6
## 
## [[4]]
## [1] 8</code></pre>
<p>If you have called a function in a package in this way <code>dplyr::mutate</code>, then you will not have to pass <code>dplyr</code> by <code>.packages</code> option. This is one of the reasons why I prefer to explicitly call the package every time I call a function. If you have compiled your functions in a package, you will just have to pass the package as follows:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="applications.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this function is compiled in the package EmpiricalIO</span></span>
<span id="cb119-2"><a href="applications.html#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="co"># temp_func &lt;- function(x) {</span></span>
<span id="cb119-3"><a href="applications.html#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   y &lt;- 2 * x</span></span>
<span id="cb119-4"><a href="applications.html#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   return(y)</span></span>
<span id="cb119-5"><a href="applications.html#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb119-6"><a href="applications.html#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="fu">foreach</span> (<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, </span>
<span id="cb119-7"><a href="applications.html#cb119-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">.packages =</span> <span class="fu">c</span>(</span>
<span id="cb119-8"><a href="applications.html#cb119-8" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;EmpiricalIO&quot;</span>,</span>
<span id="cb119-9"><a href="applications.html#cb119-9" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;magrittr&quot;</span>)) <span class="sc">%dopar%</span> {</span>
<span id="cb119-10"><a href="applications.html#cb119-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this part is parallelized</span></span>
<span id="cb119-11"><a href="applications.html#cb119-11" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">temp_func</span>(i)</span>
<span id="cb119-12"><a href="applications.html#cb119-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb119-13"><a href="applications.html#cb119-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [[1]]
## [1] 2
## 
## [[2]]
## [1] 4
## 
## [[3]]
## [1] 6
## 
## [[4]]
## [1] 8</code></pre>
<p>The graphs with the true shocks:</p>
<pre><code>## [[1]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-94-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-94-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-94-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[4]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-94-4.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[5]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-94-5.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[6]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-94-6.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[7]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-94-7.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[8]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-94-8.png" width="672" style="display: block; margin: auto;" /></p>
<p>The graphs with the Monte Carlo shocks:</p>
<pre><code>## [[1]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-96-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-96-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-96-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[4]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-96-4.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[5]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-96-5.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[6]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-96-6.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[7]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-96-7.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[8]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-96-8.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>Use <code>optim</code> to find the minimizer of the objective function using <code>Nelder-Mead</code> method. You can start from the true parameter values. Compare the estimates with the true parameters.</li>
</ol>
<pre><code>## $par
## [1]  3.9907237  0.1778582 -0.8244977  1.5326774  0.3602383  0.9336009  0.4883030
## [8]  1.0462494
## 
## $value
## [1] 0.0004678286
## 
## $counts
## function gradient 
##      237       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<pre><code>##         true  estimates
## 1  4.0000000  3.9907237
## 2  0.1836433  0.1778582
## 3 -0.8356286 -0.8244977
## 4  1.5952808  1.5326774
## 5  0.3295078  0.3602383
## 6  0.8204684  0.9336009
## 7  0.5000000  0.4883030
## 8  1.0000000  1.0462494</code></pre>

</div>
<div id="simulate-data-3" class="section level2 hasAnchor" number="10.9">
<h2><span class="header-section-number">10.9</span> Simulate data<a href="applications.html#simulate-data-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Be carefull that some parameters are changed from assignment 3</strong>. We simulate data from a discrete choice model that is the same with in assignment 3 except for the existence of unobserved product-specific fixed effects. There are <span class="math inline">\(T\)</span> markets and each market has <span class="math inline">\(N\)</span> consumers. There are <span class="math inline">\(J\)</span> products and the indirect utility of consumer <span class="math inline">\(i\)</span> in market <span class="math inline">\(t\)</span> for product <span class="math inline">\(j\)</span> is:
<span class="math display">\[
u_{itj} = \beta_{it}&#39; x_j + \alpha_{it} p_{jt} + \xi_{jt} + \epsilon_{ijt},
\]</span>
where <span class="math inline">\(\epsilon_{ijt}\)</span> is an i.i.d. type-I extreme random variable. <span class="math inline">\(x_j\)</span> is <span class="math inline">\(K\)</span>-dimensional observed characteristics of the product. <span class="math inline">\(p_{jt}\)</span> is the retail price of the product in the market.</p>
<p><span class="math inline">\(\xi_{jt}\)</span> is product-market specific fixed effect. <span class="math inline">\(p_{jt}\)</span> can be correlated with <span class="math inline">\(\xi_{jt}\)</span> but <span class="math inline">\(x_{jt}\)</span>s are independent of <span class="math inline">\(\xi_{jt}\)</span>. <span class="math inline">\(j = 0\)</span> is an outside option whose indirect utility is:
<span class="math display">\[
u_{it0} = \epsilon_{i0t},
\]</span>
where <span class="math inline">\(\epsilon_{i0t}\)</span> is an i.i.d. type-I extreme random variable.</p>
<p><span class="math inline">\(\beta_{it}\)</span> and <span class="math inline">\(\alpha_{it}\)</span> are different across consumers, and they are distributed as:
<span class="math display">\[
\beta_{itk} = \beta_{0k} + \sigma_k \nu_{itk},
\]</span>
<span class="math display">\[
\alpha_{it} = - \exp(\mu + \omega \upsilon_{it}) = - \exp(\mu + \frac{\omega^2}{2}) + [- \exp(\mu + \omega \upsilon_{it}) + \exp(\mu + \frac{\omega^2}{2})] \equiv \alpha_0 + \tilde{\alpha}_{it},
\]</span>
where <span class="math inline">\(\nu_{itk}\)</span> for <span class="math inline">\(k = 1, \cdots, K\)</span> and <span class="math inline">\(\upsilon_{it}\)</span> are i.i.d. standard normal random variables. <span class="math inline">\(\alpha_0\)</span> is the mean of <span class="math inline">\(\alpha_i\)</span> and <span class="math inline">\(\tilde{\alpha}_i\)</span> is the deviation from the mean.</p>
<p>Given a choice set in the market, <span class="math inline">\(\mathcal{J}_t \cup \{0\}\)</span>, a consumer chooses the alternative that maximizes her utility:
<span class="math display">\[
q_{ijt} = 1\{u_{ijt} = \max_{k \in \mathcal{J}_t \cup \{0\}} u_{ikt}\}.
\]</span>
The choice probability of product <span class="math inline">\(j\)</span> for consumer <span class="math inline">\(i\)</span> in market <span class="math inline">\(t\)</span> is:
<span class="math display">\[
\sigma_{jt}(p_t, x_t, \xi_t) = \mathbb{P}\{u_{ijt} = \max_{k \in \mathcal{J}_t \cup \{0\}} u_{ikt}\}.
\]</span></p>
<p>Suppose that we only observe the share data:
<span class="math display">\[
s_{jt} = \frac{1}{N} \sum_{i = 1}^N q_{ijt},
\]</span>
along with the product-market characteristics <span class="math inline">\(x_{jt}\)</span> and the retail prices <span class="math inline">\(p_{jt}\)</span> for <span class="math inline">\(j \in \mathcal{J}_t \cup \{0\}\)</span> for <span class="math inline">\(t = 1, \cdots, T\)</span>. We do not observe the choice data <span class="math inline">\(q_{ijt}\)</span> nor shocks <span class="math inline">\(\xi_{jt}, \nu_{it}, \upsilon_{it}, \epsilon_{ijt}\)</span>.</p>
<p>We draw <span class="math inline">\(\xi_{jt}\)</span> from i.i.d. normal distribution with mean 0 and standard deviation <span class="math inline">\(\sigma_{\xi}\)</span>.</p>
<ol style="list-style-type: decimal">
<li>Set the seed, constants, and parameters of interest as follows.</li>
</ol>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="applications.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set the seed</span></span>
<span id="cb139-2"><a href="applications.html#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb139-3"><a href="applications.html#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="co"># number of products</span></span>
<span id="cb139-4"><a href="applications.html#cb139-4" aria-hidden="true" tabindex="-1"></a>J <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb139-5"><a href="applications.html#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="co"># dimension of product characteristics including the intercept</span></span>
<span id="cb139-6"><a href="applications.html#cb139-6" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb139-7"><a href="applications.html#cb139-7" aria-hidden="true" tabindex="-1"></a><span class="co"># number of markets</span></span>
<span id="cb139-8"><a href="applications.html#cb139-8" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb139-9"><a href="applications.html#cb139-9" aria-hidden="true" tabindex="-1"></a><span class="co"># number of consumers per market</span></span>
<span id="cb139-10"><a href="applications.html#cb139-10" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb139-11"><a href="applications.html#cb139-11" aria-hidden="true" tabindex="-1"></a><span class="co"># number of Monte Carlo</span></span>
<span id="cb139-12"><a href="applications.html#cb139-12" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="dv">500</span></span></code></pre></div>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="applications.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set parameters of interests</span></span>
<span id="cb140-2"><a href="applications.html#cb140-2" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(K); </span>
<span id="cb140-3"><a href="applications.html#cb140-3" aria-hidden="true" tabindex="-1"></a>beta[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb140-4"><a href="applications.html#cb140-4" aria-hidden="true" tabindex="-1"></a>beta</span></code></pre></div>
<pre><code>## [1]  4.0000000  0.1836433 -0.8356286</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="applications.html#cb142-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(K)); sigma</span></code></pre></div>
<pre><code>## [1] 1.5952808 0.3295078 0.8204684</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="applications.html#cb144-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb144-2"><a href="applications.html#cb144-2" aria-hidden="true" tabindex="-1"></a>omega <span class="ot">&lt;-</span> <span class="dv">1</span></span></code></pre></div>
<p>Generate the covariates as follows.</p>
<p>The product-market characteristics:
<span class="math display">\[
x_{j1} = 1, x_{jk} \sim N(0, \sigma_x), k = 2, \cdots, K,
\]</span>
where <span class="math inline">\(\sigma_x\)</span> is referred to as <code>sd_x</code> in the code.</p>
<p>The product-market-specific unobserved fixed effect:
<span class="math display">\[
\xi_{jt} \sim N(0, \sigma_\xi),
\]</span>
where <span class="math inline">\(\sigma_xi\)</span> is referred to as <code>sd_xi</code> in the code.</p>
<p>The marginal cost of product <span class="math inline">\(j\)</span> in market <span class="math inline">\(t\)</span>:
<span class="math display">\[
c_{jt} \sim \text{logNormal}(0, \sigma_c),
\]</span>
where <span class="math inline">\(\sigma_c\)</span> is referred to as <code>sd_c</code> in the code.</p>
<p>The retail price:
<span class="math display">\[
p_{jt} - c_{jt} \sim \text{logNorm}(\gamma \xi_{jt}, \sigma_p^2),
\]</span>
where <span class="math inline">\(\gamma\)</span> is referred to as <code>price_xi</code> and <span class="math inline">\(\sigma_p\)</span> as <code>sd_p</code> in the code. This price is not the equilibrium price. We will revisit this point in a subsequent assignment.</p>
<p>The value of the auxiliary parameters are set as follows:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="applications.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set auxiliary parameters</span></span>
<span id="cb145-2"><a href="applications.html#cb145-2" aria-hidden="true" tabindex="-1"></a>price_xi <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb145-3"><a href="applications.html#cb145-3" aria-hidden="true" tabindex="-1"></a>sd_x <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb145-4"><a href="applications.html#cb145-4" aria-hidden="true" tabindex="-1"></a>sd_xi <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb145-5"><a href="applications.html#cb145-5" aria-hidden="true" tabindex="-1"></a>sd_c <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb145-6"><a href="applications.html#cb145-6" aria-hidden="true" tabindex="-1"></a>sd_p <span class="ot">&lt;-</span> <span class="fl">0.05</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><code>X</code> is the data frame such that a row contains the characteristics vector <span class="math inline">\(x_{j}\)</span> of a product and columns are product index and observed product characteristics. The dimension of the characteristics <span class="math inline">\(K\)</span> is specified above. Add the row of the outside option whose index is <span class="math inline">\(0\)</span> and all the characteristics are zero.</li>
</ol>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="applications.html#cb146-1" aria-hidden="true" tabindex="-1"></a>X</span></code></pre></div>
<pre><code>## # A tibble: 11  4
##        j   x_1     x_2     x_3
##    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1     0     0  0       0     
##  2     1     1  0.975  -0.0324
##  3     2     1  1.48    1.89  
##  4     3     1  1.15    1.64  
##  5     4     1 -0.611   1.19  
##  6     5     1  3.02    1.84  
##  7     6     1  0.780   1.56  
##  8     7     1 -1.24    0.149 
##  9     8     1 -4.43   -3.98  
## 10     9     1  2.25    1.24  
## 11    10     1 -0.0899 -0.112</code></pre>
<ol start="3" style="list-style-type: decimal">
<li><code>M</code> is the data frame such that a row contains the price <span class="math inline">\(\xi_{jt}\)</span>, marginal cost <span class="math inline">\(c_{jt}\)</span>, and price <span class="math inline">\(p_{jt}\)</span>. After generating the variables, drop some products in each market. <strong>In this assignment, we drop products in a different way from the last assignment</strong>. In order to change the number of available products in each market, for each market, first draw <span class="math inline">\(J_t\)</span> from a discrete uniform distribution between <span class="math inline">\(1\)</span> and <span class="math inline">\(J\)</span>. Then, drop products from each market using <code>dplyr::sample_frac</code> function with the realized number of available products. The variation in the available products is important for the identification of the distribution of consumer-level unobserved heterogeneity. Add the row of the outside option to each market whose index is <span class="math inline">\(0\)</span> and all the variables take value zero.</li>
</ol>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="applications.html#cb148-1" aria-hidden="true" tabindex="-1"></a>M</span></code></pre></div>
<pre><code>## # A tibble: 633  5
##        j     t      xi     c     p
##    &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     0     1  0      0      0   
##  2     1     1 -0.0779 0.951  1.86
##  3     4     1  0.209  1.03   2.31
##  4     0     2  0      0      0   
##  5     1     2 -0.197  0.988  1.90
##  6     3     2  0.550  1.09   2.78
##  7     4     2  0.382  1.00   2.54
##  8     6     2 -0.127  1.01   1.91
##  9     7     2  0.348  0.952  2.32
## 10     8     2  0.278  0.955  2.16
## #  with 623 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Generate the consumer-level heterogeneity. <code>V</code> is the data frame such that a row contains the vector of shocks to consumer-level heterogeneity, <span class="math inline">\((\nu_{i}&#39;, \upsilon_i)\)</span>. They are all i.i.d. standard normal random variables.</li>
</ol>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="applications.html#cb150-1" aria-hidden="true" tabindex="-1"></a>V</span></code></pre></div>
<pre><code>## # A tibble: 50,000  6
##        i     t  v_x_1   v_x_2  v_x_3     v_p
##    &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
##  1     1     1 -1.37   0.211   1.65   0.0141
##  2     2     1  1.37   0.378   1.35   0.387 
##  3     3     1 -2.06  -0.0662 -2.45  -1.17  
##  4     4     1 -0.992 -0.727  -1.33  -1.42  
##  5     5     1  0.252  1.87    0.751  0.317 
##  6     6     1 -1.06  -0.531   1.34  -0.224 
##  7     7     1 -0.217  1.03    0.909 -0.593 
##  8     8     1 -0.838 -0.861  -0.612  1.54  
##  9     9     1  0.659 -1.43   -1.77   0.340 
## 10    10     1  0.452 -0.239   0.138  0.695 
## #  with 49,990 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Join <code>X</code>, <code>M</code>, <code>V</code> using <code>dplyr::left_join</code> and name it <code>df</code>. <code>df</code> is the data frame such that a row contains variables for a consumer about a product that is available in a market.</li>
</ol>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="applications.html#cb152-1" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 316,500  13
##        t     i     j  v_x_1   v_x_2 v_x_3     v_p   x_1    x_2     x_3      xi     c
##    &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1     1     1     0 -1.37   0.211   1.65  0.0141     0  0      0       0      0    
##  2     1     1     1 -1.37   0.211   1.65  0.0141     1  0.975 -0.0324 -0.0779 0.951
##  3     1     1     4 -1.37   0.211   1.65  0.0141     1 -0.611  1.19    0.209  1.03 
##  4     1     2     0  1.37   0.378   1.35  0.387      0  0      0       0      0    
##  5     1     2     1  1.37   0.378   1.35  0.387      1  0.975 -0.0324 -0.0779 0.951
##  6     1     2     4  1.37   0.378   1.35  0.387      1 -0.611  1.19    0.209  1.03 
##  7     1     3     0 -2.06  -0.0662 -2.45 -1.17       0  0      0       0      0    
##  8     1     3     1 -2.06  -0.0662 -2.45 -1.17       1  0.975 -0.0324 -0.0779 0.951
##  9     1     3     4 -2.06  -0.0662 -2.45 -1.17       1 -0.611  1.19    0.209  1.03 
## 10     1     4     0 -0.992 -0.727  -1.33 -1.42       0  0      0       0      0    
## #  with 316,490 more rows, and 1 more variable: p &lt;dbl&gt;
## #  Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Draw a vector of preference shocks <code>e</code> whose length is the same as the number of rows of <code>df</code>.</li>
</ol>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="applications.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(e)</span></code></pre></div>
<pre><code>## [1]  0.1917775 -0.3312816  0.2428217  1.0164097  1.4761643  2.8297340</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Write a function <code>compute_indirect_utility(df, beta, sigma, mu, omega)</code> that returns a vector whose element is the mean indirect utility of a product for a consumer in a market. The output should have the same length with <span class="math inline">\(e\)</span>. (This function is the same with assignment 3. You can use the function.)</li>
</ol>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="applications.html#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute indirect utility</span></span>
<span id="cb156-2"><a href="applications.html#cb156-2" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> </span>
<span id="cb156-3"><a href="applications.html#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_indirect_utility</span>(</span>
<span id="cb156-4"><a href="applications.html#cb156-4" aria-hidden="true" tabindex="-1"></a>    df, beta, sigma, </span>
<span id="cb156-5"><a href="applications.html#cb156-5" aria-hidden="true" tabindex="-1"></a>           mu, omega)</span>
<span id="cb156-6"><a href="applications.html#cb156-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(u)</span></code></pre></div>
<pre><code>##               u
## [1,]  0.0000000
## [2,] -1.1415602
## [3,] -1.3798736
## [4,]  0.0000000
## [5,]  1.8935027
## [6,]  0.9258409</code></pre>
<p>In the previous assingment, we computed predicted share by simulating choice and taking their average. Instead, we compute the actual share by:
<span class="math display">\[
s_{jt} = \frac{1}{N} \sum_{i = 1}^N \frac{\exp[\beta_{it}&#39; x_j + \alpha_{it} p_{jt} + \xi_{jt}]}{1 + \sum_{k \in \mathcal{J}_t} \exp[\beta_{it}&#39; x_k + \alpha_{it} p_{kt} + \xi_{jt}]}
\]</span>
and the predicted share by:
<span class="math display">\[
\widehat{\sigma}_{j}(x, p_t, \xi_t) = \frac{1}{L} \sum_{l = 1}^L \frac{\exp[\beta_{t}^{(l)\prime} x_j + \alpha_{t}^{(l)} p_{jt} + \xi_{jt}]}{1 + \sum_{k \in \mathcal{J}_t} \exp[\beta_{t}^{(l)\prime} x_k + \alpha_{t}^{(l)} p_{kt} + \xi_{jt}]}.
\]</span></p>
<ol start="8" style="list-style-type: decimal">
<li>To do so, write a function <code>compute_choice_smooth(X, M, V, beta, sigma, mu, omega)</code> in which the choice of each consumer is not:
<span class="math display">\[
q_{ijt} = 1\{u_{ijt} = \max_{k \in \mathcal{J}_t \cup \{0\}} u_{ikt}\},
\]</span>
but
<span class="math display">\[
\tilde{q}_{ijt} = \frac{\exp(u_{ijt})}{1 + \sum_{k \in \mathcal{J}_t} \exp(u_{ikt})}.
\]</span></li>
</ol>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="applications.html#cb158-1" aria-hidden="true" tabindex="-1"></a>df_choice_smooth <span class="ot">&lt;-</span></span>
<span id="cb158-2"><a href="applications.html#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_choice_smooth</span>(X, M, V, beta, sigma, mu, omega)</span>
<span id="cb158-3"><a href="applications.html#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df_choice_smooth)</span></code></pre></div>
<pre><code>##        t                i               j             v_x_1          
##  Min.   :  1.00   Min.   :  1.0   Min.   : 0.00   Min.   :-4.302781  
##  1st Qu.: 23.00   1st Qu.:125.8   1st Qu.: 2.00   1st Qu.:-0.685539  
##  Median : 48.00   Median :250.5   Median : 4.00   Median : 0.001041  
##  Mean   : 49.67   Mean   :250.5   Mean   : 4.49   Mean   :-0.002541  
##  3rd Qu.: 77.00   3rd Qu.:375.2   3rd Qu.: 7.00   3rd Qu.: 0.673061  
##  Max.   :100.00   Max.   :500.0   Max.   :10.00   Max.   : 3.809895  
##      v_x_2               v_x_3                v_p                 x_1       
##  Min.   :-4.542122   Min.   :-3.957618   Min.   :-4.218131   Min.   :0.000  
##  1st Qu.:-0.679702   1st Qu.:-0.672701   1st Qu.:-0.669446   1st Qu.:1.000  
##  Median : 0.000935   Median : 0.003104   Median : 0.001976   Median :1.000  
##  Mean   : 0.000478   Mean   : 0.003428   Mean   : 0.000017   Mean   :0.842  
##  3rd Qu.: 0.673109   3rd Qu.: 0.678344   3rd Qu.: 0.670699   3rd Qu.:1.000  
##  Max.   : 4.313621   Max.   : 4.244194   Max.   : 4.074300   Max.   :1.000  
##       x_2               x_3                xi                  c         
##  Min.   :-4.4294   Min.   :-3.9787   Min.   :-1.498475   Min.   :0.0000  
##  1st Qu.:-0.6108   1st Qu.: 0.0000   1st Qu.:-0.263684   1st Qu.:0.9376  
##  Median : 0.7797   Median : 1.1878   Median : 0.000000   Median :0.9870  
##  Mean   : 0.3015   Mean   : 0.5034   Mean   :-0.002574   Mean   :0.8425  
##  3rd Qu.: 1.4766   3rd Qu.: 1.6424   3rd Qu.: 0.278332   3rd Qu.:1.0282  
##  Max.   : 3.0236   Max.   : 1.8877   Max.   : 1.905138   Max.   :1.1572  
##        p               u                  q           
##  Min.   :0.000   Min.   :-432.189   Min.   :0.000000  
##  1st Qu.:1.527   1st Qu.:  -3.045   1st Qu.:0.001456  
##  Median :1.885   Median :   0.000   Median :0.032012  
##  Mean   :1.809   Mean   :  -1.901   Mean   :0.157978  
##  3rd Qu.:2.324   3rd Qu.:   1.493   3rd Qu.:0.159143  
##  Max.   :8.211   Max.   :  22.343   Max.   :1.000000</code></pre>
<ol start="9" style="list-style-type: decimal">
<li>Next, write a function <code>compute_share_smooth(X, M, V, beta, sigma, mu, omega)</code> that calls <code>compute_choice_smooth</code> and then returns the share based on above <span class="math inline">\(\tilde{q}_{ijt}\)</span>. If we use these functions with the Monte Carlo shocks, it gives us the predicted share of the products.</li>
</ol>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="applications.html#cb160-1" aria-hidden="true" tabindex="-1"></a>df_share_smooth <span class="ot">&lt;-</span> <span class="fu">compute_share_smooth</span>(X, M, V, beta, sigma, mu, omega)</span>
<span id="cb160-2"><a href="applications.html#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df_share_smooth)</span></code></pre></div>
<pre><code>##        t                j              x_1             x_2               x_3         
##  Min.   :  1.00   Min.   : 0.00   Min.   :0.000   Min.   :-4.4294   Min.   :-3.9787  
##  1st Qu.: 23.00   1st Qu.: 2.00   1st Qu.:1.000   1st Qu.:-0.6108   1st Qu.: 0.0000  
##  Median : 48.00   Median : 4.00   Median :1.000   Median : 0.7797   Median : 1.1878  
##  Mean   : 49.67   Mean   : 4.49   Mean   :0.842   Mean   : 0.3015   Mean   : 0.5034  
##  3rd Qu.: 77.00   3rd Qu.: 7.00   3rd Qu.:1.000   3rd Qu.: 1.4766   3rd Qu.: 1.6424  
##  Max.   :100.00   Max.   :10.00   Max.   :1.000   Max.   : 3.0236   Max.   : 1.8877  
##        xi                  c                p               q          
##  Min.   :-1.498475   Min.   :0.0000   Min.   :0.000   Min.   :  5.094  
##  1st Qu.:-0.263684   1st Qu.:0.9376   1st Qu.:1.527   1st Qu.: 19.712  
##  Median : 0.000000   Median :0.9870   Median :1.885   Median : 34.968  
##  Mean   :-0.002574   Mean   :0.8425   Mean   :1.809   Mean   : 78.989  
##  3rd Qu.: 0.278332   3rd Qu.:1.0282   3rd Qu.:2.324   3rd Qu.:119.805  
##  Max.   : 1.905138   Max.   :1.1572   Max.   :8.211   Max.   :349.796  
##        s                 y          
##  Min.   :0.01019   Min.   :-3.2018  
##  1st Qu.:0.03942   1st Qu.:-1.8590  
##  Median :0.06994   Median :-1.3580  
##  Mean   :0.15798   Mean   :-1.1288  
##  3rd Qu.:0.23961   3rd Qu.:-0.2189  
##  Max.   :0.69959   Max.   : 1.0355</code></pre>
<p>Use this <code>df_share_smooth</code> as the data to estimate the parameters in the following section.</p>
</div>
<div id="estimate-the-parameters-2" class="section level2 hasAnchor" number="10.10">
<h2><span class="header-section-number">10.10</span> Estimate the parameters<a href="applications.html#estimate-the-parameters-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>First draw Monte Carlo consumer-level heterogeneity <code>V_mcmc</code> and Monte Carlo preference shocks <code>e_mcmc</code>. The number of simulations is <code>L</code>. This does not have to be the same with the actual number of consumers <code>N</code>.</li>
</ol>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="applications.html#cb162-1" aria-hidden="true" tabindex="-1"></a>V_mcmc</span></code></pre></div>
<pre><code>## # A tibble: 50,000  6
##        i     t   v_x_1  v_x_2   v_x_3    v_p
##    &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1     1     1  0.488  -1.51   0.528  -0.468
##  2     2     1  1.16    0.507 -0.527  -0.516
##  3     3     1 -2.49   -0.318 -0.0996 -0.893
##  4     4     1  0.0952 -0.133 -2.05    1.92 
##  5     5     1 -1.11    0.103  2.24    0.753
##  6     6     1  0.903   0.496  0.287   1.53 
##  7     7     1  0.913  -0.144  0.129  -1.17 
##  8     8     1 -1.52    0.357 -0.475  -0.736
##  9     9     1  0.643   0.219  0.815  -1.27 
## 10    10     1 -0.358   0.272 -0.650  -2.09 
## #  with 49,990 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="applications.html#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(e_mcmc)</span></code></pre></div>
<pre><code>## [1]  0.1006013  2.7039824  1.0540278  2.4697389  1.6721181 -1.0283872</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Vectorize the parameters to a vector <code>theta</code> because <code>optim</code> requires the maximiand to be a vector.</li>
</ol>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="applications.html#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set parameters</span></span>
<span id="cb166-2"><a href="applications.html#cb166-2" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">c</span>(beta, sigma, mu, omega)</span>
<span id="cb166-3"><a href="applications.html#cb166-3" aria-hidden="true" tabindex="-1"></a>theta</span></code></pre></div>
<pre><code>## [1]  4.0000000  0.1836433 -0.8356286  1.5952808  0.3295078  0.8204684  0.5000000
## [8]  1.0000000</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Estimate the parameters assuming there is no product-specific unobserved fixed effects <span class="math inline">\(\xi_{jt}\)</span>, i.e., using the functions in assignment 3. To do so, first modify <code>M</code> to <code>M_no</code> in which <code>xi</code> is replaced with 0 and estimate the model with <code>M_no</code>. Otherwise, your function will compute the share with the true <code>xi</code>.</li>
</ol>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="applications.html#cb168-1" aria-hidden="true" tabindex="-1"></a>M_no <span class="ot">&lt;-</span> M <span class="sc">%&gt;%</span></span>
<span id="cb168-2"><a href="applications.html#cb168-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">xi =</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## $par
## [1]  3.76434503  0.09615737 -0.80752298  1.58043119  0.37196977  0.91068523
## [7]  0.25811030  1.61772334
## 
## $value
## [1] 0.0006911641
## 
## $counts
## function gradient 
##      337       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<pre><code>##         true   estimates
## 1  4.0000000  3.76434503
## 2  0.1836433  0.09615737
## 3 -0.8356286 -0.80752298
## 4  1.5952808  1.58043119
## 5  0.3295078  0.37196977
## 6  0.8204684  0.91068523
## 7  0.5000000  0.25811030
## 8  1.0000000  1.61772334</code></pre>
<p>Next, we estimate the model allowing for the product-market-specific unobserved fixed effect <span class="math inline">\(\xi_{jt}\)</span> using the BLP algorithm. To do so, we slightly modify the <code>compute_indirect_utility</code>, <code>compute_choice_smooth</code>, and <code>compute_share_smooth</code> functions so that they receive <span class="math inline">\(\delta_{jt}\)</span> to compute the indirect utilities, choices, and shares. Be careful that the treatment of <span class="math inline">\(\alpha_i\)</span> is slightly different from the lecture note, because we assumed that <span class="math inline">\(\alpha_i\)</span>s are log-normal random variables.</p>
<ol start="4" style="list-style-type: decimal">
<li>Compute and print out <span class="math inline">\(\delta_{jt}\)</span> at the true parameters, i.e.:
<span class="math display">\[
\delta_{jt} = \beta_0&#39; x_j + \alpha_0&#39; p_{jt} + \xi_{jt}.
\]</span></li>
</ol>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="applications.html#cb171-1" aria-hidden="true" tabindex="-1"></a>delta</span></code></pre></div>
<pre><code>## # A tibble: 633  3
##        t     j  delta
##    &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1     1     0  0    
##  2     1     1 -0.918
##  3     1     4 -3.17 
##  4     2     0  0    
##  5     2     1 -1.15 
##  6     2     3 -4.17 
##  7     2     4 -3.63 
##  8     2     6 -2.48 
##  9     2     7 -2.32 
## 10     2     8  0.924
## #  with 623 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Write a function <code>compute_indirect_utility_delta(df, delta, sigma, mu, omega)</code> that returns a vector whose element is the mean indirect utility of a product for a consumer in a market. The output should have the same length with <span class="math inline">\(e\)</span>. Print out the output with <span class="math inline">\(\delta_{jt}\)</span> evaluated at the true parameters. Check if the output is close to the true indirect utilities.</li>
</ol>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="applications.html#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute indirect utility from delta</span></span>
<span id="cb173-2"><a href="applications.html#cb173-2" aria-hidden="true" tabindex="-1"></a>u_delta <span class="ot">&lt;-</span></span>
<span id="cb173-3"><a href="applications.html#cb173-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_indirect_utility_delta</span>(df, delta, sigma,</span>
<span id="cb173-4"><a href="applications.html#cb173-4" aria-hidden="true" tabindex="-1"></a>                                 mu, omega)</span>
<span id="cb173-5"><a href="applications.html#cb173-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(u_delta)</span></code></pre></div>
<pre><code>##               u
## [1,]  0.0000000
## [2,] -1.1415602
## [3,] -1.3798736
## [4,]  0.0000000
## [5,]  1.8935027
## [6,]  0.9258409</code></pre>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="applications.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(u <span class="sc">-</span> u_delta)</span></code></pre></div>
<pre><code>##        u             
##  Min.   :-2.842e-14  
##  1st Qu.:-4.441e-16  
##  Median : 0.000e+00  
##  Mean   : 5.030e-18  
##  3rd Qu.: 3.331e-16  
##  Max.   : 5.684e-14</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Write a function <code>compute_choice_smooth_delta(X, M, V, delta, sigma, mu, omega)</code> that first construct <code>df</code> from <code>X</code>, <code>M</code>, <code>V</code>, second call <code>compute_indirect_utility_delta</code> to obtain the vector of mean indirect utilities <code>u</code>, third compute the (smooth) choice vector <code>q</code> based on the vector of mean indirect utilities, and finally return the data frame to which <code>u</code> and <code>q</code> are added as columns. Print out the output with <span class="math inline">\(\delta_{jt}\)</span> evaluated at the true parameters. Check if the output is close to the true (smooth) choice vector.</li>
</ol>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="applications.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute choice</span></span>
<span id="cb177-2"><a href="applications.html#cb177-2" aria-hidden="true" tabindex="-1"></a>df_choice_smooth_delta <span class="ot">&lt;-</span> </span>
<span id="cb177-3"><a href="applications.html#cb177-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_choice_smooth_delta</span>(X, M, V, delta, sigma, mu, omega)</span>
<span id="cb177-4"><a href="applications.html#cb177-4" aria-hidden="true" tabindex="-1"></a>df_choice_smooth_delta</span></code></pre></div>
<pre><code>## # A tibble: 316,500  15
##        t     i     j  v_x_1   v_x_2 v_x_3     v_p   x_1    x_2     x_3      xi     c
##    &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1     1     1     0 -1.37   0.211   1.65  0.0141     0  0      0       0      0    
##  2     1     1     1 -1.37   0.211   1.65  0.0141     1  0.975 -0.0324 -0.0779 0.951
##  3     1     1     4 -1.37   0.211   1.65  0.0141     1 -0.611  1.19    0.209  1.03 
##  4     1     2     0  1.37   0.378   1.35  0.387      0  0      0       0      0    
##  5     1     2     1  1.37   0.378   1.35  0.387      1  0.975 -0.0324 -0.0779 0.951
##  6     1     2     4  1.37   0.378   1.35  0.387      1 -0.611  1.19    0.209  1.03 
##  7     1     3     0 -2.06  -0.0662 -2.45 -1.17       0  0      0       0      0    
##  8     1     3     1 -2.06  -0.0662 -2.45 -1.17       1  0.975 -0.0324 -0.0779 0.951
##  9     1     3     4 -2.06  -0.0662 -2.45 -1.17       1 -0.611  1.19    0.209  1.03 
## 10     1     4     0 -0.992 -0.727  -1.33 -1.42       0  0      0       0      0    
## #  with 316,490 more rows, and 3 more variables: p &lt;dbl&gt;, u &lt;dbl&gt;, q &lt;dbl&gt;
## #  Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</code></pre>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="applications.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df_choice_smooth_delta)</span></code></pre></div>
<pre><code>##        t                i               j             v_x_1          
##  Min.   :  1.00   Min.   :  1.0   Min.   : 0.00   Min.   :-4.302781  
##  1st Qu.: 23.00   1st Qu.:125.8   1st Qu.: 2.00   1st Qu.:-0.685539  
##  Median : 48.00   Median :250.5   Median : 4.00   Median : 0.001041  
##  Mean   : 49.67   Mean   :250.5   Mean   : 4.49   Mean   :-0.002541  
##  3rd Qu.: 77.00   3rd Qu.:375.2   3rd Qu.: 7.00   3rd Qu.: 0.673061  
##  Max.   :100.00   Max.   :500.0   Max.   :10.00   Max.   : 3.809895  
##      v_x_2               v_x_3                v_p                 x_1       
##  Min.   :-4.542122   Min.   :-3.957618   Min.   :-4.218131   Min.   :0.000  
##  1st Qu.:-0.679702   1st Qu.:-0.672701   1st Qu.:-0.669446   1st Qu.:1.000  
##  Median : 0.000935   Median : 0.003104   Median : 0.001976   Median :1.000  
##  Mean   : 0.000478   Mean   : 0.003428   Mean   : 0.000017   Mean   :0.842  
##  3rd Qu.: 0.673109   3rd Qu.: 0.678344   3rd Qu.: 0.670699   3rd Qu.:1.000  
##  Max.   : 4.313621   Max.   : 4.244194   Max.   : 4.074300   Max.   :1.000  
##       x_2               x_3                xi                  c         
##  Min.   :-4.4294   Min.   :-3.9787   Min.   :-1.498475   Min.   :0.0000  
##  1st Qu.:-0.6108   1st Qu.: 0.0000   1st Qu.:-0.263684   1st Qu.:0.9376  
##  Median : 0.7797   Median : 1.1878   Median : 0.000000   Median :0.9870  
##  Mean   : 0.3015   Mean   : 0.5034   Mean   :-0.002574   Mean   :0.8425  
##  3rd Qu.: 1.4766   3rd Qu.: 1.6424   3rd Qu.: 0.278332   3rd Qu.:1.0282  
##  Max.   : 3.0236   Max.   : 1.8877   Max.   : 1.905138   Max.   :1.1572  
##        p               u                  q           
##  Min.   :0.000   Min.   :-432.189   Min.   :0.000000  
##  1st Qu.:1.527   1st Qu.:  -3.045   1st Qu.:0.001456  
##  Median :1.885   Median :   0.000   Median :0.032012  
##  Mean   :1.809   Mean   :  -1.901   Mean   :0.157978  
##  3rd Qu.:2.324   3rd Qu.:   1.493   3rd Qu.:0.159143  
##  Max.   :8.211   Max.   :  22.343   Max.   :1.000000</code></pre>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="applications.html#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df_choice_smooth<span class="sc">$</span>q <span class="sc">-</span> df_choice_smooth_delta<span class="sc">$</span>q)</span></code></pre></div>
<pre><code>##       Min.    1st Qu.     Median       Mean    3rd Qu.       Max. 
## -1.110e-15 -6.939e-18  0.000e+00 -4.120e-20  1.735e-18  9.992e-16</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Write a function <code>compute_share_delta(X, M, V, delta, sigma, mu, omega)</code> that first construct <code>df</code> from <code>X</code>, <code>M</code>, <code>V</code>, second call <code>compute_choice_delta</code> to obtain a data frame with <code>u</code> and <code>q</code>, third compute the share of each product at each market <code>s</code> and the log difference in the share from the outside option, <span class="math inline">\(\ln(s_{jt}/s_{0t})\)</span>, denoted by <code>y</code>, and finally return the data frame that is summarized at the product-market level, dropped consumer-level variables, and added <code>s</code> and <code>y</code>.</li>
</ol>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="applications.html#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute share</span></span>
<span id="cb183-2"><a href="applications.html#cb183-2" aria-hidden="true" tabindex="-1"></a>df_share_smooth_delta <span class="ot">&lt;-</span></span>
<span id="cb183-3"><a href="applications.html#cb183-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_share_smooth_delta</span>(X, M, V, delta, sigma, mu, omega) </span>
<span id="cb183-4"><a href="applications.html#cb183-4" aria-hidden="true" tabindex="-1"></a>df_share_smooth_delta</span></code></pre></div>
<pre><code>## # A tibble: 633  11
##        t     j   x_1    x_2     x_3      xi     c     p     q      s       y
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
##  1     1     0     0  0      0       0      0      0    222.  0.444   0     
##  2     1     1     1  0.975 -0.0324 -0.0779 0.951  1.86 219.  0.438  -0.0141
##  3     1     4     1 -0.611  1.19    0.209  1.03   2.31  58.6 0.117  -1.33  
##  4     2     0     0  0      0       0      0      0    123.  0.247   0     
##  5     2     1     1  0.975 -0.0324 -0.197  0.988  1.90  27.5 0.0550 -1.50  
##  6     2     3     1  1.15   1.64    0.550  1.09   2.78  14.5 0.0291 -2.14  
##  7     2     4     1 -0.611  1.19    0.382  1.00   2.54  10.4 0.0207 -2.48  
##  8     2     6     1  0.780  1.56   -0.127  1.01   1.91  18.9 0.0378 -1.87  
##  9     2     7     1 -1.24   0.149   0.348  0.952  2.32  14.1 0.0282 -2.17  
## 10     2     8     1 -4.43  -3.98    0.278  0.955  2.16 260.  0.521   0.747 
## #  with 623 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="applications.html#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df_share_smooth_delta)</span></code></pre></div>
<pre><code>##        t                j              x_1             x_2               x_3         
##  Min.   :  1.00   Min.   : 0.00   Min.   :0.000   Min.   :-4.4294   Min.   :-3.9787  
##  1st Qu.: 23.00   1st Qu.: 2.00   1st Qu.:1.000   1st Qu.:-0.6108   1st Qu.: 0.0000  
##  Median : 48.00   Median : 4.00   Median :1.000   Median : 0.7797   Median : 1.1878  
##  Mean   : 49.67   Mean   : 4.49   Mean   :0.842   Mean   : 0.3015   Mean   : 0.5034  
##  3rd Qu.: 77.00   3rd Qu.: 7.00   3rd Qu.:1.000   3rd Qu.: 1.4766   3rd Qu.: 1.6424  
##  Max.   :100.00   Max.   :10.00   Max.   :1.000   Max.   : 3.0236   Max.   : 1.8877  
##        xi                  c                p               q          
##  Min.   :-1.498475   Min.   :0.0000   Min.   :0.000   Min.   :  5.094  
##  1st Qu.:-0.263684   1st Qu.:0.9376   1st Qu.:1.527   1st Qu.: 19.712  
##  Median : 0.000000   Median :0.9870   Median :1.885   Median : 34.968  
##  Mean   :-0.002574   Mean   :0.8425   Mean   :1.809   Mean   : 78.989  
##  3rd Qu.: 0.278332   3rd Qu.:1.0282   3rd Qu.:2.324   3rd Qu.:119.805  
##  Max.   : 1.905138   Max.   :1.1572   Max.   :8.211   Max.   :349.796  
##        s                 y          
##  Min.   :0.01019   Min.   :-3.2018  
##  1st Qu.:0.03942   1st Qu.:-1.8590  
##  Median :0.06994   Median :-1.3580  
##  Mean   :0.15798   Mean   :-1.1288  
##  3rd Qu.:0.23961   3rd Qu.:-0.2189  
##  Max.   :0.69959   Max.   : 1.0355</code></pre>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="applications.html#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df_share_smooth<span class="sc">$</span>s <span class="sc">-</span> df_share_smooth_delta<span class="sc">$</span>s)</span></code></pre></div>
<pre><code>##       Min.    1st Qu.     Median       Mean    3rd Qu.       Max. 
## -1.388e-16 -1.735e-17  0.000e+00 -1.644e-19  1.041e-17  2.220e-16</code></pre>
<ol start="8" style="list-style-type: decimal">
<li>Write a function <code>solve_delta(df_share_smooth, X, M, V, delta, sigma, mu, omega)</code> that finds <span class="math inline">\(\delta_{jt}\)</span> that equates the actua share and the predicted share based on <code>compute_share_smooth_delta</code> by the fixed-point algorithm with an operator:
<span class="math display">\[
T(\delta_{jt}^{(r)}) = \delta_{jt}^{(r)} + \kappa \cdot \log\left(\frac{s_{jt}}{\sigma_{jt}[\delta^{(r)}]}\right),
\]</span>
where <span class="math inline">\(s_{jt}\)</span> is the actual share of product <span class="math inline">\(j\)</span> in market <span class="math inline">\(t\)</span> and <span class="math inline">\(\sigma_{jt}[\delta^{(r)}]\)</span> is the predicted share of product <span class="math inline">\(j\)</span> in market <span class="math inline">\(t\)</span> given <span class="math inline">\(\delta^{(r)}\)</span>. Multiplying <span class="math inline">\(\kappa\)</span> is for the numerical stability. I set the value at <span class="math inline">\(\kappa = 1\)</span>. Adjust it if the algorithm did not work. Set the stopping criterion at <span class="math inline">\(\max_{jt}|\delta_{jt}^{(r + 1)} - \delta_{jt}^{(r)}| &lt; \lambda\)</span>. Set <span class="math inline">\(\lambda\)</span> at <span class="math inline">\(10^{-3}\)</span>. Make sure that <span class="math inline">\(\delta_{i0t}\)</span> is always set at zero while the iteration.</li>
</ol>
<p>Start the algorithm with the true <span class="math inline">\(\delta_{jt}\)</span> and check if the algorithm returns (almost) the same <span class="math inline">\(\delta_{jt}\)</span> when the actual and predicted smooth share are equated.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="applications.html#cb189-1" aria-hidden="true" tabindex="-1"></a>kappa <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb189-2"><a href="applications.html#cb189-2" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="fl">1e-3</span></span>
<span id="cb189-3"><a href="applications.html#cb189-3" aria-hidden="true" tabindex="-1"></a>delta_new <span class="ot">&lt;-</span></span>
<span id="cb189-4"><a href="applications.html#cb189-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">solve_delta</span>(df_share_smooth, X, M, V, delta, sigma, mu, omega, kappa, lambda)</span>
<span id="cb189-5"><a href="applications.html#cb189-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(delta_new)</span></code></pre></div>
<pre><code>## # A tibble: 6  3
##       t     j  delta
##   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1     1     0  0    
## 2     1     1 -0.918
## 3     1     4 -3.17 
## 4     2     0  0    
## 5     2     1 -1.15 
## 6     2     3 -4.17</code></pre>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="applications.html#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(delta_new<span class="sc">$</span>delta <span class="sc">-</span> delta<span class="sc">$</span>delta)</span></code></pre></div>
<pre><code>##       Min.    1st Qu.     Median       Mean    3rd Qu.       Max. 
## -1.776e-15 -4.441e-16  0.000e+00 -6.033e-17  0.000e+00  1.776e-15</code></pre>
<ol start="9" style="list-style-type: decimal">
<li>Check how long it takes to compute the limit <span class="math inline">\(\delta\)</span> under the Monte Carlo shocks starting from the true <span class="math inline">\(\delta\)</span> to match with <code>df_share_smooth</code>. This is approximately the time to evaluate the objective function.</li>
</ol>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="applications.html#cb193-1" aria-hidden="true" tabindex="-1"></a>delta_new <span class="ot">&lt;-</span></span>
<span id="cb193-2"><a href="applications.html#cb193-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">solve_delta</span>(df_share_smooth, X, M, V_mcmc, delta, sigma, mu, omega, kappa, lambda)</span>
<span id="cb193-3"><a href="applications.html#cb193-3" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(delta_new, <span class="at">file =</span> <span class="st">&quot;data/A4_delta_new.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="applications.html#cb194-1" aria-hidden="true" tabindex="-1"></a>delta_new <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A4_delta_new.RData&quot;</span>))</span>
<span id="cb194-2"><a href="applications.html#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(delta_new<span class="sc">$</span>delta <span class="sc">-</span> delta<span class="sc">$</span>delta)</span></code></pre></div>
<pre><code>##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## -1.23557 -0.28653  0.00000 -0.01944  0.21330  1.04105</code></pre>
<ol start="10" style="list-style-type: decimal">
<li>We use the marginal cost <span class="math inline">\(c_{jt}\)</span> as the excluded instrumental variable for <span class="math inline">\(p_{jt}\)</span>. Let <span class="math inline">\(\Psi\)</span> be the weighing matrix for the GMM estimator. For now, let it be the identity matrix. Write a function <code>compute_theta_linear(df_share_smooth, delta, mu, omega, Psi)</code> that returns the optimal linear parameters associated with the data and <span class="math inline">\(\delta\)</span>. Notice that we only obtain <span class="math inline">\(\beta_0\)</span> in this way because <span class="math inline">\(\alpha_0\)</span> is directly computed from the non-linear parameters by <span class="math inline">\(-\exp(\mu + \omega^2/2)\)</span>. The first order condition for <span class="math inline">\(\beta_0\)</span> is:
<span class="math display">\[\begin{equation}
\beta_0 = (X&#39;W \Phi^{-1} W&#39;X)^{-1} X&#39; W \Phi^{-1} W&#39; [\delta - \alpha_0 p],
\end{equation}\]</span>
where</li>
</ol>
<p><span class="math display">\[\begin{equation}
X =
\begin{pmatrix}
x_{11}&#39;\\
\vdots \\
x_{J_1 1}&#39;\\
\vdots \\
x_{1T}&#39; \\
\vdots \\
x_{J_T T}
\end{pmatrix}
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
W =
\begin{pmatrix}
x_{11}&#39; &amp; c_{11}\\
\vdots &amp; \vdots \\
x_{J_1 1}&#39; &amp; c_{J_1 1}\\
\vdots &amp; \vdots \\
x_{1T}&#39; &amp; c_{1T}\\
\vdots &amp; \vdots \\
x_{J_T T} &amp; c_{J_T T}
\end{pmatrix},
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
\delta =
\begin{pmatrix}
\delta_11\\
\vdots\\
\delta_{J_1 1}\\
\vdots\\
\delta_1T\\
\vdots\\
\delta_{J_T T}\\
\end{pmatrix}
\end{equation}\]</span>,</p>
<p>where <span class="math inline">\(\alpha_0 = - \exp(\mu + \omega^2/2)\)</span>. Notice that <span class="math inline">\(X\)</span> and <span class="math inline">\(W\)</span> does not include rows for the outwide option.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="applications.html#cb196-1" aria-hidden="true" tabindex="-1"></a>Psi <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="fu">length</span>(beta) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb196-2"><a href="applications.html#cb196-2" aria-hidden="true" tabindex="-1"></a>theta_linear <span class="ot">&lt;-</span></span>
<span id="cb196-3"><a href="applications.html#cb196-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_theta_linear</span>(df_share_smooth, delta, mu, omega, Psi) </span>
<span id="cb196-4"><a href="applications.html#cb196-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(theta_linear, beta)</span></code></pre></div>
<pre><code>##          delta       beta
## x_1  3.9799719  4.0000000
## x_2  0.1405106  0.1836433
## x_3 -0.7821397 -0.8356286</code></pre>
<ol start="11" style="list-style-type: decimal">
<li>Write a function <code>solve_xi(df_share_smooth, delta, beta, mu, omega)</code> that computes the values of <span class="math inline">\(\xi\)</span> that are implied from the data, <span class="math inline">\(\delta\)</span>, and the linear parameters. Check that the (almost) true values are returned when true <span class="math inline">\(\delta\)</span> and the true linear parmaeters are passed to the function. Notice that the returend <span class="math inline">\(\xi\)</span> should not include rows for the outside option.</li>
</ol>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="applications.html#cb198-1" aria-hidden="true" tabindex="-1"></a>xi_new <span class="ot">&lt;-</span> <span class="fu">solve_xi</span>(df_share_smooth, delta, beta, mu, omega)</span>
<span id="cb198-2"><a href="applications.html#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(xi_new)</span></code></pre></div>
<pre><code>##               xi
## [1,] -0.07789775
## [2,]  0.20897078
## [3,] -0.19714498
## [4,]  0.55001269
## [5,]  0.38158787
## [6,] -0.12668084</code></pre>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="applications.html#cb200-1" aria-hidden="true" tabindex="-1"></a>xi_true <span class="ot">&lt;-</span></span>
<span id="cb200-2"><a href="applications.html#cb200-2" aria-hidden="true" tabindex="-1"></a>  df_share_smooth <span class="sc">%&gt;%</span></span>
<span id="cb200-3"><a href="applications.html#cb200-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(j <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb200-4"><a href="applications.html#cb200-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(xi)</span>
<span id="cb200-5"><a href="applications.html#cb200-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(xi_true <span class="sc">-</span> xi_new)</span></code></pre></div>
<pre><code>##        xi            
##  Min.   :-4.441e-16  
##  1st Qu.:-9.714e-17  
##  Median : 0.000e+00  
##  Mean   :-9.388e-18  
##  3rd Qu.: 5.551e-17  
##  Max.   : 8.882e-16</code></pre>
<ol start="11" style="list-style-type: decimal">
<li>Write a function <code>GMM_objective_A4(theta_nonlinear, delta, df_share_smooth, Psi, X, M, V_mcmc, kappa, lambda)</code> that returns the value of the GMM objective function as a function of non-linear parameters <code>mu</code>, <code>omega</code>, and <code>sigma</code>:
<span class="math display">\[
\min_{\theta} \xi(\theta)&#39; W \Phi^{-1} W&#39; \xi(\theta),
\]</span>
where <span class="math inline">\(\xi(\theta)\)</span> is the values of <span class="math inline">\(\xi\)</span> that solves:
<span class="math display">\[
s = \sigma(p, x, \xi),
\]</span>
given parameters <span class="math inline">\(\theta\)</span>. Note that the row of <span class="math inline">\(\xi(\theta)\)</span> and <span class="math inline">\(W\)</span> do not include the rows for the outside options.</li>
</ol>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="applications.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="co"># non-linear parmaeters</span></span>
<span id="cb202-2"><a href="applications.html#cb202-2" aria-hidden="true" tabindex="-1"></a>theta_nonlinear <span class="ot">&lt;-</span> <span class="fu">c</span>(mu, omega, sigma)</span></code></pre></div>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="applications.html#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute GMM objective function</span></span>
<span id="cb203-2"><a href="applications.html#cb203-2" aria-hidden="true" tabindex="-1"></a>objective <span class="ot">&lt;-</span></span>
<span id="cb203-3"><a href="applications.html#cb203-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">GMM_objective_A4</span>(theta_nonlinear, delta, df_share_smooth, Psi, </span>
<span id="cb203-4"><a href="applications.html#cb203-4" aria-hidden="true" tabindex="-1"></a>                   X, M, V_mcmc, kappa, lambda) </span>
<span id="cb203-5"><a href="applications.html#cb203-5" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(objective, <span class="at">file =</span> <span class="st">&quot;data/A4_objective.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="applications.html#cb204-1" aria-hidden="true" tabindex="-1"></a>objective <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A4_objective.RData&quot;</span>))</span>
<span id="cb204-2"><a href="applications.html#cb204-2" aria-hidden="true" tabindex="-1"></a>objective</span></code></pre></div>
<pre><code>##            xi
## xi 0.09356849</code></pre>
<ol start="12" style="list-style-type: decimal">
<li>Draw a graph of the objective function that varies each non-linear parameter from 0, 0.2, <span class="math inline">\(\cdots\)</span>, 2.0 of the true value. Try with the actual shocks <code>V</code>.</li>
</ol>
<pre><code>## [[1]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-138-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-138-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-138-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[4]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-138-4.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[5]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-138-5.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="13" style="list-style-type: decimal">
<li>Find non-linear parameters that minimize the GMM objective function. Because standard deviations of the same absolute value with positive and negative values have almost the same implication for the data, you can take the absolute value if the estimates of the standard deviations happened to be negative (Another way is to set the non-negativity constraints on the standard deviations).</li>
</ol>
<pre><code>## $par
## [1] 0.3635051 0.7502512 1.5852184 0.4223104 0.8757237
## 
## $value
## [1] 2.064906e-18
## 
## $counts
## function gradient 
##       54       11 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<pre><code>##           true  estimate
## [1,] 0.5000000 0.3635051
## [2,] 1.0000000 0.7502512
## [3,] 1.5952808 1.5852184
## [4,] 0.3295078 0.4223104
## [5,] 0.8204684 0.8757237</code></pre>

</div>
<div id="simulate-data-4" class="section level2 hasAnchor" number="10.11">
<h2><span class="header-section-number">10.11</span> Simulate data<a href="applications.html#simulate-data-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We simulate data from a discrete choice model that is the same with in assignment 4 <strong>except for that the price is derived from the Nash equlibrium</strong>. There are <span class="math inline">\(T\)</span> markets and each market has <span class="math inline">\(N\)</span> consumers. There are <span class="math inline">\(J\)</span> products and the indirect utility of consumer <span class="math inline">\(i\)</span> in market <span class="math inline">\(t\)</span> for product <span class="math inline">\(j\)</span> is:
<span class="math display">\[
u_{itj} = \beta_{it}&#39; x_j + \alpha_{it} p_{jt} + \xi_{jt} + \epsilon_{ijt},
\]</span>
where <span class="math inline">\(\epsilon_{ijt}\)</span> is an i.i.d. type-I extreme random variable. <span class="math inline">\(x_j\)</span> is <span class="math inline">\(K\)</span>-dimensional observed characteristics of the product. <span class="math inline">\(p_{jt}\)</span> is the retail price of the product in the market.</p>
<p><span class="math inline">\(\xi_{jt}\)</span> is product-market specific fixed effect. <span class="math inline">\(p_{jt}\)</span> can be correlated with <span class="math inline">\(\xi_{jt}\)</span> but <span class="math inline">\(x_{jt}\)</span>s are independent of <span class="math inline">\(\xi_{jt}\)</span>. <span class="math inline">\(j = 0\)</span> is an outside option whose indirect utility is:
<span class="math display">\[
u_{it0} = \epsilon_{i0t},
\]</span>
where <span class="math inline">\(\epsilon_{i0t}\)</span> is an i.i.d. type-I extreme random variable.</p>
<p><span class="math inline">\(\beta_{it}\)</span> and <span class="math inline">\(\alpha_{it}\)</span> are different across consumers, and they are distributed as:
<span class="math display">\[
\beta_{itk} = \beta_{0k} + \sigma_k \nu_{itk},
\]</span>
<span class="math display">\[
\alpha_{it} = - \exp(\mu + \omega \upsilon_{it}) = - \exp(\mu + \frac{\omega^2}{2}) + [- \exp(\mu + \omega \upsilon_{it}) + \exp(\mu + \frac{\omega^2}{2})] \equiv \alpha_0 + \tilde{\alpha}_{it},
\]</span>
where <span class="math inline">\(\nu_{itk}\)</span> for <span class="math inline">\(k = 1, \cdots, K\)</span> and <span class="math inline">\(\upsilon_{it}\)</span> are i.i.d. standard normal random variables. <span class="math inline">\(\alpha_0\)</span> is the mean of <span class="math inline">\(\alpha_i\)</span> and <span class="math inline">\(\tilde{\alpha}_i\)</span> is the deviation from the mean.</p>
<p>Given a choice set in the market, <span class="math inline">\(\mathcal{J}_t \cup \{0\}\)</span>, a consumer chooses the alternative that maximizes her utility:
<span class="math display">\[
q_{ijt} = 1\{u_{ijt} = \max_{k \in \mathcal{J}_t \cup \{0\}} u_{ikt}\}.
\]</span>
The choice probability of product <span class="math inline">\(j\)</span> for consumer <span class="math inline">\(i\)</span> in market <span class="math inline">\(t\)</span> is:
<span class="math display">\[
\sigma_{ijt}(p_t, x_t, \xi_t) = \mathbb{P}\{u_{ijt} = \max_{k \in \mathcal{J}_t \cup \{0\}} u_{ikt}\}.
\]</span></p>
<p>Suppose that we only observe the (smooth) share data:
<span class="math display">\[
s_{jt}(p_t, x_t, \xi_t) = \frac{1}{N} \sum_{i = 1}^N \sigma_{ijt}(p_t, x_t, \xi_t) = \frac{1}{N} \sum_{i = 1}^N \frac{\exp(u_{ijt})}{1 + \sum_{k \in \mathcal{J}_t \cup \{0\}} \exp(u_{ikt})}.
\]</span>
along with the product-market characteristics <span class="math inline">\(x_{jt}\)</span> and the retail prices <span class="math inline">\(p_{jt}\)</span> for <span class="math inline">\(j \in \mathcal{J}_t \cup \{0\}\)</span> for <span class="math inline">\(t = 1, \cdots, T\)</span>. We do not observe the choice data <span class="math inline">\(q_{ijt}\)</span> nor shocks <span class="math inline">\(\xi_{jt}, \nu_{it}, \upsilon_{it}, \epsilon_{ijt}\)</span>.</p>
<p>We draw <span class="math inline">\(\xi_{jt}\)</span> from i.i.d. normal distribution with mean 0 and standard deviation <span class="math inline">\(\sigma_{\xi}\)</span>.</p>
<ol style="list-style-type: decimal">
<li>Set the seed, constants, and parameters of interest as follows.</li>
</ol>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="applications.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set the seed</span></span>
<span id="cb213-2"><a href="applications.html#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb213-3"><a href="applications.html#cb213-3" aria-hidden="true" tabindex="-1"></a><span class="co"># number of products</span></span>
<span id="cb213-4"><a href="applications.html#cb213-4" aria-hidden="true" tabindex="-1"></a>J <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb213-5"><a href="applications.html#cb213-5" aria-hidden="true" tabindex="-1"></a><span class="co"># dimension of product characteristics including the intercept</span></span>
<span id="cb213-6"><a href="applications.html#cb213-6" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb213-7"><a href="applications.html#cb213-7" aria-hidden="true" tabindex="-1"></a><span class="co"># number of markets</span></span>
<span id="cb213-8"><a href="applications.html#cb213-8" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb213-9"><a href="applications.html#cb213-9" aria-hidden="true" tabindex="-1"></a><span class="co"># number of consumers per market</span></span>
<span id="cb213-10"><a href="applications.html#cb213-10" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb213-11"><a href="applications.html#cb213-11" aria-hidden="true" tabindex="-1"></a><span class="co"># number of Monte Carlo</span></span>
<span id="cb213-12"><a href="applications.html#cb213-12" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="dv">500</span></span></code></pre></div>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="applications.html#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set parameters of interests</span></span>
<span id="cb214-2"><a href="applications.html#cb214-2" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(K); </span>
<span id="cb214-3"><a href="applications.html#cb214-3" aria-hidden="true" tabindex="-1"></a>beta[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb214-4"><a href="applications.html#cb214-4" aria-hidden="true" tabindex="-1"></a>beta</span></code></pre></div>
<pre><code>## [1]  4.0000000  0.1836433 -0.8356286</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="applications.html#cb216-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(K)); sigma</span></code></pre></div>
<pre><code>## [1] 1.5952808 0.3295078 0.8204684</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="applications.html#cb218-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb218-2"><a href="applications.html#cb218-2" aria-hidden="true" tabindex="-1"></a>omega <span class="ot">&lt;-</span> <span class="dv">1</span></span></code></pre></div>
<p>Generate the covariates as follows.</p>
<p>The product-market characteristics:
<span class="math display">\[
x_{j1} = 1, x_{jk} \sim N(0, \sigma_x), k = 2, \cdots, K,
\]</span>
where <span class="math inline">\(\sigma_x\)</span> is referred to as <code>sd_x</code> in the code.</p>
<p>The product-market-specific unobserved fixed effect:
<span class="math display">\[
\xi_{jt} \sim N(0, \sigma_\xi),
\]</span>
where <span class="math inline">\(\sigma_xi\)</span> is referred to as <code>sd_xi</code> in the code.</p>
<p>The marginal cost of product <span class="math inline">\(j\)</span> in market <span class="math inline">\(t\)</span>:
<span class="math display">\[
c_{jt} \sim \text{logNormal}(0, \sigma_c),
\]</span>
where <span class="math inline">\(\sigma_c\)</span> is referred to as <code>sd_c</code> in the code.</p>
<p>The price is determined by a Nash equilibrium. Let <span class="math inline">\(\Delta_t\)</span> be the <span class="math inline">\(J_t \times J_t\)</span> ownership matrix in which the <span class="math inline">\((j, k)\)</span>-th element <span class="math inline">\(\delta_{tjk}\)</span> is equal to 1 if product <span class="math inline">\(j\)</span> and <span class="math inline">\(k\)</span> are owned by the same firm and 0 otherwise. Assume that <span class="math inline">\(\delta_{tjk} = 1\)</span> if and only if <span class="math inline">\(j = k\)</span> for all <span class="math inline">\(t = 1, \cdots, T\)</span>, i.e., each firm owns only one product. Next, define <span class="math inline">\(\Omega_t\)</span> be <span class="math inline">\(J_t \times J_t\)</span> matrix such that whose <span class="math inline">\((j, k)\)</span>-the element <span class="math inline">\(\omega_{tjk}(p_t, x_t, \xi_t, \Delta_t)\)</span> is:
<span class="math display">\[
\omega_{tjk}(p_t, x_t, \xi_t, \Delta_t) = - \frac{\partial s_{jt}(p_t, x_t, \xi_t)}{\partial p_{kt}} \delta_{tjk}.
\]</span>
Then, the equilibrium price vector <span class="math inline">\(p_t\)</span> is determined by solving the following equilibrium condition:
<span class="math display">\[
p_t = c_t + \Omega_t(p_t, x_t, \xi_t, \Delta_t)^{-1} s_t(p_t, x_t, \xi_t).
\]</span></p>
<p>The value of the auxiliary parameters are set as follows:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="applications.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set auxiliary parameters</span></span>
<span id="cb219-2"><a href="applications.html#cb219-2" aria-hidden="true" tabindex="-1"></a>price_xi <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb219-3"><a href="applications.html#cb219-3" aria-hidden="true" tabindex="-1"></a>sd_x <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb219-4"><a href="applications.html#cb219-4" aria-hidden="true" tabindex="-1"></a>sd_xi <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb219-5"><a href="applications.html#cb219-5" aria-hidden="true" tabindex="-1"></a>sd_c <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb219-6"><a href="applications.html#cb219-6" aria-hidden="true" tabindex="-1"></a>sd_p <span class="ot">&lt;-</span> <span class="fl">0.05</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><code>X</code> is the data frame such that a row contains the characteristics vector <span class="math inline">\(x_{j}\)</span> of a product and columns are product index and observed product characteristics. The dimension of the characteristics <span class="math inline">\(K\)</span> is specified above. Add the row of the outside option whose index is <span class="math inline">\(0\)</span> and all the characteristics are zero.</li>
</ol>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="applications.html#cb220-1" aria-hidden="true" tabindex="-1"></a>X</span></code></pre></div>
<pre><code>## # A tibble: 11  4
##        j   x_1     x_2     x_3
##    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1     0     0  0       0     
##  2     1     1  0.975  -0.0324
##  3     2     1  1.48    1.89  
##  4     3     1  1.15    1.64  
##  5     4     1 -0.611   1.19  
##  6     5     1  3.02    1.84  
##  7     6     1  0.780   1.56  
##  8     7     1 -1.24    0.149 
##  9     8     1 -4.43   -3.98  
## 10     9     1  2.25    1.24  
## 11    10     1 -0.0899 -0.112</code></pre>
<ol start="3" style="list-style-type: decimal">
<li><code>M</code> is the data frame such that a row contains the price <span class="math inline">\(\xi_{jt}\)</span>, marginal cost <span class="math inline">\(c_{jt}\)</span>, and price <span class="math inline">\(p_{jt}\)</span>. For now, set <span class="math inline">\(p_{jt} = 0\)</span> and fill the equilibrium price later. After generating the variables, drop some products in each market. In order to change the number of available products in each market, for each market, first draw <span class="math inline">\(J_t\)</span> from a discrete uniform distribution between <span class="math inline">\(1\)</span> and <span class="math inline">\(J\)</span>. Then, drop products from each market using <code>dplyr::sample_frac</code> function with the realized number of available products. The variation in the available products is important for the identification of the distribution of consumer-level unobserved heterogeneity. Add the row of the outside option to each market whose index is <span class="math inline">\(0\)</span> and all the variables take value zero.</li>
</ol>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="applications.html#cb222-1" aria-hidden="true" tabindex="-1"></a>M</span></code></pre></div>
<pre><code>## # A tibble: 696  5
##        j     t      xi     c     p
##    &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     0     1  0      0         0
##  2     2     1 -0.735  1.04      0
##  3     6     1 -0.0514 0.980     0
##  4     7     1  0.194  0.961     0
##  5     8     1 -0.0269 0.989     0
##  6     0     2  0      0         0
##  7     1     2 -0.197  0.988     0
##  8     2     2 -0.0297 1.04      0
##  9     4     2  0.382  1.00      0
## 10     5     2 -0.0823 1.02      0
## #  with 686 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Generate the consumer-level heterogeneity. <code>V</code> is the data frame such that a row contains the vector of shocks to consumer-level heterogeneity, <span class="math inline">\((\nu_{i}&#39;, \upsilon_i)\)</span>. They are all i.i.d. standard normal random variables.</li>
</ol>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="applications.html#cb224-1" aria-hidden="true" tabindex="-1"></a>V</span></code></pre></div>
<pre><code>## # A tibble: 50,000  6
##        i     t   v_x_1   v_x_2   v_x_3     v_p
##    &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1     1     1  0.448   0.985   0.611   0.408 
##  2     2     1 -0.386  -0.389  -1.11   -0.667 
##  3     3     1  0.0567  0.0510  0.0329 -0.119 
##  4     4     1  0.585   0.303   0.860  -1.20  
##  5     5     1 -0.449  -1.17    0.599   0.212 
##  6     6     1 -0.782   0.0596  1.30    0.485 
##  7     7     1  1.60   -1.62   -1.91    0.669 
##  8     8     1 -1.65    2.10    0.726  -0.108 
##  9     9     1 -0.848  -0.933   2.29   -0.0195
## 10    10     1 -0.130  -0.897  -1.90   -0.185 
## #  with 49,990 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>We use <code>compute_indirect_utility(df, beta, sigma, mu, omega)</code>, <code>compute_choice_smooth(X, M, V, beta, sigma, mu, omega)</code>, and <code>compute_share_smooth(X, M, V, beta, sigma, mu, omega)</code> to compute <span class="math inline">\(s_t(p_t, x_t, \xi_t)\)</span>. On top of this, we need a function <code>compute_derivative_share_smooth(X, M, V, beta, sigma, mu, omega)</code> that approximate:</li>
</ol>
<p><span class="math display">\[
\frac{\partial s_{jt}(p_t, x_t, \xi_t)}{\partial p_{kt}} =
\begin{cases}
\frac{1}{N} \sum_{i = 1}^N \alpha_i \sigma_{ijt}(p_t, x_t, \xi_t)[1 - \sigma_{ijt}(p_t, x_t, \xi_t)] &amp;\text{   if   } j = k\\
- \frac{1}{N}\sum_{i = 1}^N \alpha_i \sigma_{ijt}(p_t, x_t, \xi_t)\sigma_{ikt}(p_t, x_t, \xi_t)] &amp;\text{   if   } j \neq k.
\end{cases}
\]</span></p>
<p>The returned object should be a list across markets and each element of the list should be <span class="math inline">\(J_t \times J_t\)</span> matrix whose <span class="math inline">\((j, k)\)</span>-th element is <span class="math inline">\(\partial s_{jt}/\partial p_{it}\)</span> (do not include the outside option). The computation will be looped across markets. I recommend to use a parallel computing for this loop.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="applications.html#cb226-1" aria-hidden="true" tabindex="-1"></a>derivative_share_smooth <span class="ot">&lt;-</span></span>
<span id="cb226-2"><a href="applications.html#cb226-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_derivative_share_smooth</span>(X, M, V, beta, sigma, mu, omega)</span>
<span id="cb226-3"><a href="applications.html#cb226-3" aria-hidden="true" tabindex="-1"></a>derivative_share_smooth[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>##             [,1]        [,2]        [,3]        [,4]
## [1,] -0.15195456  0.07243405  0.04067066  0.03615775
## [2,]  0.07243405 -0.21334454  0.06758143  0.06900886
## [3,]  0.04067066  0.06758143 -0.22465048  0.11247770
## [4,]  0.03615775  0.06900886  0.11247770 -0.22508246</code></pre>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="applications.html#cb228-1" aria-hidden="true" tabindex="-1"></a>derivative_share_smooth[[T]]</span></code></pre></div>
<pre><code>##               [,1]         [,2]         [,3]         [,4]         [,5]         [,6]
##  [1,] -0.096590746  0.003580709  0.003713348  0.011204782  0.012198589  0.008403911
##  [2,]  0.003580709 -0.054948229  0.003309376  0.009438704  0.009893682  0.007465135
##  [3,]  0.003713348  0.003309376 -0.055735044  0.009505457  0.009233146  0.007249620
##  [4,]  0.011204782  0.009438704  0.009505457 -0.160285167  0.021922796  0.022645270
##  [5,]  0.012198589  0.009893682  0.009233146  0.021922796 -0.136324417  0.019978806
##  [6,]  0.008403911  0.007465135  0.007249620  0.022645270  0.019978806 -0.119320239
##  [7,]  0.006573094  0.003856270  0.004084570  0.016649978  0.009219389  0.009873958
##  [8,]  0.033096170  0.006496123  0.007885498  0.038995016  0.016868502  0.019723897
##  [9,]  0.013495765  0.008866219  0.008606532  0.022541027  0.030984223  0.018980139
## [10,]  0.003846416  0.001815922  0.001912074  0.006631000  0.005317866  0.004460069
##               [,7]         [,8]         [,9]        [,10]
##  [1,]  0.006573094  0.033096170  0.013495765  0.003846416
##  [2,]  0.003856270  0.006496123  0.008866219  0.001815922
##  [3,]  0.004084570  0.007885498  0.008606532  0.001912074
##  [4,]  0.016649978  0.038995016  0.022541027  0.006631000
##  [5,]  0.009219389  0.016868502  0.030984223  0.005317866
##  [6,]  0.009873958  0.019723897  0.018980139  0.004460069
##  [7,] -0.101062317  0.035849014  0.010662149  0.003862923
##  [8,]  0.035849014 -0.207076797  0.027381997  0.018831945
##  [9,]  0.010662149  0.027381997 -0.148409509  0.006094688
## [10,]  0.003862923  0.018831945  0.006094688 -0.053007318</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Make a list <code>Delta</code> such that each element of the list is <span class="math inline">\(J_t \times J_t\)</span> matrix <span class="math inline">\(\Delta_t\)</span>.</li>
</ol>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="applications.html#cb230-1" aria-hidden="true" tabindex="-1"></a>Delta[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    0    0    0
## [2,]    0    1    0    0
## [3,]    0    0    1    0
## [4,]    0    0    0    1</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="applications.html#cb232-1" aria-hidden="true" tabindex="-1"></a>Delta[[T]]</span></code></pre></div>
<pre><code>##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
##  [1,]    1    0    0    0    0    0    0    0    0     0
##  [2,]    0    1    0    0    0    0    0    0    0     0
##  [3,]    0    0    1    0    0    0    0    0    0     0
##  [4,]    0    0    0    1    0    0    0    0    0     0
##  [5,]    0    0    0    0    1    0    0    0    0     0
##  [6,]    0    0    0    0    0    1    0    0    0     0
##  [7,]    0    0    0    0    0    0    1    0    0     0
##  [8,]    0    0    0    0    0    0    0    1    0     0
##  [9,]    0    0    0    0    0    0    0    0    1     0
## [10,]    0    0    0    0    0    0    0    0    0     1</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Write a function <code>update_price(logp, X, M, V, beta, sigma, mu, omega, Delta)</code> that receives a price vector <span class="math inline">\(p_t^{(r)}\)</span> and returns <span class="math inline">\(p_t^{(r + 1)}\)</span> by:
<span class="math display">\[
p_t^{(r + 1)} = c_t + \Omega_t(p_t^{(r)}, x_t, \xi_t, \Delta_t)^{-1} s_t(p_t^{(r)}, x_t, \xi_t).
\]</span>
The returned object should be a vector whose row represents the condition for an inside product of each market. To impose non-negativity constraint on the price vector, we pass log price and exponentiate inside the function. Iterate this until <span class="math inline">\(\max_{jt}|p_{jt}^{(r + 1)} - p_{jt}^{(r)}| &lt; \lambda\)</span>, for example with <span class="math inline">\(\lambda = 10^{-6}\)</span>. This iteration may or may not converge. The convergence depends on the parameters and the realization of the shocks. If the algorithm does not converge, first check the code.</li>
</ol>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="applications.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set the threshold</span></span>
<span id="cb234-2"><a href="applications.html#cb234-2" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="fl">1e-6</span></span>
<span id="cb234-3"><a href="applications.html#cb234-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set the initial price</span></span>
<span id="cb234-4"><a href="applications.html#cb234-4" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> M[M<span class="sc">$</span>j <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">&quot;p&quot;</span>]</span>
<span id="cb234-5"><a href="applications.html#cb234-5" aria-hidden="true" tabindex="-1"></a>logp <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">dim</span>(p)[<span class="dv">1</span>]))</span>
<span id="cb234-6"><a href="applications.html#cb234-6" aria-hidden="true" tabindex="-1"></a>p_new <span class="ot">&lt;-</span> <span class="fu">update_price</span>(logp, X, M, V, beta, sigma, mu, omega, Delta)</span>
<span id="cb234-7"><a href="applications.html#cb234-7" aria-hidden="true" tabindex="-1"></a><span class="co"># iterate</span></span>
<span id="cb234-8"><a href="applications.html#cb234-8" aria-hidden="true" tabindex="-1"></a>distance <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb234-9"><a href="applications.html#cb234-9" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (distance <span class="sc">&gt;</span> lambda) {</span>
<span id="cb234-10"><a href="applications.html#cb234-10" aria-hidden="true" tabindex="-1"></a>  p_old <span class="ot">&lt;-</span> p_new</span>
<span id="cb234-11"><a href="applications.html#cb234-11" aria-hidden="true" tabindex="-1"></a>  p_new <span class="ot">&lt;-</span> <span class="fu">update_price</span>(<span class="fu">log</span>(p_old), X, M, V, beta, sigma, mu, omega, Delta)</span>
<span id="cb234-12"><a href="applications.html#cb234-12" aria-hidden="true" tabindex="-1"></a>  distance <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">abs</span>(p_new <span class="sc">-</span> p_old))</span>
<span id="cb234-13"><a href="applications.html#cb234-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(distance)</span>
<span id="cb234-14"><a href="applications.html#cb234-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb234-15"><a href="applications.html#cb234-15" aria-hidden="true" tabindex="-1"></a><span class="co"># save</span></span>
<span id="cb234-16"><a href="applications.html#cb234-16" aria-hidden="true" tabindex="-1"></a>p_actual <span class="ot">&lt;-</span> p_new</span>
<span id="cb234-17"><a href="applications.html#cb234-17" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(p_actual, <span class="at">file =</span> <span class="st">&quot;data/A5_price_actual.RData&quot;</span>)</span></code></pre></div>
<!-- 10. Write a function `compute_equilibrium_condition(logp, X, M, V, beta, sigma, mu, omega, Delta)` that computes: -->
<!-- $$ -->
<!-- p_t - [c_t + \Omega_t(p_t, x_t, \xi_t, \Delta_t)^{-1} s_t(p_t, x_t, \xi_t)]. -->
<!-- $$ -->
<!-- mainly as a function of $p_t$. The returned object should be a vector whose row represents the condition for an inside product of each market. To impose non-negativity constraint on the price vector in the following optimization problem, we pass log price and exponentiate inside the function. -->
<!-- ```{r, echo = TRUE} -->
<!-- equilibrium_condition <- compute_equilibrium_condition(logp, X, M, V, beta, sigma, mu, omega, Delta) -->
<!-- head(equilibrium_condition) -->
<!-- summary(equilibrium_condition) -->
<!-- ``` -->
<!-- 11. Write a function `compute_equilibrium_price(logp, X, M, V, beta, sigma, mu, omega, Delta)` that find a price vector that makes the `compute_equilibrium_condition` zero. To solve a system of non-linear equations, you can call `nleqslv::nleqslv` inside `compute_equilibrium_price`. If `update_price` converged, use the limit as the initial price vector. Even if `update_price` did not converge, use a price vcector after several iterations for the initial price vector. -->
<!-- ```{r, echo = TRUE} -->
<!-- load(file = "data/A4_price_iteration.RData") -->
<!-- p_equilibrium_2 <- compute_equilibrium_price(log(p_new), X, M, V, beta, sigma, mu, omega, Delta) -->
<!-- save(p_equilibrium_2, file = "data/A5_price_nleqslv.RData") -->
<!-- ``` -->
</div>
<div id="estimate-the-parameters-3" class="section level2 hasAnchor" number="10.12">
<h2><span class="header-section-number">10.12</span> Estimate the parameters<a href="applications.html#estimate-the-parameters-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>Write a function <code>estimate_marginal_cost()</code> that estimate <span class="math inline">\(c_t\)</span> by the equilibrium condition as:
<span class="math display">\[
c_t = p_t - \Omega_t(p_t, x_t, \xi_t, \Delta_t)^{-1} s_t(p_t, x_t, \xi_t)
\]</span></li>
</ol>
<p>Of course, in reality, we first draw Monte Carlo shocks to approximate the share, estimate the demand parameters, and use these shocks and estimates to estimate the marginal costs. In this assignment, we check the if the estimated marginal costs coincide with the true marginal costs to confirm that the codes are correctly written.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="applications.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load</span></span>
<span id="cb235-2"><a href="applications.html#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A5_price_actual.RData&quot;</span>)</span>
<span id="cb235-3"><a href="applications.html#cb235-3" aria-hidden="true" tabindex="-1"></a><span class="co"># take the logarithm</span></span>
<span id="cb235-4"><a href="applications.html#cb235-4" aria-hidden="true" tabindex="-1"></a>logp <span class="ot">&lt;-</span> <span class="fu">log</span>(p_actual)</span>
<span id="cb235-5"><a href="applications.html#cb235-5" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the marginal cost</span></span>
<span id="cb235-6"><a href="applications.html#cb235-6" aria-hidden="true" tabindex="-1"></a>marginal_cost_estimate <span class="ot">&lt;-</span> <span class="fu">estimate_marginal_cost</span>(logp, X, M, V, beta, sigma, mu, omega, Delta)</span>
<span id="cb235-7"><a href="applications.html#cb235-7" aria-hidden="true" tabindex="-1"></a>marginal_cost_actual <span class="ot">&lt;-</span> M[M<span class="sc">$</span>j <span class="sc">&gt;</span> <span class="dv">0</span>, ]<span class="sc">$</span>c</span>
<span id="cb235-8"><a href="applications.html#cb235-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the estimate vs actual marginal costs</span></span>
<span id="cb235-9"><a href="applications.html#cb235-9" aria-hidden="true" tabindex="-1"></a>marginal_cost_df <span class="ot">&lt;-</span></span>
<span id="cb235-10"><a href="applications.html#cb235-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">actual =</span> marginal_cost_actual,</span>
<span id="cb235-11"><a href="applications.html#cb235-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">estimate =</span> marginal_cost_estimate)</span>
<span id="cb235-12"><a href="applications.html#cb235-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(marginal_cost_df, <span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> actual)) <span class="sc">+</span></span>
<span id="cb235-13"><a href="applications.html#cb235-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="lecture_files/figure-html/unnamed-chunk-155-1.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>(Optional) Translate <code>compute_indirect_utility</code>, <code>compute_choice_smooth</code>, <code>compute_derivative_share_smooth</code>, <code>update_price</code> into C++ using Rcpp and Eigen. Check that the outputs coincide at the machine precision level. I give you extra 2 points for this task on top of the usual 10 points for this assignment.</li>
</ol>
</div>
<div id="conduct-counterfactual-simulation" class="section level2 hasAnchor" number="10.13">
<h2><span class="header-section-number">10.13</span> Conduct counterfactual simulation<a href="applications.html#conduct-counterfactual-simulation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>Suppose that the firm of product 1 owner purchase the firms that own product 2 and 3. Let <code>Delta_counterfactual</code> be the relevant ownership matrix. Make <code>Delta_counterfactual</code>.</li>
</ol>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="applications.html#cb236-1" aria-hidden="true" tabindex="-1"></a>Delta_counterfactual[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    0    0    0
## [2,]    0    1    0    0
## [3,]    0    0    1    0
## [4,]    0    0    0    1</code></pre>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="applications.html#cb238-1" aria-hidden="true" tabindex="-1"></a>Delta_counterfactual[[T]]</span></code></pre></div>
<pre><code>##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
##  [1,]    1    1    1    0    0    0    0    0    0     0
##  [2,]    1    1    1    0    0    0    0    0    0     0
##  [3,]    1    1    1    0    0    0    0    0    0     0
##  [4,]    0    0    0    1    0    0    0    0    0     0
##  [5,]    0    0    0    0    1    0    0    0    0     0
##  [6,]    0    0    0    0    0    1    0    0    0     0
##  [7,]    0    0    0    0    0    0    1    0    0     0
##  [8,]    0    0    0    0    0    0    0    1    0     0
##  [9,]    0    0    0    0    0    0    0    0    1     0
## [10,]    0    0    0    0    0    0    0    0    0     1</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Compute the counterfactual price using the iteration with <code>update_price</code>. You can start the iteration from the equilibrium price. Show the average percentage change in the price for each product. In theory, the price of any product should not drop. But some prices can slightly drop because of the numerical errors.</li>
</ol>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="applications.html#cb240-1" aria-hidden="true" tabindex="-1"></a>logp <span class="ot">&lt;-</span> <span class="fu">log</span>(p_actual)</span>
<span id="cb240-2"><a href="applications.html#cb240-2" aria-hidden="true" tabindex="-1"></a>p_new <span class="ot">&lt;-</span> <span class="fu">update_price</span>(logp, X, M, V, beta, sigma, mu, omega, Delta_counterfactual)</span>
<span id="cb240-3"><a href="applications.html#cb240-3" aria-hidden="true" tabindex="-1"></a>distance <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb240-4"><a href="applications.html#cb240-4" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (distance <span class="sc">&gt;</span> lambda) {</span>
<span id="cb240-5"><a href="applications.html#cb240-5" aria-hidden="true" tabindex="-1"></a>  p_old <span class="ot">&lt;-</span> p_new</span>
<span id="cb240-6"><a href="applications.html#cb240-6" aria-hidden="true" tabindex="-1"></a>  p_new <span class="ot">&lt;-</span> <span class="fu">update_price</span>(<span class="fu">log</span>(p_old), X, M, V, beta, sigma, mu, omega, Delta_counterfactual)</span>
<span id="cb240-7"><a href="applications.html#cb240-7" aria-hidden="true" tabindex="-1"></a>  distance <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">abs</span>(p_new <span class="sc">-</span> p_old))</span>
<span id="cb240-8"><a href="applications.html#cb240-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(distance)</span>
<span id="cb240-9"><a href="applications.html#cb240-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb240-10"><a href="applications.html#cb240-10" aria-hidden="true" tabindex="-1"></a>p_counterfactual <span class="ot">&lt;-</span> p_new</span>
<span id="cb240-11"><a href="applications.html#cb240-11" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(p_counterfactual, <span class="at">file =</span> <span class="st">&quot;data/A5_price_counterfactual.RData&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">j</th>
<th align="right">p_change</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.0501744</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">0.1179955</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0.1479700</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">0.0013059</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0.0004309</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">-0.0002448</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">0.0008458</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">-0.0033448</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">0.0004042</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">0.0015040</td>
</tr>
</tbody>
</table>
<ol start="3" style="list-style-type: decimal">
<li>Write a function <code>compute_producer_surplus(p, marginal_cost, X, M, V, beta, sigma, mu, omega)</code> that returns the producer surplus for each product in each market. Compute the actual and counterfactual producer surplus under the estimated marginal costs. Show the average percentage change in the producer surplus for each product.</li>
</ol>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="applications.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute actual producer surplus</span></span>
<span id="cb241-2"><a href="applications.html#cb241-2" aria-hidden="true" tabindex="-1"></a>producer_surplus_actual <span class="ot">&lt;-</span></span>
<span id="cb241-3"><a href="applications.html#cb241-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_producer_surplus</span>(p_actual, marginal_cost_estimate, X, M, V, beta, sigma, mu, omega)</span>
<span id="cb241-4"><a href="applications.html#cb241-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(producer_surplus_actual)</span></code></pre></div>
<pre><code>##        s           
##  Min.   :0.008247  
##  1st Qu.:0.041636  
##  Median :0.071153  
##  Mean   :0.168761  
##  3rd Qu.:0.150643  
##  Max.   :1.607658</code></pre>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="applications.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute counterfactual producer surplus</span></span>
<span id="cb243-2"><a href="applications.html#cb243-2" aria-hidden="true" tabindex="-1"></a>producer_surplus_counterfactual <span class="ot">&lt;-</span></span>
<span id="cb243-3"><a href="applications.html#cb243-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_producer_surplus</span>(p_counterfactual, marginal_cost_estimate, X, M, V, beta, sigma, mu, omega)</span>
<span id="cb243-4"><a href="applications.html#cb243-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(producer_surplus_counterfactual)</span></code></pre></div>
<pre><code>##        s           
##  Min.   :0.008212  
##  1st Qu.:0.042687  
##  Median :0.073644  
##  Mean   :0.171809  
##  3rd Qu.:0.153746  
##  Max.   :1.607658</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">j</th>
<th align="right">producer_surplus_change</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.0231358</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">0.0131566</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0.0073846</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">0.0534174</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0.0449804</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0.0563809</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">0.0372859</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">0.0072057</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">0.0421801</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">0.0385013</td>
</tr>
</tbody>
</table>
<ol start="4" style="list-style-type: decimal">
<li>Write a function <code>compute_consumer_surplus(p, X, M, V, beta, sigma, mu, omega)</code> that returns the consumer surplus for each consumer in each market. Compute the actual and counterfactual consumer surplus under the estimated marginal costs. Show the percentage change in the total consumer surplus.</li>
</ol>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="applications.html#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute actual consumer surplus</span></span>
<span id="cb245-2"><a href="applications.html#cb245-2" aria-hidden="true" tabindex="-1"></a>consumer_surplus_actual <span class="ot">&lt;-</span> </span>
<span id="cb245-3"><a href="applications.html#cb245-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_consumer_surplus</span>(p_actual, X, M, V, beta, sigma, mu, omega)</span>
<span id="cb245-4"><a href="applications.html#cb245-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(consumer_surplus_actual)</span></code></pre></div>
<pre><code>##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
##   0.00000   0.03447   1.10805   4.33269   4.65720 230.98190</code></pre>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="applications.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute counterfactual consumer surplus</span></span>
<span id="cb247-2"><a href="applications.html#cb247-2" aria-hidden="true" tabindex="-1"></a>consumer_surplus_counterfactual <span class="ot">&lt;-</span> </span>
<span id="cb247-3"><a href="applications.html#cb247-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_consumer_surplus</span>(p_counterfactual, X, M, V, beta, sigma, mu, omega)</span>
<span id="cb247-4"><a href="applications.html#cb247-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(consumer_surplus_counterfactual)</span></code></pre></div>
<pre><code>##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
##   0.00000   0.03054   1.07265   4.31048   4.61989 231.02355</code></pre>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="applications.html#cb249-1" aria-hidden="true" tabindex="-1"></a>consumer_surplus_change <span class="ot">&lt;-</span> </span>
<span id="cb249-2"><a href="applications.html#cb249-2" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">sum</span>(consumer_surplus_counterfactual) <span class="sc">-</span> </span>
<span id="cb249-3"><a href="applications.html#cb249-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">sum</span>(consumer_surplus_actual)) <span class="sc">/</span></span>
<span id="cb249-4"><a href="applications.html#cb249-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(consumer_surplus_actual)</span>
<span id="cb249-5"><a href="applications.html#cb249-5" aria-hidden="true" tabindex="-1"></a>consumer_surplus_change</span></code></pre></div>
<pre><code>## [1] -0.005127025</code></pre>

</div>
<div id="simulate-data-5" class="section level2 hasAnchor" number="10.14">
<h2><span class="header-section-number">10.14</span> Simulate data<a href="applications.html#simulate-data-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this assignment, we consider a Berry-type entry model. Suppose that there are <span class="math inline">\(M\)</span> markets indexed by <span class="math inline">\(m = 1, \cdots, M\)</span>. In each market, there are <span class="math inline">\(N_m\)</span> potential entrants such that <span class="math inline">\(N_m \le \overline{N}\)</span>. Let <span class="math inline">\(x_m\)</span> be the <span class="math inline">\(K\)</span> dimensional market attributes and <span class="math inline">\(z_{im}\)</span> be the <span class="math inline">\(L\)</span> dimensional potential entrant attributes. The size of Monte Carlo simulations in the estimation is <span class="math inline">\(R\)</span>.</p>
<p>A standard %dopar% is not replicable. Therefore, we use package doRNG to perform reproducible foreach parallel.</p>
<ol style="list-style-type: decimal">
<li>Set the constants as follows:</li>
</ol>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="applications.html#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># register doRNG backend</span></span>
<span id="cb251-2"><a href="applications.html#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoRNG</span>()</span>
<span id="cb251-3"><a href="applications.html#cb251-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set the seed</span></span>
<span id="cb251-4"><a href="applications.html#cb251-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb251-5"><a href="applications.html#cb251-5" aria-hidden="true" tabindex="-1"></a><span class="co"># number of markets</span></span>
<span id="cb251-6"><a href="applications.html#cb251-6" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb251-7"><a href="applications.html#cb251-7" aria-hidden="true" tabindex="-1"></a><span class="co"># the upper bound of the number of potential entrants</span></span>
<span id="cb251-8"><a href="applications.html#cb251-8" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb251-9"><a href="applications.html#cb251-9" aria-hidden="true" tabindex="-1"></a><span class="co"># the dimension of market attributes</span></span>
<span id="cb251-10"><a href="applications.html#cb251-10" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb251-11"><a href="applications.html#cb251-11" aria-hidden="true" tabindex="-1"></a><span class="co"># the dimension of potential entrant attributes</span></span>
<span id="cb251-12"><a href="applications.html#cb251-12" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb251-13"><a href="applications.html#cb251-13" aria-hidden="true" tabindex="-1"></a><span class="co"># the number of Monte Carlo simulations</span></span>
<span id="cb251-14"><a href="applications.html#cb251-14" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="dv">100</span></span></code></pre></div>
<p>The payoff of entrant <span class="math inline">\(i\)</span> in market <span class="math inline">\(m\)</span> is:
<span class="math display">\[
\pi_{im}(y_m) = x_m&#39;\beta - \delta \ln \left(\sum_{i = 1}^{N_m} y_{im}\right) + z_{im}&#39;\alpha + \sqrt{1 - \rho^2} \nu_{im} + \rho \epsilon_{m},
\]</span>
where <span class="math inline">\(y_{im} \in \{0, 1\}\)</span> is the indicator for entrant <span class="math inline">\(i\)</span> in market <span class="math inline">\(m\)</span> to enter the market, and <span class="math inline">\(\nu_{im}\)</span> and <span class="math inline">\(\epsilon_m\)</span> are entrant- and market-specific idiosyncratic shocks that are drawn from an i.i.d. standard normal distribution. In each market, all the attributes and idiosyncratic shocks are observed by the potential entrants. <span class="math inline">\(N_m\)</span>, <span class="math inline">\(x_m\)</span>, <span class="math inline">\(z_{im}\)</span>, and <span class="math inline">\(y_m\)</span> are observed to econometrician but <span class="math inline">\(\nu_{im}\)</span> and <span class="math inline">\(\epsilon_m\)</span> are not.</p>
<ol start="2" style="list-style-type: decimal">
<li>Set the parameters as follows:</li>
</ol>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="applications.html#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="co"># parameters of interest</span></span>
<span id="cb252-2"><a href="applications.html#cb252-2" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(K)); beta</span></code></pre></div>
<pre><code>## [1] 0.6264538 0.1836433</code></pre>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="applications.html#cb254-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(L)); alpha</span></code></pre></div>
<pre><code>## [1] 0.8356286 1.5952808</code></pre>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="applications.html#cb256-1" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="dv">1</span>; delta</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="applications.html#cb258-1" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>)); rho</span></code></pre></div>
<pre><code>## [1] 0.3295078</code></pre>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="applications.html#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="co"># auxiliary parameters</span></span>
<span id="cb260-2"><a href="applications.html#cb260-2" aria-hidden="true" tabindex="-1"></a>x_mu <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb260-3"><a href="applications.html#cb260-3" aria-hidden="true" tabindex="-1"></a>x_sd <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb260-4"><a href="applications.html#cb260-4" aria-hidden="true" tabindex="-1"></a>z_mu <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb260-5"><a href="applications.html#cb260-5" aria-hidden="true" tabindex="-1"></a>z_sd <span class="ot">&lt;-</span> <span class="dv">4</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Draw exogenous variables as follows:</li>
</ol>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="applications.html#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of potential entrants</span></span>
<span id="cb261-2"><a href="applications.html#cb261-2" aria-hidden="true" tabindex="-1"></a>E <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">rdunif</span>(M, <span class="dv">1</span>, N); E</span></code></pre></div>
<pre><code>##   [1]  3  1  5  5 10  6 10  7  9  5  5  9  9  5  5  2 10  9  1  4  3  6 10 10  6  4  4
##  [28] 10  9  7  6  9  8  9  7  8  6 10  7  3 10  6  8  2  2  6  6  1  3  3  8  6  7  6
##  [55]  8  7  1  4  8  9  9  7  4  7  6  1  5  6  1  9  7  7  3  6  2 10 10  7  3  2 10
##  [82]  1 10 10  8 10  5  7  8  5  6  8  1  3 10  3  1  6  6  4</code></pre>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="applications.html#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="co"># market attributes</span></span>
<span id="cb263-2"><a href="applications.html#cb263-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb263-3"><a href="applications.html#cb263-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rnorm</span>(M <span class="sc">*</span> K, x_mu, x_sd),</span>
<span id="cb263-4"><a href="applications.html#cb263-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> M</span>
<span id="cb263-5"><a href="applications.html#cb263-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb263-6"><a href="applications.html#cb263-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(X) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;x&quot;</span>, <span class="dv">1</span><span class="sc">:</span>K, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb263-7"><a href="applications.html#cb263-7" aria-hidden="true" tabindex="-1"></a>X</span></code></pre></div>
<pre><code>##                 x_1          x_2
##   [1,] -0.706006198 -2.693970265
##   [2,]  0.594464155  3.951686710
##   [3,]  4.534260990  1.659774411
##   [4,] -3.570700401 -3.401750087
##   [5,]  2.781838563  2.563068228
##   [6,]  1.998851114  0.523736186
##   [7,]  4.189299512  5.393761936
##   [8,]  0.087448229 -1.298245999
##   [9,]  2.110056430 -0.290635262
##  [10,]  1.801296372 -1.778328492
##  [11,] -0.627560093  0.468688116
##  [12,]  4.623603418  2.206035338
##  [13,]  4.481207847 -1.195244519
##  [14,]  3.100640949  3.491119504
##  [15,]  5.760500364 -2.624248359
##  [16,]  2.675459277 -2.143953238
##  [17,] -2.829776625  5.323473121
##  [18,] -0.719796243 -2.047542396
##  [19,] -2.673837845  2.235924137
##  [20,] -0.420201909 -0.143228153
##  [21,] -0.861100032  2.228205519
##  [22,]  1.126347619  6.066619859
##  [23,] -1.732764946  5.759765300
##  [24,]  1.474086317  0.007276598
##  [25,] -0.963753932 -5.855706606
##  [26,]  6.301861808  8.492984770
##  [27,]  3.150122428  3.001198500
##  [28,]  3.730522688  2.623982008
##  [29,]  2.152556073  0.959801431
##  [30,]  6.046528242  2.530325269
##  [31,] -0.907209362  0.506872505
##  [32,] -0.384934191  2.262083930
##  [33,]  5.296846716 -0.200740232
##  [34,] -0.952089060 -3.110623633
##  [35,]  0.377857769  3.963514802
##  [36,] -0.178423788  5.559235076
##  [37,]  0.040021394  0.073778292
##  [38,]  0.162660091 -2.759869267
##  [39,]  2.482564994  2.926723917
##  [40,]  0.468008553  0.865872589
##  [41,] -0.517872386 -4.199655220
##  [42,]  5.029116476  1.006395579
##  [43,]  0.356261774 -0.890901002
##  [44,]  0.461330410 -0.022905740
##  [45,]  0.699427776 -2.469717088
##  [46,]  3.137998921  6.409425724
##  [47,]  0.779306788  0.006603891
##  [48,]  0.887097486 -3.816540237
##  [49,] -1.044981436  1.591580316
##  [50,]  0.027189183  1.789526939
##  [51,]  1.180481321 -1.957480101
##  [52,] -0.766683459 -7.666762015
##  [53,]  2.594488578 -0.921445108
##  [54,] -3.555182245  2.711522908
##  [55,]  1.919673582  0.820830172
##  [56,] -3.609349471  0.705463768
##  [57,]  0.097071619  2.682462186
##  [58,] -0.584839713 -2.559375916
##  [59,] -0.956284342  4.290331133
##  [60,]  0.829309666  0.983967915
##  [61,] -4.743078277  3.121932002
##  [62,]  4.529749936  4.102323204
##  [63,] -3.994917309  1.670441245
##  [64,] -0.390591204 -1.636122839
##  [65,] -2.347760315  4.488893668
##  [66,] -1.252457004 -5.000494834
##  [67,]  7.261499637 -0.634372220
##  [68,]  1.052186859  0.232987873
##  [69,] -2.858901591  0.501636890
##  [70,] -3.921816603  4.061391726
##  [71,]  2.350561304  1.408665679
##  [72,]  0.944320502  2.221502810
##  [73,]  0.045794876  0.791035561
##  [74,] -1.788086442  0.257006975
##  [75,] -3.462380930  3.086652420
##  [76,] -2.225576890  4.438685072
##  [77,]  4.000086411 -6.209288645
##  [78,] -0.863800084  2.718218666
##  [79,] -3.153280542  2.124173220
##  [80,]  6.607871867 -0.275803165
##  [81,]  2.275301132  3.853038423
##  [82,]  0.284058697 -0.167711545
##  [83,]  4.175449146  0.147008015
##  [84,]  3.659267954  3.572229334
##  [85,] -0.857729145  6.158881897
##  [86,]  7.618307394  1.810164703
##  [87,]  0.234918910 -0.266552029
##  [88,] -3.273483951 -2.567339885
##  [89,]  0.566801194  0.006901063
##  [90,]  1.622615018 -1.819487980
##  [91,]  7.923935197  0.223202251
##  [92,]  1.317407104  2.183137505
##  [93,]  2.370996416 -1.555571276
##  [94,]  0.768541194  8.947500643
##  [95,] -0.002002527  1.468035027
##  [96,]  0.895821915  4.390621802
##  [97,]  3.362918817 -5.867371940
##  [98,]  7.225735026  3.223003472
##  [99,]  4.082177316 -2.948735481
## [100,]  4.623725195  3.759411033</code></pre>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="applications.html#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="co"># entrant attributes</span></span>
<span id="cb265-2"><a href="applications.html#cb265-2" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span></span>
<span id="cb265-3"><a href="applications.html#cb265-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span> (<span class="at">m =</span> <span class="dv">1</span><span class="sc">:</span>M) <span class="sc">%dopar%</span> {</span>
<span id="cb265-4"><a href="applications.html#cb265-4" aria-hidden="true" tabindex="-1"></a>    Z_m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb265-5"><a href="applications.html#cb265-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rnorm</span>(E[m] <span class="sc">*</span> L, z_mu, z_sd),</span>
<span id="cb265-6"><a href="applications.html#cb265-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">nrow =</span> E[m]</span>
<span id="cb265-7"><a href="applications.html#cb265-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb265-8"><a href="applications.html#cb265-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(Z_m) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;z&quot;</span>, <span class="dv">1</span><span class="sc">:</span>L, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb265-9"><a href="applications.html#cb265-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(Z_m)</span>
<span id="cb265-10"><a href="applications.html#cb265-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb265-11"><a href="applications.html#cb265-11" aria-hidden="true" tabindex="-1"></a>Z[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>##             z_1       z_2
## [1,] -2.3581574 -7.334507
## [2,] -0.4604547  3.771050
## [3,]  2.7599294  4.610126</code></pre>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="applications.html#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unobserved market attributes</span></span>
<span id="cb267-2"><a href="applications.html#cb267-2" aria-hidden="true" tabindex="-1"></a>EP <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb267-3"><a href="applications.html#cb267-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rnorm</span>(M),</span>
<span id="cb267-4"><a href="applications.html#cb267-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> M</span>
<span id="cb267-5"><a href="applications.html#cb267-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb267-6"><a href="applications.html#cb267-6" aria-hidden="true" tabindex="-1"></a>EP</span></code></pre></div>
<pre><code>##               [,1]
##   [1,] -1.11312295
##   [2,]  0.61696648
##   [3,]  0.51349372
##   [4,]  0.36945910
##   [5,]  1.72389413
##   [6,] -0.20614457
##   [7,] -1.31419514
##   [8,]  0.06347410
##   [9,] -0.23197745
##  [10,]  0.63506033
##  [11,]  1.63464429
##  [12,] -1.80832758
##  [13,] -0.21388595
##  [14,]  0.07036614
##  [15,]  0.54970767
##  [16,] -0.69682355
##  [17,]  0.39056594
##  [18,]  0.38141126
##  [19,] -0.01237277
##  [20,] -0.12443499
##  [21,]  1.46674459
##  [22,]  0.67392868
##  [23,]  1.95642526
##  [24,] -0.26904101
##  [25,] -1.24455152
##  [26,] -0.39570292
##  [27,]  0.09739665
##  [28,] -0.23838695
##  [29,] -0.41182796
##  [30,] -1.57721805
##  [31,] -0.79727610
##  [32,] -1.09623678
##  [33,]  0.30830875
##  [34,]  0.34479512
##  [35,]  1.53964809
##  [36,] -0.32951419
##  [37,]  0.94838935
##  [38,] -0.47925559
##  [39,] -1.51488680
##  [40,]  0.43453666
##  [41,] -0.51953667
##  [42,] -0.83455903
##  [43,] -0.75664761
##  [44,]  1.08950350
##  [45,]  1.57243292
##  [46,]  1.00736437
##  [47,] -0.27315799
##  [48,] -1.30967954
##  [49,]  0.22257383
##  [50,]  1.11343318
##  [51,]  0.83739440
##  [52,]  0.31451677
##  [53,]  0.22221807
##  [54,] -0.84361539
##  [55,]  0.44380533
##  [56,]  0.05579711
##  [57,]  0.06797239
##  [58,] -0.20196174
##  [59,] -1.15801525
##  [60,] -0.59274327
##  [61,]  0.76606538
##  [62,]  0.03892812
##  [63,]  0.01464681
##  [64,] -0.18631697
##  [65,]  1.40059083
##  [66,]  0.01848557
##  [67,]  0.24919601
##  [68,]  0.14922074
##  [69,] -0.96323318
##  [70,] -0.06646677
##  [71,]  1.28692204
##  [72,]  0.45812526
##  [73,] -1.45202829
##  [74,]  0.07734228
##  [75,]  0.55989527
##  [76,] -0.07494657
##  [77,]  0.78269770
##  [78,] -0.17266856
##  [79,] -1.05129378
##  [80,]  0.72945128
##  [81,]  0.26266524
##  [82,]  0.54365786
##  [83,]  1.04106030
##  [84,]  0.19750615
##  [85,] -1.62957829
##  [86,]  0.12104023
##  [87,] -1.63742195
##  [88,] -0.53104311
##  [89,]  0.95367979
##  [90,] -1.72065066
##  [91,]  0.10632062
##  [92,] -0.60866850
##  [93,] -0.30119698
##  [94,]  0.97620252
##  [95,]  0.45600867
##  [96,]  1.29440807
##  [97,] -1.13320221
##  [98,] -0.86946035
##  [99,] -0.75497029
## [100,] -0.12963535</code></pre>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="applications.html#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unobserved entrant attributes</span></span>
<span id="cb269-2"><a href="applications.html#cb269-2" aria-hidden="true" tabindex="-1"></a>NU <span class="ot">&lt;-</span></span>
<span id="cb269-3"><a href="applications.html#cb269-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span> (<span class="at">m =</span> <span class="dv">1</span><span class="sc">:</span>M) <span class="sc">%dopar%</span> {</span>
<span id="cb269-4"><a href="applications.html#cb269-4" aria-hidden="true" tabindex="-1"></a>    NU_m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb269-5"><a href="applications.html#cb269-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rnorm</span>(E[m]),</span>
<span id="cb269-6"><a href="applications.html#cb269-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">nrow =</span> E[m]</span>
<span id="cb269-7"><a href="applications.html#cb269-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb269-8"><a href="applications.html#cb269-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(NU_m)</span>
<span id="cb269-9"><a href="applications.html#cb269-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb269-10"><a href="applications.html#cb269-10" aria-hidden="true" tabindex="-1"></a>NU[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>##            [,1]
## [1,]  0.3934210
## [2,]  0.2303175
## [3,] -0.6046126</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Write a function <code>compute_payoff(y_m, X_m, Z_m, EP_m, NU_m, beta, alpha, delta, rho)</code> that returns the vector of payoffs of the potential entrants when the vector of entry decisions is <code>y_m</code>.</li>
</ol>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="applications.html#cb271-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb271-2"><a href="applications.html#cb271-2" aria-hidden="true" tabindex="-1"></a>N_m <span class="ot">&lt;-</span> <span class="fu">dim</span>(Z[[m]])[<span class="dv">1</span>]</span>
<span id="cb271-3"><a href="applications.html#cb271-3" aria-hidden="true" tabindex="-1"></a>y_m <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">rep</span>(<span class="dv">1</span>, N_m))</span>
<span id="cb271-4"><a href="applications.html#cb271-4" aria-hidden="true" tabindex="-1"></a>y_m[<span class="fu">length</span>(y_m)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb271-5"><a href="applications.html#cb271-5" aria-hidden="true" tabindex="-1"></a>X_m <span class="ot">&lt;-</span> X[m, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb271-6"><a href="applications.html#cb271-6" aria-hidden="true" tabindex="-1"></a>Z_m <span class="ot">&lt;-</span> Z[[m]]</span>
<span id="cb271-7"><a href="applications.html#cb271-7" aria-hidden="true" tabindex="-1"></a>EP_m <span class="ot">&lt;-</span> EP[m, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb271-8"><a href="applications.html#cb271-8" aria-hidden="true" tabindex="-1"></a>NU_m <span class="ot">&lt;-</span> NU[[m]]</span>
<span id="cb271-9"><a href="applications.html#cb271-9" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_payoff</span>(y_m, X_m, Z_m, EP_m, NU_m, beta, alpha, delta, rho)</span></code></pre></div>
<pre><code>##            [,1]
## [1,] -15.296633
## [2,]   3.851629
## [3,]   0.000000</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Assume that the order of entry is predetermined. Assume that the potential entrants sequentially decide entry according to the order of the payoff excluding the competitive effects, i.e.:
<span class="math display">\[
x_m&#39;\beta + z_{im}&#39;\alpha + \sqrt{1 - \rho^2} \nu_{im} + \rho \epsilon_{m}.
\]</span>
Write a function <code>compute_sequential_entry(X_m, Z_m, EP_m, NU_m, beta, alpha, delta, rho)</code> that returns the equilibrium vector of entry at a market.</li>
</ol>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="applications.html#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_sequential_entry</span>(X_m, Z_m, EP_m, NU_m, beta, alpha, delta, rho)</span></code></pre></div>
<pre><code>##      [,1]
## [1,]    0
## [2,]    1
## [3,]    1</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Next, assume <span class="math inline">\(\rho = 0\)</span>. Assume that potential entrants simultaneously decide entry. Write a function <code>compute_simultaneous_entry(X_m, Z_m, EP_m, NU_m, beta, alpha, delta)</code> that returns the equilibrium vector of entry at a market.</li>
</ol>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="applications.html#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_simultaneous_entry</span>(X_m, Z_m, EP_m, NU_m, beta, alpha, delta)</span></code></pre></div>
<pre><code>##      [,1]
## [1,]    0
## [2,]    1
## [3,]    1</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Write a function <code>compute_sequential_entry_across_markets(X, Z, EP, NU, beta, alpha, delta, rho)</code> compute the equilibrium entry vectors under the assumption of sequential entry. The output should be a list of entry vectors across markets. Write a function to compute the equilibrium payoffs across markets, <code>compute_payoff_across_markets(Y, X, Z, EP, NU, beta, alpha, delta, rho)</code> and check that the payoffs under the equilibrium entry vectors are non-negative. Otherwise, there are some bugs in the code.</li>
</ol>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="applications.html#cb277-1" aria-hidden="true" tabindex="-1"></a>Y_sequential <span class="ot">&lt;-</span></span>
<span id="cb277-2"><a href="applications.html#cb277-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_sequential_entry_across_markets</span>(X, Z, EP, NU, beta, alpha, delta, rho)</span>
<span id="cb277-3"><a href="applications.html#cb277-3" aria-hidden="true" tabindex="-1"></a>Y_sequential[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>##      [,1]
## [1,]    0
## [2,]    1
## [3,]    1</code></pre>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="applications.html#cb279-1" aria-hidden="true" tabindex="-1"></a>Y_sequential[[M]]</span></code></pre></div>
<pre><code>##      [,1]
## [1,]    1
## [2,]    1
## [3,]    1
## [4,]    0</code></pre>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="applications.html#cb281-1" aria-hidden="true" tabindex="-1"></a>payoff_sequential <span class="ot">&lt;-</span></span>
<span id="cb281-2"><a href="applications.html#cb281-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_payoff_across_markets</span>(Y_sequential, X, Z, EP, NU, beta, alpha, delta, rho)</span>
<span id="cb281-3"><a href="applications.html#cb281-3" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(<span class="fu">unlist</span>(payoff_sequential))</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<ol start="8" style="list-style-type: decimal">
<li>Write a function <code>compute_simultaneous_entry_across_markets(X, Z, EP, NU, beta, alpha, delta, rho = 0)</code> compute the equilibrium entry vectors under the assumption of simultaneous entry. The output should be a list of entry vectors across markets. Check that the payoffs under the equilibrium entry vectors are non-negative. Otherwise, there are some bugs in the code. I also recommend to write this function with</li>
</ol>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="applications.html#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute simultaneous entry across markets</span></span>
<span id="cb283-2"><a href="applications.html#cb283-2" aria-hidden="true" tabindex="-1"></a>Y_simultaneous <span class="ot">&lt;-</span></span>
<span id="cb283-3"><a href="applications.html#cb283-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_simultaneous_entry_across_markets</span>(X, Z, EP, NU, beta, alpha, delta)</span>
<span id="cb283-4"><a href="applications.html#cb283-4" aria-hidden="true" tabindex="-1"></a>Y_simultaneous[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>##      [,1]
## [1,]    0
## [2,]    1
## [3,]    1</code></pre>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="applications.html#cb285-1" aria-hidden="true" tabindex="-1"></a>Y_simultaneous[[M]]</span></code></pre></div>
<pre><code>##      [,1]
## [1,]    1
## [2,]    1
## [3,]    1
## [4,]    0</code></pre>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="applications.html#cb287-1" aria-hidden="true" tabindex="-1"></a>payoff_simultaneous <span class="ot">&lt;-</span></span>
<span id="cb287-2"><a href="applications.html#cb287-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_payoff_across_markets</span>(Y_simultaneous, X, Z, EP, NU, beta, alpha, delta, <span class="at">rho =</span> <span class="dv">0</span>)</span>
<span id="cb287-3"><a href="applications.html#cb287-3" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(<span class="fu">unlist</span>(payoff_simultaneous))</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
</div>
<div id="estimate-the-parameters-4" class="section level2 hasAnchor" number="10.15">
<h2><span class="header-section-number">10.15</span> Estimate the parameters<a href="applications.html#estimate-the-parameters-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We estimate the parameters by matching the actual and predicted number of entrants in each market. To do so, we simulate the model for <span class="math inline">\(R\)</span> times.
Under the assumption of the sequential entry, we can uniquely predict the equilibrium identify of the entrants. So, we consider the following objective function:
<span class="math display">\[
\frac{1}{RM}\sum_{r = 1}^R \sum_{m = 1}^M \left[\sum_{i = 1}^{N_m}|y_{im} - y_{im}^{(r)}| \right]^2,
\]</span>
where <span class="math inline">\(y_{im}^{(r)}\)</span> is the entry decision in <span class="math inline">\(r\)</span>-th simulation. On the other hand, under the assumption of the simultaneous entry, we can only uniquely predict the equilibrium number of the entrants. So, we consider the following objective function:
<span class="math display">\[
\frac{1}{RM}\sum_{r = 1}^R \sum_{m = 1}^M \left[\sum_{i = 1}^{N_m}(y_{im} - y_{im}^{(r)}) \right]^2,
\]</span></p>
<ol style="list-style-type: decimal">
<li>Draw <span class="math inline">\(R\)</span> unobserved shocks:</li>
</ol>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="applications.html#cb289-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb289-2"><a href="applications.html#cb289-2" aria-hidden="true" tabindex="-1"></a><span class="co"># unobserved market attributes</span></span>
<span id="cb289-3"><a href="applications.html#cb289-3" aria-hidden="true" tabindex="-1"></a>EP_mc <span class="ot">&lt;-</span></span>
<span id="cb289-4"><a href="applications.html#cb289-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span> (<span class="at">r =</span> <span class="dv">1</span><span class="sc">:</span>R) <span class="sc">%dopar%</span> {</span>
<span id="cb289-5"><a href="applications.html#cb289-5" aria-hidden="true" tabindex="-1"></a>    EP <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb289-6"><a href="applications.html#cb289-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rnorm</span>(M),</span>
<span id="cb289-7"><a href="applications.html#cb289-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">nrow =</span> M</span>
<span id="cb289-8"><a href="applications.html#cb289-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb289-9"><a href="applications.html#cb289-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(EP)</span>
<span id="cb289-10"><a href="applications.html#cb289-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb289-11"><a href="applications.html#cb289-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-12"><a href="applications.html#cb289-12" aria-hidden="true" tabindex="-1"></a><span class="co"># unobserved entrant attributes</span></span>
<span id="cb289-13"><a href="applications.html#cb289-13" aria-hidden="true" tabindex="-1"></a>NU_mc <span class="ot">&lt;-</span></span>
<span id="cb289-14"><a href="applications.html#cb289-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span> (<span class="at">r =</span> <span class="dv">1</span><span class="sc">:</span>R) <span class="sc">%dopar%</span> {</span>
<span id="cb289-15"><a href="applications.html#cb289-15" aria-hidden="true" tabindex="-1"></a>  NU <span class="ot">&lt;-</span></span>
<span id="cb289-16"><a href="applications.html#cb289-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">foreach</span> (<span class="at">m =</span> <span class="dv">1</span><span class="sc">:</span>M) <span class="sc">%do%</span> {</span>
<span id="cb289-17"><a href="applications.html#cb289-17" aria-hidden="true" tabindex="-1"></a>      NU_m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb289-18"><a href="applications.html#cb289-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rnorm</span>(E[m]),</span>
<span id="cb289-19"><a href="applications.html#cb289-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">nrow =</span> E[m]</span>
<span id="cb289-20"><a href="applications.html#cb289-20" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb289-21"><a href="applications.html#cb289-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(NU_m)</span>
<span id="cb289-22"><a href="applications.html#cb289-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb289-23"><a href="applications.html#cb289-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(NU)</span>
<span id="cb289-24"><a href="applications.html#cb289-24" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Write a function <code>compute_monte_carlo_sequential_entry(X, Z, EP_mc, NU_mc, beta, alpha, delta, rho)</code> that returns the Monte Carlo simulation. Then, write function <code>compute_objective_sequential_entry(Y, X, Z, EP_mc, NU_mc, theta)</code> that calls<code>compute_monte_carlo_sequential_entry</code> and returns the value of the objective function given data and parameters under the assumption of sequential entry.</li>
</ol>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="applications.html#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sequential entry</span></span>
<span id="cb290-2"><a href="applications.html#cb290-2" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> theta_sequential <span class="ot">&lt;-</span></span>
<span id="cb290-3"><a href="applications.html#cb290-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(beta, alpha, delta, rho)</span>
<span id="cb290-4"><a href="applications.html#cb290-4" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Y_sequential</span>
<span id="cb290-5"><a href="applications.html#cb290-5" aria-hidden="true" tabindex="-1"></a><span class="co"># compute monte carlo simulations </span></span>
<span id="cb290-6"><a href="applications.html#cb290-6" aria-hidden="true" tabindex="-1"></a>Y_mc <span class="ot">&lt;-</span> </span>
<span id="cb290-7"><a href="applications.html#cb290-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_monte_carlo_sequential_entry</span>(</span>
<span id="cb290-8"><a href="applications.html#cb290-8" aria-hidden="true" tabindex="-1"></a>    X, Z, EP_mc, NU_mc, beta, alpha, delta, rho)</span>
<span id="cb290-9"><a href="applications.html#cb290-9" aria-hidden="true" tabindex="-1"></a>Y_mc[[<span class="dv">1</span>]][[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>##      [,1]
## [1,]    0
## [2,]    1
## [3,]    1</code></pre>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="applications.html#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute objective function</span></span>
<span id="cb292-2"><a href="applications.html#cb292-2" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_objective_sequential_entry</span>(Y, X, Z, EP_mc, NU_mc, theta)</span></code></pre></div>
<pre><code>## [1] 0.34</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Write a function <code>compute_objective_simultaneous_entry(Y, X, Z, EP_mc, NU_mc, theta)</code> that returns the value of the objective function given data and parameters under the assumption of simultaneous entry.</li>
</ol>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="applications.html#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simultaneous entry</span></span>
<span id="cb294-2"><a href="applications.html#cb294-2" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> theta_simultaneous <span class="ot">&lt;-</span></span>
<span id="cb294-3"><a href="applications.html#cb294-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(beta, alpha, delta)</span>
<span id="cb294-4"><a href="applications.html#cb294-4" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Y_simultaneous</span>
<span id="cb294-5"><a href="applications.html#cb294-5" aria-hidden="true" tabindex="-1"></a><span class="co"># compute monte carlo simulations</span></span>
<span id="cb294-6"><a href="applications.html#cb294-6" aria-hidden="true" tabindex="-1"></a>Y_mc <span class="ot">&lt;-</span> <span class="fu">compute_monte_carlo_simultaneous_entry</span>(X, Z, EP_mc, NU_mc, beta, alpha, delta)</span>
<span id="cb294-7"><a href="applications.html#cb294-7" aria-hidden="true" tabindex="-1"></a>Y_mc[[<span class="dv">1</span>]][[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>##      [,1]
## [1,]    0
## [2,]    1
## [3,]    1</code></pre>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="applications.html#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute objective function</span></span>
<span id="cb296-2"><a href="applications.html#cb296-2" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_objective_simultaneous_entry</span>(Y, X, Z, EP_mc, NU_mc, theta)</span></code></pre></div>
<pre><code>## [1] 0.2456</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Check the value of the objective function around the true parameter under the assumption of the sequential entry.</li>
</ol>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="applications.html#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sequential entry</span></span>
<span id="cb298-2"><a href="applications.html#cb298-2" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> theta_sequential <span class="ot">&lt;-</span></span>
<span id="cb298-3"><a href="applications.html#cb298-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(beta, alpha, delta, rho)</span>
<span id="cb298-4"><a href="applications.html#cb298-4" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Y_sequential</span>
<span id="cb298-5"><a href="applications.html#cb298-5" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> compute_sequential_entry_across_markets</span>
<span id="cb298-6"><a href="applications.html#cb298-6" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">beta_&quot;</span>, <span class="dv">1</span><span class="sc">:</span>K, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>), </span>
<span id="cb298-7"><a href="applications.html#cb298-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">paste</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">alpha_&quot;</span>, <span class="dv">1</span><span class="sc">:</span>L, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb298-8"><a href="applications.html#cb298-8" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;</span><span class="sc">\\</span><span class="st">delta&quot;</span>,</span>
<span id="cb298-9"><a href="applications.html#cb298-9" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;</span><span class="sc">\\</span><span class="st">rho&quot;</span>)</span>
<span id="cb298-10"><a href="applications.html#cb298-10" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;$&quot;</span>, label, <span class="st">&quot;$&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb298-11"><a href="applications.html#cb298-11" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the graph</span></span>
<span id="cb298-12"><a href="applications.html#cb298-12" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="fu">foreach</span> (<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(theta)) <span class="sc">%do%</span> {</span>
<span id="cb298-13"><a href="applications.html#cb298-13" aria-hidden="true" tabindex="-1"></a>  theta_i <span class="ot">&lt;-</span> theta[i]</span>
<span id="cb298-14"><a href="applications.html#cb298-14" aria-hidden="true" tabindex="-1"></a>  theta_i_list <span class="ot">&lt;-</span> theta_i <span class="sc">*</span> <span class="fu">seq</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb298-15"><a href="applications.html#cb298-15" aria-hidden="true" tabindex="-1"></a>  objective_i <span class="ot">&lt;-</span> </span>
<span id="cb298-16"><a href="applications.html#cb298-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">foreach</span> (<span class="at">j =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(theta_i_list),</span>
<span id="cb298-17"><a href="applications.html#cb298-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">.combine =</span> <span class="st">&quot;rbind&quot;</span>) <span class="sc">%do%</span> {</span>
<span id="cb298-18"><a href="applications.html#cb298-18" aria-hidden="true" tabindex="-1"></a>               theta_ij <span class="ot">&lt;-</span> theta_i_list[j]</span>
<span id="cb298-19"><a href="applications.html#cb298-19" aria-hidden="true" tabindex="-1"></a>               theta_j <span class="ot">&lt;-</span> theta</span>
<span id="cb298-20"><a href="applications.html#cb298-20" aria-hidden="true" tabindex="-1"></a>               theta_j[i] <span class="ot">&lt;-</span> theta_ij</span>
<span id="cb298-21"><a href="applications.html#cb298-21" aria-hidden="true" tabindex="-1"></a>               objective_ij <span class="ot">&lt;-</span> </span>
<span id="cb298-22"><a href="applications.html#cb298-22" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">compute_objective_sequential_entry</span>(Y, X, Z, EP_mc, NU_mc, theta_j)</span>
<span id="cb298-23"><a href="applications.html#cb298-23" aria-hidden="true" tabindex="-1"></a>               <span class="fu">return</span>(objective_ij)</span>
<span id="cb298-24"><a href="applications.html#cb298-24" aria-hidden="true" tabindex="-1"></a>             }</span>
<span id="cb298-25"><a href="applications.html#cb298-25" aria-hidden="true" tabindex="-1"></a>  df_graph <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> theta_i_list, <span class="at">y =</span> objective_i) </span>
<span id="cb298-26"><a href="applications.html#cb298-26" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_graph, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> </span>
<span id="cb298-27"><a href="applications.html#cb298-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb298-28"><a href="applications.html#cb298-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> theta_i, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb298-29"><a href="applications.html#cb298-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;objective function&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">TeX</span>(label[i]))</span>
<span id="cb298-30"><a href="applications.html#cb298-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(g)</span>
<span id="cb298-31"><a href="applications.html#cb298-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb298-32"><a href="applications.html#cb298-32" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(graph, <span class="at">file =</span> <span class="st">&quot;data/A6_graph_sequential.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="applications.html#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A6_graph_sequential.RData&quot;</span>)</span>
<span id="cb299-2"><a href="applications.html#cb299-2" aria-hidden="true" tabindex="-1"></a>graph</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-179-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-179-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-179-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[4]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-179-4.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[5]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-179-5.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[6]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-179-6.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Check the value of the objective function around the true parameter under the assumption of the simultaneous entry.</li>
</ol>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="applications.html#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simultaneous entry</span></span>
<span id="cb306-2"><a href="applications.html#cb306-2" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> theta_simultaneous <span class="ot">&lt;-</span></span>
<span id="cb306-3"><a href="applications.html#cb306-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(beta, alpha, delta)</span>
<span id="cb306-4"><a href="applications.html#cb306-4" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Y_simultaneous</span>
<span id="cb306-5"><a href="applications.html#cb306-5" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> compute_simultaneous_entry_across_markets</span>
<span id="cb306-6"><a href="applications.html#cb306-6" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">beta_&quot;</span>, <span class="dv">1</span><span class="sc">:</span>K, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>), </span>
<span id="cb306-7"><a href="applications.html#cb306-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">paste</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">alpha_&quot;</span>, <span class="dv">1</span><span class="sc">:</span>L, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb306-8"><a href="applications.html#cb306-8" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;</span><span class="sc">\\</span><span class="st">delta&quot;</span>)</span>
<span id="cb306-9"><a href="applications.html#cb306-9" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;$&quot;</span>, label, <span class="st">&quot;$&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb306-10"><a href="applications.html#cb306-10" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the graph</span></span>
<span id="cb306-11"><a href="applications.html#cb306-11" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="fu">foreach</span> (<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(theta)) <span class="sc">%do%</span> {</span>
<span id="cb306-12"><a href="applications.html#cb306-12" aria-hidden="true" tabindex="-1"></a>  theta_i <span class="ot">&lt;-</span> theta[i]</span>
<span id="cb306-13"><a href="applications.html#cb306-13" aria-hidden="true" tabindex="-1"></a>  theta_i_list <span class="ot">&lt;-</span> theta_i <span class="sc">*</span> <span class="fu">seq</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb306-14"><a href="applications.html#cb306-14" aria-hidden="true" tabindex="-1"></a>  objective_i <span class="ot">&lt;-</span> </span>
<span id="cb306-15"><a href="applications.html#cb306-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">foreach</span> (<span class="at">j =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(theta_i_list),</span>
<span id="cb306-16"><a href="applications.html#cb306-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">.combine =</span> <span class="st">&quot;rbind&quot;</span>) <span class="sc">%do%</span> {</span>
<span id="cb306-17"><a href="applications.html#cb306-17" aria-hidden="true" tabindex="-1"></a>               theta_ij <span class="ot">&lt;-</span> theta_i_list[j]</span>
<span id="cb306-18"><a href="applications.html#cb306-18" aria-hidden="true" tabindex="-1"></a>               theta_j <span class="ot">&lt;-</span> theta</span>
<span id="cb306-19"><a href="applications.html#cb306-19" aria-hidden="true" tabindex="-1"></a>               theta_j[i] <span class="ot">&lt;-</span> theta_ij</span>
<span id="cb306-20"><a href="applications.html#cb306-20" aria-hidden="true" tabindex="-1"></a>               objective_ij <span class="ot">&lt;-</span> </span>
<span id="cb306-21"><a href="applications.html#cb306-21" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">compute_objective_simultaneous_entry</span>(Y, X, Z, EP_mc, NU_mc, theta_j)</span>
<span id="cb306-22"><a href="applications.html#cb306-22" aria-hidden="true" tabindex="-1"></a>               <span class="fu">return</span>(objective_ij)</span>
<span id="cb306-23"><a href="applications.html#cb306-23" aria-hidden="true" tabindex="-1"></a>             }</span>
<span id="cb306-24"><a href="applications.html#cb306-24" aria-hidden="true" tabindex="-1"></a>  df_graph <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> theta_i_list, <span class="at">y =</span> objective_i) </span>
<span id="cb306-25"><a href="applications.html#cb306-25" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_graph, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> </span>
<span id="cb306-26"><a href="applications.html#cb306-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb306-27"><a href="applications.html#cb306-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> theta_i, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb306-28"><a href="applications.html#cb306-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;objective function&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">TeX</span>(label[i]))</span>
<span id="cb306-29"><a href="applications.html#cb306-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(g)</span>
<span id="cb306-30"><a href="applications.html#cb306-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb306-31"><a href="applications.html#cb306-31" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(graph, <span class="at">file =</span> <span class="st">&quot;data/A6_graph_simultaneous.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="applications.html#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A6_graph_simultaneous.RData&quot;</span>)</span>
<span id="cb307-2"><a href="applications.html#cb307-2" aria-hidden="true" tabindex="-1"></a>graph</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-181-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-181-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-181-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[4]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-181-4.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[5]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-181-5.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>Estimate the parameters under the assumption of the sequential entry.</li>
</ol>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="applications.html#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sequential entry</span></span>
<span id="cb313-2"><a href="applications.html#cb313-2" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> theta_sequential <span class="ot">&lt;-</span></span>
<span id="cb313-3"><a href="applications.html#cb313-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(beta, alpha, delta, rho)</span></code></pre></div>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="applications.html#cb314-1" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Y_sequential</span>
<span id="cb314-2"><a href="applications.html#cb314-2" aria-hidden="true" tabindex="-1"></a>result_sequential <span class="ot">&lt;-</span></span>
<span id="cb314-3"><a href="applications.html#cb314-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">optim</span>(<span class="at">par =</span> theta,</span>
<span id="cb314-4"><a href="applications.html#cb314-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">fn =</span> compute_objective_sequential_entry,</span>
<span id="cb314-5"><a href="applications.html#cb314-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">method =</span> <span class="st">&quot;Nelder-Mead&quot;</span>,</span>
<span id="cb314-6"><a href="applications.html#cb314-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">Y =</span> Y,</span>
<span id="cb314-7"><a href="applications.html#cb314-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">X =</span> X,</span>
<span id="cb314-8"><a href="applications.html#cb314-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">Z =</span> Z,</span>
<span id="cb314-9"><a href="applications.html#cb314-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">EP_mc =</span> EP_mc,</span>
<span id="cb314-10"><a href="applications.html#cb314-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">NU_mc =</span> NU_mc)</span>
<span id="cb314-11"><a href="applications.html#cb314-11" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(result_sequential, <span class="at">file =</span> <span class="st">&quot;data/A6_estimate_sequential.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="applications.html#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A6_estimate_sequential.RData&quot;</span>)</span>
<span id="cb315-2"><a href="applications.html#cb315-2" aria-hidden="true" tabindex="-1"></a>result_sequential</span></code></pre></div>
<pre><code>## $par
## [1] 0.7761887 0.2204343 1.0747480 2.0150864 0.9116741 0.2875538
## 
## $value
## [1] 0.2638
## 
## $counts
## function gradient 
##      233       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="applications.html#cb317-1" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span></span>
<span id="cb317-2"><a href="applications.html#cb317-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb317-3"><a href="applications.html#cb317-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">actual =</span> theta,</span>
<span id="cb317-4"><a href="applications.html#cb317-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate =</span> result_sequential<span class="sc">$</span>par</span>
<span id="cb317-5"><a href="applications.html#cb317-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb317-6"><a href="applications.html#cb317-6" aria-hidden="true" tabindex="-1"></a>comparison</span></code></pre></div>
<pre><code>##      actual  estimate
## 1 0.6264538 0.7761887
## 2 0.1836433 0.2204343
## 3 0.8356286 1.0747480
## 4 1.5952808 2.0150864
## 5 1.0000000 0.9116741
## 6 0.3295078 0.2875538</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Estimate the parameters under the assumption of the simultaneous entry. Set the lower bound for <span class="math inline">\(\delta\)</span> at 0.</li>
</ol>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="applications.html#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simultaneous entry</span></span>
<span id="cb319-2"><a href="applications.html#cb319-2" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> theta_simultaneous <span class="ot">&lt;-</span></span>
<span id="cb319-3"><a href="applications.html#cb319-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(beta, alpha, delta)</span></code></pre></div>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="applications.html#cb320-1" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> Y_simultaneous</span>
<span id="cb320-2"><a href="applications.html#cb320-2" aria-hidden="true" tabindex="-1"></a>result_simultaneous <span class="ot">&lt;-</span></span>
<span id="cb320-3"><a href="applications.html#cb320-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">optim</span>(<span class="at">par =</span> theta,</span>
<span id="cb320-4"><a href="applications.html#cb320-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">fn =</span> compute_objective_simultaneous_entry,</span>
<span id="cb320-5"><a href="applications.html#cb320-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">method =</span> <span class="st">&quot;Nelder-Mead&quot;</span>,</span>
<span id="cb320-6"><a href="applications.html#cb320-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">Y =</span> Y,</span>
<span id="cb320-7"><a href="applications.html#cb320-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">X =</span> X,</span>
<span id="cb320-8"><a href="applications.html#cb320-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">Z =</span> Z,</span>
<span id="cb320-9"><a href="applications.html#cb320-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">EP_mc =</span> EP_mc,</span>
<span id="cb320-10"><a href="applications.html#cb320-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">NU_mc =</span> NU_mc)</span>
<span id="cb320-11"><a href="applications.html#cb320-11" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(result_simultaneous, <span class="at">file =</span> <span class="st">&quot;data/A6_estimate_simultaneous.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="applications.html#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A6_estimate_simultaneous.RData&quot;</span>)</span>
<span id="cb321-2"><a href="applications.html#cb321-2" aria-hidden="true" tabindex="-1"></a>result_simultaneous</span></code></pre></div>
<pre><code>## $par
## [1] 0.7347919 0.2151107 0.9427083 1.7495325 0.9448480
## 
## $value
## [1] 0.2158
## 
## $counts
## function gradient 
##      151       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="applications.html#cb323-1" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span></span>
<span id="cb323-2"><a href="applications.html#cb323-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb323-3"><a href="applications.html#cb323-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">actual =</span> theta,</span>
<span id="cb323-4"><a href="applications.html#cb323-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate =</span> result_simultaneous<span class="sc">$</span>par</span>
<span id="cb323-5"><a href="applications.html#cb323-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb323-6"><a href="applications.html#cb323-6" aria-hidden="true" tabindex="-1"></a>comparison</span></code></pre></div>
<pre><code>##      actual  estimate
## 1 0.6264538 0.7347919
## 2 0.1836433 0.2151107
## 3 0.8356286 0.9427083
## 4 1.5952808 1.7495325
## 5 1.0000000 0.9448480</code></pre>
</div>
<div id="conduct-counterfactual-simulations" class="section level2 hasAnchor" number="10.16">
<h2><span class="header-section-number">10.16</span> Conduct counterfactual simulations<a href="applications.html#conduct-counterfactual-simulations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>Fix the first draw of the Monte Carlo shocks. Suppose that the competitive effect becomes mild, i.e.<span class="math inline">\(\delta\)</span> is changed to 0.5. Under these shocks, compute the equilibrium number of entrants across markets and plot the histogram with the estimated and counterfactual parameters. Conduct this analysis under the assumptions of sequential and simultaneous entry.</li>
</ol>
<pre><code>## `summarise()` has grouped output by &#39;parameters&#39;. You can override using the
## `.groups` argument.</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-188-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## `summarise()` has grouped output by &#39;parameters&#39;. You can override using the
## `.groups` argument.</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-189-1.png" width="672" style="display: block; margin: auto;" /></p>

</div>
<div id="simulate-data-6" class="section level2 hasAnchor" number="10.17">
<h2><span class="header-section-number">10.17</span> Simulate data<a href="applications.html#simulate-data-6" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Suppose that there is a firm and it makes decisions for <span class="math inline">\(t = 1, \cdots, \infty\)</span>. We solve the model under the infinite-horizon assumption, but generate data only for <span class="math inline">\(t = 1, \cdots, T\)</span>. There are <span class="math inline">\(L = 5\)</span> state <span class="math inline">\(s \in \{1, 2, 3, 4, 5\}\)</span> states for the player. The firm can choose <span class="math inline">\(K + 1 = 2\)</span> actions <span class="math inline">\(a \in \{0, 1\}\)</span>.</p>
<p>The mean period payoff to the firm is:
<span class="math display">\[
\pi(a, s) :=  \alpha \ln s - \beta a,
\]</span>
where <span class="math inline">\(\alpha, \beta &gt; 0\)</span>. The period payoff is:
<span class="math display">\[
\pi(a, s) + \epsilon(a),
\]</span>
and <span class="math inline">\(\epsilon(a)\)</span> is an i.i.d. type-I extreme random variable that is independent of all the other variables.</p>
<p>At the beginning of each period, the state <span class="math inline">\(s\)</span> and choice-specific shocks <span class="math inline">\(\epsilon(a), a = 0, 1\)</span> are realized, and the the firm chooses her action. Then, the game moves to the next period.</p>
<p>Suppose that <span class="math inline">\(s &gt; 1\)</span> and <span class="math inline">\(s &lt; L\)</span>. If <span class="math inline">\(a = 0\)</span>, the state stays at the same state with probability <span class="math inline">\(1 - \kappa\)</span> and moves down by 1 with probability <span class="math inline">\(\kappa\)</span>. If <span class="math inline">\(a = 1\)</span>, the state moves up by 1 with probability <span class="math inline">\(\gamma\)</span>, moves down by 1 with probability <span class="math inline">\(\kappa\)</span>, and stays at the same with probability <span class="math inline">\(1 - \kappa - \gamma\)</span>.</p>
<p>Suppose that <span class="math inline">\(s = 1\)</span>. If <span class="math inline">\(a = 0\)</span>, the state stays at the same state with probability 1. If <span class="math inline">\(a = 1\)</span>, the state moves up by 1 with probability <span class="math inline">\(\gamma\)</span> and stays at the same with probability <span class="math inline">\(1 - \gamma\)</span>.</p>
<p>Suppose that <span class="math inline">\(s = L\)</span>. If <span class="math inline">\(a = 0\)</span>, the state stays at the same state with probability <span class="math inline">\(1 - \kappa\)</span> and moves down by 1 with probability <span class="math inline">\(\kappa\)</span>. If <span class="math inline">\(a = 1\)</span>, the state moves down by 1 with probability <span class="math inline">\(\kappa\)</span>, and stays at the same with probability <span class="math inline">\(1 - \kappa\)</span>.</p>
<p>The mean period profit is summarized in <span class="math inline">\(\Pi\)</span> as:
<span class="math display">\[
\Pi :=
\begin{pmatrix}
\pi(0, 1)\\
\vdots\\
\pi(K, 1)\\
\vdots \\
\pi(0, L)\\
\vdots\\
\pi(K, L)\\
\end{pmatrix}
\]</span></p>
<p>The transition law is summarized in <span class="math inline">\(G\)</span> as:</p>
<p><span class="math display">\[
g(a, s, s&#39;) := \mathbb{P}\{s_{t + 1} = s&#39;|s_t = s, a_t = a\},
\]</span></p>
<p><span class="math display">\[
G :=
\begin{pmatrix}
g(0, 1, 1) &amp; \cdots &amp; g(0, 1, L)\\
\vdots &amp; &amp; \vdots \\
g(K, 1, 1) &amp; \cdots &amp; g(K, 1, L)\\
&amp; \vdots &amp; \\
g(0, L, 1) &amp; \cdots &amp; g(0, L, L)\\
\vdots &amp; &amp; \vdots \\
g(K, L, 1) &amp; \cdots &amp; g(K, L, L)\\
\end{pmatrix}.
\]</span>
The discount factor is denoted by <span class="math inline">\(\delta\)</span>. We simulate data for <span class="math inline">\(N\)</span> firms for <span class="math inline">\(T\)</span> periods each.</p>
<ol style="list-style-type: decimal">
<li>Set constants and parameters as follows:</li>
</ol>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="applications.html#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb327-2"><a href="applications.html#cb327-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb327-3"><a href="applications.html#cb327-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set constants </span></span>
<span id="cb327-4"><a href="applications.html#cb327-4" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb327-5"><a href="applications.html#cb327-5" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb327-6"><a href="applications.html#cb327-6" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb327-7"><a href="applications.html#cb327-7" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb327-8"><a href="applications.html#cb327-8" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="fl">1e-10</span></span>
<span id="cb327-9"><a href="applications.html#cb327-9" aria-hidden="true" tabindex="-1"></a><span class="co"># set parameters</span></span>
<span id="cb327-10"><a href="applications.html#cb327-10" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb327-11"><a href="applications.html#cb327-11" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb327-12"><a href="applications.html#cb327-12" aria-hidden="true" tabindex="-1"></a>kappa <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb327-13"><a href="applications.html#cb327-13" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb327-14"><a href="applications.html#cb327-14" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="fl">0.95</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Write function <code>compute_pi(alpha, beta, L, K)</code> that computes <span class="math inline">\(\Pi\)</span> given parameters and compute the true <span class="math inline">\(\Pi\)</span> under the true parameters. Dont use methods in <code>dplyr</code> and deal with matrix operations.</li>
</ol>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="applications.html#cb328-1" aria-hidden="true" tabindex="-1"></a>PI <span class="ot">&lt;-</span> <span class="fu">compute_PI</span>(alpha, beta, L, K); PI</span></code></pre></div>
<pre><code>##             [,1]
## k0_l1  0.0000000
## k1_l1 -3.0000000
## k0_l2  0.3465736
## k1_l2 -2.6534264
## k0_l3  0.5493061
## k1_l3 -2.4506939
## k0_l4  0.6931472
## k1_l4 -2.3068528
## k0_l5  0.8047190
## k1_l5 -2.1952810</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Write function <code>compute_G(kappa, gamma, L, K)</code> that computes <span class="math inline">\(G\)</span> given parameters and compute the true <span class="math inline">\(G\)</span> under the true parameters. Dont use methods in <code>dplyr</code> and deal with matrix operations.</li>
</ol>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="applications.html#cb330-1" aria-hidden="true" tabindex="-1"></a>G <span class="ot">&lt;-</span> <span class="fu">compute_G</span>(kappa, gamma, L, K); G</span></code></pre></div>
<pre><code>##        l1  l2  l3  l4  l5
## k0_l1 1.0 0.0 0.0 0.0 0.0
## k1_l1 0.4 0.6 0.0 0.0 0.0
## k0_l2 0.1 0.9 0.0 0.0 0.0
## k1_l2 0.1 0.3 0.6 0.0 0.0
## k0_l3 0.0 0.1 0.9 0.0 0.0
## k1_l3 0.0 0.1 0.3 0.6 0.0
## k0_l4 0.0 0.0 0.1 0.9 0.0
## k1_l4 0.0 0.0 0.1 0.3 0.6
## k0_l5 0.0 0.0 0.0 0.1 0.9
## k1_l5 0.0 0.0 0.0 0.1 0.9</code></pre>
<p>The exante-value function is written as a function of a conditional choice probability as follows:
<span class="math display">\[
\varphi^{(\theta_1, \theta_2)}(p) := [I - \delta \Sigma(p) G]^{-1}\Sigma(p)[\Pi + E(p)],
\]</span>
where <span class="math inline">\(\theta_1 = (\alpha, \beta)\)</span> and <span class="math inline">\(\theta_2 = (\kappa, \gamma)\)</span> and:
<span class="math display">\[
\Sigma(p) =
\begin{pmatrix}
p(1)&#39; &amp; &amp; \\
&amp; \ddots &amp; \\
&amp; &amp; p(L)&#39;
\end{pmatrix}
\]</span>
and:
<span class="math display">\[
E(p) =
\gamma - \ln p.
\]</span></p>
<ol start="3" style="list-style-type: decimal">
<li>Write a function <code>compute_exante_value(p, PI, G, L, K, delta)</code> that returns the exante value function given a conditional choice probability. Dont use methods in <code>dplyr</code> and deal with matrix operations. When a choice probability is zero at some element, the corresponding element of <span class="math inline">\(E(p)\)</span> can be set at zero, because anyway we multiply the zero probability to the element and the corresponding element in <span class="math inline">\(E(p)\)</span> does not affect the result.</li>
</ol>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="applications.html#cb332-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="fl">0.5</span>, L <span class="sc">*</span> (K <span class="sc">+</span> <span class="dv">1</span>)), <span class="at">ncol =</span> <span class="dv">1</span>); p</span></code></pre></div>
<pre><code>##       [,1]
##  [1,]  0.5
##  [2,]  0.5
##  [3,]  0.5
##  [4,]  0.5
##  [5,]  0.5
##  [6,]  0.5
##  [7,]  0.5
##  [8,]  0.5
##  [9,]  0.5
## [10,]  0.5</code></pre>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="applications.html#cb334-1" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">compute_exante_value</span>(p, PI, G, L, K, delta); V</span></code></pre></div>
<pre><code>##         [,1]
## l1  5.777876
## l2  7.597282
## l3  9.126304
## l4 10.115439
## l5 10.593438</code></pre>
<p>The optimal conditional choice probability is written as a function of an exante value function as follows:
<span class="math display">\[
\Lambda^{(\theta_1, \theta_2)}(V)(a, s) := \frac{\exp[\pi(a, s) + \delta \sum_{s&#39;}V(s&#39;)g(a, s, s&#39;)]}{\sum_{a&#39;}\exp[\pi(a&#39;, s) + \delta \sum_{s&#39;}V(s&#39;)g(a&#39;, s, s&#39;)]},
\]</span>
where <span class="math inline">\(V\)</span> is an exante value function.</p>
<ol start="4" style="list-style-type: decimal">
<li>Write a function <code>compute_ccp(V, PI, G, L, K, delta)</code> that returns the optimal conditional choice probability given an exante value function. Dont use methods in <code>dplyr</code> and deal with matrix operations. To do so, write a function <code>compute_choice_value(V, PI, G, delta)</code> that returns the choice-specific value function. Use this for debugging by checking if the results are intuitive.</li>
</ol>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="applications.html#cb336-1" aria-hidden="true" tabindex="-1"></a>value <span class="ot">&lt;-</span> <span class="fu">compute_choice_value</span>(V, PI, G, delta); value</span></code></pre></div>
<pre><code>##            [,1]
## k0_l1  5.488982
## k1_l1  3.526044
## k0_l2  7.391148
## k1_l2  5.262691
## k0_l3  9.074038
## k1_l3  6.637845
## k0_l4 10.208846
## k1_l4  7.481306
## k0_l5 10.823075
## k1_l5  7.823075</code></pre>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="applications.html#cb338-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">compute_ccp</span>(V, PI, G, L, K, delta); p</span></code></pre></div>
<pre><code>##             [,1]
## k0_l1 0.87685057
## k1_l1 0.12314943
## k0_l2 0.89363847
## k1_l2 0.10636153
## k0_l3 0.91954591
## k1_l3 0.08045409
## k0_l4 0.93863232
## k1_l4 0.06136768
## k0_l5 0.95257413
## k1_l5 0.04742587</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Write a function that find the equilibrium conditional choice probability and ex-ante value function by iterating the update of an exante value function and an optimal conditional choice probability. The iteration should stop when <span class="math inline">\(\max_s|V^{(r + 1)}(s) - V^{(r)}(s)| &lt; \lambda\)</span> with <span class="math inline">\(\lambda = 10^{-10}\)</span>.</li>
</ol>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="applications.html#cb340-1" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">solve_dynamic_decision</span>(PI, G, L, K, delta, lambda); output</span></code></pre></div>
<pre><code>## $p
##             [,1]
## k0_l1 0.82218962
## k1_l1 0.17781038
## k0_l2 0.80024354
## k1_l2 0.19975646
## k0_l3 0.83074516
## k1_l3 0.16925484
## k0_l4 0.87691534
## k1_l4 0.12308466
## k0_l5 0.95257413
## k1_l5 0.04742587
## 
## $V
##        [,1]
## l1 15.46000
## l2 18.03675
## l3 20.86514
## l4 23.33721
## l5 25.15557</code></pre>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="applications.html#cb342-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> output<span class="sc">$</span>p</span>
<span id="cb342-2"><a href="applications.html#cb342-2" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> output<span class="sc">$</span>V</span>
<span id="cb342-3"><a href="applications.html#cb342-3" aria-hidden="true" tabindex="-1"></a>value <span class="ot">&lt;-</span> <span class="fu">compute_choice_value</span>(V, PI, G, delta); value</span></code></pre></div>
<pre><code>##           [,1]
## k0_l1 14.68700
## k1_l1 13.15574
## k0_l2 17.23669
## k1_l2 15.84887
## k0_l3 20.10249
## k1_l3 18.51157
## k0_l4 22.62865
## k1_l4 20.66511
## k0_l5 24.52976
## k1_l5 21.52976</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Write a function <code>simulate_dynamic_decision(p, s, PI, G, L, K, T, delta, seed)</code> that simulate the data for a single firm starting from an initial state for <span class="math inline">\(T\)</span> periods. The function should accept a value of seed and set the seed at the beginning of the procedure inside the function, because the process is stochastic.</li>
</ol>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="applications.html#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set initial value</span></span>
<span id="cb344-2"><a href="applications.html#cb344-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb344-3"><a href="applications.html#cb344-3" aria-hidden="true" tabindex="-1"></a><span class="co"># draw simulation for a firm</span></span>
<span id="cb344-4"><a href="applications.html#cb344-4" aria-hidden="true" tabindex="-1"></a>seed <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb344-5"><a href="applications.html#cb344-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">simulate_dynamic_decision</span>(p, s, G, L, K, T, delta, seed); df</span></code></pre></div>
<pre><code>## # A tibble: 100  3
##        t     s     a
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1     1     0
##  2     2     1     0
##  3     3     1     0
##  4     4     1     1
##  5     5     2     1
##  6     6     1     0
##  7     7     1     0
##  8     8     1     0
##  9     9     1     0
## 10    10     1     0
## #  with 90 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Write a function <code>simulate_dynamic_decision_across_firms(p, s, PI, G, L, K, T, N, delta)</code> that returns simulation data for <span class="math inline">\(N\)</span> firm. For firm <span class="math inline">\(i\)</span>, set the seed at <span class="math inline">\(i\)</span></li>
</ol>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="applications.html#cb346-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">simulate_dynamic_decision_across_firms</span>(p, s,  G, L, K, T, N, delta)</span>
<span id="cb346-2"><a href="applications.html#cb346-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(df, <span class="at">file =</span> <span class="st">&quot;data/A7_df.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="applications.html#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A7_df.RData&quot;</span>)</span>
<span id="cb347-2"><a href="applications.html#cb347-2" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 100,000  4
##        i     t     s     a
##    &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1     1     1     0
##  2     1     2     1     0
##  3     1     3     1     0
##  4     1     4     1     1
##  5     1     5     2     1
##  6     1     6     1     0
##  7     1     7     1     0
##  8     1     8     1     0
##  9     1     9     1     0
## 10     1    10     1     0
## #  with 99,990 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<ol start="8" style="list-style-type: decimal">
<li>Write a function <code>estimate_ccp(df)</code> that returns a non-parametric estimate of the conditional choice probability in the data. Compare the estimated conditional choice probability and the true conditional choice probability by a bar plot.</li>
</ol>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="applications.html#cb349-1" aria-hidden="true" tabindex="-1"></a>p_est <span class="ot">&lt;-</span> <span class="fu">estimate_ccp</span>(df)</span>
<span id="cb349-2"><a href="applications.html#cb349-2" aria-hidden="true" tabindex="-1"></a>check_ccp <span class="ot">&lt;-</span> <span class="fu">cbind</span>(p, p_est)</span>
<span id="cb349-3"><a href="applications.html#cb349-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(check_ccp) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;true&quot;</span>, <span class="st">&quot;estimate&quot;</span>)</span>
<span id="cb349-4"><a href="applications.html#cb349-4" aria-hidden="true" tabindex="-1"></a>check_ccp <span class="ot">&lt;-</span> check_ccp <span class="sc">%&gt;%</span></span>
<span id="cb349-5"><a href="applications.html#cb349-5" aria-hidden="true" tabindex="-1"></a>  reshape2<span class="sc">::</span><span class="fu">melt</span>()</span>
<span id="cb349-6"><a href="applications.html#cb349-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> check_ccp, <span class="fu">aes</span>(<span class="at">x =</span> Var1, <span class="at">y =</span> value, </span>
<span id="cb349-7"><a href="applications.html#cb349-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">fill =</span> Var2)) <span class="sc">+</span></span>
<span id="cb349-8"><a href="applications.html#cb349-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb349-9"><a href="applications.html#cb349-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Value&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;action/state&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;probability&quot;</span>)</span></code></pre></div>
<p><img src="lecture_files/figure-html/unnamed-chunk-200-1.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="9" style="list-style-type: decimal">
<li>Write a function <code>estimate_G(df)</code> that returns a non-parametric estiamte of the transition matrix in the data. Compare the estimated transition matrix and the true transition matrix by a bar plot.</li>
</ol>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="applications.html#cb350-1" aria-hidden="true" tabindex="-1"></a>G_est <span class="ot">&lt;-</span> <span class="fu">estimate_G</span>(df); G_est</span></code></pre></div>
<pre><code>##              l1         l2        l3         l4        l5
## k0_l1 1.0000000 0.00000000 0.0000000 0.00000000 0.0000000
## k1_l1 0.3930818 0.60691824 0.0000000 0.00000000 0.0000000
## k0_l2 0.1012162 0.89878384 0.0000000 0.00000000 0.0000000
## k1_l2 0.1031410 0.31276454 0.5840945 0.00000000 0.0000000
## k0_l3 0.0000000 0.09660837 0.9033916 0.00000000 0.0000000
## k1_l3 0.0000000 0.09974569 0.3071489 0.59310540 0.0000000
## k0_l4 0.0000000 0.00000000 0.1012564 0.89874358 0.0000000
## k1_l4 0.0000000 0.00000000 0.1039339 0.29966003 0.5964060
## k0_l5 0.0000000 0.00000000 0.0000000 0.09891400 0.9010860
## k1_l5 0.0000000 0.00000000 0.0000000 0.09751037 0.9024896</code></pre>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="applications.html#cb352-1" aria-hidden="true" tabindex="-1"></a>check_G <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">&quot;true&quot;</span>, reshape2<span class="sc">::</span><span class="fu">melt</span>(G))</span>
<span id="cb352-2"><a href="applications.html#cb352-2" aria-hidden="true" tabindex="-1"></a>check_G_est <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">&quot;estimate&quot;</span>, reshape2<span class="sc">::</span><span class="fu">melt</span>(G_est))</span>
<span id="cb352-3"><a href="applications.html#cb352-3" aria-hidden="true" tabindex="-1"></a>check_G <span class="ot">&lt;-</span> <span class="fu">rbind</span>(check_G, check_G_est)</span>
<span id="cb352-4"><a href="applications.html#cb352-4" aria-hidden="true" tabindex="-1"></a>check_G<span class="sc">$</span>variable <span class="ot">=</span> <span class="fu">paste</span>(check_G<span class="sc">$</span>Var1, check_G<span class="sc">$</span>Var2, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb352-5"><a href="applications.html#cb352-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> check_G, <span class="fu">aes</span>(<span class="at">x =</span> variable, <span class="at">y =</span> value,</span>
<span id="cb352-6"><a href="applications.html#cb352-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fill =</span> type)) <span class="sc">+</span></span>
<span id="cb352-7"><a href="applications.html#cb352-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb352-8"><a href="applications.html#cb352-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Value&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;action/state/state&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;probability&quot;</span>) <span class="sc">+</span></span>
<span id="cb352-9"><a href="applications.html#cb352-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="lecture_files/figure-html/unnamed-chunk-201-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="estimate-parameters" class="section level2 hasAnchor" number="10.18">
<h2><span class="header-section-number">10.18</span> Estimate parameters<a href="applications.html#estimate-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>Vectorize the parameters as follows:</li>
</ol>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="applications.html#cb353-1" aria-hidden="true" tabindex="-1"></a>theta_1 <span class="ot">&lt;-</span> <span class="fu">c</span>(alpha, beta)</span>
<span id="cb353-2"><a href="applications.html#cb353-2" aria-hidden="true" tabindex="-1"></a>theta_2 <span class="ot">&lt;-</span> <span class="fu">c</span>(kappa, gamma)</span>
<span id="cb353-3"><a href="applications.html#cb353-3" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">c</span>(theta_1, theta_2)</span></code></pre></div>
<p>First, we estimate the parameters by a nested fixed-point algorithm. The loglikelihood for <span class="math inline">\(\{a_{it}, s_{it}\}_{i = 1, \cdots, N, t = 1, \cdots, T}\)</span> is:
<span class="math display">\[
\frac{1}{NT} \sum_{i = 1}^N \sum_{t = 1}^T[\log\mathbb{P}\{a_{it}|s_{it}\} + \log \mathbb{P}\{s_{i, t + 1}|a_{it}, s_{it}\}],
\]</span>
with <span class="math inline">\(\mathbb{P}\{s_{i, T + 1}|a_{iT}, s_{iT}\} = 1\)</span> for all <span class="math inline">\(i\)</span> as <span class="math inline">\(s_{i, T + 1}\)</span> is not observed.</p>
<ol start="2" style="list-style-type: decimal">
<li>Write a function <code>compute_loglikelihood_NFP(theta, df, delta, L, K)</code> that compute the loglikelihood.</li>
</ol>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="applications.html#cb354-1" aria-hidden="true" tabindex="-1"></a>loglikelihood <span class="ot">&lt;-</span> <span class="fu">compute_loglikelihood_NFP</span>(theta, df, delta, L, K); loglikelihood</span></code></pre></div>
<pre><code>## [1] -0.7474961</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Check the value of the objective function around the true parameter.</li>
</ol>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="applications.html#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="co"># label</span></span>
<span id="cb356-2"><a href="applications.html#cb356-2" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">alpha&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">beta&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">kappa&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">gamma&quot;</span>)</span>
<span id="cb356-3"><a href="applications.html#cb356-3" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;$&quot;</span>, label, <span class="st">&quot;$&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb356-4"><a href="applications.html#cb356-4" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the graph</span></span>
<span id="cb356-5"><a href="applications.html#cb356-5" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="fu">foreach</span> (<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(theta)) <span class="sc">%do%</span> {</span>
<span id="cb356-6"><a href="applications.html#cb356-6" aria-hidden="true" tabindex="-1"></a>  theta_i <span class="ot">&lt;-</span> theta[i]</span>
<span id="cb356-7"><a href="applications.html#cb356-7" aria-hidden="true" tabindex="-1"></a>  theta_i_list <span class="ot">&lt;-</span> theta_i <span class="sc">*</span> <span class="fu">seq</span>(<span class="fl">0.8</span>, <span class="fl">1.2</span>, <span class="at">by =</span> <span class="fl">0.05</span>)</span>
<span id="cb356-8"><a href="applications.html#cb356-8" aria-hidden="true" tabindex="-1"></a>  objective_i <span class="ot">&lt;-</span> </span>
<span id="cb356-9"><a href="applications.html#cb356-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">foreach</span> (<span class="at">j =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(theta_i_list),</span>
<span id="cb356-10"><a href="applications.html#cb356-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">.combine =</span> <span class="st">&quot;rbind&quot;</span>) <span class="sc">%do%</span> {</span>
<span id="cb356-11"><a href="applications.html#cb356-11" aria-hidden="true" tabindex="-1"></a>               theta_ij <span class="ot">&lt;-</span> theta_i_list[j]</span>
<span id="cb356-12"><a href="applications.html#cb356-12" aria-hidden="true" tabindex="-1"></a>               theta_j <span class="ot">&lt;-</span> theta</span>
<span id="cb356-13"><a href="applications.html#cb356-13" aria-hidden="true" tabindex="-1"></a>               theta_j[i] <span class="ot">&lt;-</span> theta_ij</span>
<span id="cb356-14"><a href="applications.html#cb356-14" aria-hidden="true" tabindex="-1"></a>               objective_ij <span class="ot">&lt;-</span> </span>
<span id="cb356-15"><a href="applications.html#cb356-15" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">compute_loglikelihood_NFP</span>(</span>
<span id="cb356-16"><a href="applications.html#cb356-16" aria-hidden="true" tabindex="-1"></a>                   theta_j, df, delta, L, K); loglikelihood</span>
<span id="cb356-17"><a href="applications.html#cb356-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-18"><a href="applications.html#cb356-18" aria-hidden="true" tabindex="-1"></a>               <span class="fu">return</span>(objective_ij)</span>
<span id="cb356-19"><a href="applications.html#cb356-19" aria-hidden="true" tabindex="-1"></a>             }</span>
<span id="cb356-20"><a href="applications.html#cb356-20" aria-hidden="true" tabindex="-1"></a>  df_graph <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> theta_i_list, <span class="at">y =</span> objective_i) </span>
<span id="cb356-21"><a href="applications.html#cb356-21" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_graph, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> </span>
<span id="cb356-22"><a href="applications.html#cb356-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb356-23"><a href="applications.html#cb356-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> theta_i, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb356-24"><a href="applications.html#cb356-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;objective function&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">TeX</span>(label[i]))</span>
<span id="cb356-25"><a href="applications.html#cb356-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(g)</span>
<span id="cb356-26"><a href="applications.html#cb356-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb356-27"><a href="applications.html#cb356-27" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(graph, <span class="at">file =</span> <span class="st">&quot;data/A7_NFP_graph.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="applications.html#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A7_NFP_graph.RData&quot;</span>)</span>
<span id="cb357-2"><a href="applications.html#cb357-2" aria-hidden="true" tabindex="-1"></a>graph</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-205-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-205-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-205-3.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[4]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-205-4.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Estiamte the parameters by maximizing the loglikelihood. To keep the model to be well-defined, impose an ad hoc lower and upper bounds such that <span class="math inline">\(\alpha \in [0, 1], \beta \in [0, 5], \kappa \in [0, 0.2], \gamma \in [0, 0.7]\)</span>.</li>
</ol>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="applications.html#cb362-1" aria-hidden="true" tabindex="-1"></a>lower <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(theta))</span>
<span id="cb362-2"><a href="applications.html#cb362-2" aria-hidden="true" tabindex="-1"></a>upper <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="fl">0.2</span>, <span class="fl">0.7</span>)</span>
<span id="cb362-3"><a href="applications.html#cb362-3" aria-hidden="true" tabindex="-1"></a>NFP_result <span class="ot">&lt;-</span></span>
<span id="cb362-4"><a href="applications.html#cb362-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">optim</span>(<span class="at">par =</span> theta,</span>
<span id="cb362-5"><a href="applications.html#cb362-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">fn =</span> compute_loglikelihood_NFP,</span>
<span id="cb362-6"><a href="applications.html#cb362-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">method =</span> <span class="st">&quot;L-BFGS-B&quot;</span>,</span>
<span id="cb362-7"><a href="applications.html#cb362-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> lower,</span>
<span id="cb362-8"><a href="applications.html#cb362-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> upper,</span>
<span id="cb362-9"><a href="applications.html#cb362-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">control =</span> <span class="fu">list</span>(<span class="at">fnscale =</span> <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb362-10"><a href="applications.html#cb362-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">df =</span> df, </span>
<span id="cb362-11"><a href="applications.html#cb362-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">delta =</span> delta,</span>
<span id="cb362-12"><a href="applications.html#cb362-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">L =</span> L,</span>
<span id="cb362-13"><a href="applications.html#cb362-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">K =</span> K)</span>
<span id="cb362-14"><a href="applications.html#cb362-14" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(NFP_result, <span class="at">file =</span> <span class="st">&quot;data/A7_NFP_result.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="applications.html#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A7_NFP_result.RData&quot;</span>)</span>
<span id="cb363-2"><a href="applications.html#cb363-2" aria-hidden="true" tabindex="-1"></a>NFP_result</span></code></pre></div>
<pre><code>## $par
## [1] 0.5273235 3.0652558 0.1000122 0.5955431
## 
## $value
## [1] -0.7474743
## 
## $counts
## function gradient 
##       21       21 
## 
## $convergence
## [1] 0
## 
## $message
## [1] &quot;CONVERGENCE: REL_REDUCTION_OF_F &lt;= FACTR*EPSMCH&quot;</code></pre>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="applications.html#cb365-1" aria-hidden="true" tabindex="-1"></a>compare <span class="ot">&lt;-</span></span>
<span id="cb365-2"><a href="applications.html#cb365-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb365-3"><a href="applications.html#cb365-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">true =</span> theta,</span>
<span id="cb365-4"><a href="applications.html#cb365-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate =</span> NFP_result<span class="sc">$</span>par</span>
<span id="cb365-5"><a href="applications.html#cb365-5" aria-hidden="true" tabindex="-1"></a>  ); compare</span></code></pre></div>
<pre><code>##   true  estimate
## 1  0.5 0.5273235
## 2  3.0 3.0652558
## 3  0.1 0.1000122
## 4  0.6 0.5955431</code></pre>
<p>Next, we estimate the parameters by CCP approach.</p>
<ol start="5" style="list-style-type: decimal">
<li>Write a function <code>estimate_theta_2(df)</code> that returns the estimates of <span class="math inline">\(\kappa\)</span> and <span class="math inline">\(\gamma\)</span> directly from data by counting relevant events.</li>
</ol>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="applications.html#cb367-1" aria-hidden="true" tabindex="-1"></a>theta_2_est <span class="ot">&lt;-</span> <span class="fu">estimate_theta_2</span>(df); theta_2_est</span></code></pre></div>
<pre><code>## [1] 0.09988488 0.59551895</code></pre>
<p>The objective function of the minimum distance estimator based on the conditional choice probability approach is:
<span class="math display">\[
\frac{1}{KL}\sum_{s = 1}^L \sum_{a = 1}^K\{\hat{p}(a, s) - p^{(\theta_1, \theta_2)}(a, s)\}^2,
\]</span>
where <span class="math inline">\(\hat{p}\)</span> is the non-parametric estimate of the conditional choice probability and <span class="math inline">\(p^{(\theta_1, \theta_2)}\)</span> is the optimal conditional choice probability under parameters <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span>.</p>
<ol start="6" style="list-style-type: decimal">
<li>Write a function <code>compute_CCP_objective(theta_1, theta_2, p_est, L, K, delta)</code> that returns the objective function of the above minimum distance estimator given a non-parametric estimate of the conditional choice probability and <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span>.</li>
</ol>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="applications.html#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_CCP_objective</span>(theta_1, theta_2, p_est, L, K, delta)</span></code></pre></div>
<pre><code>## [1] 5.000511e-06</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Check the value of the objective function around the true parameter.</li>
</ol>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="applications.html#cb371-1" aria-hidden="true" tabindex="-1"></a><span class="co"># label</span></span>
<span id="cb371-2"><a href="applications.html#cb371-2" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">alpha&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">beta&quot;</span>)</span>
<span id="cb371-3"><a href="applications.html#cb371-3" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;$&quot;</span>, label, <span class="st">&quot;$&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb371-4"><a href="applications.html#cb371-4" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the graph</span></span>
<span id="cb371-5"><a href="applications.html#cb371-5" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="fu">foreach</span> (<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(theta_1)) <span class="sc">%do%</span> {</span>
<span id="cb371-6"><a href="applications.html#cb371-6" aria-hidden="true" tabindex="-1"></a>  theta_i <span class="ot">&lt;-</span> theta_1[i]</span>
<span id="cb371-7"><a href="applications.html#cb371-7" aria-hidden="true" tabindex="-1"></a>  theta_i_list <span class="ot">&lt;-</span> theta_i <span class="sc">*</span> <span class="fu">seq</span>(<span class="fl">0.8</span>, <span class="fl">1.2</span>, <span class="at">by =</span> <span class="fl">0.05</span>)</span>
<span id="cb371-8"><a href="applications.html#cb371-8" aria-hidden="true" tabindex="-1"></a>  objective_i <span class="ot">&lt;-</span> </span>
<span id="cb371-9"><a href="applications.html#cb371-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">foreach</span> (<span class="at">j =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(theta_i_list),</span>
<span id="cb371-10"><a href="applications.html#cb371-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">.combine =</span> <span class="st">&quot;rbind&quot;</span>) <span class="sc">%do%</span> {</span>
<span id="cb371-11"><a href="applications.html#cb371-11" aria-hidden="true" tabindex="-1"></a>               theta_ij <span class="ot">&lt;-</span> theta_i_list[j]</span>
<span id="cb371-12"><a href="applications.html#cb371-12" aria-hidden="true" tabindex="-1"></a>               theta_j <span class="ot">&lt;-</span> theta_1</span>
<span id="cb371-13"><a href="applications.html#cb371-13" aria-hidden="true" tabindex="-1"></a>               theta_j[i] <span class="ot">&lt;-</span> theta_ij</span>
<span id="cb371-14"><a href="applications.html#cb371-14" aria-hidden="true" tabindex="-1"></a>               objective_ij <span class="ot">&lt;-</span> </span>
<span id="cb371-15"><a href="applications.html#cb371-15" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">compute_CCP_objective</span>(theta_j, theta_2, p_est, L, K, delta)</span>
<span id="cb371-16"><a href="applications.html#cb371-16" aria-hidden="true" tabindex="-1"></a>               <span class="fu">return</span>(objective_ij)</span>
<span id="cb371-17"><a href="applications.html#cb371-17" aria-hidden="true" tabindex="-1"></a>             }</span>
<span id="cb371-18"><a href="applications.html#cb371-18" aria-hidden="true" tabindex="-1"></a>  df_graph <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> theta_i_list, <span class="at">y =</span> objective_i) </span>
<span id="cb371-19"><a href="applications.html#cb371-19" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_graph, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> </span>
<span id="cb371-20"><a href="applications.html#cb371-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb371-21"><a href="applications.html#cb371-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> theta_i, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb371-22"><a href="applications.html#cb371-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;objective function&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">TeX</span>(label[i]))</span>
<span id="cb371-23"><a href="applications.html#cb371-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(g)</span>
<span id="cb371-24"><a href="applications.html#cb371-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb371-25"><a href="applications.html#cb371-25" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(graph, <span class="at">file =</span> <span class="st">&quot;data/A7_CCP_graph.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="applications.html#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A7_CCP_graph.RData&quot;</span>)</span>
<span id="cb372-2"><a href="applications.html#cb372-2" aria-hidden="true" tabindex="-1"></a>graph</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-211-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-211-2.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Estiamte the parameters by minimizing the objective function. To keep the model to be well-defined, impose an ad hoc lower and upper bounds such that <span class="math inline">\(\alpha \in [0, 1], \beta \in [0, 5]\)</span>.</li>
</ol>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="applications.html#cb375-1" aria-hidden="true" tabindex="-1"></a>lower <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(theta_1))</span>
<span id="cb375-2"><a href="applications.html#cb375-2" aria-hidden="true" tabindex="-1"></a>upper <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb375-3"><a href="applications.html#cb375-3" aria-hidden="true" tabindex="-1"></a>CCP_result <span class="ot">&lt;-</span></span>
<span id="cb375-4"><a href="applications.html#cb375-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">optim</span>(<span class="at">par =</span> theta_1,</span>
<span id="cb375-5"><a href="applications.html#cb375-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">fn =</span> compute_CCP_objective,</span>
<span id="cb375-6"><a href="applications.html#cb375-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">method =</span> <span class="st">&quot;L-BFGS-B&quot;</span>,</span>
<span id="cb375-7"><a href="applications.html#cb375-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> lower,</span>
<span id="cb375-8"><a href="applications.html#cb375-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> upper,</span>
<span id="cb375-9"><a href="applications.html#cb375-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">theta_2 =</span> theta_2_est, </span>
<span id="cb375-10"><a href="applications.html#cb375-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">p_est =</span> p_est, </span>
<span id="cb375-11"><a href="applications.html#cb375-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">L =</span> L, </span>
<span id="cb375-12"><a href="applications.html#cb375-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">K =</span> K, </span>
<span id="cb375-13"><a href="applications.html#cb375-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">delta =</span> delta)</span>
<span id="cb375-14"><a href="applications.html#cb375-14" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(CCP_result, <span class="at">file =</span> <span class="st">&quot;data/A7_CCP_result.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="applications.html#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A7_CCP_result.RData&quot;</span>)</span>
<span id="cb376-2"><a href="applications.html#cb376-2" aria-hidden="true" tabindex="-1"></a>CCP_result</span></code></pre></div>
<pre><code>## $par
## [1] 0.5271684 3.0644600
## 
## $value
## [1] 1.790528e-06
## 
## $counts
## function gradient 
##       11       11 
## 
## $convergence
## [1] 0
## 
## $message
## [1] &quot;CONVERGENCE: REL_REDUCTION_OF_F &lt;= FACTR*EPSMCH&quot;</code></pre>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="applications.html#cb378-1" aria-hidden="true" tabindex="-1"></a>compare <span class="ot">&lt;-</span></span>
<span id="cb378-2"><a href="applications.html#cb378-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb378-3"><a href="applications.html#cb378-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">true =</span> theta_1,</span>
<span id="cb378-4"><a href="applications.html#cb378-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate =</span> CCP_result<span class="sc">$</span>par</span>
<span id="cb378-5"><a href="applications.html#cb378-5" aria-hidden="true" tabindex="-1"></a>  ); compare</span></code></pre></div>
<pre><code>##   true  estimate
## 1  0.5 0.5271684
## 2  3.0 3.0644600</code></pre>

</div>
<div id="simulate-data-7" class="section level2 hasAnchor" number="10.19">
<h2><span class="header-section-number">10.19</span> Simulate data<a href="applications.html#simulate-data-7" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Suppose that there are <span class="math inline">\(m = 1, \cdots, M\)</span> markets and in each market there are <span class="math inline">\(i = 1, \cdots, N\)</span> firms and each firm makes decisions for <span class="math inline">\(t = 1, \cdots, \infty\)</span>. In the following, I suppress the index of market, <span class="math inline">\(m\)</span>. We solve the model under the infinite-horizon assumption, but generate data only for <span class="math inline">\(t = 1, \cdots, T\)</span>. There are <span class="math inline">\(L = 3\)</span> state <span class="math inline">\(\{1, 2, 3\}\)</span> states for each firm. Each firm can choose <span class="math inline">\(K + 1 = 2\)</span> actions <span class="math inline">\(\{0, 1\}\)</span>. Thus, <span class="math inline">\(m_a := (K + 1)^N\)</span> and <span class="math inline">\(m_s = L^N\)</span>. Let <span class="math inline">\(a_i\)</span> and <span class="math inline">\(s_i\)</span> be firm <span class="math inline">\(i\)</span>s action and state and <span class="math inline">\(a\)</span> and <span class="math inline">\(s\)</span> are vectors of individual actions and states.</p>
<p>The mean period payoff to firm <span class="math inline">\(i\)</span> is:
<span class="math display">\[
\pi_i(a, s) := \tilde{\pi}(a_i, s_i, \overline{s}) :=  \alpha \ln s_i - \eta \ln s_i \sum_{j \neq i} \ln s_j - \beta a_i,
\]</span>
where <span class="math inline">\(\alpha, \beta, \eta&gt; 0\)</span>, and <span class="math inline">\(\alpha &gt; \eta\)</span>. The term <span class="math inline">\(\eta\)</span> means that the returns to investment decreases as rivals average state profile improves. The period payoff is:
<span class="math display">\[
\tilde{\pi}(a_i, s_i, \overline{s})+ \epsilon_i(a_i),
\]</span>
and <span class="math inline">\(\epsilon_i(a_i)\)</span> is an i.i.d. type-I extreme random variable that is independent of all the other variables.</p>
<p>At the beginning of each period, the state <span class="math inline">\(s\)</span> is realized and publicly observed. Then choice-specific shocks <span class="math inline">\(\epsilon_i(a_i), a_i = 0, 1\)</span> are realized and privately observed by firm <span class="math inline">\(i = 1, \cdots, N\)</span>. Then each firm simultaneously chooses her action. Then, the game moves to next period.</p>
<p>State transition is independent across firms conditional on individual state and action.</p>
<p>Suppose that <span class="math inline">\(s_i &gt; 1\)</span> and <span class="math inline">\(s_i &lt; L\)</span>. If <span class="math inline">\(a_i = 0\)</span>, the state stays at the same state with probability <span class="math inline">\(1 - \kappa\)</span> and moves down by 1 with probability <span class="math inline">\(\kappa\)</span>. If <span class="math inline">\(a = 1\)</span>, the state moves up by 1 with probability <span class="math inline">\(\gamma\)</span>, moves down by 1 with probability <span class="math inline">\(\kappa\)</span>, and stays at the same with probability <span class="math inline">\(1 - \kappa - \gamma\)</span>.</p>
<p>Suppose that <span class="math inline">\(s_i = 1\)</span>. If <span class="math inline">\(a_i = 0\)</span>, the state stays at the same state with probability 1. If <span class="math inline">\(a_i = 1\)</span>, the state moves up by 1 with probability <span class="math inline">\(\gamma\)</span> and stays at the same with probability <span class="math inline">\(1 - \gamma\)</span>.</p>
<p>Suppose that <span class="math inline">\(s_i = L\)</span>. If <span class="math inline">\(a_i = 0\)</span>, the state stays at the same state with probability <span class="math inline">\(1 - \kappa\)</span> and moves down by 1 with probability <span class="math inline">\(\kappa\)</span>. If <span class="math inline">\(a = 1\)</span>, the state moves down by 1 with probability <span class="math inline">\(\kappa\)</span>, and stays at the same with probability <span class="math inline">\(1 - \kappa\)</span>.</p>
<p>The mean period profit is summarized in <span class="math inline">\(\Pi\)</span> as:</p>
<p><span class="math display">\[
\Pi :=
\begin{pmatrix}
\pi(1, 1)\\
\vdots\\
\pi(m_a, 1)\\
\vdots \\
\pi(1, m_s)\\
\vdots\\
\pi(m_a, m_s)\\
\end{pmatrix}
\]</span></p>
<p>The transition law is summarized in <span class="math inline">\(G\)</span> as:</p>
<p><span class="math display">\[
g(a, s, s&#39;) := \mathbb{P}\{s_{t + 1} = s&#39;|s_t = s, a_t = a\},
\]</span></p>
<p><span class="math display">\[
G :=
\begin{pmatrix}
g(1, 1, 1) &amp; \cdots &amp; g(1, 1, m_s)\\
\vdots &amp; &amp; \vdots \\
g(m_a, 1, 1) &amp; \cdots &amp; g(m_a, 1, m_s)\\
&amp; \vdots &amp; \\
g(1, m_s, 1) &amp; \cdots &amp; g(1, m_s, m_s)\\
\vdots &amp; &amp; \vdots \\
g(m_a, m_s, 1) &amp; \cdots &amp; g(m_a, m_s, m_s)\\
\end{pmatrix}.
\]</span>
The discount factor is denoted by <span class="math inline">\(\delta\)</span>. We simulate data for <span class="math inline">\(M\)</span> markets with <span class="math inline">\(N\)</span> firms for <span class="math inline">\(T\)</span> periods.</p>
<ol style="list-style-type: decimal">
<li>Set constants and parameters as follows:</li>
</ol>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="applications.html#cb380-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb380-2"><a href="applications.html#cb380-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb380-3"><a href="applications.html#cb380-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set constants </span></span>
<span id="cb380-4"><a href="applications.html#cb380-4" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb380-5"><a href="applications.html#cb380-5" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb380-6"><a href="applications.html#cb380-6" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb380-7"><a href="applications.html#cb380-7" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb380-8"><a href="applications.html#cb380-8" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb380-9"><a href="applications.html#cb380-9" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="fl">1e-10</span></span>
<span id="cb380-10"><a href="applications.html#cb380-10" aria-hidden="true" tabindex="-1"></a><span class="co"># set parameters</span></span>
<span id="cb380-11"><a href="applications.html#cb380-11" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb380-12"><a href="applications.html#cb380-12" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb380-13"><a href="applications.html#cb380-13" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb380-14"><a href="applications.html#cb380-14" aria-hidden="true" tabindex="-1"></a>kappa <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb380-15"><a href="applications.html#cb380-15" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb380-16"><a href="applications.html#cb380-16" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="fl">0.95</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Write a function <code>compute_action_state_space(K, L, N)</code> that returns a data frame for action and state space. Returned objects are list of data frame <code>A</code> and <code>S</code>. In <code>A</code>, column <code>k</code> is the index of an action profile, <code>i</code> is the index of a firm, and <code>a</code> is the action of the firm. In <code>S</code>, column <code>l</code> is the index of an state profile, <code>i</code> is the index of a firm, and <code>s</code> is the state of the firm.</li>
</ol>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="applications.html#cb381-1" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">compute_action_state_space</span>(L, K, N)</span>
<span id="cb381-2"><a href="applications.html#cb381-2" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> output<span class="sc">$</span>A</span>
<span id="cb381-3"><a href="applications.html#cb381-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(A)</span></code></pre></div>
<pre><code>## # A tibble: 6  3
##       k     i     a
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1     1     1     0
## 2     1     2     0
## 3     1     3     0
## 4     2     1     1
## 5     2     2     0
## 6     2     3     0</code></pre>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="applications.html#cb383-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(A)</span></code></pre></div>
<pre><code>## # A tibble: 6  3
##       k     i     a
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1     7     1     0
## 2     7     2     1
## 3     7     3     1
## 4     8     1     1
## 5     8     2     1
## 6     8     3     1</code></pre>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="applications.html#cb385-1" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> output<span class="sc">$</span>S</span>
<span id="cb385-2"><a href="applications.html#cb385-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(S)</span></code></pre></div>
<pre><code>## # A tibble: 6  3
##       l     i     s
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1     1     1     1
## 2     1     2     1
## 3     1     3     1
## 4     2     1     2
## 5     2     2     1
## 6     2     3     1</code></pre>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="applications.html#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(S)</span></code></pre></div>
<pre><code>## # A tibble: 6  3
##       l     i     s
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1   124     1     4
## 2   124     2     5
## 3   124     3     5
## 4   125     1     5
## 5   125     2     5
## 6   125     3     5</code></pre>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="applications.html#cb389-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dimension</span></span>
<span id="cb389-2"><a href="applications.html#cb389-2" aria-hidden="true" tabindex="-1"></a>m_a <span class="ot">&lt;-</span> <span class="fu">max</span>(A<span class="sc">$</span>k); m_a</span></code></pre></div>
<pre><code>## [1] 8</code></pre>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="applications.html#cb391-1" aria-hidden="true" tabindex="-1"></a>m_s <span class="ot">&lt;-</span> <span class="fu">max</span>(S<span class="sc">$</span>l); m_s</span></code></pre></div>
<pre><code>## [1] 125</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Write function <code>compute_PI_game(alpha, beta, eta, L, K, N)</code> that returns a list of <span class="math inline">\(\Pi_i\)</span>.</li>
</ol>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="applications.html#cb393-1" aria-hidden="true" tabindex="-1"></a>PI <span class="ot">&lt;-</span> <span class="fu">compute_PI_game</span>(alpha, beta, eta, A, S)</span>
<span id="cb393-2"><a href="applications.html#cb393-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(PI[[N]])</span></code></pre></div>
<pre><code>##      [,1]
## [1,]    0
## [2,]    0
## [3,]    0
## [4,]    0
## [5,]   -2
## [6,]   -2</code></pre>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="applications.html#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(PI[[N]])[<span class="dv">1</span>] <span class="sc">==</span> m_s <span class="sc">*</span> m_a</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Write function <code>compute_G_game(g, A, S)</code> that converts an individual transition probability matrix into a joint transition probability matrix <span class="math inline">\(G\)</span>.</li>
</ol>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="applications.html#cb397-1" aria-hidden="true" tabindex="-1"></a>G_marginal <span class="ot">&lt;-</span> <span class="fu">compute_G</span>(kappa, gamma, L, K)</span>
<span id="cb397-2"><a href="applications.html#cb397-2" aria-hidden="true" tabindex="-1"></a>G <span class="ot">&lt;-</span> <span class="fu">compute_G_game</span>(G_marginal, A, S)</span>
<span id="cb397-3"><a href="applications.html#cb397-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(G)</span></code></pre></div>
<pre><code>##         1    2 3 4 5    6    7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
## [1,] 1.00 0.00 0 0 0 0.00 0.00 0 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
## [2,] 0.40 0.60 0 0 0 0.00 0.00 0 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
## [3,] 0.40 0.00 0 0 0 0.60 0.00 0 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
## [4,] 0.16 0.24 0 0 0 0.24 0.36 0 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
## [5,] 0.40 0.00 0 0 0 0.00 0.00 0 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
## [6,] 0.16 0.24 0 0 0 0.00 0.00 0 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##        26   27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50
## [1,] 0.00 0.00  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
## [2,] 0.00 0.00  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
## [3,] 0.00 0.00  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
## [4,] 0.00 0.00  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
## [5,] 0.60 0.00  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
## [6,] 0.24 0.36  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##      51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77
## [1,]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
## [2,]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
## [3,]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
## [4,]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
## [5,]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
## [6,]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##      78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102
## [1,]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0   0   0   0
## [2,]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0   0   0   0
## [3,]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0   0   0   0
## [4,]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0   0   0   0
## [5,]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0   0   0   0
## [6,]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0   0   0   0
##      103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122
## [1,]   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
## [2,]   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
## [3,]   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
## [4,]   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
## [5,]   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
## [6,]   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0
##      123 124 125
## [1,]   0   0   0
## [2,]   0   0   0
## [3,]   0   0   0
## [4,]   0   0   0
## [5,]   0   0   0
## [6,]   0   0   0</code></pre>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="applications.html#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(G)[<span class="dv">1</span>] <span class="sc">==</span> m_s <span class="sc">*</span> m_a</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="applications.html#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(G)[<span class="dv">2</span>] <span class="sc">==</span> m_s</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>The ex-ante-value function for a firm is written as a function of a conditional choice probability as follows:
<span class="math display">\[
\varphi_i^{(\theta_1, \theta_2)}(p) := [I - \delta \Sigma(p) G]^{-1}[\Sigma(p)\Pi_i + D_i(p)],
\]</span>
where <span class="math inline">\(\theta_1 = (\alpha, \beta, \eta)\)</span> and <span class="math inline">\(\theta_2 = (\kappa, \gamma)\)</span>, <span class="math inline">\(p_i(a_i|s)\)</span> is the probability that firm <span class="math inline">\(i\)</span> choose action <span class="math inline">\(a_i\)</span> when the state profile is <span class="math inline">\(s\)</span>, and:
<span class="math display">\[
p(a|s) = \prod_{i = 1}^N p_i(a_i|s),
\]</span></p>
<p><span class="math display">\[
p(s) =
\begin{pmatrix}
p(1|s) \\
\vdots \\
p(m_a|s)
\end{pmatrix},
\]</span></p>
<p><span class="math display">\[
p =
\begin{pmatrix}
p(1)\\
\vdots\\
p(m_s)
\end{pmatrix},
\]</span></p>
<p><span class="math display">\[
\Sigma(p) =
\begin{pmatrix}
p(1)&#39; &amp; &amp; \\
&amp; \ddots &amp; \\
&amp; &amp; p(L)&#39;
\end{pmatrix}
\]</span></p>
<p>and:</p>
<p><span class="math display">\[
D_i(p) =
\begin{pmatrix}
\sum_{k = 0}^K \mathbb{E}\{\epsilon_i^k|a_i = k, 1\}p_i(a_i = k|1)\\
\vdots\\
\sum_{k = 0}^K \mathbb{E}\{\epsilon_i^k|a_i = k, m_s\}p_i(a_i = k|m_s)
\end{pmatrix}.
\]</span></p>
<ol start="5" style="list-style-type: decimal">
<li>Write a function <code>initialize_p_marginal(A, S)</code> that defines an initial marginal condition choice probability. In the output <code>p_marginal</code>, <code>p</code> is the probability for firm <code>i</code> to take action <code>a</code> conditional on the state profile being <code>l</code>. Next, write a function <code>compute_p_joint(p_marginal, A, S)</code> that computes a corresponding joint conditional choice probability from a marginal conditional choice probability. In the output <code>p_joint</code>, <code>p</code> is the joint probability that firms take action profile <code>k</code> condition on the state profile being <code>l</code>. Finally, write a function <code>compute_p_marginal(p_joint, A, S)</code> that compute a corresponding marginal conditional choice probability from a joint conditional choice probability.</li>
</ol>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="applications.html#cb403-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define a conditional choice probability for each firm</span></span>
<span id="cb403-2"><a href="applications.html#cb403-2" aria-hidden="true" tabindex="-1"></a>p_marginal <span class="ot">&lt;-</span> <span class="fu">initialize_p_marginal</span>(A, S)</span>
<span id="cb403-3"><a href="applications.html#cb403-3" aria-hidden="true" tabindex="-1"></a>p_marginal</span></code></pre></div>
<pre><code>## # A tibble: 750  4
##        i     l     a     p
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1     1     1     0   0.5
##  2     1     1     1   0.5
##  3     1     2     0   0.5
##  4     1     2     1   0.5
##  5     1     3     0   0.5
##  6     1     3     1   0.5
##  7     1     4     0   0.5
##  8     1     4     1   0.5
##  9     1     5     0   0.5
## 10     1     5     1   0.5
## #  with 740 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="applications.html#cb405-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(p_marginal)[<span class="dv">1</span>] <span class="sc">==</span> N <span class="sc">*</span> m_s <span class="sc">*</span> (K <span class="sc">+</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="applications.html#cb407-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute joint conitional choice probability from marginal probability</span></span>
<span id="cb407-2"><a href="applications.html#cb407-2" aria-hidden="true" tabindex="-1"></a>p_joint <span class="ot">&lt;-</span> <span class="fu">compute_p_joint</span>(p_marginal, A, S)</span>
<span id="cb407-3"><a href="applications.html#cb407-3" aria-hidden="true" tabindex="-1"></a>p_joint</span></code></pre></div>
<pre><code>## # A tibble: 1,000  3
##        l     k     p
##    &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1     1     1 0.125
##  2     1     2 0.125
##  3     1     3 0.125
##  4     1     4 0.125
##  5     1     5 0.125
##  6     1     6 0.125
##  7     1     7 0.125
##  8     1     8 0.125
##  9     2     1 0.125
## 10     2     2 0.125
## #  with 990 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="applications.html#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(p_joint)[<span class="dv">1</span>] <span class="sc">==</span> m_s <span class="sc">*</span> m_a</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="applications.html#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute marginal conditional chocie probability from joint probability</span></span>
<span id="cb411-2"><a href="applications.html#cb411-2" aria-hidden="true" tabindex="-1"></a>p_marginal_2 <span class="ot">&lt;-</span> <span class="fu">compute_p_marginal</span>(p_joint, A, S)</span>
<span id="cb411-3"><a href="applications.html#cb411-3" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(<span class="fu">abs</span>(p_marginal <span class="sc">-</span> p_marginal_2))</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Write a function <code>compute_Sigma(p_marginal, A, S)</code> that computes <span class="math inline">\(\Sigma(p)\)</span> given a joint conditional choice probability. Then, write a function <code>compute_D(p_marginal)</code> that returns a list of <span class="math inline">\(D_i(p)\)</span>.</li>
</ol>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="applications.html#cb413-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute Sigma for ex-ante value function calculation</span></span>
<span id="cb413-2"><a href="applications.html#cb413-2" aria-hidden="true" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">compute_Sigma</span>(p_marginal, A, S)</span>
<span id="cb413-3"><a href="applications.html#cb413-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Sigma)</span></code></pre></div>
<pre><code>## 6 x 1000 sparse Matrix of class &quot;dgCMatrix&quot;
##                                                                                   
## [1,] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125 .     .     .     .     .    
## [2,] .     .     .     .     .     .     .     .     0.125 0.125 0.125 0.125 0.125
## [3,] .     .     .     .     .     .     .     .     .     .     .     .     .    
## [4,] .     .     .     .     .     .     .     .     .     .     .     .     .    
## [5,] .     .     .     .     .     .     .     .     .     .     .     .     .    
## [6,] .     .     .     .     .     .     .     .     .     .     .     .     .    
##                                                                                   
## [1,] .     .     .     .     .     .     .     .     .     .     .     .     .    
## [2,] 0.125 0.125 0.125 .     .     .     .     .     .     .     .     .     .    
## [3,] .     .     .     0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125 .     .    
## [4,] .     .     .     .     .     .     .     .     .     .     .     0.125 0.125
## [5,] .     .     .     .     .     .     .     .     .     .     .     .     .    
## [6,] .     .     .     .     .     .     .     .     .     .     .     .     .    
##                                                                              
## [1,] .     .     .     .     .     .     .     .     .     .     .     ......
## [2,] .     .     .     .     .     .     .     .     .     .     .     ......
## [3,] .     .     .     .     .     .     .     .     .     .     .     ......
## [4,] 0.125 0.125 0.125 0.125 0.125 0.125 .     .     .     .     .     ......
## [5,] .     .     .     .     .     .     0.125 0.125 0.125 0.125 0.125 ......
## [6,] .     .     .     .     .     .     .     .     .     .     .     ......
## 
##  .....suppressing 963 columns in show(); maybe adjust &#39;options(max.print= *, width = *)&#39;
##  ..............................</code></pre>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="applications.html#cb415-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(Sigma)[<span class="dv">1</span>] <span class="sc">==</span> m_s</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="applications.html#cb417-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(Sigma)[<span class="dv">2</span>] <span class="sc">==</span> m_s <span class="sc">*</span> m_a</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="applications.html#cb419-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute D for ex-ante value function calculation</span></span>
<span id="cb419-2"><a href="applications.html#cb419-2" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">compute_D</span>(p_marginal)</span>
<span id="cb419-3"><a href="applications.html#cb419-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(D[[N]])</span></code></pre></div>
<pre><code>##          [,1]
## [1,] 1.270363
## [2,] 1.270363
## [3,] 1.270363
## [4,] 1.270363
## [5,] 1.270363
## [6,] 1.270363</code></pre>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="applications.html#cb421-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(D[[N]])[<span class="dv">1</span>] <span class="sc">==</span> m_s</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Write a function <code>compute_exante_value_game(p_marginal, A, S, PI, G, delta)</code> that returns a list of matrices whose <span class="math inline">\(i\)</span>-th element represents the ex-ante value function given a conditional choice probability for firm <span class="math inline">\(i\)</span>.</li>
</ol>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="applications.html#cb423-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute ex-ante value funciton for each firm</span></span>
<span id="cb423-2"><a href="applications.html#cb423-2" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">compute_exante_value_game</span>(p_marginal, A, S, PI, G, delta)</span>
<span id="cb423-3"><a href="applications.html#cb423-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(V[[N]])</span></code></pre></div>
<pre><code>## 6 x 1 Matrix of class &quot;dgeMatrix&quot;
##         [,1]
## l1 10.786330
## l2 10.175982
## l3  9.606812
## l4  9.255459
## l5  9.115332
## l6 10.175982</code></pre>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="applications.html#cb425-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(V[[N]])[<span class="dv">1</span>] <span class="sc">==</span> m_s</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>The optimal conditional choice probability is written as a function of an ex-ante value function and a conditional choice probability of others as follows:
<span class="math display">\[
\Lambda_i^{(\theta_1, \theta_2)}(V_i, p_{-i})(a_i, s) := \frac{\exp\{\sum_{a_{-i}}p_{-i}(a_{-i}|s)[\pi_i(a_i, a_{-i}, s) + \delta \sum_{s&#39;}V_i(s&#39;)g(a_i, a_{-i}, s, s&#39;)]\}}{\sum_{a_i&#39;}\exp\{\sum_{a_{-i}}p_{-i}(a_{-i}|s)[\pi_i(a_i&#39;, a_{-i}, s) + \delta \sum_{s&#39;}V_i(s&#39;)g(a_i&#39;, a_{-i}, s, s&#39;)]\}},
\]</span>
where <span class="math inline">\(V\)</span> is an ex-ante value function.</p>
<ol start="8" style="list-style-type: decimal">
<li>Write a function <code>compute_profile_value_game(V, PI, G, delta, S, A)</code> that returns a data frame that contains information on value function at a state and action profile for each firm. In the output <code>value</code>, <code>i</code> is the index of a firm, <code>l</code> is the index of a state profile, <code>k</code> is the index of an action profile, and <code>value</code> is the value for the firm at the state and action profile.</li>
</ol>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="applications.html#cb427-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute state-action-profile value function</span></span>
<span id="cb427-2"><a href="applications.html#cb427-2" aria-hidden="true" tabindex="-1"></a>value <span class="ot">&lt;-</span> <span class="fu">compute_profile_value_game</span>(V, PI, G, delta, S, A)</span>
<span id="cb427-3"><a href="applications.html#cb427-3" aria-hidden="true" tabindex="-1"></a>value</span></code></pre></div>
<pre><code>## # A tibble: 3,000  4
##        i     l     k value
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1     1     1     1 10.2 
##  2     1     1     2  9.63
##  3     1     1     3  9.90
##  4     1     1     4  9.13
##  5     1     1     5  9.90
##  6     1     1     6  9.13
##  7     1     1     7  9.55
##  8     1     1     8  8.64
##  9     1     2     1 13.0 
## 10     1     2     2 12.1 
## #  with 2,990 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="applications.html#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(value)[<span class="dv">1</span>] <span class="sc">==</span> N <span class="sc">*</span> m_s <span class="sc">*</span> m_a</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<ol start="9" style="list-style-type: decimal">
<li>Write a function <code>compute_choice_value_game(p_marginal, V, PI, G, delta, A, S)</code> that computes a data frame that contains information on a choice-specific value function given an ex-ante value function and a conditional choice probability of others.</li>
</ol>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="applications.html#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute choice-specific value function</span></span>
<span id="cb431-2"><a href="applications.html#cb431-2" aria-hidden="true" tabindex="-1"></a>value <span class="ot">&lt;-</span> <span class="fu">compute_choice_value_game</span>(p_marginal, V, PI, G, delta, A, S)</span>
<span id="cb431-3"><a href="applications.html#cb431-3" aria-hidden="true" tabindex="-1"></a>value</span></code></pre></div>
<pre><code>## # A tibble: 750  4
##        i     l     a value
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1     1     1     0  9.90
##  2     1     1     1  9.13
##  3     1     2     0 12.4 
##  4     1     2     1 11.4 
##  5     1     3     0 14.5 
##  6     1     3     1 13.2 
##  7     1     4     0 16.0 
##  8     1     4     1 14.3 
##  9     1     5     0 16.8 
## 10     1     5     1 14.8 
## #  with 740 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<ol start="10" style="list-style-type: decimal">
<li>Write a function <code>compute_ccp_game(p_marginal, V, PI, G, delta, A, S)</code> that computes a data frame that contains information on a conditional choice probability given an ex-ante value function and a conditional choice probability of others.</li>
</ol>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="applications.html#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute conditional choice probability </span></span>
<span id="cb433-2"><a href="applications.html#cb433-2" aria-hidden="true" tabindex="-1"></a>p_marginal <span class="ot">&lt;-</span> <span class="fu">compute_ccp_game</span>(p_marginal, V, PI, G, delta, A, S)</span>
<span id="cb433-3"><a href="applications.html#cb433-3" aria-hidden="true" tabindex="-1"></a>p_marginal</span></code></pre></div>
<pre><code>## # A tibble: 750  4
##        i     l     a     p
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1     1     1     0 0.683
##  2     1     1     1 0.317
##  3     1     2     0 0.734
##  4     1     2     1 0.266
##  5     1     3     0 0.794
##  6     1     3     1 0.206
##  7     1     4     0 0.840
##  8     1     4     1 0.160
##  9     1     5     0 0.881
## 10     1     5     1 0.119
## #  with 740 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<ol start="11" style="list-style-type: decimal">
<li>Write a function <code>solve_dynamic_game(PI, G, L, K, delta, lambda, A, S)</code> that find the equilibrium conditional choice probability and ex-ante value function by iterating the update of an ex-ante value function and a best-response conditional choice probability. The iteration should stop when <span class="math inline">\(\max_s|V^{(r + 1)}(s) - V^{(r)}(s)| &lt; \lambda\)</span> with <span class="math inline">\(\lambda = 10^{-10}\)</span>. There is no theoretical guarantee for the convergence.</li>
</ol>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="applications.html#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="co"># solve the dynamic game model</span></span>
<span id="cb435-2"><a href="applications.html#cb435-2" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span></span>
<span id="cb435-3"><a href="applications.html#cb435-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">solve_dynamic_game</span>(PI, G, L, K, delta, lambda, A, S)</span>
<span id="cb435-4"><a href="applications.html#cb435-4" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(output, <span class="at">file =</span> <span class="st">&quot;data/A8_equilibrium.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="applications.html#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A8_equilibrium.RData&quot;</span>)</span>
<span id="cb436-2"><a href="applications.html#cb436-2" aria-hidden="true" tabindex="-1"></a>p_marginal <span class="ot">&lt;-</span> output<span class="sc">$</span>p_marginal; <span class="fu">head</span>(p_marginal)</span></code></pre></div>
<pre><code>## # A tibble: 6  4
##       i     l     a     p
##   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
## 1     1     1     0 0.534
## 2     1     1     1 0.466
## 3     1     2     0 0.545
## 4     1     2     1 0.455
## 5     1     3     0 0.629
## 6     1     3     1 0.371</code></pre>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="applications.html#cb438-1" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> output<span class="sc">$</span>V[[N]]; <span class="fu">head</span>(V)</span></code></pre></div>
<pre><code>## 6 x 1 Matrix of class &quot;dgeMatrix&quot;
##        [,1]
## l1 18.98883
## l2 18.51236
## l3 18.08141
## l4 17.77417
## l5 17.59426
## l6 18.51236</code></pre>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="applications.html#cb440-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute joint conitional choice probability</span></span>
<span id="cb440-2"><a href="applications.html#cb440-2" aria-hidden="true" tabindex="-1"></a>p_joint <span class="ot">&lt;-</span> <span class="fu">compute_p_joint</span>(p_marginal, A, S); <span class="fu">head</span>(p_joint)</span></code></pre></div>
<pre><code>## # A tibble: 6  3
##       l     k     p
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
## 1     1     1 0.152
## 2     1     2 0.133
## 3     1     3 0.133
## 4     1     4 0.116
## 5     1     5 0.133
## 6     1     6 0.116</code></pre>
<ol start="12" style="list-style-type: decimal">
<li>Write a function <code>simulate_dynamic_game(p_joint, l, G, N, T, S, A, seed)</code> that simulate the data for a market starting from an initial state for <span class="math inline">\(T\)</span> periods. The function should accept a value of seed and set the seed at the beginning of the procedure inside the function, because the process is stochastic.</li>
</ol>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="applications.html#cb442-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate a dynamic game</span></span>
<span id="cb442-2"><a href="applications.html#cb442-2" aria-hidden="true" tabindex="-1"></a><span class="co"># set initial state profile</span></span>
<span id="cb442-3"><a href="applications.html#cb442-3" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb442-4"><a href="applications.html#cb442-4" aria-hidden="true" tabindex="-1"></a><span class="co"># draw simulation for a firm</span></span>
<span id="cb442-5"><a href="applications.html#cb442-5" aria-hidden="true" tabindex="-1"></a>seed <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb442-6"><a href="applications.html#cb442-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">simulate_dynamic_game</span>(p_joint, l, G, N, T, S, A, seed)</span>
<span id="cb442-7"><a href="applications.html#cb442-7" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 300  6
##        t     i     l     k     s     a
##    &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
##  1     1     1     1     5     1     0
##  2     1     2     1     5     1     0
##  3     1     3     1     5     1     1
##  4     2     1    26     2     1     1
##  5     2     2    26     2     1     0
##  6     2     3    26     2     2     0
##  7     3     1    26     8     1     1
##  8     3     2    26     8     1     1
##  9     3     3    26     8     2     1
## 10     4     1    52     8     2     1
## #  with 290 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<ol start="13" style="list-style-type: decimal">
<li>Write a function <code>simulate_dynamic_decision_across_firms(p_joint, l, G, N, T, M, S, A, seed)</code> that returns simulation data for <span class="math inline">\(N\)</span> firm. For firm <span class="math inline">\(i\)</span>, set the seed at <span class="math inline">\(i\)</span></li>
</ol>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="applications.html#cb444-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate data across markets</span></span>
<span id="cb444-2"><a href="applications.html#cb444-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">simulate_dynamic_decision_across_markets</span>(p_joint, l, G, N, T, M, S, A)</span>
<span id="cb444-3"><a href="applications.html#cb444-3" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(df, <span class="at">file =</span> <span class="st">&quot;data/A8_df.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="applications.html#cb445-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A8_df.RData&quot;</span>)</span>
<span id="cb445-2"><a href="applications.html#cb445-2" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 300,000  7
##        m     t     i     l     k     s     a
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
##  1     1     1     1     1     5     1     0
##  2     1     1     2     1     5     1     0
##  3     1     1     3     1     5     1     1
##  4     1     2     1    26     2     1     1
##  5     1     2     2    26     2     1     0
##  6     1     2     3    26     2     2     0
##  7     1     3     1    26     8     1     1
##  8     1     3     2    26     8     1     1
##  9     1     3     3    26     8     2     1
## 10     1     4     1    52     8     2     1
## #  with 299,990 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="applications.html#cb447-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df)</span></code></pre></div>
<pre><code>##        m                t                i           l                k        
##  Min.   :   1.0   Min.   :  1.00   Min.   :1   Min.   :  1.00   Min.   :1.000  
##  1st Qu.: 250.8   1st Qu.: 25.75   1st Qu.:1   1st Qu.: 43.00   1st Qu.:1.000  
##  Median : 500.5   Median : 50.50   Median :2   Median : 74.00   Median :2.000  
##  Mean   : 500.5   Mean   : 50.50   Mean   :2   Mean   : 71.02   Mean   :2.497  
##  3rd Qu.: 750.2   3rd Qu.: 75.25   3rd Qu.:3   3rd Qu.:100.00   3rd Qu.:4.000  
##  Max.   :1000.0   Max.   :100.00   Max.   :3   Max.   :125.00   Max.   :8.000  
##        s               a         
##  Min.   :1.000   Min.   :0.0000  
##  1st Qu.:2.000   1st Qu.:0.0000  
##  Median :3.000   Median :0.0000  
##  Mean   :3.273   Mean   :0.2141  
##  3rd Qu.:5.000   3rd Qu.:0.0000  
##  Max.   :5.000   Max.   :1.0000</code></pre>
<ol start="14" style="list-style-type: decimal">
<li>Write a function <code>estimate_ccp_marginal_game(df)</code> that returns a non-parametric estimate of the marginal conditional choice probability for each firm in the data. Compare the estimated conditional choice probability and the true conditional choice probability by a bar plot.</li>
</ol>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="applications.html#cb449-1" aria-hidden="true" tabindex="-1"></a><span class="co"># non-parametrically estimate the conditional choice probability</span></span>
<span id="cb449-2"><a href="applications.html#cb449-2" aria-hidden="true" tabindex="-1"></a>p_marginal_est <span class="ot">&lt;-</span> <span class="fu">estimate_ccp_marginal_game</span>(df)</span>
<span id="cb449-3"><a href="applications.html#cb449-3" aria-hidden="true" tabindex="-1"></a>check_ccp <span class="ot">&lt;-</span> p_marginal_est <span class="sc">%&gt;%</span></span>
<span id="cb449-4"><a href="applications.html#cb449-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">estimate =</span> p) <span class="sc">%&gt;%</span></span>
<span id="cb449-5"><a href="applications.html#cb449-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(p_marginal, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;i&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;a&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb449-6"><a href="applications.html#cb449-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">true =</span> p) <span class="sc">%&gt;%</span></span>
<span id="cb449-7"><a href="applications.html#cb449-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(a <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb449-8"><a href="applications.html#cb449-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> check_ccp, <span class="fu">aes</span>(<span class="at">x =</span> true, <span class="at">y =</span> estimate)) <span class="sc">+</span></span>
<span id="cb449-9"><a href="applications.html#cb449-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb449-10"><a href="applications.html#cb449-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Value&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;true&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;estimate&quot;</span>)</span></code></pre></div>
<p><img src="lecture_files/figure-html/unnamed-chunk-230-1.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="15" style="list-style-type: decimal">
<li>Write a function <code>estimate_G_marginal(df)</code> that returns a non-parametric estimate of the marginal transition probability matrix. Compare the estimated transition matrix and the true transition matrix by a bar plot.</li>
</ol>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="applications.html#cb450-1" aria-hidden="true" tabindex="-1"></a><span class="co"># non-parametrically estimate individual transition probability</span></span>
<span id="cb450-2"><a href="applications.html#cb450-2" aria-hidden="true" tabindex="-1"></a>G_marginal_est <span class="ot">&lt;-</span> <span class="fu">estimate_G_marginal</span>(df)</span>
<span id="cb450-3"><a href="applications.html#cb450-3" aria-hidden="true" tabindex="-1"></a>check_G <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">&quot;true&quot;</span>, reshape2<span class="sc">::</span><span class="fu">melt</span>(G_marginal))</span>
<span id="cb450-4"><a href="applications.html#cb450-4" aria-hidden="true" tabindex="-1"></a>check_G_est <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">type =</span> <span class="st">&quot;estimate&quot;</span>, reshape2<span class="sc">::</span><span class="fu">melt</span>(G_marginal_est))</span>
<span id="cb450-5"><a href="applications.html#cb450-5" aria-hidden="true" tabindex="-1"></a>check_G <span class="ot">&lt;-</span> <span class="fu">rbind</span>(check_G, check_G_est)</span>
<span id="cb450-6"><a href="applications.html#cb450-6" aria-hidden="true" tabindex="-1"></a>check_G<span class="sc">$</span>variable <span class="ot">=</span> <span class="fu">paste</span>(check_G<span class="sc">$</span>Var1, check_G<span class="sc">$</span>Var2, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb450-7"><a href="applications.html#cb450-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> check_G, <span class="fu">aes</span>(<span class="at">x =</span> variable, <span class="at">y =</span> value,</span>
<span id="cb450-8"><a href="applications.html#cb450-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fill =</span> type)) <span class="sc">+</span></span>
<span id="cb450-9"><a href="applications.html#cb450-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb450-10"><a href="applications.html#cb450-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Value&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;action/state/state&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;probability&quot;</span>) <span class="sc">+</span></span>
<span id="cb450-11"><a href="applications.html#cb450-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="lecture_files/figure-html/unnamed-chunk-231-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="estimate-parameters-1" class="section level2 hasAnchor" number="10.20">
<h2><span class="header-section-number">10.20</span> Estimate parameters<a href="applications.html#estimate-parameters-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>Vectorize the parameters as follows:</li>
</ol>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="applications.html#cb451-1" aria-hidden="true" tabindex="-1"></a>theta_1 <span class="ot">&lt;-</span> <span class="fu">c</span>(alpha, beta, eta)</span>
<span id="cb451-2"><a href="applications.html#cb451-2" aria-hidden="true" tabindex="-1"></a>theta_2 <span class="ot">&lt;-</span> <span class="fu">c</span>(kappa, gamma)</span>
<span id="cb451-3"><a href="applications.html#cb451-3" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">c</span>(theta_1, theta_2)</span></code></pre></div>
<p>We estimate the parameters by a CCP approach.</p>
<ol style="list-style-type: decimal">
<li>Write a function <code>estimate_theta_2_game(df)</code> that returns the estimates of <span class="math inline">\(\kappa\)</span> and <span class="math inline">\(\gamma\)</span> directly from data by counting relevant events.</li>
</ol>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="applications.html#cb452-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate theta_2</span></span>
<span id="cb452-2"><a href="applications.html#cb452-2" aria-hidden="true" tabindex="-1"></a>theta_2_est <span class="ot">&lt;-</span> <span class="fu">estimate_theta_2_game</span>(df); theta_2_est</span></code></pre></div>
<pre><code>## [1] 0.09929994 0.59579550</code></pre>
<p>The objective function of the minimum distance estimator based on the conditional choice probability approach is:
<span class="math display">\[
\frac{1}{N K m_s} \sum_{i = 1}^N \sum_{l = 1}^{m_s} \sum_{k = 1}^{K}\{\hat{p}_i(a_k|s_l) - p_i^{(\theta_1, \theta_2)}(a_k|s_l)\}^2,
\]</span>
where <span class="math inline">\(\hat{p}_i\)</span> is the non-parametric estimate of the marginal conditional choice probability and <span class="math inline">\(p_i^{(\theta_1, \theta_2)}\)</span> is the marginal conditional choice probability under parameters <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span> given <span class="math inline">\(\hat{p}_i\)</span>. <span class="math inline">\(a_k\)</span> is <span class="math inline">\(k\)</span>-th action for a firm and <span class="math inline">\(s_l\)</span> is <span class="math inline">\(l\)</span>-th state profile.</p>
<ol start="2" style="list-style-type: decimal">
<li>Write a function <code>compute_CCP_objective_game(theta_1, theta_2, p_est, L, K, delta)</code> that returns the objective function of the above minimum distance estimator given a non-parametric estimate of the conditional choice probability and <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span>.</li>
</ol>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="applications.html#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the objective function of the minimum distance estimator based on the CCP approach</span></span>
<span id="cb454-2"><a href="applications.html#cb454-2" aria-hidden="true" tabindex="-1"></a>objective <span class="ot">&lt;-</span> <span class="fu">compute_CCP_objective_game</span>(theta_1, theta_2, p_marginal_est, A, S, delta, lambda)</span>
<span id="cb454-3"><a href="applications.html#cb454-3" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(objective, <span class="at">file =</span> <span class="st">&quot;data/A8_objective.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="applications.html#cb455-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A8_objective.RData&quot;</span>)</span>
<span id="cb455-2"><a href="applications.html#cb455-2" aria-hidden="true" tabindex="-1"></a>objective</span></code></pre></div>
<pre><code>## [1] 0.0003059688</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Check the value of the objective function around the true parameter.</li>
</ol>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="applications.html#cb457-1" aria-hidden="true" tabindex="-1"></a><span class="co"># label</span></span>
<span id="cb457-2"><a href="applications.html#cb457-2" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">alpha&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">beta&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">eta&quot;</span>)</span>
<span id="cb457-3"><a href="applications.html#cb457-3" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;$&quot;</span>, label, <span class="st">&quot;$&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb457-4"><a href="applications.html#cb457-4" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the graph</span></span>
<span id="cb457-5"><a href="applications.html#cb457-5" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="fu">foreach</span> (<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(theta_1)) <span class="sc">%do%</span> {</span>
<span id="cb457-6"><a href="applications.html#cb457-6" aria-hidden="true" tabindex="-1"></a>  theta_i <span class="ot">&lt;-</span> theta_1[i]</span>
<span id="cb457-7"><a href="applications.html#cb457-7" aria-hidden="true" tabindex="-1"></a>  theta_i_list <span class="ot">&lt;-</span> theta_i <span class="sc">*</span> <span class="fu">seq</span>(<span class="fl">0.5</span>, <span class="dv">2</span>, <span class="at">by =</span> <span class="fl">0.2</span>)</span>
<span id="cb457-8"><a href="applications.html#cb457-8" aria-hidden="true" tabindex="-1"></a>  objective_i <span class="ot">&lt;-</span></span>
<span id="cb457-9"><a href="applications.html#cb457-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">foreach</span> (<span class="at">j =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(theta_i_list),</span>
<span id="cb457-10"><a href="applications.html#cb457-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">.combine =</span> <span class="st">&quot;rbind&quot;</span>) <span class="sc">%dopar%</span> {</span>
<span id="cb457-11"><a href="applications.html#cb457-11" aria-hidden="true" tabindex="-1"></a>               theta_ij <span class="ot">&lt;-</span> theta_i_list[j]</span>
<span id="cb457-12"><a href="applications.html#cb457-12" aria-hidden="true" tabindex="-1"></a>               theta_j <span class="ot">&lt;-</span> theta_1</span>
<span id="cb457-13"><a href="applications.html#cb457-13" aria-hidden="true" tabindex="-1"></a>               theta_j[i] <span class="ot">&lt;-</span> theta_ij</span>
<span id="cb457-14"><a href="applications.html#cb457-14" aria-hidden="true" tabindex="-1"></a>               objective_ij <span class="ot">&lt;-</span> </span>
<span id="cb457-15"><a href="applications.html#cb457-15" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">compute_CCP_objective_game</span>(theta_j, theta_2, p_marginal_est, A, S, delta, lambda)</span>
<span id="cb457-16"><a href="applications.html#cb457-16" aria-hidden="true" tabindex="-1"></a>               <span class="fu">return</span>(objective_ij)</span>
<span id="cb457-17"><a href="applications.html#cb457-17" aria-hidden="true" tabindex="-1"></a>             }</span>
<span id="cb457-18"><a href="applications.html#cb457-18" aria-hidden="true" tabindex="-1"></a>  df_graph <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> theta_i_list, <span class="at">y =</span> objective_i)</span>
<span id="cb457-19"><a href="applications.html#cb457-19" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_graph, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb457-20"><a href="applications.html#cb457-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb457-21"><a href="applications.html#cb457-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> theta_i, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb457-22"><a href="applications.html#cb457-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;objective function&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">TeX</span>(label[i]))</span>
<span id="cb457-23"><a href="applications.html#cb457-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(g)</span>
<span id="cb457-24"><a href="applications.html#cb457-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb457-25"><a href="applications.html#cb457-25" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(graph, <span class="at">file =</span> <span class="st">&quot;data/A8_CCP_graph.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="applications.html#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A8_CCP_graph.RData&quot;</span>)</span>
<span id="cb458-2"><a href="applications.html#cb458-2" aria-hidden="true" tabindex="-1"></a>graph</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-237-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-237-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-237-3.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Estimate the parameters by minimizing the objective function. To keep the model to be well-defined, impose an ad hoc lower and upper bounds such that <span class="math inline">\(\alpha \in [0, 1], \beta \in [0, 5], \delta \in [0, 1]\)</span>.</li>
</ol>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="applications.html#cb462-1" aria-hidden="true" tabindex="-1"></a>lower <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(theta_1))</span>
<span id="cb462-2"><a href="applications.html#cb462-2" aria-hidden="true" tabindex="-1"></a>upper <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="fl">0.3</span>)</span>
<span id="cb462-3"><a href="applications.html#cb462-3" aria-hidden="true" tabindex="-1"></a>CCP_result <span class="ot">&lt;-</span></span>
<span id="cb462-4"><a href="applications.html#cb462-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">optim</span>(<span class="at">par =</span> theta_1,</span>
<span id="cb462-5"><a href="applications.html#cb462-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">fn =</span> compute_CCP_objective_game,</span>
<span id="cb462-6"><a href="applications.html#cb462-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">method =</span> <span class="st">&quot;L-BFGS-B&quot;</span>,</span>
<span id="cb462-7"><a href="applications.html#cb462-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> lower,</span>
<span id="cb462-8"><a href="applications.html#cb462-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> upper,</span>
<span id="cb462-9"><a href="applications.html#cb462-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">theta_2 =</span> theta_2_est,</span>
<span id="cb462-10"><a href="applications.html#cb462-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">p_marginal_est =</span> p_marginal_est,</span>
<span id="cb462-11"><a href="applications.html#cb462-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">A =</span> A,</span>
<span id="cb462-12"><a href="applications.html#cb462-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">S =</span> S,</span>
<span id="cb462-13"><a href="applications.html#cb462-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">delta =</span> delta,</span>
<span id="cb462-14"><a href="applications.html#cb462-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">lambda =</span> lambda)</span>
<span id="cb462-15"><a href="applications.html#cb462-15" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(CCP_result, <span class="at">file =</span> <span class="st">&quot;data/A8_CCP_result.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="applications.html#cb463-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A8_CCP_result.RData&quot;</span>)</span>
<span id="cb463-2"><a href="applications.html#cb463-2" aria-hidden="true" tabindex="-1"></a>CCP_result</span></code></pre></div>
<pre><code>## $par
## [1] 0.998164 2.000860 0.300000
## 
## $value
## [1] 0.000303798
## 
## $counts
## function gradient 
##        5        5 
## 
## $convergence
## [1] 0
## 
## $message
## [1] &quot;CONVERGENCE: REL_REDUCTION_OF_F &lt;= FACTR*EPSMCH&quot;</code></pre>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="applications.html#cb465-1" aria-hidden="true" tabindex="-1"></a>compare <span class="ot">&lt;-</span></span>
<span id="cb465-2"><a href="applications.html#cb465-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb465-3"><a href="applications.html#cb465-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">true =</span> theta_1,</span>
<span id="cb465-4"><a href="applications.html#cb465-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate =</span> CCP_result<span class="sc">$</span>par</span>
<span id="cb465-5"><a href="applications.html#cb465-5" aria-hidden="true" tabindex="-1"></a>  ); compare</span></code></pre></div>
<pre><code>##   true estimate
## 1  1.0 0.998164
## 2  2.0 2.000860
## 3  0.3 0.300000</code></pre>

</div>
<div id="simulate-data-8" class="section level2 hasAnchor" number="10.21">
<h2><span class="header-section-number">10.21</span> Simulate data<a href="applications.html#simulate-data-8" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We simulate bid data from a second- and first-price sealed bid auctions.</p>
<p>First, we draw bid data from a second-price sealed bid auctions. Suppose that for each auction <span class="math inline">\(t = 1, \cdots, T\)</span>, there are <span class="math inline">\(i = 2, \cdots, n_t\)</span> potential bidders. At each auction, an auctioneer allocates one item and sets the reserve price at <span class="math inline">\(r_t\)</span>. When the signal for bidder <span class="math inline">\(i\)</span> in auction <span class="math inline">\(t\)</span> is <span class="math inline">\(x_{it}\)</span>, her expected value of the item is <span class="math inline">\(x_{it}\)</span>. A signal <span class="math inline">\(x_{it}\)</span> is drawn from an i.i.d. beta distribution <span class="math inline">\(B(\alpha, \beta)\)</span>. Let <span class="math inline">\(F_X(\cdot; \alpha, \beta)\)</span> be its distribution and <span class="math inline">\(f_X(\cdot; \alpha, \beta)\)</span> be the density. A reserve is set at 0.2. <span class="math inline">\(n_t\)</span> is drawn from a Poisson distribution with mean <span class="math inline">\(\lambda\)</span>. If <span class="math inline">\(n_t = 1\)</span>, replace with <span class="math inline">\(n_t = 2\)</span> to ensure at least two potential bidders. An equilibrium strategy is such that a bidder participates and bids <span class="math inline">\(\beta(x) = x\)</span> if <span class="math inline">\(x \ge r_t\)</span> and does not participate otherwise.</p>
<ol style="list-style-type: decimal">
<li>Set the constants and parameters as follows:</li>
</ol>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="applications.html#cb467-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb467-2"><a href="applications.html#cb467-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb467-3"><a href="applications.html#cb467-3" aria-hidden="true" tabindex="-1"></a><span class="co"># number of auctions</span></span>
<span id="cb467-4"><a href="applications.html#cb467-4" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb467-5"><a href="applications.html#cb467-5" aria-hidden="true" tabindex="-1"></a><span class="co"># parameter of value distribution</span></span>
<span id="cb467-6"><a href="applications.html#cb467-6" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb467-7"><a href="applications.html#cb467-7" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb467-8"><a href="applications.html#cb467-8" aria-hidden="true" tabindex="-1"></a><span class="co"># prameters of number of potential bidders</span></span>
<span id="cb467-9"><a href="applications.html#cb467-9" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="dv">10</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Draw a vector of valuations and reservation prices.</li>
</ol>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="applications.html#cb468-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of bidders</span></span>
<span id="cb468-2"><a href="applications.html#cb468-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">rpois</span>(T, lambda)</span>
<span id="cb468-3"><a href="applications.html#cb468-3" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(N <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">2</span>, N)</span>
<span id="cb468-4"><a href="applications.html#cb468-4" aria-hidden="true" tabindex="-1"></a><span class="co"># draw valuations</span></span>
<span id="cb468-5"><a href="applications.html#cb468-5" aria-hidden="true" tabindex="-1"></a>valuation <span class="ot">&lt;-</span></span>
<span id="cb468-6"><a href="applications.html#cb468-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">foreach</span> (<span class="at">tt =</span> <span class="dv">1</span><span class="sc">:</span>T, <span class="at">.combine =</span> <span class="st">&quot;rbind&quot;</span>) <span class="sc">%do%</span> {</span>
<span id="cb468-7"><a href="applications.html#cb468-7" aria-hidden="true" tabindex="-1"></a>    n_t <span class="ot">&lt;-</span> N[tt]</span>
<span id="cb468-8"><a href="applications.html#cb468-8" aria-hidden="true" tabindex="-1"></a>    header <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">t =</span> tt, <span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span>n_t) </span>
<span id="cb468-9"><a href="applications.html#cb468-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(header)</span>
<span id="cb468-10"><a href="applications.html#cb468-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb468-11"><a href="applications.html#cb468-11" aria-hidden="true" tabindex="-1"></a>valuation <span class="ot">&lt;-</span> valuation <span class="sc">%&gt;%</span></span>
<span id="cb468-12"><a href="applications.html#cb468-12" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb468-13"><a href="applications.html#cb468-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">rbeta</span>(<span class="fu">length</span>(i), alpha, beta))</span>
<span id="cb468-14"><a href="applications.html#cb468-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(valuation, <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-242-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="applications.html#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="co"># draw reserve prices</span></span>
<span id="cb470-2"><a href="applications.html#cb470-2" aria-hidden="true" tabindex="-1"></a>reserve <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb470-3"><a href="applications.html#cb470-3" aria-hidden="true" tabindex="-1"></a>reserve <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">t =</span> <span class="dv">1</span><span class="sc">:</span>T, <span class="at">r =</span> reserve)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Write a function <code>compute_winning_bids_second(valuation, reserve)</code> that returns a winning bid from each second-price auction. It returns nothing for an auction in which no bid was above the reserve price. In the output, <code>t</code> refers to the auction index, <code>m</code> to the number of actual bidders, <code>r</code> to the reserve price, and <code>w</code> to the winning bid.</li>
</ol>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="applications.html#cb471-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute winning bids from second-price auction</span></span>
<span id="cb471-2"><a href="applications.html#cb471-2" aria-hidden="true" tabindex="-1"></a>df_second_w <span class="ot">&lt;-</span></span>
<span id="cb471-3"><a href="applications.html#cb471-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_winning_bids_second</span>(valuation, reserve)</span>
<span id="cb471-4"><a href="applications.html#cb471-4" aria-hidden="true" tabindex="-1"></a>df_second_w</span></code></pre></div>
<pre><code>## # A tibble: 100  5
##        t     n     m     r     w
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1     8     8   0.2 0.637
##  2     2    10    10   0.2 0.647
##  3     3     7     5   0.2 0.484
##  4     4    11     8   0.2 0.804
##  5     5    14    12   0.2 0.920
##  6     6    12    11   0.2 0.942
##  7     7    11     9   0.2 0.810
##  8     8     9     9   0.2 0.724
##  9     9    14    14   0.2 0.880
## 10    10    11     9   0.2 0.677
## #  with 90 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="applications.html#cb473-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_second_w, <span class="fu">aes</span>(<span class="at">x =</span> w)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-243-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Next, we simulate bid data from first-price sealed bid auctions. The setting is the same as the second-price auctions expect for the auction rule. An equilibrium bidding strategy is to participate and bid:
<span class="math display">\[
\beta(x) = x - \frac{\int_{r_t}^x F_X(t)^{N - 1}}{F_X(x)^{N - 1}},
\]</span>
if <span class="math inline">\(x \ge r\)</span> and not to participate otherwise.</p>
<ol start="4" style="list-style-type: decimal">
<li>Write a function <code>bid_first(x, r, alpha, beta, n)</code> that returns the equilibrium bid. To integrate a function, use <code>integrate</code> function in R. It returns 0 if <span class="math inline">\(x &lt; r\)</span>.</li>
</ol>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="applications.html#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute bid from first-price auction</span></span>
<span id="cb475-2"><a href="applications.html#cb475-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> N[<span class="dv">1</span>]</span>
<span id="cb475-3"><a href="applications.html#cb475-3" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> N[<span class="dv">1</span>]</span>
<span id="cb475-4"><a href="applications.html#cb475-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> valuation[<span class="dv">1</span>, <span class="st">&quot;x&quot;</span>] <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>(); x</span></code></pre></div>
<pre><code>## [1] 0.3902289</code></pre>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="applications.html#cb477-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> reserve[<span class="dv">1</span>, <span class="st">&quot;r&quot;</span>] <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>(); r</span></code></pre></div>
<pre><code>## [1] 0.2</code></pre>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="applications.html#cb479-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">bid_first</span>(x, r, alpha, beta, n); b</span></code></pre></div>
<pre><code>## [1] 0.3596662</code></pre>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="applications.html#cb481-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> r<span class="sc">/</span><span class="dv">2</span>; x</span></code></pre></div>
<pre><code>## [1] 0.1</code></pre>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="applications.html#cb483-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">bid_first</span>(x, r, alpha, beta, n); b</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="applications.html#cb485-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">bid_first</span>(<span class="dv">1</span>, r, alpha, beta, n); b</span></code></pre></div>
<pre><code>## [1] 0.7978258</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Write a function <code>compute_bids_first(valuation, reserve, alpha, beta)</code> that returns bids from each first-price auctions. It returns bids below the reserve price.</li>
</ol>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="applications.html#cb487-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute bid data from first-price auctions</span></span>
<span id="cb487-2"><a href="applications.html#cb487-2" aria-hidden="true" tabindex="-1"></a>df_first <span class="ot">&lt;-</span> <span class="fu">compute_bids_first</span>(valuation, reserve, alpha, beta)</span>
<span id="cb487-3"><a href="applications.html#cb487-3" aria-hidden="true" tabindex="-1"></a>df_first</span></code></pre></div>
<pre><code>## # A tibble: 994  7
##        t     i     x     r     n     m     b
##    &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1     1     1 0.390   0.2     8     8 0.360
##  2     1     2 0.410   0.2     8     8 0.378
##  3     1     3 0.422   0.2     8     8 0.388
##  4     1     4 0.637   0.2     8     8 0.577
##  5     1     5 0.450   0.2     8     8 0.413
##  6     1     6 0.359   0.2     8     8 0.332
##  7     1     7 0.837   0.2     8     8 0.731
##  8     1     8 0.440   0.2     8     8 0.404
##  9     2     1 0.449   0.2    10    10 0.420
## 10     2     2 0.472   0.2    10    10 0.441
## #  with 984 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="applications.html#cb489-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_first, <span class="fu">aes</span>(<span class="at">x =</span> b)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-245-1.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>Write a function <code>compute_winning_bids_first(valuation, reserve, alpha, beta)</code> that returns only the winning bids from each first-price auction. It will call <code>compute_bids_first</code> inside the function. It does not return anything when no bidder bids above the reserve price.</li>
</ol>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="applications.html#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute winning bids from first-price auctions</span></span>
<span id="cb491-2"><a href="applications.html#cb491-2" aria-hidden="true" tabindex="-1"></a>df_first_w <span class="ot">&lt;-</span></span>
<span id="cb491-3"><a href="applications.html#cb491-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compute_winning_bids_first</span>(valuation, reserve, alpha, beta)</span>
<span id="cb491-4"><a href="applications.html#cb491-4" aria-hidden="true" tabindex="-1"></a>df_first_w</span></code></pre></div>
<pre><code>## # A tibble: 100  5
##        t     n     m     r     w
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1     8     8   0.2 0.731
##  2     2    10    10   0.2 0.638
##  3     3     7     5   0.2 0.525
##  4     4    11     8   0.2 0.818
##  5     5    14    12   0.2 0.842
##  6     6    12    11   0.2 0.833
##  7     7    11     9   0.2 0.772
##  8     8     9     9   0.2 0.753
##  9     9    14    14   0.2 0.849
## 10    10    11     9   0.2 0.803
## #  with 90 more rows
## #  Use `print(n = ...)` to see more rows</code></pre>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="applications.html#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_first_w, <span class="fu">aes</span>(<span class="at">x =</span> w)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-246-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="estimate-the-parameters-5" class="section level2 hasAnchor" number="10.22">
<h2><span class="header-section-number">10.22</span> Estimate the parameters<a href="applications.html#estimate-the-parameters-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We first estimate the parameters from the winning bids data of second-price auctions. We estimate the parameters by maximizing a log-likelihood.</p>
<p><span class="math display">\[
l(\alpha, \beta) := \frac{1}{T} \sum_{t = 1}^T \ln\frac{h_t(w_t)^{1\{m_t &gt; 1\}} \mathbb{P}\{m_t = 1\}^{1\{m_t = 1\}}}{1 - \mathbb{P}\{m_t = 0\}},
\]</span>
where:
<span class="math display">\[
\mathbb{P}\{m_t = 0\} := F_X(r_t)^{n_t},
\]</span>
<span class="math display">\[
\mathbb{P}\{m_t = 1\} := n_t F_X(r_t; \alpha, \beta)^{n_t - 1} [1 - F_X(r_t; \alpha, \beta)].
\]</span></p>
<p><span class="math display">\[
h_t(w_t) := n_t (n_t - 1) F_X(w_t; \alpha, \beta)^{n_t - 2} [1 - F_X(w_t; \alpha, \beta)] f_X(w_t; \alpha, \beta).
\]</span></p>
<ol style="list-style-type: decimal">
<li>Write a function <code>compute_p_second_w(w, r, m, n, alpha, beta)</code> that computes <span class="math inline">\(\mathbb{P}\{m_t = 1\}\)</span> if <span class="math inline">\(m_t = 1\)</span> and <span class="math inline">\(h_t(w_t)\)</span> if <span class="math inline">\(m_t &gt; 1\)</span>.</li>
</ol>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="applications.html#cb495-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute probability density for winning bids from a second-price auction</span></span>
<span id="cb495-2"><a href="applications.html#cb495-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> df_second_w[<span class="dv">1</span>, ]<span class="sc">$</span>w</span>
<span id="cb495-3"><a href="applications.html#cb495-3" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> df_second_w[<span class="dv">1</span>, ]<span class="sc">$</span>r</span>
<span id="cb495-4"><a href="applications.html#cb495-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> df_second_w[<span class="dv">1</span>, ]<span class="sc">$</span>m</span>
<span id="cb495-5"><a href="applications.html#cb495-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> df_second_w[<span class="dv">1</span>, ]<span class="sc">$</span>n</span>
<span id="cb495-6"><a href="applications.html#cb495-6" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_p_second_w</span>(w, r, m, n, alpha, beta)</span></code></pre></div>
<pre><code>## [1] 2.752949</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Write a function <code>compute_m0(r, n, alpha, beta)</code> that computes <span class="math inline">\(\mathbb{P}\{m_t = 0\}\)</span>.</li>
</ol>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="applications.html#cb497-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute non-participation probability</span></span>
<span id="cb497-2"><a href="applications.html#cb497-2" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_m0</span>(r, n, alpha, beta)</span></code></pre></div>
<pre><code>## [1] 1.368569e-08</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Write a function <code>compute_loglikelihood_second_price_w(theta, df_second_w)</code> that computes the log-likelihood for a second-price auction winning bid data.</li>
</ol>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="applications.html#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute log-likelihood for winning bids from second-price auctions</span></span>
<span id="cb499-2"><a href="applications.html#cb499-2" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">c</span>(alpha, beta)</span>
<span id="cb499-3"><a href="applications.html#cb499-3" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_loglikelihood_second_price_w</span>(theta, df_second_w)</span></code></pre></div>
<pre><code>## [1] 0.9849261</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Compare the value of objective function around the true parameters.</li>
</ol>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="applications.html#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="co"># label</span></span>
<span id="cb501-2"><a href="applications.html#cb501-2" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">alpha&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">beta&quot;</span>)</span>
<span id="cb501-3"><a href="applications.html#cb501-3" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;$&quot;</span>, label, <span class="st">&quot;$&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb501-4"><a href="applications.html#cb501-4" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the graph</span></span>
<span id="cb501-5"><a href="applications.html#cb501-5" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="fu">foreach</span> (<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(theta)) <span class="sc">%do%</span> {</span>
<span id="cb501-6"><a href="applications.html#cb501-6" aria-hidden="true" tabindex="-1"></a>  theta_i <span class="ot">&lt;-</span> theta[i]</span>
<span id="cb501-7"><a href="applications.html#cb501-7" aria-hidden="true" tabindex="-1"></a>  theta_i_list <span class="ot">&lt;-</span> theta_i <span class="sc">*</span> <span class="fu">seq</span>(<span class="fl">0.8</span>, <span class="fl">1.2</span>, <span class="at">by =</span> <span class="fl">0.05</span>)</span>
<span id="cb501-8"><a href="applications.html#cb501-8" aria-hidden="true" tabindex="-1"></a>  objective_i <span class="ot">&lt;-</span></span>
<span id="cb501-9"><a href="applications.html#cb501-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">foreach</span> (<span class="at">j =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(theta_i_list),</span>
<span id="cb501-10"><a href="applications.html#cb501-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">.packages =</span> <span class="fu">c</span>(</span>
<span id="cb501-11"><a href="applications.html#cb501-11" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;EmpiricalIO&quot;</span>,</span>
<span id="cb501-12"><a href="applications.html#cb501-12" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;foreach&quot;</span>,</span>
<span id="cb501-13"><a href="applications.html#cb501-13" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;magrittr&quot;</span></span>
<span id="cb501-14"><a href="applications.html#cb501-14" aria-hidden="true" tabindex="-1"></a>               ),</span>
<span id="cb501-15"><a href="applications.html#cb501-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">.combine =</span> <span class="st">&quot;rbind&quot;</span>) <span class="sc">%dopar%</span> {</span>
<span id="cb501-16"><a href="applications.html#cb501-16" aria-hidden="true" tabindex="-1"></a>               theta_ij <span class="ot">&lt;-</span> theta_i_list[j]</span>
<span id="cb501-17"><a href="applications.html#cb501-17" aria-hidden="true" tabindex="-1"></a>               theta_j <span class="ot">&lt;-</span> theta</span>
<span id="cb501-18"><a href="applications.html#cb501-18" aria-hidden="true" tabindex="-1"></a>               theta_j[i] <span class="ot">&lt;-</span> theta_ij</span>
<span id="cb501-19"><a href="applications.html#cb501-19" aria-hidden="true" tabindex="-1"></a>               objective_ij <span class="ot">&lt;-</span> </span>
<span id="cb501-20"><a href="applications.html#cb501-20" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">compute_loglikelihood_second_price_w</span>(</span>
<span id="cb501-21"><a href="applications.html#cb501-21" aria-hidden="true" tabindex="-1"></a>                   theta_j, df_second_w)</span>
<span id="cb501-22"><a href="applications.html#cb501-22" aria-hidden="true" tabindex="-1"></a>               <span class="fu">return</span>(objective_ij)</span>
<span id="cb501-23"><a href="applications.html#cb501-23" aria-hidden="true" tabindex="-1"></a>             }</span>
<span id="cb501-24"><a href="applications.html#cb501-24" aria-hidden="true" tabindex="-1"></a>  df_graph <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(theta_i_list), </span>
<span id="cb501-25"><a href="applications.html#cb501-25" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> <span class="fu">as.numeric</span>(objective_i))</span>
<span id="cb501-26"><a href="applications.html#cb501-26" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_graph, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb501-27"><a href="applications.html#cb501-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb501-28"><a href="applications.html#cb501-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> theta_i, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb501-29"><a href="applications.html#cb501-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;objective function&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">TeX</span>(label[i]))</span>
<span id="cb501-30"><a href="applications.html#cb501-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(g)</span>
<span id="cb501-31"><a href="applications.html#cb501-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb501-32"><a href="applications.html#cb501-32" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(graph, <span class="at">file =</span> <span class="st">&quot;data/A9_second_parametric_graph.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="applications.html#cb502-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A9_second_parametric_graph.RData&quot;</span>)</span>
<span id="cb502-2"><a href="applications.html#cb502-2" aria-hidden="true" tabindex="-1"></a>graph</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-251-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-251-2.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Estimate the parameters by maximizing the log-likelihood.</li>
</ol>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="applications.html#cb505-1" aria-hidden="true" tabindex="-1"></a>result_second_parametric <span class="ot">&lt;-</span></span>
<span id="cb505-2"><a href="applications.html#cb505-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">optim</span>(</span>
<span id="cb505-3"><a href="applications.html#cb505-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">par =</span> theta,</span>
<span id="cb505-4"><a href="applications.html#cb505-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fn =</span> compute_loglikelihood_second_price_w,</span>
<span id="cb505-5"><a href="applications.html#cb505-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">df_second_w =</span> df_second_w,</span>
<span id="cb505-6"><a href="applications.html#cb505-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;L-BFGS-B&quot;</span>,</span>
<span id="cb505-7"><a href="applications.html#cb505-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">list</span>(<span class="at">fnscale =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb505-8"><a href="applications.html#cb505-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb505-9"><a href="applications.html#cb505-9" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(result_second_parametric, <span class="at">file =</span> <span class="st">&quot;data/A9_result_second_parametric.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="applications.html#cb506-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A9_result_second_parametric.RData&quot;</span>)</span>
<span id="cb506-2"><a href="applications.html#cb506-2" aria-hidden="true" tabindex="-1"></a>result_second_parametric</span></code></pre></div>
<pre><code>## $par
## [1] 2.199238 2.078327
## 
## $value
## [1] 0.9883372
## 
## $counts
## function gradient 
##       11       11 
## 
## $convergence
## [1] 0
## 
## $message
## [1] &quot;CONVERGENCE: REL_REDUCTION_OF_F &lt;= FACTR*EPSMCH&quot;</code></pre>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="applications.html#cb508-1" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span></span>
<span id="cb508-2"><a href="applications.html#cb508-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb508-3"><a href="applications.html#cb508-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">true =</span> theta,</span>
<span id="cb508-4"><a href="applications.html#cb508-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate =</span> result_second_parametric<span class="sc">$</span>par</span>
<span id="cb508-5"><a href="applications.html#cb508-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb508-6"><a href="applications.html#cb508-6" aria-hidden="true" tabindex="-1"></a>comparison</span></code></pre></div>
<pre><code>##   true estimate
## 1    2 2.199238
## 2    2 2.078327</code></pre>
<p>Next, we estimate the parameters from the winning bids data from first-price auctions. We estimate the parameters by maximizing a log-likelihood.</p>
<ol start="5" style="list-style-type: decimal">
<li>Write a function <code>inverse_bid_equation(x, b, r, alpha, beta, n)</code> that returns <span class="math inline">\(\beta(x) - b\)</span> for a bid <span class="math inline">\(b\)</span>. Write a function <code>inverse_bid_first(b, r, alpha, beta, n)</code> that is an inverse function <code>bid_first</code> with respect to the signal, that is,
<span class="math display">\[
\eta(b) := \beta^{-1}(b).
\]</span></li>
</ol>
<p>To do so, we can use a built-in function called <code>uniroot</code>, which solves <span class="math inline">\(x\)</span> such that <span class="math inline">\(f(x) = 0\)</span> for scalar <span class="math inline">\(x\)</span>. In <code>uniroot</code>, <code>lower</code> and <code>upper</code> are set at <span class="math inline">\(r_t\)</span> and <span class="math inline">\(\beta(1)\)</span>, respectively.</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="applications.html#cb510-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> df_first_w[<span class="dv">1</span>, <span class="st">&quot;r&quot;</span>] <span class="sc">%&gt;%</span></span>
<span id="cb510-2"><a href="applications.html#cb510-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>()</span>
<span id="cb510-3"><a href="applications.html#cb510-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> df_first_w[<span class="dv">1</span>, <span class="st">&quot;n&quot;</span>] <span class="sc">%&gt;%</span></span>
<span id="cb510-4"><a href="applications.html#cb510-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.integer</span>()</span>
<span id="cb510-5"><a href="applications.html#cb510-5" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">*</span> r <span class="sc">+</span> <span class="fl">0.5</span> </span>
<span id="cb510-6"><a href="applications.html#cb510-6" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb510-7"><a href="applications.html#cb510-7" aria-hidden="true" tabindex="-1"></a><span class="co"># compute invecrse bid equation</span></span>
<span id="cb510-8"><a href="applications.html#cb510-8" aria-hidden="true" tabindex="-1"></a><span class="fu">inverse_bid_equation</span>(x, b, r, alpha, beta, n)</span></code></pre></div>
<pre><code>## [1] -0.1421105</code></pre>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="applications.html#cb512-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute inverse bid</span></span>
<span id="cb512-2"><a href="applications.html#cb512-2" aria-hidden="true" tabindex="-1"></a><span class="fu">inverse_bid_first</span>(b, r, alpha, beta, n)</span></code></pre></div>
<pre><code>## [1] 0.6653238</code></pre>
<p>The log-likelihood conditional on <span class="math inline">\(m_t \ge 1\)</span> is:
<span class="math display">\[
l(\alpha, \beta) := \frac{1}{T}\sum_{t = 1}^T \log \frac{h_t(w_t)}{1 - F_X(r_t)^{n_t}},
\]</span>
where the probability density of having <span class="math inline">\(w_t\)</span> is:
<span class="math display">\[
\begin{split}
h_t(w_t) &amp;= n_t F_X[\eta_t(w_t)]^{n_t - 1} f_X[\eta_t(w_t)] \eta_t&#39;(w_t)\\
&amp;= \frac{n_t F_X[\eta_t(w_t)]^{n_t}}{(n_t - 1)[\eta_t(w_t) - w_t]},
\end{split}
\]</span>
where the second equation is from the first-order condition.</p>
<ol start="6" style="list-style-type: decimal">
<li>Write a function <code>compute_p_first_w(w, r, alpha, beta, n)</code> that returns <span class="math inline">\(h_t(w)\)</span>. Remark that the equilibrium bid at specific parameters is <code>bid_first(1, r, alpha, beta, n)</code>. If the observed wining bid <code>w</code> is above the upper limit, the function will issue an error. Therefore, inside the function <code>compute_p_first_w(w, r, alpha, beta, n)</code>, check if <code>w</code> is above <code>bid_first(1, r, alpha, beta, n)</code> and if so return <span class="math inline">\(10^{-6}\)</span>.</li>
</ol>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="applications.html#cb514-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute probability density for a winning bid from a first-price auction</span></span>
<span id="cb514-2"><a href="applications.html#cb514-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb514-3"><a href="applications.html#cb514-3" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_p_first_w</span>(w, r, alpha, beta, n)</span></code></pre></div>
<pre><code>## [1] 0.2720049</code></pre>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="applications.html#cb516-1" aria-hidden="true" tabindex="-1"></a>upper <span class="ot">&lt;-</span> <span class="fu">bid_first</span>(<span class="dv">1</span>, r, alpha, beta, n)</span>
<span id="cb516-2"><a href="applications.html#cb516-2" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_p_first_w</span>(upper <span class="sc">+</span> <span class="dv">1</span>, r, alpha, beta, n)</span></code></pre></div>
<pre><code>## [1] 1e-06</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Write a function <code>compute_loglikelihood_first_price_w(theta, df_first_w)</code> that computes the log-likelihood for a first-price auction winning bid data.</li>
</ol>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="applications.html#cb518-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute log-likelihood for winning bids for first-price auctions</span></span>
<span id="cb518-2"><a href="applications.html#cb518-2" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_loglikelihood_first_price_w</span>(theta, df_first_w)</span></code></pre></div>
<pre><code>## [1] 1.597414</code></pre>
<ol start="8" style="list-style-type: decimal">
<li>Compare the value of the objective function around the true parameters.</li>
</ol>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="applications.html#cb520-1" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">c</span>(alpha, beta)</span>
<span id="cb520-2"><a href="applications.html#cb520-2" aria-hidden="true" tabindex="-1"></a><span class="co"># label</span></span>
<span id="cb520-3"><a href="applications.html#cb520-3" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">alpha&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">beta&quot;</span>)</span>
<span id="cb520-4"><a href="applications.html#cb520-4" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;$&quot;</span>, label, <span class="st">&quot;$&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb520-5"><a href="applications.html#cb520-5" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the graph</span></span>
<span id="cb520-6"><a href="applications.html#cb520-6" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="fu">foreach</span> (<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(theta)) <span class="sc">%do%</span> {</span>
<span id="cb520-7"><a href="applications.html#cb520-7" aria-hidden="true" tabindex="-1"></a>  theta_i <span class="ot">&lt;-</span> theta[i]</span>
<span id="cb520-8"><a href="applications.html#cb520-8" aria-hidden="true" tabindex="-1"></a>  theta_i_list <span class="ot">&lt;-</span> theta_i <span class="sc">*</span> <span class="fu">seq</span>(<span class="fl">0.8</span>, <span class="fl">1.2</span>, <span class="at">by =</span> <span class="fl">0.05</span>)</span>
<span id="cb520-9"><a href="applications.html#cb520-9" aria-hidden="true" tabindex="-1"></a>  objective_i <span class="ot">&lt;-</span></span>
<span id="cb520-10"><a href="applications.html#cb520-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">foreach</span> (<span class="at">j =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(theta_i_list),</span>
<span id="cb520-11"><a href="applications.html#cb520-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">.packages =</span> <span class="fu">c</span>(</span>
<span id="cb520-12"><a href="applications.html#cb520-12" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;EmpiricalIO&quot;</span>,</span>
<span id="cb520-13"><a href="applications.html#cb520-13" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;foreach&quot;</span>,</span>
<span id="cb520-14"><a href="applications.html#cb520-14" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;magrittr&quot;</span></span>
<span id="cb520-15"><a href="applications.html#cb520-15" aria-hidden="true" tabindex="-1"></a>               ),</span>
<span id="cb520-16"><a href="applications.html#cb520-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">.combine =</span> <span class="st">&quot;rbind&quot;</span>) <span class="sc">%dopar%</span> {</span>
<span id="cb520-17"><a href="applications.html#cb520-17" aria-hidden="true" tabindex="-1"></a>               theta_ij <span class="ot">&lt;-</span> theta_i_list[j]</span>
<span id="cb520-18"><a href="applications.html#cb520-18" aria-hidden="true" tabindex="-1"></a>               theta_j <span class="ot">&lt;-</span> theta</span>
<span id="cb520-19"><a href="applications.html#cb520-19" aria-hidden="true" tabindex="-1"></a>               theta_j[i] <span class="ot">&lt;-</span> theta_ij</span>
<span id="cb520-20"><a href="applications.html#cb520-20" aria-hidden="true" tabindex="-1"></a>               objective_ij <span class="ot">&lt;-</span> </span>
<span id="cb520-21"><a href="applications.html#cb520-21" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">compute_loglikelihood_first_price_w</span>(</span>
<span id="cb520-22"><a href="applications.html#cb520-22" aria-hidden="true" tabindex="-1"></a>                   theta_j, df_first_w)</span>
<span id="cb520-23"><a href="applications.html#cb520-23" aria-hidden="true" tabindex="-1"></a>               <span class="fu">return</span>(objective_ij)</span>
<span id="cb520-24"><a href="applications.html#cb520-24" aria-hidden="true" tabindex="-1"></a>             }</span>
<span id="cb520-25"><a href="applications.html#cb520-25" aria-hidden="true" tabindex="-1"></a>  df_graph <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(theta_i_list), </span>
<span id="cb520-26"><a href="applications.html#cb520-26" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> <span class="fu">as.numeric</span>(objective_i))</span>
<span id="cb520-27"><a href="applications.html#cb520-27" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_graph, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb520-28"><a href="applications.html#cb520-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb520-29"><a href="applications.html#cb520-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> theta_i, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb520-30"><a href="applications.html#cb520-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;objective function&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">TeX</span>(label[i]))</span>
<span id="cb520-31"><a href="applications.html#cb520-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(g)</span>
<span id="cb520-32"><a href="applications.html#cb520-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb520-33"><a href="applications.html#cb520-33" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(graph, <span class="at">file =</span> <span class="st">&quot;data/A9_first_parametric_graph.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="applications.html#cb521-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A9_first_parametric_graph.RData&quot;</span>)</span>
<span id="cb521-2"><a href="applications.html#cb521-2" aria-hidden="true" tabindex="-1"></a>graph</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-258-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lecture_files/figure-html/unnamed-chunk-258-2.png" width="672" style="display: block; margin: auto;" /></p>
<ol start="9" style="list-style-type: decimal">
<li>Estimate the parameters by maximizing the log-likelihood. Set the lower bounds at zero. Use the Nelder-Mead method. Otherwise the parameter search can go to extreme values because of the discontinuity at the point where the upper limit is below the observed bid.</li>
</ol>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="applications.html#cb524-1" aria-hidden="true" tabindex="-1"></a>result_first_parametric <span class="ot">&lt;-</span></span>
<span id="cb524-2"><a href="applications.html#cb524-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">optim</span>(</span>
<span id="cb524-3"><a href="applications.html#cb524-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">par =</span> theta,</span>
<span id="cb524-4"><a href="applications.html#cb524-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fn =</span> compute_loglikelihood_first_price_w,</span>
<span id="cb524-5"><a href="applications.html#cb524-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">df_first_w =</span> df_first_w,</span>
<span id="cb524-6"><a href="applications.html#cb524-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">&quot;Nelder-Mead&quot;</span>,</span>
<span id="cb524-7"><a href="applications.html#cb524-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">list</span>(<span class="at">fnscale =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb524-8"><a href="applications.html#cb524-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb524-9"><a href="applications.html#cb524-9" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(result_first_parametric, <span class="at">file =</span> <span class="st">&quot;data/A9_result_first_parametric.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="applications.html#cb525-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">&quot;data/A9_result_first_parametric.RData&quot;</span>)</span>
<span id="cb525-2"><a href="applications.html#cb525-2" aria-hidden="true" tabindex="-1"></a>result_first_parametric</span></code></pre></div>
<pre><code>## $par
## [1] 1.977676 2.004715
## 
## $value
## [1] 1.607161
## 
## $counts
## function gradient 
##       91       NA 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="applications.html#cb527-1" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span></span>
<span id="cb527-2"><a href="applications.html#cb527-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb527-3"><a href="applications.html#cb527-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">true =</span> theta,</span>
<span id="cb527-4"><a href="applications.html#cb527-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate =</span> result_first_parametric<span class="sc">$</span>par</span>
<span id="cb527-5"><a href="applications.html#cb527-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb527-6"><a href="applications.html#cb527-6" aria-hidden="true" tabindex="-1"></a>comparison</span></code></pre></div>
<pre><code>##   true estimate
## 1    2 1.977676
## 2    2 2.004715</code></pre>
<p>Finally, we non-parametrically estimate the distribution of the valuation using bid data from first-price auctions <code>df_first</code>.</p>
<ol start="10" style="list-style-type: decimal">
<li>Write a function <code>F_b(b)</code> that returns an empirical cumulative distribution at <code>b</code>. This can be obtained by using a function <code>ecdf</code>.
Also, write a function <code>f_b(b)</code> that returns an empirical probability density at <code>b</code>. This can be obtained by combining functions <code>approxfun</code> and <code>density</code>.</li>
</ol>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="applications.html#cb529-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cumulative distribution</span></span>
<span id="cb529-2"><a href="applications.html#cb529-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_first, <span class="fu">aes</span>(<span class="at">x =</span> b)) <span class="sc">+</span> <span class="fu">stat_ecdf</span>(<span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb529-3"><a href="applications.html#cb529-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;bid&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;cumulative distribution&quot;</span>)</span></code></pre></div>
<p><img src="lecture_files/figure-html/unnamed-chunk-261-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="applications.html#cb530-1" aria-hidden="true" tabindex="-1"></a>F_b <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(df_first<span class="sc">$</span>b)</span>
<span id="cb530-2"><a href="applications.html#cb530-2" aria-hidden="true" tabindex="-1"></a><span class="fu">F_b</span>(<span class="fl">0.4</span>)</span></code></pre></div>
<pre><code>## [1] 0.4104628</code></pre>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="applications.html#cb532-1" aria-hidden="true" tabindex="-1"></a><span class="fu">F_b</span>(<span class="fl">0.6</span>)</span></code></pre></div>
<pre><code>## [1] 0.7173038</code></pre>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="applications.html#cb534-1" aria-hidden="true" tabindex="-1"></a><span class="co"># probability density</span></span>
<span id="cb534-2"><a href="applications.html#cb534-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_first, <span class="fu">aes</span>(<span class="at">x =</span> b)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span>)</span></code></pre></div>
<p><img src="lecture_files/figure-html/unnamed-chunk-261-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="applications.html#cb535-1" aria-hidden="true" tabindex="-1"></a>f_b <span class="ot">&lt;-</span> <span class="fu">approxfun</span>(<span class="fu">density</span>(df_first<span class="sc">$</span>b))</span>
<span id="cb535-2"><a href="applications.html#cb535-2" aria-hidden="true" tabindex="-1"></a><span class="fu">f_b</span>(<span class="fl">0.4</span>)</span></code></pre></div>
<pre><code>## [1] 1.680124</code></pre>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="applications.html#cb537-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f_b</span>(<span class="fl">0.6</span>)</span></code></pre></div>
<pre><code>## [1] 1.469983</code></pre>
<p>The equilibrium distribution and density of the highest rivals bid are:
<span class="math display">\[
H_b(b) := F_b(b)^{n - 1},
\]</span>
<span class="math display">\[
h_b(b) := (n - 1) f_b(b) F_b(b)^{n - 2}.
\]</span></p>
<ol start="11" style="list-style-type: decimal">
<li>Write a function <code>H_b(b, n, F_b)</code> and <code>h_b(b, F_b, f_b)</code> that return the equilibrium distribution and density of the highest rivals bid at point <code>b</code>.</li>
</ol>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="applications.html#cb539-1" aria-hidden="true" tabindex="-1"></a><span class="fu">H_b</span>(<span class="fl">0.4</span>, n, F_b)</span></code></pre></div>
<pre><code>## [1] 0.001962983</code></pre>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="applications.html#cb541-1" aria-hidden="true" tabindex="-1"></a><span class="fu">h_b</span>(<span class="fl">0.4</span>, n, F_b, f_b)</span></code></pre></div>
<pre><code>## [1] 0.05624476</code></pre>
<p>When a bidder bids <span class="math inline">\(b\)</span>, the implied valuation of her is:
<span class="math display">\[
x = b + \frac{H_b(b)}{h_b(b)}.
\]</span></p>
<ol start="12" style="list-style-type: decimal">
<li>Write a function <code>compute_implied_valuation(b, n, r)</code> that returns the implied valuation given a bid. Let it return <span class="math inline">\(x = 0\)</span> if <span class="math inline">\(b &lt; r\)</span>, because we cannot know the value when the bid is below the reserve price.</li>
</ol>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="applications.html#cb543-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> df_first[<span class="dv">1</span>, <span class="st">&quot;r&quot;</span>]</span>
<span id="cb543-2"><a href="applications.html#cb543-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> df_first[<span class="dv">1</span>, <span class="st">&quot;n&quot;</span>]</span>
<span id="cb543-3"><a href="applications.html#cb543-3" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_implied_valuation</span>(<span class="fl">0.4</span>, n, r, F_b, f_b)</span></code></pre></div>
<pre><code>##           n
## 1 0.4349007</code></pre>
<ol start="13" style="list-style-type: decimal">
<li>Obtain the vector of implied valuations from the vector of bids and draw the empirical cumulative distribution. Overlay it with the true empirical cumulative distribution of the valuations.</li>
</ol>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="applications.html#cb545-1" aria-hidden="true" tabindex="-1"></a>valuation_implied <span class="ot">&lt;-</span> df_first <span class="sc">%&gt;%</span></span>
<span id="cb545-2"><a href="applications.html#cb545-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb545-3"><a href="applications.html#cb545-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">compute_implied_valuation</span>(b, n, r, F_b, f_b)) <span class="sc">%&gt;%</span></span>
<span id="cb545-4"><a href="applications.html#cb545-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb545-5"><a href="applications.html#cb545-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(x) <span class="sc">%&gt;%</span></span>
<span id="cb545-6"><a href="applications.html#cb545-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;estimate&quot;</span>)</span>
<span id="cb545-7"><a href="applications.html#cb545-7" aria-hidden="true" tabindex="-1"></a>valuation_true <span class="ot">&lt;-</span> valuation <span class="sc">%&gt;%</span></span>
<span id="cb545-8"><a href="applications.html#cb545-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(x) <span class="sc">%&gt;%</span></span>
<span id="cb545-9"><a href="applications.html#cb545-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;true&quot;</span>)</span>
<span id="cb545-10"><a href="applications.html#cb545-10" aria-hidden="true" tabindex="-1"></a>valuation_plot <span class="ot">&lt;-</span> <span class="fu">rbind</span>(valuation_true, valuation_implied)</span>
<span id="cb545-11"><a href="applications.html#cb545-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(valuation_plot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">color =</span> type)) <span class="sc">+</span> <span class="fu">stat_ecdf</span>()</span></code></pre></div>
<p><img src="lecture_files/figure-html/unnamed-chunk-264-1.png" width="672" style="display: block; margin: auto;" /></p>

</div>
</div>
<h3> References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-acemogluInnovationReallocationGrowth2018" class="csl-entry">
Acemoglu, D., Akcigit, U., Alp, H., Bloom, N., &amp; Kerr, W. (2018). <a href="https://doi.org/10.1257/aer.20130470">Innovation, <span>Reallocation</span>, and <span>Growth</span></a>. <em>American Economic Review</em>, <em>108</em>(11), 34503491.
</div>
<div id="ref-agarwalDemandAnalysisUsing2018" class="csl-entry">
Agarwal, N., &amp; Somaini, P. (2018). <a href="https://doi.org/10.3982/ECTA13615">Demand <span>Analysis Using Strategic Reports</span>: <span>An Application</span> to a <span>School Choice Mechanism</span></a>. <em>Econometrica</em>, <em>86</em>(2), 391444.
</div>
<div id="ref-aizawaAdvertisingRiskSelection2018" class="csl-entry">
Aizawa, N., &amp; Kim, Y. S. (2018). <a href="https://doi.org/10.1257/aer.20151485">Advertising and <span>Risk Selection</span> in <span>Health Insurance Markets</span></a>. <em>American Economic Review</em>, <em>108</em>(3), 828867.
</div>
<div id="ref-chiapporiTestingAsymmetricInformation2000" class="csl-entry">
Chiappori, P.-A., &amp; Salanie, B. (2000). <a href="https://doi.org/10.1086/262111">Testing for <span>Asymmetric Information</span> in <span>Insurance Markets</span></a>. <em>Journal of Political Economy</em>, <em>108</em>(1), 5678.
</div>
<div id="ref-crawfordWelfareEffectsVertical2018" class="csl-entry">
Crawford, G. S., Lee, R. S., Whinston, M. D., &amp; Yurukoglu, A. (2018). <a href="https://doi.org/10.3982/ECTA14031">The <span>Welfare Effects</span> of <span>Vertical Integration</span> in <span>Multichannel Television Markets</span></a>. <em>Econometrica</em>, <em>86</em>(3), 891954.
</div>
<div id="ref-crawfordAsymmetricInformationImperfect2018" class="csl-entry">
Crawford, G. S., Pavanini, N., &amp; Schivardi, F. (2018). <a href="https://doi.org/10.1257/aer.20150487">Asymmetric <span>Information</span> and <span>Imperfect Competition</span> in <span>Lending Markets</span></a>. <em>American Economic Review</em>, <em>108</em>(7), 16591701.
</div>
<div id="ref-crawfordQualityOverprovisionCable2019" class="csl-entry">
Crawford, G. S., Shcherbakov, O., &amp; Shum, M. (2019). <a href="https://doi.org/10.1257/aer.20151182">Quality <span>Overprovision</span> in <span>Cable Television Markets</span></a>. <em>American Economic Review</em>, <em>109</em>(3), 956995.
</div>
<div id="ref-dinersteinConsumerPriceSearch2018" class="csl-entry">
Dinerstein, M., Einav, L., Levin, J., &amp; Sundaresan, N. (2018). <a href="https://doi.org/10.1257/aer.20171218">Consumer <span>Price Search</span> and <span>Platform Design</span> in <span>Internet Commerce</span></a>. <em>American Economic Review</em>, <em>108</em>(7), 18201859.
</div>
<div id="ref-doraszelskiJustStartingOut2018" class="csl-entry">
Doraszelski, Ulrich, Lewis, G., &amp; Pakes, A. (2018). <a href="https://doi.org/10.1257/aer.20160177">Just <span>Starting Out</span>: <span>Learning</span> and <span>Equilibrium</span> in a <span>New Market</span></a>. <em>American Economic Review</em>, <em>108</em>(3), 565615.
</div>
<div id="ref-duboisIdentifyingIndustryMargins2018" class="csl-entry">
Dubois, P., &amp; Lasio, L. (2018). <a href="https://doi.org/10.1257/aer.20140202">Identifying <span>Industry Margins</span> with <span>Price Constraints</span>: <span>Structural Estimation</span> on <span>Pharmaceuticals</span></a>. <em>American Economic Review</em>, <em>108</em>(12), 36853724.
</div>
<div id="ref-einavProviderIncentivesHealthcare2018" class="csl-entry">
Einav, L., Finkelstein, A., &amp; Mahoney, N. (2018). <a href="https://doi.org/10.3982/ECTA15022">Provider <span>Incentives</span> and <span>Healthcare Costs</span>: <span>Evidence From Long</span>-<span>Term Care Hospitals</span></a>. <em>Econometrica</em>, <em>86</em>(6), 21612219.
</div>
<div id="ref-fackTruthTellingPreferenceEstimation2019" class="csl-entry">
Fack, G., Grenet, J., &amp; He, Y. (2019). <a href="https://doi.org/10.1257/aer.20151422">Beyond <span>Truth</span>-<span>Telling</span>: <span>Preference Estimation</span> with <span>Centralized School Choice</span> and <span>College Admissions</span></a>. <em>American Economic Review</em>, <em>109</em>(4), 14861529.
</div>
<div id="ref-hoEquilibriumProviderNetworks2019" class="csl-entry">
Ho, K., &amp; Lee, R. S. (2019). <a href="https://doi.org/10.1257/aer.20171288">Equilibrium <span>Provider Networks</span>: <span>Bargaining</span> and <span>Exclusion</span> in <span>Health Care Markets</span></a>. <em>American Economic Review</em>, <em>109</em>(2), 473522.
</div>
<div id="ref-holmstromFinancialIntermediationLoanable1997" class="csl-entry">
Holmstrom, B., &amp; Tirole, J. (1997). <a href="https://doi.org/10.1162/003355397555316">Financial <span>Intermediation</span>, <span>Loanable Funds</span>, and <span>The Real Sector</span></a>. <em>The Quarterly Journal of Economics</em>, <em>112</em>(3), 663691.
</div>
<div id="ref-hortacsuBidShadingBidder2018" class="csl-entry">
Hortasu, A., Kastl, J., &amp; Zhang, A. (2018). <a href="https://doi.org/10.1257/aer.20160675">Bid <span>Shading</span> and <span>Bidder Surplus</span> in the <span>US Treasury Auction System</span></a>. <em>American Economic Review</em>, <em>108</em>(1), 147169.
</div>
<div id="ref-lesterScreeningAdverseSelection2018" class="csl-entry">
Lester, B., Shourideh, A., Venkateswaran, V., &amp; Zetlin-Jones, A. (2018). <a href="https://doi.org/10.1086/700730">Screening and <span>Adverse Selection</span> in <span>Frictional Markets</span></a>. <em>Journal of Political Economy</em>, <em>127</em>(1), 338377.
</div>
<div id="ref-mahoneyImperfectCompetitionSelection2017" class="csl-entry">
Mahoney, N., &amp; Weyl, E. G. (2017). <a href="https://doi.org/10.1162/REST_a_00661">Imperfect <span>Competition</span> in <span>Selection Markets</span></a>. <em>The Review of Economics and Statistics</em>, <em>99</em>(4), 637651.
</div>
<div id="ref-miraveteMarketPowerLaffer2018" class="csl-entry">
Miravete, E. J., Seim, K., &amp; Thurk, J. (2018). <a href="https://doi.org/10.3982/ECTA12307">Market <span>Power</span> and the <span>Laffer Curve</span></a>. <em>Econometrica</em>, <em>86</em>(5), 16511687.
</div>
<div id="ref-stiglitzCreditRationingMarkets1981" class="csl-entry">
Stiglitz, J. E., &amp; Weiss, A. (1981). Credit <span>Rationing</span> in <span>Markets</span> with <span>Imperfect Information</span>. <em>The American Economic Review</em>, <em>71</em>(3), 393410.
</div>
<div id="ref-trebbiInsurgencySmallWars2019" class="csl-entry">
Trebbi, F., &amp; Weese, E. (2019). <a href="https://doi.org/10.3982/ECTA14436">Insurgency and <span>Small Wars</span>: <span>Estimation</span> of <span>Unobserved Coalition Structures</span></a>. <em>Econometrica</em>, <em>87</em>(2), 463496.
</div>
<div id="ref-wollmannTrucksBailoutsEquilibrium2018" class="csl-entry">
Wollmann, T. G. (2018). <a href="https://doi.org/10.1257/aer.20160863">Trucks without <span>Bailouts</span>: <span>Equilibrium Product Characteristics</span> for <span>Commercial Vehicles</span></a>. <em>American Economic Review</em>, <em>108</em>(6), 13641406.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="auction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rcpp.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["lecture.pdf", "lecture.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
